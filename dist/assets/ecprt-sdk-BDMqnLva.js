var ta={};function Do(r,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(e){if(e!=="default"&&!(e in r)){var n=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(r,e,n.get?n:{enumerable:!0,get:function(){return i[e]}})}})}),Object.freeze(r)}function cr(r,t){(t==null||t>r.length)&&(t=r.length);for(var i=0,e=Array(t);i<t;i++)e[i]=r[i];return e}function Ao(r){if(Array.isArray(r))return r}function Mo(r){if(Array.isArray(r))return cr(r)}function Lo(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function O(r,t,i){return t=vn(t),jo(r,Br()?Reflect.construct(t,i||[],vn(r).constructor):t.apply(r,i))}function P(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function Uo(r,t,i){if(Br())return Reflect.construct.apply(null,arguments);var e=[null];e.push.apply(e,t);var n=new(r.bind.apply(r,e));return i&&ct(n,i.prototype),n}function ia(r,t){for(var i=0;i<t.length;i++){var e=t[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,ts(e.key),e)}}function E(r,t,i){return t&&ia(r.prototype,t),i&&ia(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}function z(r,t){var i=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!i){if(Array.isArray(r)||(i=Fr(r))||t){i&&(r=i);var e=0,n=function(){};return{s:n,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,o=!1;return{s:function(){i=i.call(r)},n:function(){var u=i.next();return s=u.done,u},e:function(u){o=!0,a=u},f:function(){try{s||i.return==null||i.return()}finally{if(o)throw a}}}}function gt(r,t,i){return(t=ts(t))in r?Object.defineProperty(r,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[t]=i,r}function lr(){return lr=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,t,i){var e=Vo(r,t);if(e){var n=Object.getOwnPropertyDescriptor(e,t);return n.get?n.get.call(arguments.length<3?r:i):n.value}},lr.apply(null,arguments)}function vn(r){return vn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vn(r)}function N(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),t&&ct(r,t)}function Jo(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}function Br(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Br=function(){return!!r})()}function Bo(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Fo(r,t){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var e,n,a,s,o=[],u=!0,c=!1;try{if(a=(i=i.call(r)).next,t===0){if(Object(i)!==i)return;u=!1}else for(;!(u=(e=a.call(i)).done)&&(o.push(e.value),o.length!==t);u=!0);}catch(l){c=!0,n=l}finally{try{if(!u&&i.return!=null&&(s=i.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}function _o(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qo(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jo(r,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Lo(r)}function v(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var r,t,i=typeof Symbol=="function"?Symbol:{},e=i.iterator||"@@iterator",n=i.toStringTag||"@@toStringTag";function a(h,p,g,k){var y=p&&p.prototype instanceof o?p:o,T=Object.create(y.prototype);return Pe(T,"_invoke",function(S,w,C){var I,R,L,M=0,H=C||[],U=!1,W={p:0,n:0,v:r,a:Y,f:Y.bind(r,4),d:function(X,G){return I=X,R=0,L=r,W.n=G,s}};function Y(X,G){for(R=X,L=G,t=0;!U&&M&&!K&&t<H.length;t++){var K,$=H[t],he=W.p,Ae=$[2];X>3?(K=Ae===G)&&(L=$[(R=$[4])?5:(R=3,3)],$[4]=$[5]=r):$[0]<=he&&((K=X<2&&he<$[1])?(R=0,W.v=G,W.n=$[1]):he<Ae&&(K=X<3||$[0]>G||G>Ae)&&($[4]=X,$[5]=G,W.n=Ae,R=0))}if(K||X>1)return s;throw U=!0,G}return function(X,G,K){if(M>1)throw TypeError("Generator is already running");for(U&&G===1&&Y(G,K),R=G,L=K;(t=R<2?r:L)||!U;){I||(R?R<3?(R>1&&(W.n=-1),Y(R,L)):W.n=L:W.v=L);try{if(M=2,I){if(R||(X="next"),t=I[X]){if(!(t=t.call(I,L)))throw TypeError("iterator result is not an object");if(!t.done)return t;L=t.value,R<2&&(R=0)}else R===1&&(t=I.return)&&t.call(I),R<2&&(L=TypeError("The iterator does not provide a '"+X+"' method"),R=1);I=r}else if((t=(U=W.n<0)?L:S.call(w,W))!==s)break}catch($){I=r,R=1,L=$}finally{M=1}}return{value:t,done:U}}}(h,g,k),!0),T}var s={};function o(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][e]?t(t([][e]())):(Pe(t={},e,function(){return this}),t),d=c.prototype=o.prototype=Object.create(l);function f(h){return Object.setPrototypeOf?Object.setPrototypeOf(h,c):(h.__proto__=c,Pe(h,n,"GeneratorFunction")),h.prototype=Object.create(d),h}return u.prototype=c,Pe(d,"constructor",c),Pe(c,"constructor",u),u.displayName="GeneratorFunction",Pe(c,n,"GeneratorFunction"),Pe(d),Pe(d,n,"Generator"),Pe(d,e,function(){return this}),Pe(d,"toString",function(){return"[object Generator]"}),(v=function(){return{w:a,m:f}})()}function Pe(r,t,i,e){var n=Object.defineProperty;try{n({},"",{})}catch{n=0}Pe=function(a,s,o,u){if(s)n?n(a,s,{value:o,enumerable:!u,configurable:!u,writable:!u}):a[s]=o;else{let c=function(l,d){Pe(a,l,function(f){return this._invoke(l,d,f)})};c("next",0),c("throw",1),c("return",2)}},Pe(r,t,i,e)}function ra(r){if(r!=null){var t=r[typeof Symbol=="function"&&Symbol.iterator||"@@iterator"],i=0;if(t)return t.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length))return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}}}throw new TypeError(typeof r+" is not iterable")}function ct(r,t){return ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,e){return i.__proto__=e,i},ct(r,t)}function x(r,t){return Ao(r)||Fo(r,t)||Fr(r,t)||_o()}function Vo(r,t){for(;!{}.hasOwnProperty.call(r,t)&&(r=vn(r))!==null;);return r}function Q(r,t,i,e){var n=lr(vn(1&e?r.prototype:r),t,i);return 2&e&&typeof n=="function"?function(a){return n.apply(i,a)}:n}function Oe(r){return Mo(r)||Bo(r)||Fr(r)||qo()}function Go(r,t){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var e=i.call(r,t);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function ts(r){var t=Go(r,"string");return typeof t=="symbol"?t:t+""}function j(r){"@babel/helpers - typeof";return j=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(r)}function Fr(r,t){if(r){if(typeof r=="string")return cr(r,t);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?cr(r,t):void 0}}function lt(r){var t=typeof Map=="function"?new Map:void 0;return lt=function(i){if(i===null||!Jo(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(i))return t.get(i);t.set(i,e)}function e(){return Uo(i,arguments,vn(this).constructor)}return e.prototype=Object.create(i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),ct(e,i)},lt(r)}function oe(r,t){if(!r)throw new Error(t)}var Wo=34028234663852886e22,Ho=-34028234663852886e22,zo=4294967295,Ko=2147483647,Yo=-2147483648;function jt(r){if(typeof r!="number")throw new Error("invalid int 32: "+j(r));if(!Number.isInteger(r)||r>Ko||r<Yo)throw new Error("invalid int 32: "+r)}function dr(r){if(typeof r!="number")throw new Error("invalid uint 32: "+j(r));if(!Number.isInteger(r)||r>zo||r<0)throw new Error("invalid uint 32: "+r)}function is(r){if(typeof r!="number")throw new Error("invalid float 32: "+j(r));if(Number.isFinite(r)&&(r>Wo||r<Ho))throw new Error("invalid float 32: "+r)}var rs=Symbol("@bufbuild/protobuf/enum-type");function Qo(r){var t=r[rs];return oe(t,"missing enum type on enum object"),t}function as(r,t,i,e){r[rs]=ss(t,i.map(function(n){return{no:n.no,name:n.name,localName:r[n.no]}}))}function ss(r,t,i){var e=Object.create(null),n=Object.create(null),a=[],s=z(t),o;try{for(s.s();!(o=s.n()).done;){var u=o.value,c=os(u);a.push(c),e[u.name]=c,n[u.no]=c}}catch(l){s.e(l)}finally{s.f()}return{typeName:r,values:a,findName:function(d){return e[d]},findNumber:function(d){return n[d]}}}function Xo(r,t,i){var e={},n=z(t),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,o=os(s);e[o.localName]=o.no,e[o.no]=o.localName}}catch(u){n.e(u)}finally{n.f()}return as(e,r,t),e}function os(r){return"localName"in r?r:Object.assign(Object.assign({},r),{localName:r.name})}var J=function(){function r(){P(this,r)}return E(r,[{key:"equals",value:function(i){return this.getType().runtime.util.equals(this.getType(),this,i)}},{key:"clone",value:function(){return this.getType().runtime.util.clone(this)}},{key:"fromBinary",value:function(i,e){var n=this.getType(),a=n.runtime.bin,s=a.makeReadOptions(e);return a.readMessage(this,s.readerFactory(i),i.byteLength,s),this}},{key:"fromJson",value:function(i,e){var n=this.getType(),a=n.runtime.json,s=a.makeReadOptions(e);return a.readMessage(n,i,s,this),this}},{key:"fromJsonString",value:function(i,e){var n;try{n=JSON.parse(i)}catch(a){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(a instanceof Error?a.message:String(a)))}return this.fromJson(n,e)}},{key:"toBinary",value:function(i){var e=this.getType(),n=e.runtime.bin,a=n.makeWriteOptions(i),s=a.writerFactory();return n.writeMessage(this,s,a),s.finish()}},{key:"toJson",value:function(i){var e=this.getType(),n=e.runtime.json,a=n.makeWriteOptions(i);return n.writeMessage(this,a)}},{key:"toJsonString",value:function(i){var e,n=this.toJson(i);return JSON.stringify(n,null,(e=i==null?void 0:i.prettySpaces)!==null&&e!==void 0?e:0)}},{key:"toJSON",value:function(){return this.toJson({emitDefaultValues:!0})}},{key:"getType",value:function(){return Object.getPrototypeOf(this).constructor}}])}();function Zo(r,t,i,e){var n,a=(n=e==null?void 0:e.localName)!==null&&n!==void 0?n:t.substring(t.lastIndexOf(".")+1),s=gt({},a,function(o){r.util.initFields(this),r.util.initPartial(o,this)})[a];return Object.setPrototypeOf(s.prototype,new J),Object.assign(s,{runtime:r,typeName:t,fields:r.util.newFieldList(i),fromBinary:function(u,c){return new s().fromBinary(u,c)},fromJson:function(u,c){return new s().fromJson(u,c)},fromJsonString:function(u,c){return new s().fromJsonString(u,c)},equals:function(u,c){return r.util.equals(s,u,c)}}),s}function $o(){for(var r=0,t=0,i=0;i<28;i+=7){var e=this.buf[this.pos++];if(r|=(e&127)<<i,!(e&128))return this.assertBounds(),[r,t]}var n=this.buf[this.pos++];if(r|=(n&15)<<28,t=(n&112)>>4,!(n&128))return this.assertBounds(),[r,t];for(var a=3;a<=31;a+=7){var s=this.buf[this.pos++];if(t|=(s&127)<<a,!(s&128))return this.assertBounds(),[r,t]}throw new Error("invalid varint")}function Qi(r,t,i){for(var e=0;e<28;e=e+7){var n=r>>>e,a=!(!(n>>>7)&&t==0),s=(a?n|128:n)&255;if(i.push(s),!a)return}var o=r>>>28&15|(t&7)<<4,u=!!(t>>3);if(i.push((u?o|128:o)&255),!!u){for(var c=3;c<31;c=c+7){var l=t>>>c,d=!!(l>>>7),f=(d?l|128:l)&255;if(i.push(f),!d)return}i.push(t>>>31&1)}}var Vt=4294967296;function aa(r){var t=r[0]==="-";t&&(r=r.slice(1));var i=1e6,e=0,n=0;function a(s,o){var u=Number(r.slice(s,o));n*=i,e=e*i+u,e>=Vt&&(n=n+(e/Vt|0),e=e%Vt)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),t?cs(e,n):_r(e,n)}function xo(r,t){var i=_r(r,t),e=i.hi&2147483648;e&&(i=cs(i.lo,i.hi));var n=us(i.lo,i.hi);return e?"-"+n:n}function us(r,t){var i=eu(r,t);if(r=i.lo,t=i.hi,t<=2097151)return String(Vt*t+r);var e=r&16777215,n=(r>>>24|t<<8)&16777215,a=t>>16&65535,s=e+n*6777216+a*6710656,o=n+a*8147497,u=a*2,c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(u+=Math.floor(o/c),o%=c),u.toString()+sa(o)+sa(s)}function eu(r,t){return{lo:r>>>0,hi:t>>>0}}function _r(r,t){return{lo:r|0,hi:t|0}}function cs(r,t){return t=~t,r?r=~r+1:t+=1,_r(r,t)}var sa=function(t){var i=String(t);return"0000000".slice(i.length)+i};function oa(r,t){if(r>=0){for(;r>127;)t.push(r&127|128),r=r>>>7;t.push(r)}else{for(var i=0;i<9;i++)t.push(r&127|128),r=r>>7;t.push(1)}}function nu(){var r=this.buf[this.pos++],t=r&127;if(!(r&128))return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<7,!(r&128))return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<14,!(r&128))return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<21,!(r&128))return this.assertBounds(),t;r=this.buf[this.pos++],t|=(r&15)<<28;for(var i=5;r&128&&i<10;i++)r=this.buf[this.pos++];if(r&128)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function tu(){var r=new DataView(new ArrayBuffer(8)),t=typeof BigInt=="function"&&typeof r.getBigInt64=="function"&&typeof r.getBigUint64=="function"&&typeof r.setBigInt64=="function"&&typeof r.setBigUint64=="function"&&((typeof process>"u"?"undefined":j(process))!="object"||j(ta)!="object"||ta.BUF_BIGINT_DISABLE!=="1");if(t){var i=BigInt("-9223372036854775808"),e=BigInt("9223372036854775807"),n=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse:function(c){var l=typeof c=="bigint"?c:BigInt(c);if(l>e||l<i)throw new Error("int64 invalid: ".concat(c));return l},uParse:function(c){var l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<n)throw new Error("uint64 invalid: ".concat(c));return l},enc:function(c){return r.setBigInt64(0,this.parse(c),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},uEnc:function(c){return r.setBigInt64(0,this.uParse(c),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},dec:function(c,l){return r.setInt32(0,c,!0),r.setInt32(4,l,!0),r.getBigInt64(0,!0)},uDec:function(c,l){return r.setInt32(0,c,!0),r.setInt32(4,l,!0),r.getBigUint64(0,!0)}}}var s=function(c){return oe(/^-?[0-9]+$/.test(c),"int64 invalid: ".concat(c))},o=function(c){return oe(/^[0-9]+$/.test(c),"uint64 invalid: ".concat(c))};return{zero:"0",supported:!1,parse:function(c){return typeof c!="string"&&(c=c.toString()),s(c),c},uParse:function(c){return typeof c!="string"&&(c=c.toString()),o(c),c},enc:function(c){return typeof c!="string"&&(c=c.toString()),s(c),aa(c)},uEnc:function(c){return typeof c!="string"&&(c=c.toString()),o(c),aa(c)},dec:function(c,l){return xo(c,l)},uDec:function(c,l){return us(c,l)}}}var V=tu(),D;(function(r){r[r.DOUBLE=1]="DOUBLE",r[r.FLOAT=2]="FLOAT",r[r.INT64=3]="INT64",r[r.UINT64=4]="UINT64",r[r.INT32=5]="INT32",r[r.FIXED64=6]="FIXED64",r[r.FIXED32=7]="FIXED32",r[r.BOOL=8]="BOOL",r[r.STRING=9]="STRING",r[r.BYTES=12]="BYTES",r[r.UINT32=13]="UINT32",r[r.SFIXED32=15]="SFIXED32",r[r.SFIXED64=16]="SFIXED64",r[r.SINT32=17]="SINT32",r[r.SINT64=18]="SINT64"})(D||(D={}));var on;(function(r){r[r.BIGINT=0]="BIGINT",r[r.STRING=1]="STRING"})(on||(on={}));function tn(r,t,i){if(t===i)return!0;if(r==D.BYTES){if(!(t instanceof Uint8Array)||!(i instanceof Uint8Array)||t.length!==i.length)return!1;for(var e=0;e<t.length;e++)if(t[e]!==i[e])return!1;return!0}switch(r){case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return t==i}return!1}function Ln(r,t){switch(r){case D.BOOL:return!1;case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return t==0?V.zero:"0";case D.DOUBLE:case D.FLOAT:return 0;case D.BYTES:return new Uint8Array(0);case D.STRING:return"";default:return 0}}function ls(r,t){switch(r){case D.BOOL:return t===!1;case D.STRING:return t==="";case D.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var ce;(function(r){r[r.Varint=0]="Varint",r[r.Bit64=1]="Bit64",r[r.LengthDelimited=2]="LengthDelimited",r[r.StartGroup=3]="StartGroup",r[r.EndGroup=4]="EndGroup",r[r.Bit32=5]="Bit32"})(ce||(ce={}));var iu=function(){function r(t){P(this,r),this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}return E(r,[{key:"finish",value:function(){this.chunks.push(new Uint8Array(this.buf));for(var i=0,e=0;e<this.chunks.length;e++)i+=this.chunks[e].length;for(var n=new Uint8Array(i),a=0,s=0;s<this.chunks.length;s++)n.set(this.chunks[s],a),a+=this.chunks[s].length;return this.chunks=[],n}},{key:"fork",value:function(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}},{key:"join",value:function(){var i=this.finish(),e=this.stack.pop();if(!e)throw new Error("invalid state, fork stack empty");return this.chunks=e.chunks,this.buf=e.buf,this.uint32(i.byteLength),this.raw(i)}},{key:"tag",value:function(i,e){return this.uint32((i<<3|e)>>>0)}},{key:"raw",value:function(i){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(i),this}},{key:"uint32",value:function(i){for(dr(i);i>127;)this.buf.push(i&127|128),i=i>>>7;return this.buf.push(i),this}},{key:"int32",value:function(i){return jt(i),oa(i,this.buf),this}},{key:"bool",value:function(i){return this.buf.push(i?1:0),this}},{key:"bytes",value:function(i){return this.uint32(i.byteLength),this.raw(i)}},{key:"string",value:function(i){var e=this.textEncoder.encode(i);return this.uint32(e.byteLength),this.raw(e)}},{key:"float",value:function(i){is(i);var e=new Uint8Array(4);return new DataView(e.buffer).setFloat32(0,i,!0),this.raw(e)}},{key:"double",value:function(i){var e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,i,!0),this.raw(e)}},{key:"fixed32",value:function(i){dr(i);var e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,i,!0),this.raw(e)}},{key:"sfixed32",value:function(i){jt(i);var e=new Uint8Array(4);return new DataView(e.buffer).setInt32(0,i,!0),this.raw(e)}},{key:"sint32",value:function(i){return jt(i),i=(i<<1^i>>31)>>>0,oa(i,this.buf),this}},{key:"sfixed64",value:function(i){var e=new Uint8Array(8),n=new DataView(e.buffer),a=V.enc(i);return n.setInt32(0,a.lo,!0),n.setInt32(4,a.hi,!0),this.raw(e)}},{key:"fixed64",value:function(i){var e=new Uint8Array(8),n=new DataView(e.buffer),a=V.uEnc(i);return n.setInt32(0,a.lo,!0),n.setInt32(4,a.hi,!0),this.raw(e)}},{key:"int64",value:function(i){var e=V.enc(i);return Qi(e.lo,e.hi,this.buf),this}},{key:"sint64",value:function(i){var e=V.enc(i),n=e.hi>>31,a=e.lo<<1^n,s=(e.hi<<1|e.lo>>>31)^n;return Qi(a,s,this.buf),this}},{key:"uint64",value:function(i){var e=V.uEnc(i);return Qi(e.lo,e.hi,this.buf),this}}])}(),ru=function(){function r(t,i){P(this,r),this.varint64=$o,this.uint32=nu,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=i??new TextDecoder}return E(r,[{key:"tag",value:function(){var i=this.uint32(),e=i>>>3,n=i&7;if(e<=0||n<0||n>5)throw new Error("illegal tag: field no "+e+" wire type "+n);return[e,n]}},{key:"skip",value:function(i,e){var n=this.pos;switch(i){case ce.Varint:for(;this.buf[this.pos++]&128;);break;case ce.Bit64:this.pos+=4;case ce.Bit32:this.pos+=4;break;case ce.LengthDelimited:var a=this.uint32();this.pos+=a;break;case ce.StartGroup:for(;;){var s=this.tag(),o=x(s,2),u=o[0],c=o[1];if(c===ce.EndGroup){if(e!==void 0&&u!==e)throw new Error("invalid end group tag");break}this.skip(c,u)}break;default:throw new Error("cant skip wire type "+i)}return this.assertBounds(),this.buf.subarray(n,this.pos)}},{key:"assertBounds",value:function(){if(this.pos>this.len)throw new RangeError("premature EOF")}},{key:"int32",value:function(){return this.uint32()|0}},{key:"sint32",value:function(){var i=this.uint32();return i>>>1^-(i&1)}},{key:"int64",value:function(){return V.dec.apply(V,Oe(this.varint64()))}},{key:"uint64",value:function(){return V.uDec.apply(V,Oe(this.varint64()))}},{key:"sint64",value:function(){var i=this.varint64(),e=x(i,2),n=e[0],a=e[1],s=-(n&1);return n=(n>>>1|(a&1)<<31)^s,a=a>>>1^s,V.dec(n,a)}},{key:"bool",value:function(){var i=this.varint64(),e=x(i,2),n=e[0],a=e[1];return n!==0||a!==0}},{key:"fixed32",value:function(){return this.view.getUint32((this.pos+=4)-4,!0)}},{key:"sfixed32",value:function(){return this.view.getInt32((this.pos+=4)-4,!0)}},{key:"fixed64",value:function(){return V.uDec(this.sfixed32(),this.sfixed32())}},{key:"sfixed64",value:function(){return V.dec(this.sfixed32(),this.sfixed32())}},{key:"float",value:function(){return this.view.getFloat32((this.pos+=4)-4,!0)}},{key:"double",value:function(){return this.view.getFloat64((this.pos+=8)-8,!0)}},{key:"bytes",value:function(){var i=this.uint32(),e=this.pos;return this.pos+=i,this.assertBounds(),this.buf.subarray(e,e+i)}},{key:"string",value:function(){return this.textDecoder.decode(this.bytes())}}])}();function au(r,t,i,e){var n;return{typeName:t,extendee:i,get field(){if(!n){var a=typeof e=="function"?e():e;a.name=t.split(".").pop(),a.jsonName="[".concat(t,"]"),n=r.util.newFieldList([a]).list()[0]}return n},runtime:r}}function ds(r){var t=r.field.localName,i=Object.create(null);return i[t]=su(r),[i,function(){return i[t]}]}function su(r){var t=r.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return Ln(t.T,t.L);case"message":var i=t.T,e=new i;return i.fieldWrapper?i.fieldWrapper.unwrapField(e):e;case"map":throw"map fields are not allowed to be extensions"}}function ou(r,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(var i=r.length-1;i>=0;--i)if(r[i].no==t.no)return[r[i]];return[]}return r.filter(function(e){return e.no===t.no})}var Ye="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),si=[];for(var Ft=0;Ft<Ye.length;Ft++)si[Ye[Ft].charCodeAt(0)]=Ft;si[45]=Ye.indexOf("+");si[95]=Ye.indexOf("/");var fs={dec:function(t){var i=t.length*3/4;t[t.length-2]=="="?i-=2:t[t.length-1]=="="&&(i-=1);for(var e=new Uint8Array(i),n=0,a=0,s,o=0,u=0;u<t.length;u++){if(s=si[t.charCodeAt(u)],s===void 0)switch(t[u]){case"=":a=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:o=s,a=1;break;case 1:e[n++]=o<<2|(s&48)>>4,o=s,a=2;break;case 2:e[n++]=(o&15)<<4|(s&60)>>2,o=s,a=3;break;case 3:e[n++]=(o&3)<<6|s,a=0;break}}if(a==1)throw Error("invalid base64 string.");return e.subarray(0,n)},enc:function(t){for(var i="",e=0,n,a=0,s=0;s<t.length;s++)switch(n=t[s],e){case 0:i+=Ye[n>>2],a=(n&3)<<4,e=1;break;case 1:i+=Ye[a|n>>4],a=(n&15)<<2,e=2;break;case 2:i+=Ye[a|n>>6],i+=Ye[n&63],e=0;break}return e&&(i+=Ye[a],i+="=",e==1&&(i+="=")),i}};function uu(r,t,i){ms(t,r);var e=t.runtime.bin.makeReadOptions(i),n=ou(r.getType().runtime.bin.listUnknownFields(r),t.field),a=ds(t),s=x(a,2),o=s[0],u=s[1],c=z(n),l;try{for(c.s();!(l=c.n()).done;){var d=l.value;t.runtime.bin.readField(o,e.readerFactory(d.data),t.field,d.wireType,e)}}catch(f){c.e(f)}finally{c.f()}return u()}function cu(r,t,i,e){ms(t,r);var n=t.runtime.bin.makeReadOptions(e),a=t.runtime.bin.makeWriteOptions(e);if(hs(r,t)){var s=r.getType().runtime.bin.listUnknownFields(r).filter(function(T){return T.no!=t.field.no});r.getType().runtime.bin.discardUnknownFields(r);var o=z(s),u;try{for(o.s();!(u=o.n()).done;){var c=u.value;r.getType().runtime.bin.onUnknownField(r,c.no,c.wireType,c.data)}}catch(T){o.e(T)}finally{o.f()}}var l=a.writerFactory(),d=t.field;!d.opt&&!d.repeated&&(d.kind=="enum"||d.kind=="scalar")&&(d=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(d,i,l,a);for(var f=n.readerFactory(l.finish());f.pos<f.len;){var h=f.tag(),p=x(h,2),g=p[0],k=p[1],y=f.skip(k,g);r.getType().runtime.bin.onUnknownField(r,g,k,y)}}function hs(r,t){var i=r.getType();return t.extendee.typeName===i.typeName&&!!i.runtime.bin.listUnknownFields(r).find(function(e){return e.no==t.field.no})}function ms(r,t){oe(r.extendee.typeName==t.getType().typeName,"extension ".concat(r.typeName," can only be applied to message ").concat(r.extendee.typeName))}function vs(r,t){var i=r.localName;if(r.repeated)return t[i].length>0;if(r.oneof)return t[r.oneof.localName].case===i;switch(r.kind){case"enum":case"scalar":return r.opt||r.req?t[i]!==void 0:r.kind=="enum"?t[i]!==r.T.values[0].no:!ls(r.T,t[i]);case"message":return t[i]!==void 0;case"map":return Object.keys(t[i]).length>0}}function ua(r,t){var i=r.localName,e=!r.opt&&!r.req;if(r.repeated)t[i]=[];else if(r.oneof)t[r.oneof.localName]={case:void 0};else switch(r.kind){case"map":t[i]={};break;case"enum":t[i]=e?r.T.values[0].no:void 0;break;case"scalar":t[i]=e?Ln(r.T,r.L):void 0;break;case"message":t[i]=void 0;break}}function Qe(r,t){if(r===null||j(r)!="object"||!Object.getOwnPropertyNames(J.prototype).every(function(e){return e in r&&typeof r[e]=="function"}))return!1;var i=r.getType();return i===null||typeof i!="function"||!("typeName"in i)||typeof i.typeName!="string"?!1:t===void 0?!0:i.typeName==t.typeName}function ps(r,t){return Qe(t)||!r.fieldWrapper?t:r.fieldWrapper.wrapField(t)}D.DOUBLE,D.FLOAT,D.INT64,D.UINT64,D.INT32,D.UINT32,D.BOOL,D.STRING,D.BYTES;var ca={ignoreUnknownFields:!1},la={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function lu(r){return r?Object.assign(Object.assign({},ca),r):ca}function du(r){return r?Object.assign(Object.assign({},la),r):la}var ei=Symbol(),Gt=Symbol();function fu(){return{makeReadOptions:lu,makeWriteOptions:du,readMessage:function(t,i,e,n){if(i==null||Array.isArray(i)||j(i)!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(qe(i)));n=n??new t;for(var a=new Map,s=e.typeRegistry,o=0,u=Object.entries(i);o<u.length;o++){var c=x(u[o],2),l=c[0],d=c[1],f=t.fields.findJsonName(l);if(f){if(f.oneof){if(d===null&&f.kind=="scalar")continue;var h=a.get(f.oneof);if(h!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(f.oneof.name,'" present: "').concat(h,'", "').concat(l,'"'));a.set(f.oneof,l)}da(n,d,f,e,t)}else{var p=!1;if(s!=null&&s.findExtension&&l.startsWith("[")&&l.endsWith("]")){var g=s.findExtension(l.substring(1,l.length-1));if(g&&g.extendee.typeName==t.typeName){p=!0;var k=ds(g),y=x(k,2),T=y[0],S=y[1];da(T,d,g.field,e,g),cu(n,g,S(),e)}}if(!p&&!e.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(l,'" is unknown'))}}return n},writeMessage:function(t,i){var e=t.getType(),n={},a;try{var s=z(e.fields.byNumber()),o;try{for(s.s();!(o=s.n()).done;){if(a=o.value,!vs(a,t)){if(a.req)throw"required field not set";if(!i.emitDefaultValues||!mu(a))continue}var u=a.oneof?t[a.oneof.localName].value:t[a.localName],c=fa(a,u,i);c!==void 0&&(n[i.useProtoFieldName?a.name:a.jsonName]=c)}}catch(S){s.e(S)}finally{s.f()}var l=i.typeRegistry;if(l!=null&&l.findExtensionFor){var d=z(e.runtime.bin.listUnknownFields(t)),f;try{for(d.s();!(f=d.n()).done;){var h=f.value,p=l.findExtensionFor(e.typeName,h.no);if(p&&hs(t,p)){var g=uu(t,p,i),k=fa(p.field,g,i);k!==void 0&&(n[p.field.jsonName]=k)}}}catch(S){d.e(S)}finally{d.f()}}}catch(S){var y=a?"cannot encode field ".concat(e.typeName,".").concat(a.name," to JSON"):"cannot encode message ".concat(e.typeName," to JSON"),T=S instanceof Error?S.message:String(S);throw new Error(y+(T.length>0?": ".concat(T):""))}return n},readScalar:function(t,i,e){return it(t,i,e??on.BIGINT,!0)},writeScalar:function(t,i,e){if(i!==void 0&&(e||ls(t,i)))return Wt(t,i)},debug:qe}}function qe(r){if(r===null)return"null";switch(j(r)){case"object":return Array.isArray(r)?"array":"object";case"string":return r.length>100?"string":'"'.concat(r.split('"').join('\\"'),'"');default:return String(r)}}function da(r,t,i,e,n){var a=i.localName;if(i.repeated){if(oe(i.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(qe(t)));var s=r[a],o=z(t),u;try{for(o.s();!(u=o.n()).done;){var c=u.value;if(c===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(qe(c)));switch(i.kind){case"message":s.push(i.T.fromJson(c,e));break;case"enum":var l=Xi(i.T,c,e.ignoreUnknownFields,!0);l!==Gt&&s.push(l);break;case"scalar":try{s.push(it(i.T,c,i.L,!0))}catch(U){var d="cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(qe(c));throw U instanceof Error&&U.message.length>0&&(d+=": ".concat(U.message)),new Error(d)}break}}}catch(U){o.e(U)}finally{o.f()}}else if(i.kind=="map"){if(t===null)return;if(j(t)!="object"||Array.isArray(t))throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(qe(t)));for(var f=r[a],h=0,p=Object.entries(t);h<p.length;h++){var g=x(p[h],2),k=g[0],y=g[1];if(y===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: map value null"));var T=void 0;try{T=hu(i.K,k)}catch(U){var S="cannot decode map key for field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(qe(t));throw U instanceof Error&&U.message.length>0&&(S+=": ".concat(U.message)),new Error(S)}switch(i.V.kind){case"message":f[T]=i.V.T.fromJson(y,e);break;case"enum":var w=Xi(i.V.T,y,e.ignoreUnknownFields,!0);w!==Gt&&(f[T]=w);break;case"scalar":try{f[T]=it(i.V.T,y,on.BIGINT,!0)}catch(U){var C="cannot decode map value for field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(qe(t));throw U instanceof Error&&U.message.length>0&&(C+=": ".concat(U.message)),new Error(C)}break}}}else switch(i.oneof&&(r=r[i.oneof.localName]={case:a},a="value"),i.kind){case"message":var I=i.T;if(t===null&&I.typeName!="google.protobuf.Value")return;var R=r[a];Qe(R)?R.fromJson(t,e):(r[a]=R=I.fromJson(t,e),I.fieldWrapper&&!i.oneof&&(r[a]=I.fieldWrapper.unwrapField(R)));break;case"enum":var L=Xi(i.T,t,e.ignoreUnknownFields,!1);switch(L){case ei:ua(i,r);break;case Gt:break;default:r[a]=L;break}break;case"scalar":try{var M=it(i.T,t,i.L,!1);switch(M){case ei:ua(i,r);break;default:r[a]=M;break}}catch(U){var H="cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(qe(t));throw U instanceof Error&&U.message.length>0&&(H+=": ".concat(U.message)),new Error(H)}break}}function hu(r,t){if(r===D.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return it(r,t,on.BIGINT,!0).toString()}function it(r,t,i,e){if(t===null)return e?Ln(r,i):ei;switch(r){case D.DOUBLE:case D.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;var n=Number(t);if(Number.isNaN(n)||!Number.isFinite(n))break;return r==D.FLOAT&&is(n),n;case D.INT32:case D.FIXED32:case D.SFIXED32:case D.SINT32:case D.UINT32:var a;if(typeof t=="number"?a=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(a=Number(t)),a===void 0)break;return r==D.UINT32||r==D.FIXED32?dr(a):jt(a),a;case D.INT64:case D.SFIXED64:case D.SINT64:if(typeof t!="number"&&typeof t!="string")break;var s=V.parse(t);return i?s.toString():s;case D.FIXED64:case D.UINT64:if(typeof t!="number"&&typeof t!="string")break;var o=V.uParse(t);return i?o.toString():o;case D.BOOL:if(typeof t!="boolean")break;return t;case D.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case D.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return fs.dec(t)}throw new Error}function Xi(r,t,i,e){if(t===null)return r.typeName=="google.protobuf.NullValue"?0:e?r.values[0].no:ei;switch(j(t)){case"number":if(Number.isInteger(t))return t;break;case"string":var n=r.findName(t);if(n!==void 0)return n.no;if(i)return Gt;break}throw new Error("cannot decode enum ".concat(r.typeName," from JSON: ").concat(qe(t)))}function mu(r){return r.repeated||r.kind=="map"?!0:!(r.oneof||r.kind=="message"||r.opt||r.req)}function fa(r,t,i){if(r.kind=="map"){oe(j(t)=="object"&&t!=null);var e={},n=Object.entries(t);switch(r.V.kind){case"scalar":var a=z(n),s;try{for(a.s();!(s=a.n()).done;){var o=x(s.value,2),u=o[0],c=o[1];e[u.toString()]=Wt(r.V.T,c)}}catch(M){a.e(M)}finally{a.f()}break;case"message":var l=z(n),d;try{for(l.s();!(d=l.n()).done;){var f=x(d.value,2),h=f[0],p=f[1];e[h.toString()]=p.toJson(i)}}catch(M){l.e(M)}finally{l.f()}break;case"enum":var g=r.V.T,k=z(n),y;try{for(k.s();!(y=k.n()).done;){var T=x(y.value,2),S=T[0],w=T[1];e[S.toString()]=Zi(g,w,i.enumAsInteger)}}catch(M){k.e(M)}finally{k.f()}break}return i.emitDefaultValues||n.length>0?e:void 0}if(r.repeated){oe(Array.isArray(t));var C=[];switch(r.kind){case"scalar":for(var I=0;I<t.length;I++)C.push(Wt(r.T,t[I]));break;case"enum":for(var R=0;R<t.length;R++)C.push(Zi(r.T,t[R],i.enumAsInteger));break;case"message":for(var L=0;L<t.length;L++)C.push(t[L].toJson(i));break}return i.emitDefaultValues||C.length>0?C:void 0}switch(r.kind){case"scalar":return Wt(r.T,t);case"enum":return Zi(r.T,t,i.enumAsInteger);case"message":return ps(r.T,t).toJson(i)}}function Zi(r,t,i){var e;if(oe(typeof t=="number"),r.typeName=="google.protobuf.NullValue")return null;if(i)return t;var n=r.findNumber(t);return(e=n==null?void 0:n.name)!==null&&e!==void 0?e:t}function Wt(r,t){switch(r){case D.INT32:case D.SFIXED32:case D.SINT32:case D.FIXED32:case D.UINT32:return oe(typeof t=="number"),t;case D.FLOAT:case D.DOUBLE:return oe(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case D.STRING:return oe(typeof t=="string"),t;case D.BOOL:return oe(typeof t=="boolean"),t;case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return oe(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case D.BYTES:return oe(t instanceof Uint8Array),fs.enc(t)}}var Pn=Symbol("@bufbuild/protobuf/unknown-fields"),ha={readUnknownFields:!0,readerFactory:function(t){return new ru(t)}},ma={writeUnknownFields:!0,writerFactory:function(){return new iu}};function vu(r){return r?Object.assign(Object.assign({},ha),r):ha}function pu(r){return r?Object.assign(Object.assign({},ma),r):ma}function gu(){return{makeReadOptions:vu,makeWriteOptions:pu,listUnknownFields:function(t){var i;return(i=t[Pn])!==null&&i!==void 0?i:[]},discardUnknownFields:function(t){delete t[Pn]},writeUnknownFields:function(t,i){var e=t,n=e[Pn];if(n){var a=z(n),s;try{for(a.s();!(s=a.n()).done;){var o=s.value;i.tag(o.no,o.wireType).raw(o.data)}}catch(u){a.e(u)}finally{a.f()}}},onUnknownField:function(t,i,e,n){var a=t;Array.isArray(a[Pn])||(a[Pn]=[]),a[Pn].push({no:i,wireType:e,data:n})},readMessage:function(t,i,e,n,a){for(var s=t.getType(),o=a?i.len:i.pos+e,u,c;i.pos<o;){var l=i.tag(),d=x(l,2);if(u=d[0],c=d[1],a===!0&&c==ce.EndGroup)break;var f=s.fields.find(u);if(!f){var h=i.skip(c,u);n.readUnknownFields&&this.onUnknownField(t,u,c,h);continue}va(t,i,f,c,n)}if(a&&(c!=ce.EndGroup||u!==e))throw new Error("invalid end group tag")},readField:va,writeMessage:function(t,i,e){var n=t.getType(),a=z(n.fields.byNumber()),s;try{for(a.s();!(s=a.n()).done;){var o=s.value;if(!vs(o,t)){if(o.req)throw new Error("cannot encode field ".concat(n.typeName,".").concat(o.name," to binary: required field not set"));continue}var u=o.oneof?t[o.oneof.localName].value:t[o.localName];pa(o,u,i,e)}}catch(c){a.e(c)}finally{a.f()}return e.writeUnknownFields&&this.writeUnknownFields(t,i),i},writeField:function(t,i,e,n){i!==void 0&&pa(t,i,e,n)}}}function va(r,t,i,e,n){var a=i.repeated,s=i.localName;switch(i.oneof&&(r=r[i.oneof.localName],r.case!=s&&delete r.value,r.case=s,s="value"),i.kind){case"scalar":case"enum":var o=i.kind=="enum"?D.INT32:i.T,u=ni;if(i.kind=="scalar"&&i.L>0&&(u=yu),a){var c=r[s],l=e==ce.LengthDelimited&&o!=D.STRING&&o!=D.BYTES;if(l)for(var d=t.uint32()+t.pos;t.pos<d;)c.push(u(t,o));else c.push(u(t,o))}else r[s]=u(t,o);break;case"message":var f=i.T;a?r[s].push(Ht(t,new f,n,i)):Qe(r[s])?Ht(t,r[s],n,i):(r[s]=Ht(t,new f,n,i),f.fieldWrapper&&!i.oneof&&!i.repeated&&(r[s]=f.fieldWrapper.unwrapField(r[s])));break;case"map":var h=ku(i,t,n),p=x(h,2),g=p[0],k=p[1];r[s][g]=k;break}}function Ht(r,t,i,e){var n=t.getType().runtime.bin,a=e==null?void 0:e.delimited;return n.readMessage(t,r,a?e.no:r.uint32(),i,a),t}function ku(r,t,i){for(var e=t.uint32(),n=t.pos+e,a,s;t.pos<n;){var o=t.tag(),u=x(o,1),c=u[0];switch(c){case 1:a=ni(t,r.K);break;case 2:switch(r.V.kind){case"scalar":s=ni(t,r.V.T);break;case"enum":s=t.int32();break;case"message":s=Ht(t,new r.V.T,i,void 0);break}break}}if(a===void 0&&(a=Ln(r.K,on.BIGINT)),typeof a!="string"&&typeof a!="number"&&(a=a.toString()),s===void 0)switch(r.V.kind){case"scalar":s=Ln(r.V.T,on.BIGINT);break;case"enum":s=r.V.T.values[0].no;break;case"message":s=new r.V.T;break}return[a,s]}function yu(r,t){var i=ni(r,t);return typeof i=="bigint"?i.toString():i}function ni(r,t){switch(t){case D.STRING:return r.string();case D.BOOL:return r.bool();case D.DOUBLE:return r.double();case D.FLOAT:return r.float();case D.INT32:return r.int32();case D.INT64:return r.int64();case D.UINT64:return r.uint64();case D.FIXED64:return r.fixed64();case D.BYTES:return r.bytes();case D.FIXED32:return r.fixed32();case D.SFIXED32:return r.sfixed32();case D.SFIXED64:return r.sfixed64();case D.SINT64:return r.sint64();case D.UINT32:return r.uint32();case D.SINT32:return r.sint32()}}function pa(r,t,i,e){oe(t!==void 0);var n=r.repeated;switch(r.kind){case"scalar":case"enum":var a=r.kind=="enum"?D.INT32:r.T;if(n)if(oe(Array.isArray(t)),r.packed)Tu(i,a,r.no,t);else{var s=z(t),o;try{for(s.s();!(o=s.n()).done;){var u=o.value;rt(i,a,r.no,u)}}catch(y){s.e(y)}finally{s.f()}}else rt(i,a,r.no,t);break;case"message":if(n){oe(Array.isArray(t));var c=z(t),l;try{for(c.s();!(l=c.n()).done;){var d=l.value;ga(i,e,r,d)}}catch(y){c.e(y)}finally{c.f()}}else ga(i,e,r,t);break;case"map":oe(j(t)=="object"&&t!=null);for(var f=0,h=Object.entries(t);f<h.length;f++){var p=x(h[f],2),g=p[0],k=p[1];bu(i,e,r,g,k)}break}}function bu(r,t,i,e,n){r.tag(i.no,ce.LengthDelimited),r.fork();var a=e;switch(i.K){case D.INT32:case D.FIXED32:case D.UINT32:case D.SFIXED32:case D.SINT32:a=Number.parseInt(e);break;case D.BOOL:oe(e=="true"||e=="false"),a=e=="true";break}switch(rt(r,i.K,1,a),i.V.kind){case"scalar":rt(r,i.V.T,2,n);break;case"enum":rt(r,D.INT32,2,n);break;case"message":oe(n!==void 0),r.tag(2,ce.LengthDelimited).bytes(n.toBinary(t));break}r.join()}function ga(r,t,i,e){var n=ps(i.T,e);i.delimited?r.tag(i.no,ce.StartGroup).raw(n.toBinary(t)).tag(i.no,ce.EndGroup):r.tag(i.no,ce.LengthDelimited).bytes(n.toBinary(t))}function rt(r,t,i,e){oe(e!==void 0);var n=gs(t),a=x(n,2),s=a[0],o=a[1];r.tag(i,s)[o](e)}function Tu(r,t,i,e){if(e.length){r.tag(i,ce.LengthDelimited).fork();for(var n=gs(t),a=x(n,2),s=a[1],o=0;o<e.length;o++)r[s](e[o]);r.join()}}function gs(r){var t=ce.Varint;switch(r){case D.BYTES:case D.STRING:t=ce.LengthDelimited;break;case D.DOUBLE:case D.FIXED64:case D.SFIXED64:t=ce.Bit64;break;case D.FIXED32:case D.SFIXED32:case D.FLOAT:t=ce.Bit32;break}var i=D[r].toLowerCase();return[t,i]}function Su(){return{setEnumType:as,initPartial:function(t,i){if(t!==void 0){var e=i.getType(),n=z(e.fields.byMember()),a;try{var s=function(){var c=a.value,l=c.localName,d=i,f=t;if(f[l]==null)return 0;switch(c.kind){case"oneof":var h=f[l].case;if(h===void 0)return 0;var p=c.findField(h),g=f[l].value;p&&p.kind=="message"&&!Qe(g,p.T)?g=new p.T(g):p&&p.kind==="scalar"&&p.T===D.BYTES&&(g=Qn(g)),d[l]={case:h,value:g};break;case"scalar":case"enum":var k=f[l];c.T===D.BYTES&&(k=c.repeated?k.map(Qn):Qn(k)),d[l]=k;break;case"map":switch(c.V.kind){case"scalar":case"enum":if(c.V.T===D.BYTES)for(var y=0,T=Object.entries(f[l]);y<T.length;y++){var S=x(T[y],2),w=S[0],C=S[1];d[l][w]=Qn(C)}else Object.assign(d[l],f[l]);break;case"message":for(var I=c.V.T,R=0,L=Object.keys(f[l]);R<L.length;R++){var M=L[R],H=f[l][M];I.fieldWrapper||(H=new I(H)),d[l][M]=H}break}break;case"message":var U=c.T;if(c.repeated)d[l]=f[l].map(function(Y){return Qe(Y,U)?Y:new U(Y)});else{var W=f[l];U.fieldWrapper?U.typeName==="google.protobuf.BytesValue"?d[l]=Qn(W):d[l]=W:d[l]=Qe(W,U)?W:new U(W)}break}},o;for(n.s();!(a=n.n()).done;)o=s()}catch(u){n.e(u)}finally{n.f()}}},equals:function(t,i,e){return i===e?!0:!i||!e?!1:t.fields.byMember().every(function(n){var a=i[n.localName],s=e[n.localName];if(n.repeated){if(a.length!==s.length)return!1;switch(n.kind){case"message":return a.every(function(h,p){return n.T.equals(h,s[p])});case"scalar":return a.every(function(h,p){return tn(n.T,h,s[p])});case"enum":return a.every(function(h,p){return tn(D.INT32,h,s[p])})}throw new Error("repeated cannot contain ".concat(n.kind))}switch(n.kind){case"message":var o=a,u=s;return n.T.fieldWrapper&&(o!==void 0&&!Qe(o)&&(o=n.T.fieldWrapper.wrapField(o)),u!==void 0&&!Qe(u)&&(u=n.T.fieldWrapper.wrapField(u))),n.T.equals(o,u);case"enum":return tn(D.INT32,a,s);case"scalar":return tn(n.T,a,s);case"oneof":if(a.case!==s.case)return!1;var c=n.findField(a.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(a.value,s.value);case"enum":return tn(D.INT32,a.value,s.value);case"scalar":return tn(c.T,a.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":var l=Object.keys(a).concat(Object.keys(s));switch(n.V.kind){case"message":var d=n.V.T;return l.every(function(h){return d.equals(a[h],s[h])});case"enum":return l.every(function(h){return tn(D.INT32,a[h],s[h])});case"scalar":var f=n.V.T;return l.every(function(h){return tn(f,a[h],s[h])})}break}})},clone:function(t){var i=t.getType(),e=new i,n=e,a=z(i.fields.byMember()),s;try{for(a.s();!(s=a.n()).done;){var o=s.value,u=t[o.localName],c=void 0;if(o.repeated)c=u.map(_t);else if(o.kind=="map"){c=n[o.localName];for(var l=0,d=Object.entries(u);l<d.length;l++){var f=x(d[l],2),h=f[0],p=f[1];c[h]=_t(p)}}else if(o.kind=="oneof"){var g=o.findField(u.case);c=g?{case:u.case,value:_t(u.value)}:{case:void 0}}else c=_t(u);n[o.localName]=c}}catch(S){a.e(S)}finally{a.f()}var k=z(i.runtime.bin.listUnknownFields(t)),y;try{for(k.s();!(y=k.n()).done;){var T=y.value;i.runtime.bin.onUnknownField(n,T.no,T.wireType,T.data)}}catch(S){k.e(S)}finally{k.f()}return e}}}function _t(r){if(r===void 0)return r;if(Qe(r))return r.clone();if(r instanceof Uint8Array){var t=new Uint8Array(r.byteLength);return t.set(r),t}return r}function Qn(r){return r instanceof Uint8Array?r:new Uint8Array(r)}function Cu(r,t,i){return{syntax:r,json:fu(),bin:gu(),util:Object.assign(Object.assign({},Su()),{newFieldList:t,initFields:i}),makeMessageType:function(n,a,s){return Zo(this,n,a,s)},makeEnum:Xo,makeEnumType:ss,getEnumType:Qo,makeExtension:function(n,a,s){return au(this,n,a,s)}}}var wu=function(){function r(t,i){P(this,r),this._fields=t,this._normalizer=i}return E(r,[{key:"findJsonName",value:function(i){if(!this.jsonNames){var e={},n=z(this.list()),a;try{for(n.s();!(a=n.n()).done;){var s=a.value;e[s.jsonName]=e[s.name]=s}}catch(o){n.e(o)}finally{n.f()}this.jsonNames=e}return this.jsonNames[i]}},{key:"find",value:function(i){if(!this.numbers){var e={},n=z(this.list()),a;try{for(n.s();!(a=n.n()).done;){var s=a.value;e[s.no]=s}}catch(o){n.e(o)}finally{n.f()}this.numbers=e}return this.numbers[i]}},{key:"list",value:function(){return this.all||(this.all=this._normalizer(this._fields)),this.all}},{key:"byNumber",value:function(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(function(i,e){return i.no-e.no})),this.numbersAsc}},{key:"byMember",value:function(){if(!this.members){this.members=[];var i=this.members,e,n=z(this.list()),a;try{for(n.s();!(a=n.n()).done;){var s=a.value;s.oneof?s.oneof!==e&&(e=s.oneof,i.push(e)):i.push(s)}}catch(o){n.e(o)}finally{n.f()}}return this.members}}])}();function ks(r,t){var i=ys(r);return t?i:Nu(Ou(i))}function Pu(r){return ks(r,!1)}var Eu=ys;function ys(r){for(var t=!1,i=[],e=0;e<r.length;e++){var n=r.charAt(e);switch(n){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":i.push(n),t=!1;break;default:t&&(t=!1,n=n.toUpperCase()),i.push(n);break}}return i.join("")}var Ru=new Set(["constructor","toString","toJSON","valueOf"]),Iu=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),bs=function(t){return"".concat(t,"$")},Ou=function(t){return Iu.has(t)?bs(t):t},Nu=function(t){return Ru.has(t)?bs(t):t},Du=function(){function r(t){P(this,r),this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=Pu(t)}return E(r,[{key:"addField",value:function(i){oe(i.oneof===this,"field ".concat(i.name," not one of ").concat(this.name)),this.fields.push(i)}},{key:"findField",value:function(i){if(!this._lookup){this._lookup=Object.create(null);for(var e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[i]}}])}();function Au(r,t){var i,e,n,a,s,o,u=[],c,l=z(typeof r=="function"?r():r),d;try{for(l.s();!(d=l.n()).done;){var f=d.value,h=f;if(h.localName=ks(f.name,f.oneof!==void 0),h.jsonName=(i=f.jsonName)!==null&&i!==void 0?i:Eu(f.name),h.repeated=(e=f.repeated)!==null&&e!==void 0?e:!1,f.kind=="scalar"&&(h.L=(n=f.L)!==null&&n!==void 0?n:on.BIGINT),h.delimited=(a=f.delimited)!==null&&a!==void 0?a:!1,h.req=(s=f.req)!==null&&s!==void 0?s:!1,h.opt=(o=f.opt)!==null&&o!==void 0?o:!1,f.packed===void 0&&t&&(h.packed=f.kind=="enum"||f.kind=="scalar"&&f.T!=D.BYTES&&f.T!=D.STRING),f.oneof!==void 0){var p=typeof f.oneof=="string"?f.oneof:f.oneof.name;(!c||c.name!=p)&&(c=new Du(p)),h.oneof=c,c.addField(h)}u.push(h)}}catch(g){l.e(g)}finally{l.f()}return u}var m=Cu("proto3",function(r){return new wu(r,function(t){return Au(t,!0)})},function(r){var t=z(r.getType().fields.byMember()),i;try{for(t.s();!(i=t.n()).done;){var e=i.value;if(!e.opt){var n=e.localName,a=r;if(e.repeated){a[n]=[];continue}switch(e.kind){case"oneof":a[n]={case:void 0};break;case"enum":a[n]=0;break;case"map":a[n]={};break;case"scalar":a[n]=Ln(e.T,e.L);break;case"message":break}}}}catch(s){t.e(s)}finally{t.f()}}),Te=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.seconds=V.zero,e.nanos=0,m.util.initPartial(i,e),e}return N(t,r),E(t,[{key:"fromJson",value:function(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(m.json.debug(e)));var a=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!a)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");var s=Date.parse(a[1]+"-"+a[2]+"-"+a[3]+"T"+a[4]+":"+a[5]+":"+a[6]+(a[8]?a[8]:"Z"));if(Number.isNaN(s))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=V.parse(s/1e3),this.nanos=0,a[7]&&(this.nanos=parseInt("1"+a[7]+"0".repeat(9-a[7].length))-1e9),this}},{key:"toJson",value:function(e){var n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");var a="Z";if(this.nanos>0){var s=(this.nanos+1e9).toString().substring(1);s.substring(3)==="000000"?a="."+s.substring(0,3)+"Z":s.substring(6)==="000"?a="."+s.substring(0,6)+"Z":a="."+s+"Z"}return new Date(n).toISOString().replace(".000Z",a)}},{key:"toDate",value:function(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}}],[{key:"now",value:function(){return t.fromDate(new Date)}},{key:"fromDate",value:function(e){var n=e.getTime();return new t({seconds:V.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}},{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Te.runtime=m;Te.typeName="google.protobuf.Timestamp";Te.fields=m.util.newFieldList(function(){return[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]});var Mu=m.makeMessageType("livekit.MetricsBatch",function(){return[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Te},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:Lu,repeated:!0},{no:5,name:"events",kind:"message",T:Ju,repeated:!0}]}),Lu=m.makeMessageType("livekit.TimeSeriesMetric",function(){return[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:Uu,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]}),Uu=m.makeMessageType("livekit.MetricSample",function(){return[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Te},{no:3,name:"value",kind:"scalar",T:2}]}),Ju=m.makeMessageType("livekit.EventMetric",function(){return[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Te},{no:7,name:"normalized_end_timestamp",kind:"message",T:Te,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]}),fr;(function(r){r[r.DEFAULT_AC=0]="DEFAULT_AC",r[r.OPUS=1]="OPUS",r[r.AAC=2]="AAC"})(fr||(fr={}));m.util.setEnumType(fr,"livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]);var hr;(function(r){r[r.DEFAULT_VC=0]="DEFAULT_VC",r[r.H264_BASELINE=1]="H264_BASELINE",r[r.H264_MAIN=2]="H264_MAIN",r[r.H264_HIGH=3]="H264_HIGH",r[r.VP8=4]="VP8"})(hr||(hr={}));m.util.setEnumType(hr,"livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]);var mr;(function(r){r[r.IC_DEFAULT=0]="IC_DEFAULT",r[r.IC_JPEG=1]="IC_JPEG"})(mr||(mr={}));m.util.setEnumType(mr,"livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]);var ke;(function(r){r[r.AUDIO=0]="AUDIO",r[r.VIDEO=1]="VIDEO",r[r.DATA=2]="DATA"})(ke||(ke={}));m.util.setEnumType(ke,"livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]);var ue;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.CAMERA=1]="CAMERA",r[r.MICROPHONE=2]="MICROPHONE",r[r.SCREEN_SHARE=3]="SCREEN_SHARE",r[r.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"})(ue||(ue={}));m.util.setEnumType(ue,"livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]);var De;(function(r){r[r.LOW=0]="LOW",r[r.MEDIUM=1]="MEDIUM",r[r.HIGH=2]="HIGH",r[r.OFF=3]="OFF"})(De||(De={}));m.util.setEnumType(De,"livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]);var Ze;(function(r){r[r.POOR=0]="POOR",r[r.GOOD=1]="GOOD",r[r.EXCELLENT=2]="EXCELLENT",r[r.LOST=3]="LOST"})(Ze||(Ze={}));m.util.setEnumType(Ze,"livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]);var Fe;(function(r){r[r.UNSET=0]="UNSET",r[r.DISABLED=1]="DISABLED",r[r.ENABLED=2]="ENABLED"})(Fe||(Fe={}));m.util.setEnumType(Fe,"livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]);var be;(function(r){r[r.UNKNOWN_REASON=0]="UNKNOWN_REASON",r[r.CLIENT_INITIATED=1]="CLIENT_INITIATED",r[r.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",r[r.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",r[r.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",r[r.ROOM_DELETED=5]="ROOM_DELETED",r[r.STATE_MISMATCH=6]="STATE_MISMATCH",r[r.JOIN_FAILURE=7]="JOIN_FAILURE",r[r.MIGRATION=8]="MIGRATION",r[r.SIGNAL_CLOSE=9]="SIGNAL_CLOSE",r[r.ROOM_CLOSED=10]="ROOM_CLOSED",r[r.USER_UNAVAILABLE=11]="USER_UNAVAILABLE",r[r.USER_REJECTED=12]="USER_REJECTED",r[r.SIP_TRUNK_FAILURE=13]="SIP_TRUNK_FAILURE"})(be||(be={}));m.util.setEnumType(be,"livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]);var ze;(function(r){r[r.RR_UNKNOWN=0]="RR_UNKNOWN",r[r.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",r[r.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",r[r.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",r[r.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE"})(ze||(ze={}));m.util.setEnumType(ze,"livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]);var dt;(function(r){r[r.SE_UNKNOWN=0]="SE_UNKNOWN",r[r.SE_CODEC_UNSUPPORTED=1]="SE_CODEC_UNSUPPORTED",r[r.SE_TRACK_NOTFOUND=2]="SE_TRACK_NOTFOUND"})(dt||(dt={}));m.util.setEnumType(dt,"livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]);var Re;(function(r){r[r.TF_STEREO=0]="TF_STEREO",r[r.TF_NO_DTX=1]="TF_NO_DTX",r[r.TF_AUTO_GAIN_CONTROL=2]="TF_AUTO_GAIN_CONTROL",r[r.TF_ECHO_CANCELLATION=3]="TF_ECHO_CANCELLATION",r[r.TF_NOISE_SUPPRESSION=4]="TF_NOISE_SUPPRESSION",r[r.TF_ENHANCED_NOISE_CANCELLATION=5]="TF_ENHANCED_NOISE_CANCELLATION"})(Re||(Re={}));m.util.setEnumType(Re,"livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]);var Vn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.name="",e.emptyTimeout=0,e.departureTimeout=0,e.maxParticipants=0,e.creationTime=V.zero,e.turnPassword="",e.enabledCodecs=[],e.metadata="",e.numParticipants=0,e.numPublishers=0,e.activeRecording=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Vn.runtime=m;Vn.typeName="livekit.Room";Vn.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:pn,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Rt}]});var pn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.mime="",e.fmtpLine="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);pn.runtime=m;pn.typeName="livekit.Codec";pn.fields=m.util.newFieldList(function(){return[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]});var qr=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.enabled=!1,e.min=0,e.max=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);qr.runtime=m;qr.typeName="livekit.PlayoutDelay";qr.fields=m.util.newFieldList(function(){return[{no:1,name:"enabled",kind:"scalar",T:8},{no:2,name:"min",kind:"scalar",T:13},{no:3,name:"max",kind:"scalar",T:13}]});var oi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.canSubscribe=!1,e.canPublish=!1,e.canPublishData=!1,e.canPublishSources=[],e.hidden=!1,e.recorder=!1,e.canUpdateMetadata=!1,e.agent=!1,e.canSubscribeMetrics=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);oi.runtime=m;oi.typeName="livekit.ParticipantPermission";oi.fields=m.util.newFieldList(function(){return[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:m.getEnumType(ue),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]});var un=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.identity="",e.state=gn.JOINING,e.tracks=[],e.metadata="",e.joinedAt=V.zero,e.name="",e.version=0,e.region="",e.isPublisher=!1,e.kind=cn.STANDARD,e.attributes={},e.disconnectReason=be.UNKNOWN_REASON,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);un.runtime=m;un.typeName="livekit.ParticipantInfo";un.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:m.getEnumType(gn)},{no:4,name:"tracks",kind:"message",T:$e,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:oi},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:m.getEnumType(cn)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:m.getEnumType(be)}]});var gn;(function(r){r[r.JOINING=0]="JOINING",r[r.JOINED=1]="JOINED",r[r.ACTIVE=2]="ACTIVE",r[r.DISCONNECTED=3]="DISCONNECTED"})(gn||(gn={}));m.util.setEnumType(gn,"livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]);var cn;(function(r){r[r.STANDARD=0]="STANDARD",r[r.INGRESS=1]="INGRESS",r[r.EGRESS=2]="EGRESS",r[r.SIP=3]="SIP",r[r.AGENT=4]="AGENT"})(cn||(cn={}));m.util.setEnumType(cn,"livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]);var jr=function(r){function t(i){var e;return P(this,t),e=O(this,t),m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);jr.runtime=m;jr.typeName="livekit.Encryption";jr.fields=m.util.newFieldList(function(){return[]});var fe;(function(r){r[r.NONE=0]="NONE",r[r.GCM=1]="GCM",r[r.CUSTOM=2]="CUSTOM"})(fe||(fe={}));m.util.setEnumType(fe,"livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]);var ui=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.mimeType="",e.mid="",e.cid="",e.layers=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);ui.runtime=m;ui.typeName="livekit.SimulcastCodecInfo";ui.fields=m.util.newFieldList(function(){return[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:je,repeated:!0}]});var $e=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.type=ke.AUDIO,e.name="",e.muted=!1,e.width=0,e.height=0,e.simulcast=!1,e.disableDtx=!1,e.source=ue.UNKNOWN,e.layers=[],e.mimeType="",e.mid="",e.codecs=[],e.stereo=!1,e.disableRed=!1,e.encryption=fe.NONE,e.stream="",e.audioFeatures=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);$e.runtime=m;$e.typeName="livekit.TrackInfo";$e.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:m.getEnumType(ke)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:m.getEnumType(ue)},{no:10,name:"layers",kind:"message",T:je,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:ui,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:m.getEnumType(fe)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Rt},{no:19,name:"audio_features",kind:"enum",T:m.getEnumType(Re),repeated:!0}]});var je=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.quality=De.LOW,e.width=0,e.height=0,e.bitrate=0,e.ssrc=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);je.runtime=m;je.typeName="livekit.VideoLayer";je.fields=m.util.newFieldList(function(){return[{no:1,name:"quality",kind:"enum",T:m.getEnumType(De)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]});var Le=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.kind=ne.RELIABLE,e.participantIdentity="",e.destinationIdentities=[],e.value={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Le.runtime=m;Le.typeName="livekit.DataPacket";Le.fields=m.util.newFieldList(function(){return[{no:1,name:"kind",kind:"enum",T:m.getEnumType(ne)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:yt,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ci,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:bt,oneof:"value"},{no:7,name:"transcription",kind:"message",T:li,oneof:"value"},{no:8,name:"metrics",kind:"message",T:Mu,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Un,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Tt,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:St,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Ct,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:bi,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Ti,oneof:"value"}]});var ne;(function(r){r[r.RELIABLE=0]="RELIABLE",r[r.LOSSY=1]="LOSSY"})(ne||(ne={}));m.util.setEnumType(ne,"livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]);var ci=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.speakers=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);ci.runtime=m;ci.typeName="livekit.ActiveSpeakerUpdate";ci.fields=m.util.newFieldList(function(){return[{no:1,name:"speakers",kind:"message",T:kt,repeated:!0}]});var kt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.level=0,e.active=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);kt.runtime=m;kt.typeName="livekit.SpeakerInfo";kt.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]});var yt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.participantIdentity="",e.payload=new Uint8Array(0),e.destinationSids=[],e.destinationIdentities=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);yt.runtime=m;yt.typeName="livekit.UserPacket";yt.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0}]});var bt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.code=0,e.digit="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);bt.runtime=m;bt.typeName="livekit.SipDTMF";bt.fields=m.util.newFieldList(function(){return[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]});var li=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.transcribedParticipantIdentity="",e.trackId="",e.segments=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);li.runtime=m;li.typeName="livekit.Transcription";li.fields=m.util.newFieldList(function(){return[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:di,repeated:!0}]});var di=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.id="",e.text="",e.startTime=V.zero,e.endTime=V.zero,e.final=!1,e.language="",e.error=!1,e.failureReason="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);di.runtime=m;di.typeName="livekit.TranscriptionSegment";di.fields=m.util.newFieldList(function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9},{no:7,name:"error",kind:"scalar",T:8},{no:8,name:"failure_reason",kind:"scalar",T:9}]});var Un=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.id="",e.timestamp=V.zero,e.message="",e.deleted=!1,e.generated=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Un.runtime=m;Un.typeName="livekit.ChatMessage";Un.fields=m.util.newFieldList(function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]});var Tt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.id="",e.method="",e.payload="",e.responseTimeoutMs=0,e.version=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Tt.runtime=m;Tt.typeName="livekit.RpcRequest";Tt.fields=m.util.newFieldList(function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]});var St=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.requestId="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);St.runtime=m;St.typeName="livekit.RpcAck";St.fields=m.util.newFieldList(function(){return[{no:1,name:"request_id",kind:"scalar",T:9}]});var Ct=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.requestId="",e.value={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ct.runtime=m;Ct.typeName="livekit.RpcResponse";Ct.fields=m.util.newFieldList(function(){return[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:wt,oneof:"value"}]});var wt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.code=0,e.message="",e.data="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);wt.runtime=m;wt.typeName="livekit.RpcError";wt.fields=m.util.newFieldList(function(){return[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]});var Pt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.trackSids=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Pt.runtime=m;Pt.typeName="livekit.ParticipantTracks";Pt.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]});var fi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.edition=Jn.Standard,e.version="",e.protocol=0,e.region="",e.nodeId="",e.debugInfo="",e.agentProtocol=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);fi.runtime=m;fi.typeName="livekit.ServerInfo";fi.fields=m.util.newFieldList(function(){return[{no:1,name:"edition",kind:"enum",T:m.getEnumType(Jn)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]});var Jn;(function(r){r[r.Standard=0]="Standard",r[r.Cloud=1]="Cloud"})(Jn||(Jn={}));m.util.setEnumType(Jn,"livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]);var hi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sdk=Bn.UNKNOWN,e.version="",e.protocol=0,e.os="",e.osVersion="",e.deviceModel="",e.browser="",e.browserVersion="",e.address="",e.network="",e.otherSdks="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);hi.runtime=m;hi.typeName="livekit.ClientInfo";hi.fields=m.util.newFieldList(function(){return[{no:1,name:"sdk",kind:"enum",T:m.getEnumType(Bn)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]});var Bn;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.JS=1]="JS",r[r.SWIFT=2]="SWIFT",r[r.ANDROID=3]="ANDROID",r[r.FLUTTER=4]="FLUTTER",r[r.GO=5]="GO",r[r.UNITY=6]="UNITY",r[r.REACT_NATIVE=7]="REACT_NATIVE",r[r.RUST=8]="RUST",r[r.PYTHON=9]="PYTHON",r[r.CPP=10]="CPP",r[r.UNITY_WEB=11]="UNITY_WEB",r[r.NODE=12]="NODE"})(Bn||(Bn={}));m.util.setEnumType(Bn,"livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]);var Et=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.resumeConnection=Fe.UNSET,e.forceRelay=Fe.UNSET,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Et.runtime=m;Et.typeName="livekit.ClientConfiguration";Et.fields=m.util.newFieldList(function(){return[{no:1,name:"video",kind:"message",T:ft},{no:2,name:"screen",kind:"message",T:ft},{no:3,name:"resume_connection",kind:"enum",T:m.getEnumType(Fe)},{no:4,name:"disabled_codecs",kind:"message",T:mi},{no:5,name:"force_relay",kind:"enum",T:m.getEnumType(Fe)}]});var ft=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.hardwareEncoder=Fe.UNSET,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);ft.runtime=m;ft.typeName="livekit.VideoConfiguration";ft.fields=m.util.newFieldList(function(){return[{no:1,name:"hardware_encoder",kind:"enum",T:m.getEnumType(Fe)}]});var mi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.codecs=[],e.publish=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);mi.runtime=m;mi.typeName="livekit.DisabledCodecs";mi.fields=m.util.newFieldList(function(){return[{no:1,name:"codecs",kind:"message",T:pn,repeated:!0},{no:2,name:"publish",kind:"message",T:pn,repeated:!0}]});var fn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.duration=0,e.startTimestamp=V.zero,e.endTimestamp=V.zero,e.rtpClockTicks=V.zero,e.driftSamples=V.zero,e.driftMs=0,e.clockRate=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);fn.runtime=m;fn.typeName="livekit.RTPDrift";fn.fields=m.util.newFieldList(function(){return[{no:1,name:"start_time",kind:"message",T:Te},{no:2,name:"end_time",kind:"message",T:Te},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"start_timestamp",kind:"scalar",T:4},{no:5,name:"end_timestamp",kind:"scalar",T:4},{no:6,name:"rtp_clock_ticks",kind:"scalar",T:4},{no:7,name:"drift_samples",kind:"scalar",T:3},{no:8,name:"drift_ms",kind:"scalar",T:1},{no:9,name:"clock_rate",kind:"scalar",T:1}]});var Vr=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.duration=0,e.packets=0,e.packetRate=0,e.bytes=V.zero,e.headerBytes=V.zero,e.bitrate=0,e.packetsLost=0,e.packetLossRate=0,e.packetLossPercentage=0,e.packetsDuplicate=0,e.packetDuplicateRate=0,e.bytesDuplicate=V.zero,e.headerBytesDuplicate=V.zero,e.bitrateDuplicate=0,e.packetsPadding=0,e.packetPaddingRate=0,e.bytesPadding=V.zero,e.headerBytesPadding=V.zero,e.bitratePadding=0,e.packetsOutOfOrder=0,e.frames=0,e.frameRate=0,e.jitterCurrent=0,e.jitterMax=0,e.gapHistogram={},e.nacks=0,e.nackAcks=0,e.nackMisses=0,e.nackRepeated=0,e.plis=0,e.firs=0,e.rttCurrent=0,e.rttMax=0,e.keyFrames=0,e.layerLockPlis=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Vr.runtime=m;Vr.typeName="livekit.RTPStats";Vr.fields=m.util.newFieldList(function(){return[{no:1,name:"start_time",kind:"message",T:Te},{no:2,name:"end_time",kind:"message",T:Te},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"packets",kind:"scalar",T:13},{no:5,name:"packet_rate",kind:"scalar",T:1},{no:6,name:"bytes",kind:"scalar",T:4},{no:39,name:"header_bytes",kind:"scalar",T:4},{no:7,name:"bitrate",kind:"scalar",T:1},{no:8,name:"packets_lost",kind:"scalar",T:13},{no:9,name:"packet_loss_rate",kind:"scalar",T:1},{no:10,name:"packet_loss_percentage",kind:"scalar",T:2},{no:11,name:"packets_duplicate",kind:"scalar",T:13},{no:12,name:"packet_duplicate_rate",kind:"scalar",T:1},{no:13,name:"bytes_duplicate",kind:"scalar",T:4},{no:40,name:"header_bytes_duplicate",kind:"scalar",T:4},{no:14,name:"bitrate_duplicate",kind:"scalar",T:1},{no:15,name:"packets_padding",kind:"scalar",T:13},{no:16,name:"packet_padding_rate",kind:"scalar",T:1},{no:17,name:"bytes_padding",kind:"scalar",T:4},{no:41,name:"header_bytes_padding",kind:"scalar",T:4},{no:18,name:"bitrate_padding",kind:"scalar",T:1},{no:19,name:"packets_out_of_order",kind:"scalar",T:13},{no:20,name:"frames",kind:"scalar",T:13},{no:21,name:"frame_rate",kind:"scalar",T:1},{no:22,name:"jitter_current",kind:"scalar",T:1},{no:23,name:"jitter_max",kind:"scalar",T:1},{no:24,name:"gap_histogram",kind:"map",K:5,V:{kind:"scalar",T:13}},{no:25,name:"nacks",kind:"scalar",T:13},{no:37,name:"nack_acks",kind:"scalar",T:13},{no:26,name:"nack_misses",kind:"scalar",T:13},{no:38,name:"nack_repeated",kind:"scalar",T:13},{no:27,name:"plis",kind:"scalar",T:13},{no:28,name:"last_pli",kind:"message",T:Te},{no:29,name:"firs",kind:"scalar",T:13},{no:30,name:"last_fir",kind:"message",T:Te},{no:31,name:"rtt_current",kind:"scalar",T:13},{no:32,name:"rtt_max",kind:"scalar",T:13},{no:33,name:"key_frames",kind:"scalar",T:13},{no:34,name:"last_key_frame",kind:"message",T:Te},{no:35,name:"layer_lock_plis",kind:"scalar",T:13},{no:36,name:"last_layer_lock_pli",kind:"message",T:Te},{no:44,name:"packet_drift",kind:"message",T:fn},{no:45,name:"ntp_report_drift",kind:"message",T:fn},{no:46,name:"rebased_report_drift",kind:"message",T:fn},{no:47,name:"received_report_drift",kind:"message",T:fn}]});var vi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.rtpTimestamp=0,e.rtpTimestampExt=V.zero,e.ntpTimestamp=V.zero,e.at=V.zero,e.atAdjusted=V.zero,e.packets=0,e.octets=V.zero,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);vi.runtime=m;vi.typeName="livekit.RTCPSenderReportState";vi.fields=m.util.newFieldList(function(){return[{no:1,name:"rtp_timestamp",kind:"scalar",T:13},{no:2,name:"rtp_timestamp_ext",kind:"scalar",T:4},{no:3,name:"ntp_timestamp",kind:"scalar",T:4},{no:4,name:"at",kind:"scalar",T:3},{no:5,name:"at_adjusted",kind:"scalar",T:3},{no:6,name:"packets",kind:"scalar",T:13},{no:7,name:"octets",kind:"scalar",T:4}]});var Gr=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.started=!1,e.referenceLayerSpatial=0,e.preStartTime=V.zero,e.extFirstTimestamp=V.zero,e.dummyStartTimestampOffset=V.zero,e.codecMunger={case:void 0},e.senderReportState=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Gr.runtime=m;Gr.typeName="livekit.RTPForwarderState";Gr.fields=m.util.newFieldList(function(){return[{no:1,name:"started",kind:"scalar",T:8},{no:2,name:"reference_layer_spatial",kind:"scalar",T:5},{no:3,name:"pre_start_time",kind:"scalar",T:3},{no:4,name:"ext_first_timestamp",kind:"scalar",T:4},{no:5,name:"dummy_start_timestamp_offset",kind:"scalar",T:4},{no:6,name:"rtp_munger",kind:"message",T:pi},{no:7,name:"vp8_munger",kind:"message",T:gi,oneof:"codec_munger"},{no:8,name:"sender_report_state",kind:"message",T:vi,repeated:!0}]});var pi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.extLastSequenceNumber=V.zero,e.extSecondLastSequenceNumber=V.zero,e.extLastTimestamp=V.zero,e.extSecondLastTimestamp=V.zero,e.lastMarker=!1,e.secondLastMarker=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);pi.runtime=m;pi.typeName="livekit.RTPMungerState";pi.fields=m.util.newFieldList(function(){return[{no:1,name:"ext_last_sequence_number",kind:"scalar",T:4},{no:2,name:"ext_second_last_sequence_number",kind:"scalar",T:4},{no:3,name:"ext_last_timestamp",kind:"scalar",T:4},{no:4,name:"ext_second_last_timestamp",kind:"scalar",T:4},{no:5,name:"last_marker",kind:"scalar",T:8},{no:6,name:"second_last_marker",kind:"scalar",T:8}]});var gi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.extLastPictureId=0,e.pictureIdUsed=!1,e.lastTl0PicIdx=0,e.tl0PicIdxUsed=!1,e.tidUsed=!1,e.lastKeyIdx=0,e.keyIdxUsed=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);gi.runtime=m;gi.typeName="livekit.VP8MungerState";gi.fields=m.util.newFieldList(function(){return[{no:1,name:"ext_last_picture_id",kind:"scalar",T:5},{no:2,name:"picture_id_used",kind:"scalar",T:8},{no:3,name:"last_tl0_pic_idx",kind:"scalar",T:13},{no:4,name:"tl0_pic_idx_used",kind:"scalar",T:8},{no:5,name:"tid_used",kind:"scalar",T:8},{no:6,name:"last_key_idx",kind:"scalar",T:13},{no:7,name:"key_idx_used",kind:"scalar",T:8}]});var Rt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.unixMicro=V.zero,e.ticks=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Rt.runtime=m;Rt.typeName="livekit.TimedVersion";Rt.fields=m.util.newFieldList(function(){return[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]});var Wr=function(r){function t(i){var e;return P(this,t),e=O(this,t),m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Wr.runtime=m;Wr.typeName="livekit.DataStream";Wr.fields=m.util.newFieldList(function(){return[]});var ht;(function(r){r[r.CREATE=0]="CREATE",r[r.UPDATE=1]="UPDATE",r[r.DELETE=2]="DELETE",r[r.REACTION=3]="REACTION"})(ht||(ht={}));m.util.setEnumType(ht,"livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]);var ki=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.operationType=ht.CREATE,e.version=0,e.replyToStreamId="",e.attachedStreamIds=[],e.generated=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);ki.runtime=m;ki.typeName="livekit.DataStream.TextHeader";ki.fields=m.util.newFieldList(function(){return[{no:1,name:"operation_type",kind:"enum",T:m.getEnumType(ht)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}]});var yi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.fileName="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);yi.runtime=m;yi.typeName="livekit.DataStream.FileHeader";yi.fields=m.util.newFieldList(function(){return[{no:1,name:"file_name",kind:"scalar",T:9}]});var bi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.streamId="",e.timestamp=V.zero,e.topic="",e.mimeType="",e.encryptionType=fe.NONE,e.extensions={},e.contentHeader={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);bi.runtime=m;bi.typeName="livekit.DataStream.Header";bi.fields=m.util.newFieldList(function(){return[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:m.getEnumType(fe)},{no:8,name:"extensions",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:ki,oneof:"content_header"},{no:10,name:"file_header",kind:"message",T:yi,oneof:"content_header"}]});var Ti=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.streamId="",e.chunkIndex=V.zero,e.content=new Uint8Array(0),e.complete=!1,e.version=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ti.runtime=m;Ti.typeName="livekit.DataStream.Chunk";Ti.fields=m.util.newFieldList(function(){return[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"complete",kind:"scalar",T:8},{no:5,name:"version",kind:"scalar",T:5},{no:6,name:"iv",kind:"scalar",T:12,opt:!0}]});var Bu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fu(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ts={exports:{}};(function(r){(function(t,i){r.exports?r.exports=i():t.log=i()})(Bu,function(){var t=function(){},i="undefined",e=(typeof window>"u"?"undefined":j(window))!==i&&j(window.navigator)!==i&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],a={},s=null;function o(g,k){var y=g[k];if(typeof y.bind=="function")return y.bind(g);try{return Function.prototype.bind.call(y,g)}catch{return function(){return Function.prototype.apply.apply(y,[g,arguments])}}}function u(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(g){return g==="debug"&&(g="log"),(typeof console>"u"?"undefined":j(console))===i?!1:g==="trace"&&e?u:console[g]!==void 0?o(console,g):console.log!==void 0?o(console,"log"):t}function l(){for(var g=this.getLevel(),k=0;k<n.length;k++){var y=n[k];this[y]=k<g?t:this.methodFactory(y,g,this.name)}if(this.log=this.debug,(typeof console>"u"?"undefined":j(console))===i&&g<this.levels.SILENT)return"No console available for logging"}function d(g){return function(){(typeof console>"u"?"undefined":j(console))!==i&&(l.call(this),this[g].apply(this,arguments))}}function f(g,k,y){return c(g)||d.apply(this,arguments)}function h(g,k){var y=this,T,S,w,C="loglevel";typeof g=="string"?C+=":"+g:j(g)==="symbol"&&(C=void 0);function I(U){var W=(n[U]||"silent").toUpperCase();if(!((typeof window>"u"?"undefined":j(window))===i||!C)){try{window.localStorage[C]=W;return}catch{}try{window.document.cookie=encodeURIComponent(C)+"="+W+";"}catch{}}}function R(){var U;if(!((typeof window>"u"?"undefined":j(window))===i||!C)){try{U=window.localStorage[C]}catch{}if(j(U)===i)try{var W=window.document.cookie,Y=encodeURIComponent(C),X=W.indexOf(Y+"=");X!==-1&&(U=/^([^;]+)/.exec(W.slice(X+Y.length+1))[1])}catch{}return y.levels[U]===void 0&&(U=void 0),U}}function L(){if(!((typeof window>"u"?"undefined":j(window))===i||!C)){try{window.localStorage.removeItem(C)}catch{}try{window.document.cookie=encodeURIComponent(C)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function M(U){var W=U;if(typeof W=="string"&&y.levels[W.toUpperCase()]!==void 0&&(W=y.levels[W.toUpperCase()]),typeof W=="number"&&W>=0&&W<=y.levels.SILENT)return W;throw new TypeError("log.setLevel() called with invalid level: "+U)}y.name=g,y.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},y.methodFactory=k||f,y.getLevel=function(){return w??S??T},y.setLevel=function(U,W){return w=M(U),W!==!1&&I(w),l.call(y)},y.setDefaultLevel=function(U){S=M(U),R()||y.setLevel(U,!1)},y.resetLevel=function(){w=null,L(),l.call(y)},y.enableAll=function(U){y.setLevel(y.levels.TRACE,U)},y.disableAll=function(U){y.setLevel(y.levels.SILENT,U)},y.rebuild=function(){if(s!==y&&(T=M(s.getLevel())),l.call(y),s===y)for(var U in a)a[U].rebuild()},T=M(s?s.getLevel():"WARN");var H=R();H!=null&&(w=M(H)),l.call(y)}s=new h,s.getLogger=function(k){if(j(k)!=="symbol"&&typeof k!="string"||k==="")throw new TypeError("You must supply a name when creating a logger.");var y=a[k];return y||(y=a[k]=new h(k,s.methodFactory)),y};var p=(typeof window>"u"?"undefined":j(window))!==i?window.log:void 0;return s.noConflict=function(){return(typeof window>"u"?"undefined":j(window))!==i&&window.log===s&&(window.log=p),s},s.getLoggers=function(){return a},s.default=s,s})})(Ts);var Si=Ts.exports,vr;(function(r){r[r.trace=0]="trace",r[r.debug=1]="debug",r[r.info=2]="info",r[r.warn=3]="warn",r[r.error=4]="error",r[r.silent=5]="silent"})(vr||(vr={}));var _e;(function(r){r.Default="livekit",r.Room="livekit-room",r.Participant="livekit-participant",r.Track="livekit-track",r.Publication="livekit-track-publication",r.Engine="livekit-engine",r.Signal="livekit-signal",r.PCManager="livekit-pc-manager",r.PCTransport="livekit-pc-transport",r.E2EE="lk-e2ee"})(_e||(_e={}));var Z=Si.getLogger("livekit"),_u=Object.values(_e).map(function(r){return Si.getLogger(r)});Z.setDefaultLevel(vr.info);function xe(r){var t=Si.getLogger(r);return t.setDefaultLevel(Z.getLevel()),t}function Ml(r,t){{var i=z(_u),e;try{for(i.s();!(e=i.n()).done;){var n=e.value;n.setLevel(r)}}catch(a){i.e(a)}finally{i.f()}}}var qu=Si.getLogger("lk-e2ee"),Xn=7e3,ju=[0,300,2*2*300,3*3*300,4*4*300,Xn,Xn,Xn,Xn,Xn],Vu=function(){function r(t){P(this,r),this._retryDelays=t!==void 0?Oe(t):ju}return E(r,[{key:"nextRetryDelayInMs",value:function(i){if(i.retryCount>=this._retryDelays.length)return null;var e=this._retryDelays[i.retryCount];return i.retryCount<=1?e:e+Math.random()*1e3}}])}();function b(r,t,i,e){function n(a){return a instanceof i?a:new i(function(s){s(a)})}return new(i||(i=Promise))(function(a,s){function o(l){try{c(e.next(l))}catch(d){s(d)}}function u(l){try{c(e.throw(l))}catch(d){s(d)}}function c(l){l.done?a(l.value):n(l.value).then(o,u)}c((e=e.apply(r,t||[])).next())})}function ka(r){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&r[t],e=0;if(i)return i.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&e>=r.length&&(r=void 0),{value:r&&r[e++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Rn(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],i;return t?t.call(r):(r=typeof ka=="function"?ka(r):r[Symbol.iterator](),i={},e("next"),e("throw"),e("return"),i[Symbol.asyncIterator]=function(){return this},i);function e(a){i[a]=r[a]&&function(s){return new Promise(function(o,u){s=r[a](s),n(o,u,s.done,s.value)})}}function n(a,s,o,u){Promise.resolve(u).then(function(c){a({value:c,done:o})},s)}}var ye;(function(r){r[r.PUBLISHER=0]="PUBLISHER",r[r.SUBSCRIBER=1]="SUBSCRIBER"})(ye||(ye={}));m.util.setEnumType(ye,"livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]);var kn;(function(r){r[r.ACTIVE=0]="ACTIVE",r[r.PAUSED=1]="PAUSED"})(kn||(kn={}));m.util.setEnumType(kn,"livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]);var ti;(function(r){r[r.UDP=0]="UDP",r[r.TCP=1]="TCP",r[r.TLS=2]="TLS"})(ti||(ti={}));m.util.setEnumType(ti,"livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]);var pr;(function(r){r[r.AddAudioTrack=0]="AddAudioTrack",r[r.AddVideoTrack=1]="AddVideoTrack",r[r.Join=2]="Join",r[r.Leave=3]="Leave",r[r.MuteAudio=4]="MuteAudio",r[r.MuteVideo=5]="MuteVideo",r[r.UnmuteAudio=6]="UnmuteAudio",r[r.UnmuteVideo=7]="UnmuteVideo"})(pr||(pr={}));m.util.setEnumType(pr,"livekit.RequestType",[{no:0,name:"AddAudioTrack"},{no:1,name:"AddVideoTrack"},{no:2,name:"Join"},{no:3,name:"Leave"},{no:4,name:"MuteAudio"},{no:5,name:"MuteVideo"},{no:6,name:"UnmuteAudio"},{no:7,name:"UnmuteVideo"}]);var Ci=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.message={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ci.runtime=m;Ci.typeName="livekit.SignalRequest";Ci.fields=m.util.newFieldList(function(){return[{no:1,name:"offer",kind:"message",T:Ge,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ge,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Gn,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Fn,oneof:"message"},{no:5,name:"mute",kind:"message",T:Wn,oneof:"message"},{no:6,name:"subscription",kind:"message",T:yn,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:It,oneof:"message"},{no:8,name:"leave",kind:"message",T:bn,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Nt,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Lt,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Ut,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Ee,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Dt,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Bt,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Ot,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Ii,oneof:"message"},{no:19,name:"health_check",kind:"message",T:Wi,oneof:"message"}]});var mt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.message={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);mt.runtime=m;mt.typeName="livekit.SignalResponse";mt.fields=m.util.newFieldList(function(){return[{no:1,name:"join",kind:"message",T:wi,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ge,oneof:"message"},{no:3,name:"offer",kind:"message",T:Ge,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Gn,oneof:"message"},{no:5,name:"update",kind:"message",T:Ri,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Hn,oneof:"message"},{no:8,name:"leave",kind:"message",T:bn,oneof:"message"},{no:9,name:"mute",kind:"message",T:Wn,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Oi,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Ni,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Ai,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:Li,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Ji,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Bi,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Ei,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Pi,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Fi,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:ji,oneof:"message"},{no:22,name:"health_check_response",kind:"message",T:Hi,oneof:"message"},{no:23,name:"request_response",kind:"message",T:Vi,oneof:"message"},{no:24,name:"track_subscribed",kind:"message",T:Gi,oneof:"message"}]});var hn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.codec="",e.cid="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);hn.runtime=m;hn.typeName="livekit.SimulcastCodec";hn.fields=m.util.newFieldList(function(){return[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]});var Fn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.cid="",e.name="",e.type=ke.AUDIO,e.width=0,e.height=0,e.muted=!1,e.disableDtx=!1,e.source=ue.UNKNOWN,e.layers=[],e.simulcastCodecs=[],e.sid="",e.stereo=!1,e.disableRed=!1,e.encryption=fe.NONE,e.stream="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Fn.runtime=m;Fn.typeName="livekit.AddTrackRequest";Fn.fields=m.util.newFieldList(function(){return[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:m.getEnumType(ke)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:m.getEnumType(ue)},{no:9,name:"layers",kind:"message",T:je,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:hn,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:m.getEnumType(fe)},{no:15,name:"stream",kind:"scalar",T:9}]});var Gn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.candidateInit="",e.target=ye.PUBLISHER,e.final=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Gn.runtime=m;Gn.typeName="livekit.TrickleRequest";Gn.fields=m.util.newFieldList(function(){return[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:m.getEnumType(ye)},{no:3,name:"final",kind:"scalar",T:8}]});var Wn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.muted=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Wn.runtime=m;Wn.typeName="livekit.MuteTrackRequest";Wn.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]});var wi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.otherParticipants=[],e.serverVersion="",e.iceServers=[],e.subscriberPrimary=!1,e.alternativeUrl="",e.serverRegion="",e.pingTimeout=0,e.pingInterval=0,e.sifTrailer=new Uint8Array(0),e.enabledPublishCodecs=[],e.fastPublish=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);wi.runtime=m;wi.typeName="livekit.JoinResponse";wi.fields=m.util.newFieldList(function(){return[{no:1,name:"room",kind:"message",T:Vn},{no:2,name:"participant",kind:"message",T:un},{no:3,name:"other_participants",kind:"message",T:un,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:At,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Et},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:fi},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:pn,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]});var Pi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.iceServers=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Pi.runtime=m;Pi.typeName="livekit.ReconnectResponse";Pi.fields=m.util.newFieldList(function(){return[{no:1,name:"ice_servers",kind:"message",T:At,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Et}]});var Hn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.cid="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Hn.runtime=m;Hn.typeName="livekit.TrackPublishedResponse";Hn.fields=m.util.newFieldList(function(){return[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:$e}]});var Ei=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ei.runtime=m;Ei.typeName="livekit.TrackUnpublishedResponse";Ei.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9}]});var Ge=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.type="",e.sdp="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ge.runtime=m;Ge.typeName="livekit.SessionDescription";Ge.fields=m.util.newFieldList(function(){return[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]});var Ri=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participants=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ri.runtime=m;Ri.typeName="livekit.ParticipantUpdate";Ri.fields=m.util.newFieldList(function(){return[{no:1,name:"participants",kind:"message",T:un,repeated:!0}]});var yn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSids=[],e.subscribe=!1,e.participantTracks=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);yn.runtime=m;yn.typeName="livekit.UpdateSubscription";yn.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Pt,repeated:!0}]});var It=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSids=[],e.disabled=!1,e.quality=De.LOW,e.width=0,e.height=0,e.fps=0,e.priority=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);It.runtime=m;It.typeName="livekit.UpdateTrackSettings";It.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:m.getEnumType(De)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]});var Ot=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",e.features=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ot.runtime=m;Ot.typeName="livekit.UpdateLocalAudioTrack";Ot.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:m.getEnumType(Re),repeated:!0}]});var Ii=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",e.width=0,e.height=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ii.runtime=m;Ii.typeName="livekit.UpdateLocalVideoTrack";Ii.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]});var bn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.canReconnect=!1,e.reason=be.UNKNOWN_REASON,e.action=Ve.DISCONNECT,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);bn.runtime=m;bn.typeName="livekit.LeaveRequest";bn.fields=m.util.newFieldList(function(){return[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:m.getEnumType(be)},{no:3,name:"action",kind:"enum",T:m.getEnumType(Ve)},{no:4,name:"regions",kind:"message",T:_i}]});var Ve;(function(r){r[r.DISCONNECT=0]="DISCONNECT",r[r.RESUME=1]="RESUME",r[r.RECONNECT=2]="RECONNECT"})(Ve||(Ve={}));m.util.setEnumType(Ve,"livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]);var Nt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",e.layers=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Nt.runtime=m;Nt.typeName="livekit.UpdateVideoLayers";Nt.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:je,repeated:!0}]});var Dt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.metadata="",e.name="",e.attributes={},e.requestId=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Dt.runtime=m;Dt.typeName="livekit.UpdateParticipantMetadata";Dt.fields=m.util.newFieldList(function(){return[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]});var At=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.urls=[],e.username="",e.credential="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);At.runtime=m;At.typeName="livekit.ICEServer";At.fields=m.util.newFieldList(function(){return[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]});var Oi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.speakers=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Oi.runtime=m;Oi.typeName="livekit.SpeakersChanged";Oi.fields=m.util.newFieldList(function(){return[{no:1,name:"speakers",kind:"message",T:kt,repeated:!0}]});var Ni=function(r){function t(i){var e;return P(this,t),e=O(this,t),m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ni.runtime=m;Ni.typeName="livekit.RoomUpdate";Ni.fields=m.util.newFieldList(function(){return[{no:1,name:"room",kind:"message",T:Vn}]});var Di=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.quality=Ze.POOR,e.score=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Di.runtime=m;Di.typeName="livekit.ConnectionQualityInfo";Di.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:m.getEnumType(Ze)},{no:3,name:"score",kind:"scalar",T:2}]});var Ai=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.updates=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ai.runtime=m;Ai.typeName="livekit.ConnectionQualityUpdate";Ai.fields=m.util.newFieldList(function(){return[{no:1,name:"updates",kind:"message",T:Di,repeated:!0}]});var Mi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.trackSid="",e.state=kn.ACTIVE,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Mi.runtime=m;Mi.typeName="livekit.StreamStateInfo";Mi.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:m.getEnumType(kn)}]});var Li=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.streamStates=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Li.runtime=m;Li.typeName="livekit.StreamStateUpdate";Li.fields=m.util.newFieldList(function(){return[{no:1,name:"stream_states",kind:"message",T:Mi,repeated:!0}]});var zn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.quality=De.LOW,e.enabled=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);zn.runtime=m;zn.typeName="livekit.SubscribedQuality";zn.fields=m.util.newFieldList(function(){return[{no:1,name:"quality",kind:"enum",T:m.getEnumType(De)},{no:2,name:"enabled",kind:"scalar",T:8}]});var Ui=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.codec="",e.qualities=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ui.runtime=m;Ui.typeName="livekit.SubscribedCodec";Ui.fields=m.util.newFieldList(function(){return[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:zn,repeated:!0}]});var Ji=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",e.subscribedQualities=[],e.subscribedCodecs=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ji.runtime=m;Ji.typeName="livekit.SubscribedQualityUpdate";Ji.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:zn,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Ui,repeated:!0}]});var Mt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.allTracks=!1,e.trackSids=[],e.participantIdentity="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Mt.runtime=m;Mt.typeName="livekit.TrackPermission";Mt.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]});var Lt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.allParticipants=!1,e.trackPermissions=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Lt.runtime=m;Lt.typeName="livekit.SubscriptionPermission";Lt.fields=m.util.newFieldList(function(){return[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Mt,repeated:!0}]});var Bi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.trackSid="",e.allowed=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Bi.runtime=m;Bi.typeName="livekit.SubscriptionPermissionUpdate";Bi.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]});var Ut=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.publishTracks=[],e.dataChannels=[],e.trackSidsDisabled=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ut.runtime=m;Ut.typeName="livekit.SyncState";Ut.fields=m.util.newFieldList(function(){return[{no:1,name:"answer",kind:"message",T:Ge},{no:2,name:"subscription",kind:"message",T:yn},{no:3,name:"publish_tracks",kind:"message",T:Hn,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Jt,repeated:!0},{no:5,name:"offer",kind:"message",T:Ge},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]});var Jt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.label="",e.id=0,e.target=ye.PUBLISHER,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Jt.runtime=m;Jt.typeName="livekit.DataChannelInfo";Jt.fields=m.util.newFieldList(function(){return[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:m.getEnumType(ye)}]});var Ee=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.scenario={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ee.runtime=m;Ee.typeName="livekit.SimulateScenario";Ee.fields=m.util.newFieldList(function(){return[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:m.getEnumType(ti),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]});var Bt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.timestamp=V.zero,e.rtt=V.zero,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Bt.runtime=m;Bt.typeName="livekit.Ping";Bt.fields=m.util.newFieldList(function(){return[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]});var Fi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.lastPingTimestamp=V.zero,e.timestamp=V.zero,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Fi.runtime=m;Fi.typeName="livekit.Pong";Fi.fields=m.util.newFieldList(function(){return[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]});var _i=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.regions=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);_i.runtime=m;_i.typeName="livekit.RegionSettings";_i.fields=m.util.newFieldList(function(){return[{no:1,name:"regions",kind:"message",T:qi,repeated:!0}]});var qi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.region="",e.url="",e.distance=V.zero,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);qi.runtime=m;qi.typeName="livekit.RegionInfo";qi.fields=m.util.newFieldList(function(){return[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]});var ji=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",e.err=dt.SE_UNKNOWN,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);ji.runtime=m;ji.typeName="livekit.SubscriptionResponse";ji.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:m.getEnumType(dt)}]});var Vi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.requestId=0,e.reason=_n.OK,e.message="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Vi.runtime=m;Vi.typeName="livekit.RequestResponse";Vi.fields=m.util.newFieldList(function(){return[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:m.getEnumType(_n)},{no:3,name:"message",kind:"scalar",T:9}]});var _n;(function(r){r[r.OK=0]="OK",r[r.NOT_FOUND=1]="NOT_FOUND",r[r.NOT_ALLOWED=2]="NOT_ALLOWED",r[r.LIMIT_EXCEEDED=3]="LIMIT_EXCEEDED"})(_n||(_n={}));m.util.setEnumType(_n,"livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]);var Gi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Gi.runtime=m;Gi.typeName="livekit.TrackSubscribed";Gi.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9}]});var Wi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.roomName="",e.egressId="",e.nodeId="",e.timestamp=V.zero,e.connId="",e.errorMessage="",e.isNormalClosure=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Wi.runtime=m;Wi.typeName="livekit.HealthCheck";Wi.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"room_name",kind:"scalar",T:9},{no:3,name:"egress_id",kind:"scalar",T:9},{no:4,name:"node_id",kind:"scalar",T:9},{no:5,name:"timestamp",kind:"scalar",T:3},{no:6,name:"conn_id",kind:"scalar",T:9},{no:7,name:"error_message",kind:"scalar",T:9},{no:8,name:"is_normal_closure",kind:"scalar",T:8}]});var Hi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.connId="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Hi.runtime=m;Hi.typeName="livekit.HealthCheckResponse";Hi.fields=m.util.newFieldList(function(){return[{no:1,name:"conn_id",kind:"scalar",T:9}]});var Hr=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sdk=vt.UNKNOWN,e.os="",e.deviceId="",e.date="",e.ipaddress="",e.nwSignalStrength="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Hr.runtime=m;Hr.typeName="livekit.DeviceInfo";Hr.fields=m.util.newFieldList(function(){return[{no:1,name:"sdk",kind:"enum",T:m.getEnumType(vt)},{no:2,name:"os",kind:"scalar",T:9},{no:3,name:"deviceId",kind:"scalar",T:9},{no:4,name:"date",kind:"scalar",T:9},{no:5,name:"ipaddress",kind:"scalar",T:9},{no:6,name:"nw_signal_strength",kind:"scalar",T:9}]});var vt;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.JS=1]="JS",r[r.SWIFT=2]="SWIFT",r[r.ANDROID=3]="ANDROID",r[r.FLUTTER=4]="FLUTTER",r[r.GO=5]="GO",r[r.UNITY=6]="UNITY",r[r.REACT_NATIVE=7]="REACT_NATIVE",r[r.RUST=8]="RUST"})(vt||(vt={}));m.util.setEnumType(vt,"livekit.DeviceInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"}]);var zr={exports:{}},On=(typeof Reflect>"u"?"undefined":j(Reflect))==="object"?Reflect:null,ya=On&&typeof On.apply=="function"?On.apply:function(t,i,e){return Function.prototype.apply.call(t,i,e)},zt;On&&typeof On.ownKeys=="function"?zt=On.ownKeys:Object.getOwnPropertySymbols?zt=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:zt=function(t){return Object.getOwnPropertyNames(t)};function Gu(r){console&&console.warn&&console.warn(r)}var Ss=Number.isNaN||function(t){return t!==t};function te(){te.init.call(this)}zr.exports=te;zr.exports.once=Ku;te.EventEmitter=te;te.prototype._events=void 0;te.prototype._eventsCount=0;te.prototype._maxListeners=void 0;var ba=10;function zi(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+j(r))}Object.defineProperty(te,"defaultMaxListeners",{enumerable:!0,get:function(){return ba},set:function(t){if(typeof t!="number"||t<0||Ss(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");ba=t}});te.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};te.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Ss(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Cs(r){return r._maxListeners===void 0?te.defaultMaxListeners:r._maxListeners}te.prototype.getMaxListeners=function(){return Cs(this)};te.prototype.emit=function(t){for(var i=[],e=1;e<arguments.length;e++)i.push(arguments[e]);var n=t==="error",a=this._events;if(a!==void 0)n=n&&a.error===void 0;else if(!n)return!1;if(n){var s;if(i.length>0&&(s=i[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var u=a[t];if(u===void 0)return!1;if(typeof u=="function")ya(u,this,i);else for(var c=u.length,l=Is(u,c),e=0;e<c;++e)ya(l[e],this,i);return!0};function ws(r,t,i,e){var n,a,s;if(zi(i),a=r._events,a===void 0?(a=r._events=Object.create(null),r._eventsCount=0):(a.newListener!==void 0&&(r.emit("newListener",t,i.listener?i.listener:i),a=r._events),s=a[t]),s===void 0)s=a[t]=i,++r._eventsCount;else if(typeof s=="function"?s=a[t]=e?[i,s]:[s,i]:e?s.unshift(i):s.push(i),n=Cs(r),n>0&&s.length>n&&!s.warned){s.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=t,o.count=s.length,Gu(o)}return r}te.prototype.addListener=function(t,i){return ws(this,t,i,!1)};te.prototype.on=te.prototype.addListener;te.prototype.prependListener=function(t,i){return ws(this,t,i,!0)};function Wu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ps(r,t,i){var e={fired:!1,wrapFn:void 0,target:r,type:t,listener:i},n=Wu.bind(e);return n.listener=i,e.wrapFn=n,n}te.prototype.once=function(t,i){return zi(i),this.on(t,Ps(this,t,i)),this};te.prototype.prependOnceListener=function(t,i){return zi(i),this.prependListener(t,Ps(this,t,i)),this};te.prototype.removeListener=function(t,i){var e,n,a,s,o;if(zi(i),n=this._events,n===void 0)return this;if(e=n[t],e===void 0)return this;if(e===i||e.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,e.listener||i));else if(typeof e!="function"){for(a=-1,s=e.length-1;s>=0;s--)if(e[s]===i||e[s].listener===i){o=e[s].listener,a=s;break}if(a<0)return this;a===0?e.shift():Hu(e,a),e.length===1&&(n[t]=e[0]),n.removeListener!==void 0&&this.emit("removeListener",t,o||i)}return this};te.prototype.off=te.prototype.removeListener;te.prototype.removeAllListeners=function(t){var i,e,n;if(e=this._events,e===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete e[t]),this;if(arguments.length===0){var a=Object.keys(e),s;for(n=0;n<a.length;++n)s=a[n],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=e[t],typeof i=="function")this.removeListener(t,i);else if(i!==void 0)for(n=i.length-1;n>=0;n--)this.removeListener(t,i[n]);return this};function Es(r,t,i){var e=r._events;if(e===void 0)return[];var n=e[t];return n===void 0?[]:typeof n=="function"?i?[n.listener||n]:[n]:i?zu(n):Is(n,n.length)}te.prototype.listeners=function(t){return Es(this,t,!0)};te.prototype.rawListeners=function(t){return Es(this,t,!1)};te.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):Rs.call(r,t)};te.prototype.listenerCount=Rs;function Rs(r){var t=this._events;if(t!==void 0){var i=t[r];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}te.prototype.eventNames=function(){return this._eventsCount>0?zt(this._events):[]};function Is(r,t){for(var i=new Array(t),e=0;e<t;++e)i[e]=r[e];return i}function Hu(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function zu(r){for(var t=new Array(r.length),i=0;i<t.length;++i)t[i]=r[i].listener||r[i];return t}function Ku(r,t){return new Promise(function(i,e){function n(s){r.removeListener(t,a),e(s)}function a(){typeof r.removeListener=="function"&&r.removeListener("error",n),i([].slice.call(arguments))}Os(r,t,a,{once:!0}),t!=="error"&&Yu(r,n,{once:!0})})}function Yu(r,t,i){typeof r.on=="function"&&Os(r,"error",t,i)}function Os(r,t,i,e){if(typeof r.on=="function")e.once?r.once(t,i):r.on(t,i);else if(typeof r.addEventListener=="function")r.addEventListener(t,function n(a){e.once&&r.removeEventListener(t,n),i(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+j(r))}var He=zr.exports,Ns=!0,Ds=!0;function nt(r,t,i){var e=r.match(t);return e&&e.length>=i&&parseFloat(e[i],10)}function Tn(r,t,i){if(r.RTCPeerConnection){var e=r.RTCPeerConnection.prototype,n=e.addEventListener;e.addEventListener=function(s,o){if(s!==t)return n.apply(this,arguments);var u=function(l){var d=i(l);d&&(o.handleEvent?o.handleEvent(d):o(d))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(o,u),n.apply(this,[s,u])};var a=e.removeEventListener;e.removeEventListener=function(s,o){if(s!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(o))return a.apply(this,arguments);var u=this._eventMap[t].get(o);return this._eventMap[t].delete(o),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[s,u])},Object.defineProperty(e,"on"+t,{get:function(){return this["_on"+t]},set:function(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}}function Qu(r){return typeof r!="boolean"?new Error("Argument type: "+j(r)+". Please use a boolean."):(Ns=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function Xu(r){return typeof r!="boolean"?new Error("Argument type: "+j(r)+". Please use a boolean."):(Ds=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function As(){if((typeof window>"u"?"undefined":j(window))==="object"){if(Ns)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Kr(r,t){Ds&&console.warn(r+" is deprecated, please use "+t+" instead.")}function Zu(r){var t={browser:null,version:null};if(typeof r>"u"||!r.navigator||!r.navigator.userAgent)return t.browser="Not a browser.",t;var i=r.navigator;if(i.mozGetUserMedia)t.browser="firefox",t.version=parseInt(nt(i.userAgent,/Firefox\/(\d+)\./,1));else if(i.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(nt(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(r.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(nt(i.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype,t._safariVersion=nt(i.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function Ta(r){return Object.prototype.toString.call(r)==="[object Object]"}function Ms(r){return Ta(r)?Object.keys(r).reduce(function(t,i){var e=Ta(r[i]),n=e?Ms(r[i]):r[i],a=e&&!Object.keys(n).length;return n===void 0||a?t:Object.assign(t,gt({},i,n))},{}):r}function gr(r,t,i){!t||i.has(t.id)||(i.set(t.id,t),Object.keys(t).forEach(function(e){e.endsWith("Id")?gr(r,r.get(t[e]),i):e.endsWith("Ids")&&t[e].forEach(function(n){gr(r,r.get(n),i)})}))}function Sa(r,t,i){var e=i?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;var a=[];return r.forEach(function(s){s.type==="track"&&s.trackIdentifier===t.id&&a.push(s)}),a.forEach(function(s){r.forEach(function(o){o.type===e&&o.trackId===s.id&&gr(r,o,n)})}),n}var Ca=As;function Ls(r,t){var i=r&&r.navigator;if(i.mediaDevices){var e=function(c){if(j(c)!=="object"||c.mandatory||c.optional)return c;var l={};return Object.keys(c).forEach(function(d){if(!(d==="require"||d==="advanced"||d==="mediaSource")){var f=j(c[d])==="object"?c[d]:{ideal:c[d]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);var h=function(k,y){return k?k+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(f.ideal!==void 0){l.optional=l.optional||[];var p={};typeof f.ideal=="number"?(p[h("min",d)]=f.ideal,l.optional.push(p),p={},p[h("max",d)]=f.ideal,l.optional.push(p)):(p[h("",d)]=f.ideal,l.optional.push(p))}f.exact!==void 0&&typeof f.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[h("",d)]=f.exact):["min","max"].forEach(function(g){f[g]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[h(g,d)]=f[g])})}}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},n=function(c,l){if(t.version>=61)return l(c);if(c=JSON.parse(JSON.stringify(c)),c&&j(c.audio)==="object"){var d=function(k,y,T){y in k&&!(T in k)&&(k[T]=k[y],delete k[y])};c=JSON.parse(JSON.stringify(c)),d(c.audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=e(c.audio)}if(c&&j(c.video)==="object"){var f=c.video.facingMode;f=f&&(j(f)==="object"?f:{ideal:f});var h=t.version<66;if(f&&(f.exact==="user"||f.exact==="environment"||f.ideal==="user"||f.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete c.video.facingMode;var p;if(f.exact==="environment"||f.ideal==="environment"?p=["back","rear"]:(f.exact==="user"||f.ideal==="user")&&(p=["front"]),p)return i.mediaDevices.enumerateDevices().then(function(g){g=g.filter(function(y){return y.kind==="videoinput"});var k=g.find(function(y){return p.some(function(T){return y.label.toLowerCase().includes(T)})});return!k&&g.length&&p.includes("back")&&(k=g[g.length-1]),k&&(c.video.deviceId=f.exact?{exact:k.deviceId}:{ideal:k.deviceId}),c.video=e(c.video),Ca("chrome: "+JSON.stringify(c)),l(c)})}c.video=e(c.video)}return Ca("chrome: "+JSON.stringify(c)),l(c)},a=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(c,l,d){n(c,function(f){i.webkitGetUserMedia(f,l,function(h){d&&d(a(h))})})};if(i.getUserMedia=s.bind(i),i.mediaDevices.getUserMedia){var o=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(u){return n(u,function(c){return o(c).then(function(l){if(c.audio&&!l.getAudioTracks().length||c.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(function(d){d.stop()}),new DOMException("","NotFoundError");return l},function(l){return Promise.reject(a(l))})})}}}}function $u(r,t){if(!(r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices)&&r.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}r.navigator.mediaDevices.getDisplayMedia=function(e){return t(e).then(function(n){var a=e.video&&e.video.width,s=e.video&&e.video.height,o=e.video&&e.video.frameRate;return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:o||3}},a&&(e.video.mandatory.maxWidth=a),s&&(e.video.mandatory.maxHeight=s),r.navigator.mediaDevices.getUserMedia(e)})}}}function Us(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function Js(r){if(j(r)==="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._ontrackpoly||(this._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(a){var s;r.RTCPeerConnection.prototype.getReceivers?s=e.getReceivers().find(function(u){return u.track&&u.track.id===a.track.id}):s={track:a.track};var o=new Event("track");o.track=a.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[n.stream],e.dispatchEvent(o)}),n.stream.getTracks().forEach(function(a){var s;r.RTCPeerConnection.prototype.getReceivers?s=e.getReceivers().find(function(u){return u.track&&u.track.id===a.id}):s={track:a};var o=new Event("track");o.track=a,o.receiver=s,o.transceiver={receiver:s},o.streams=[n.stream],e.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Tn(r,"track",function(i){return i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i})}function Bs(r){if(j(r)==="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){var t=function(u,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=u.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:u}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var i=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(u,c){var l=i.apply(this,arguments);return l||(l=t(this,u),this._senders.push(l)),l};var e=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(u){e.apply(this,arguments);var c=this._senders.indexOf(u);c!==-1&&this._senders.splice(c,1)}}var n=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(u){var c=this;this._senders=this._senders||[],n.apply(this,[u]),u.getTracks().forEach(function(l){c._senders.push(t(c,l))})};var a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(u){var c=this;this._senders=this._senders||[],a.apply(this,[u]),u.getTracks().forEach(function(l){var d=c._senders.find(function(f){return f.track===l});d&&c._senders.splice(c._senders.indexOf(d),1)})}}else if(j(r)==="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){var s=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){var u=this,c=s.apply(this,[]);return c.forEach(function(l){return l._pc=u}),c},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Fs(r){if(r.RTCPeerConnection){var t=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),a=n[0],s=n[1],o=n[2];if(arguments.length>0&&typeof a=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof a!="function"))return t.apply(this,[]);var u=function(f){var h={},p=f.result();return p.forEach(function(g){var k={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(function(y){k[y]=g.stat(y)}),h[k.id]=k}),h},c=function(f){return new Map(Object.keys(f).map(function(h){return[h,f[h]]}))};if(arguments.length>=2){var l=function(f){s(c(u(f)))};return t.apply(this,[l,a])}return new Promise(function(d,f){t.apply(e,[function(h){d(c(u(h)))},f])}).then(s,o)}}}function _s(r){if(j(r)==="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver){if(!("getStats"in r.RTCRtpSender.prototype)){var t=r.RTCPeerConnection.prototype.getSenders;t&&(r.RTCPeerConnection.prototype.getSenders=function(){var s=this,o=t.apply(this,[]);return o.forEach(function(u){return u._pc=s}),o});var i=r.RTCPeerConnection.prototype.addTrack;i&&(r.RTCPeerConnection.prototype.addTrack=function(){var s=i.apply(this,arguments);return s._pc=this,s}),r.RTCRtpSender.prototype.getStats=function(){var s=this;return this._pc.getStats().then(function(o){return Sa(o,s.track,!0)})}}if(!("getStats"in r.RTCRtpReceiver.prototype)){var e=r.RTCPeerConnection.prototype.getReceivers;e&&(r.RTCPeerConnection.prototype.getReceivers=function(){var s=this,o=e.apply(this,[]);return o.forEach(function(u){return u._pc=s}),o}),Tn(r,"track",function(a){return a.receiver._pc=a.srcElement,a}),r.RTCRtpReceiver.prototype.getStats=function(){var s=this;return this._pc.getStats().then(function(o){return Sa(o,s.track,!1)})}}if("getStats"in r.RTCRtpSender.prototype&&"getStats"in r.RTCRtpReceiver.prototype){var n=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){var s=arguments[0],o,u,c;return this.getSenders().forEach(function(l){l.track===s&&(o?c=!0:o=l)}),this.getReceivers().forEach(function(l){return l.track===s&&(u?c=!0:u=l),l.track===s}),c||o&&u?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():u?u.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}}}function qs(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){var s=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(o){return s._shimmedLocalStreams[o][0]})};var t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var u=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(u)===-1&&this._shimmedLocalStreams[o.id].push(u):this._shimmedLocalStreams[o.id]=[o,u],u};var i=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(s){var o=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(function(l){var d=o.getSenders().find(function(f){return f.track===l});if(d)throw new DOMException("Track already exists.","InvalidAccessError")});var u=this.getSenders();i.apply(this,arguments);var c=this.getSenders().filter(function(l){return u.indexOf(l)===-1});this._shimmedLocalStreams[s.id]=[s].concat(c)};var e=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],e.apply(this,arguments)};var n=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(s){var o=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(function(u){var c=o._shimmedLocalStreams[u].indexOf(s);c!==-1&&o._shimmedLocalStreams[u].splice(c,1),o._shimmedLocalStreams[u].length===1&&delete o._shimmedLocalStreams[u]}),n.apply(this,arguments)}}function js(r,t){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&t.version>=65)return qs(r);var i=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){var l=this,d=i.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(function(f){return l._reverseStreams[f.id]})};var e=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(l){var d=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(function(h){var p=d.getSenders().find(function(g){return g.track===h});if(p)throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){var f=new r.MediaStream(l.getTracks());this._streams[l.id]=f,this._reverseStreams[f.id]=l,l=f}e.apply(this,[l])};var n=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},r.RTCPeerConnection.prototype.addTrack=function(l,d){var f=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(function(y){return y===l}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var p=this.getSenders().find(function(y){return y.track===l});if(p)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var g=this._streams[d.id];if(g)g.addTrack(l),Promise.resolve().then(function(){f.dispatchEvent(new Event("negotiationneeded"))});else{var k=new r.MediaStream([l]);this._streams[d.id]=k,this._reverseStreams[k.id]=d,this.addStream(k)}return this.getSenders().find(function(y){return y.track===l})};function a(c,l){var d=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(function(f){var h=c._reverseStreams[f],p=c._streams[h.id];d=d.replace(new RegExp(p.id,"g"),h.id)}),new RTCSessionDescription({type:l.type,sdp:d})}function s(c,l){var d=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(function(f){var h=c._reverseStreams[f],p=c._streams[h.id];d=d.replace(new RegExp(h.id,"g"),p.id)}),new RTCSessionDescription({type:l.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){var l=r.RTCPeerConnection.prototype[c],d=gt({},c,function(){var f=this,h=arguments,p=arguments.length&&typeof arguments[0]=="function";return p?l.apply(this,[function(g){var k=a(f,g);h[0].apply(null,[k])},function(g){h[1]&&h[1].apply(null,g)},arguments[2]]):l.apply(this,arguments).then(function(g){return a(f,g)})});r.RTCPeerConnection.prototype[c]=d[c]});var o=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=s(this,arguments[0]),o.apply(this,arguments))};var u=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get:function(){var l=u.get.apply(this);return l.type===""?l:a(this,l)}}),r.RTCPeerConnection.prototype.removeTrack=function(l){var d=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var f=l._pc===this;if(!f)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var h;Object.keys(this._streams).forEach(function(p){var g=d._streams[p].getTracks().find(function(k){return l.track===k});g&&(h=d._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function kr(r,t){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){var e=r.RTCPeerConnection.prototype[i],n=gt({},i,function(){return arguments[0]=new(i==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)});r.RTCPeerConnection.prototype[i]=n[i]})}function Vs(r,t){Tn(r,"negotiationneeded",function(i){var e=i.target;if(!((t.version<72||e.getConfiguration&&e.getConfiguration().sdpSemantics==="plan-b")&&e.signalingState!=="stable"))return i})}var wa=Object.freeze({__proto__:null,fixNegotiationNeeded:Vs,shimAddTrackRemoveTrack:js,shimAddTrackRemoveTrackWithNative:qs,shimGetDisplayMedia:$u,shimGetSendersWithDtmf:Bs,shimGetStats:Fs,shimGetUserMedia:Ls,shimMediaStream:Us,shimOnTrack:Js,shimPeerConnection:kr,shimSenderReceiverGetStats:_s});function Gs(r,t){var i=r&&r.navigator,e=r&&r.MediaStreamTrack;if(i.getUserMedia=function(u,c,l){Kr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(u).then(c,l)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){var n=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},a=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(u){return j(u)==="object"&&j(u.audio)==="object"&&(u=JSON.parse(JSON.stringify(u)),n(u.audio,"autoGainControl","mozAutoGainControl"),n(u.audio,"noiseSuppression","mozNoiseSuppression")),a(u)},e&&e.prototype.getSettings){var s=e.prototype.getSettings;e.prototype.getSettings=function(){var u=s.apply(this,arguments);return n(u,"mozAutoGainControl","autoGainControl"),n(u,"mozNoiseSuppression","noiseSuppression"),u}}if(e&&e.prototype.applyConstraints){var o=e.prototype.applyConstraints;e.prototype.applyConstraints=function(u){return this.kind==="audio"&&j(u)==="object"&&(u=JSON.parse(JSON.stringify(u)),n(u,"autoGainControl","mozAutoGainControl"),n(u,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[u])}}}}function xu(r,t){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(e){if(!(e&&e.video)){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return e.video===!0?e.video={mediaSource:t}:e.video.mediaSource=t,r.navigator.mediaDevices.getUserMedia(e)})}function Ws(r){j(r)==="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function yr(r,t){if(!(j(r)!=="object"||!(r.RTCPeerConnection||r.mozRTCPeerConnection))){!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){var a=r.RTCPeerConnection.prototype[n],s=gt({},n,function(){return arguments[0]=new(n==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)});r.RTCPeerConnection.prototype[n]=s[n]});var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){var a=Array.prototype.slice.call(arguments),s=a[0],o=a[1],u=a[2];return e.apply(this,[s||null]).then(function(c){if(t.version<53&&!o)try{c.forEach(function(l){l.type=i[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach(function(d,f){c.set(f,Object.assign({},d,{type:i[d.type]||d.type}))})}return c}).then(o,u)}}}function Hs(r){if(j(r)==="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&!(r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)){var t=r.RTCPeerConnection.prototype.getSenders;t&&(r.RTCPeerConnection.prototype.getSenders=function(){var n=this,a=t.apply(this,[]);return a.forEach(function(s){return s._pc=n}),a});var i=r.RTCPeerConnection.prototype.addTrack;i&&(r.RTCPeerConnection.prototype.addTrack=function(){var n=i.apply(this,arguments);return n._pc=this,n}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function zs(r){if(j(r)==="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&!(r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)){var t=r.RTCPeerConnection.prototype.getReceivers;t&&(r.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach(function(a){return a._pc=e}),n}),Tn(r,"track",function(i){return i.receiver._pc=i.srcElement,i}),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function Ks(r){!r.RTCPeerConnection||"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(i){var e=this;Kr("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&i.getTracks().includes(n.track)&&e.removeTrack(n)})})}function Ys(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function Qs(r){if(j(r)==="object"&&r.RTCPeerConnection){var t=r.RTCPeerConnection.prototype.addTransceiver;t&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;e===void 0&&(e=[]),e=Oe(e);var n=e.length>0;n&&e.forEach(function(u){if("rid"in u){var c=/^[a-z0-9]{0,16}$/i;if(!c.test(u.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var a=t.apply(this,arguments);if(n){var s=a.sender,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=e,s.sendEncodings=e,this.setParametersPromises.push(s.setParameters(o).then(function(){delete s.sendEncodings}).catch(function(){delete s.sendEncodings})))}return a})}}function Xs(r){if(j(r)==="object"&&r.RTCRtpSender){var t=r.RTCRtpSender.prototype.getParameters;t&&(r.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function Zs(r){if(j(r)==="object"&&r.RTCPeerConnection){var t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(n,e)}).finally(function(){n.setParametersPromises=[]}):t.apply(this,arguments)}}}function $s(r){if(j(r)==="object"&&r.RTCPeerConnection){var t=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(n,e)}).finally(function(){n.setParametersPromises=[]}):t.apply(this,arguments)}}}var Pa=Object.freeze({__proto__:null,shimAddTransceiver:Qs,shimCreateAnswer:$s,shimCreateOffer:Zs,shimGetDisplayMedia:xu,shimGetParameters:Xs,shimGetUserMedia:Gs,shimOnTrack:Ws,shimPeerConnection:yr,shimRTCDataChannel:Ys,shimReceiverGetStats:zs,shimRemoveStream:Ks,shimSenderGetStats:Hs});function xs(r){if(!(j(r)!=="object"||!r.RTCPeerConnection)){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){var t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(a){return t.call(n,a,e)}),e.getVideoTracks().forEach(function(a){return t.call(n,a,e)})},r.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,a=arguments.length,s=new Array(a>1?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];return s&&s.forEach(function(u){n._localStreams?n._localStreams.includes(u)||n._localStreams.push(u):n._localStreams=[u]}),t.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(e){var n=this;this._localStreams||(this._localStreams=[]);var a=this._localStreams.indexOf(e);if(a!==-1){this._localStreams.splice(a,1);var s=e.getTracks();this.getSenders().forEach(function(o){s.includes(o.track)&&n.removeTrack(o)})}})}}function eo(r){if(!(j(r)!=="object"||!r.RTCPeerConnection)&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var n=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(function(s){if(n._remoteStreams||(n._remoteStreams=[]),!n._remoteStreams.includes(s)){n._remoteStreams.push(s);var o=new Event("addstream");o.stream=s,n.dispatchEvent(o)}})})}});var t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(function(a){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(a)>=0)){e._remoteStreams.push(a);var s=new Event("addstream");s.stream=a,e.dispatchEvent(s)}})}),t.apply(e,arguments)}}}function no(r){if(!(j(r)!=="object"||!r.RTCPeerConnection)){var t=r.RTCPeerConnection.prototype,i=t.createOffer,e=t.createAnswer,n=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(c,l){var d=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[d]);return l?(f.then(c,l),Promise.resolve()):f},t.createAnswer=function(c,l){var d=arguments.length>=2?arguments[2]:arguments[0],f=e.apply(this,[d]);return l?(f.then(c,l),Promise.resolve()):f};var o=function(c,l,d){var f=n.apply(this,[c]);return d?(f.then(l,d),Promise.resolve()):f};t.setLocalDescription=o,o=function(c,l,d){var f=a.apply(this,[c]);return d?(f.then(l,d),Promise.resolve()):f},t.setRemoteDescription=o,o=function(c,l,d){var f=s.apply(this,[c]);return d?(f.then(l,d),Promise.resolve()):f},t.addIceCandidate=o}}function to(r){var t=r&&r.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var i=t.mediaDevices,e=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=function(n){return e(io(n))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(a,s,o){t.mediaDevices.getUserMedia(a).then(s,o)}).bind(t))}function io(r){return r&&r.video!==void 0?Object.assign({},r,{video:Ms(r.video)}):r}function ro(r){if(r.RTCPeerConnection){var t=r.RTCPeerConnection;r.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var a=[],s=0;s<e.iceServers.length;s++){var o=e.iceServers[s];o.urls===void 0&&o.url?(Kr("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,a.push(o)):a.push(e.iceServers[s])}e.iceServers=a}return new t(e,n)},r.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function ao(r){j(r)==="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function so(r){var t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(e){if(e){typeof e.offerToReceiveAudio<"u"&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find(function(s){return s.receiver.track.kind==="audio"});e.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):e.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof e.offerToReceiveVideo<"u"&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var a=this.getTransceivers().find(function(s){return s.receiver.track.kind==="video"});e.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):e.offerToReceiveVideo===!0&&!a&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function oo(r){j(r)!=="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}var Ea=Object.freeze({__proto__:null,shimAudioContext:oo,shimCallbacksAPI:no,shimConstraints:io,shimCreateOfferLegacy:so,shimGetUserMedia:to,shimLocalStreamsAPI:xs,shimRTCIceServerUrls:ro,shimRemoteStreamsAPI:eo,shimTrackEventTransceiver:ao}),uo={exports:{}};(function(r){var t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(function(e){return e.trim()})},t.splitSections=function(i){var e=i.split(`
m=`);return e.map(function(n,a){return(a>0?"m="+n:n).trim()+`\r
`})},t.getDescription=function(i){var e=t.splitSections(i);return e&&e[0]},t.getMediaSections=function(i){var e=t.splitSections(i);return e.shift(),e},t.matchPrefix=function(i,e){return t.splitLines(i).filter(function(n){return n.indexOf(e)===0})},t.parseCandidate=function(i){var e;i.indexOf("a=candidate:")===0?e=i.substring(12).split(" "):e=i.substring(10).split(" ");for(var n={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]},a=8;a<e.length;a+=2)switch(e[a]){case"raddr":n.relatedAddress=e[a+1];break;case"rport":n.relatedPort=parseInt(e[a+1],10);break;case"tcptype":n.tcpType=e[a+1];break;case"ufrag":n.ufrag=e[a+1],n.usernameFragment=e[a+1];break;default:n[e[a]]===void 0&&(n[e[a]]=e[a+1]);break}return n},t.writeCandidate=function(i){var e=[];e.push(i.foundation);var n=i.component;n==="rtp"?e.push(1):n==="rtcp"?e.push(2):e.push(n),e.push(i.protocol.toUpperCase()),e.push(i.priority),e.push(i.address||i.ip),e.push(i.port);var a=i.type;return e.push("typ"),e.push(a),a!=="host"&&i.relatedAddress&&i.relatedPort&&(e.push("raddr"),e.push(i.relatedAddress),e.push("rport"),e.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(e.push("tcptype"),e.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(e.push("ufrag"),e.push(i.usernameFragment||i.ufrag)),"candidate:"+e.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){var e=i.substring(9).split(" "),n={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),n.name=e[0],n.clockRate=parseInt(e[1],10),n.channels=e.length===3?parseInt(e[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(i){var e=i.payloadType;i.preferredPayloadType!==void 0&&(e=i.preferredPayloadType);var n=i.channels||i.numChannels||1;return"a=rtpmap:"+e+" "+i.name+"/"+i.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(i){var e=i.substring(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1],attributes:e.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){for(var e={},n,a=i.substring(i.indexOf(" ")+1).split(";"),s=0;s<a.length;s++)n=a[s].trim().split("="),e[n[0].trim()]=n[1];return e},t.writeFmtp=function(i){var e="",n=i.payloadType;if(i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){var a=[];Object.keys(i.parameters).forEach(function(s){i.parameters[s]!==void 0?a.push(s+"="+i.parameters[s]):a.push(s)}),e+="a=fmtp:"+n+" "+a.join(";")+`\r
`}return e},t.parseRtcpFb=function(i){var e=i.substring(i.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},t.writeRtcpFb=function(i){var e="",n=i.payloadType;return i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(function(a){e+="a=rtcp-fb:"+n+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),e},t.parseSsrcMedia=function(i){var e=i.indexOf(" "),n={ssrc:parseInt(i.substring(7,e),10)},a=i.indexOf(":",e);return a>-1?(n.attribute=i.substring(e+1,a),n.value=i.substring(a+1)):n.attribute=i.substring(e+1),n},t.parseSsrcGroup=function(i){var e=i.substring(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(function(n){return parseInt(n,10)})}},t.getMid=function(i){var e=t.matchPrefix(i,"a=mid:")[0];if(e)return e.substring(6)},t.parseFingerprint=function(i){var e=i.substring(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}},t.getDtlsParameters=function(i,e){var n=t.matchPrefix(i+e,"a=fingerprint:");return{role:"auto",fingerprints:n.map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,e){var n="a=setup:"+e+`\r
`;return i.fingerprints.forEach(function(a){n+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),n},t.parseCryptoLine=function(i){var e=i.substring(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(j(i.keyParams)==="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;var e=i.substring(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,e){var n=t.matchPrefix(i+e,"a=crypto:");return n.map(t.parseCryptoLine)},t.getIceParameters=function(i,e){var n=t.matchPrefix(i+e,"a=ice-ufrag:")[0],a=t.matchPrefix(i+e,"a=ice-pwd:")[0];return n&&a?{usernameFragment:n.substring(12),password:a.substring(10)}:null},t.writeIceParameters=function(i){var e="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(e+=`a=ice-lite\r
`),e},t.parseRtpParameters=function(i){var e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(i),a=n[0].split(" ");e.profile=a[2];for(var s=3;s<a.length;s++){var o=a[s],u=t.matchPrefix(i,"a=rtpmap:"+o+" ")[0];if(u){var c=t.parseRtpMap(u),l=t.matchPrefix(i,"a=fmtp:"+o+" ");switch(c.parameters=l.length?t.parseFmtp(l[0]):{},c.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),e.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(c.name.toUpperCase());break}}}t.matchPrefix(i,"a=extmap:").forEach(function(f){e.headerExtensions.push(t.parseExtmap(f))});var d=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return e.codecs.forEach(function(f){d.forEach(function(h){var p=f.rtcpFeedback.find(function(g){return g.type===h.type&&g.parameter===h.parameter});p||f.rtcpFeedback.push(h)})}),e},t.writeRtpDescription=function(i,e){var n="";n+="m="+i+" ",n+=e.codecs.length>0?"9":"0",n+=" "+(e.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=e.codecs.map(function(s){return s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType}).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,e.codecs.forEach(function(s){n+=t.writeRtpMap(s),n+=t.writeFmtp(s),n+=t.writeRtcpFb(s)});var a=0;return e.codecs.forEach(function(s){s.maxptime>a&&(a=s.maxptime)}),a>0&&(n+="a=maxptime:"+a+`\r
`),e.headerExtensions&&e.headerExtensions.forEach(function(s){n+=t.writeExtmap(s)}),n},t.parseRtpEncodingParameters=function(i){var e=[],n=t.parseRtpParameters(i),a=n.fecMechanisms.indexOf("RED")!==-1,s=n.fecMechanisms.indexOf("ULPFEC")!==-1,o=t.matchPrefix(i,"a=ssrc:").map(function(f){return t.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),u=o.length>0&&o[0].ssrc,c,l=t.matchPrefix(i,"a=ssrc-group:FID").map(function(f){var h=f.substring(17).split(" ");return h.map(function(p){return parseInt(p,10)})});l.length>0&&l[0].length>1&&l[0][0]===u&&(c=l[0][1]),n.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var h={ssrc:u,codecPayloadType:parseInt(f.parameters.apt,10)};u&&c&&(h.rtx={ssrc:c}),e.push(h),a&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:u,mechanism:s?"red+ulpfec":"red"},e.push(h))}}),e.length===0&&u&&e.push({ssrc:u});var d=t.matchPrefix(i,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,e.forEach(function(f){f.maxBitrate=d})),e},t.parseRtcpParameters=function(i){var e={},n=t.matchPrefix(i,"a=ssrc:").map(function(o){return t.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="cname"})[0];n&&(e.cname=n.value,e.ssrc=n.ssrc);var a=t.matchPrefix(i,"a=rtcp-rsize");e.reducedSize=a.length>0,e.compound=a.length===0;var s=t.matchPrefix(i,"a=rtcp-mux");return e.mux=s.length>0,e},t.writeRtcpParameters=function(i){var e="";return i.reducedSize&&(e+=`a=rtcp-rsize\r
`),i.mux&&(e+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(e+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),e},t.parseMsid=function(i){var e,n=t.matchPrefix(i,"a=msid:");if(n.length===1)return e=n[0].substring(7).split(" "),{stream:e[0],track:e[1]};var a=t.matchPrefix(i,"a=ssrc:").map(function(s){return t.parseSsrcMedia(s)}).filter(function(s){return s.attribute==="msid"});if(a.length>0)return e=a[0].value.split(" "),{stream:e[0],track:e[1]}},t.parseSctpDescription=function(i){var e=t.parseMLine(i),n=t.matchPrefix(i,"a=max-message-size:"),a;n.length>0&&(a=parseInt(n[0].substring(19),10)),isNaN(a)&&(a=65536);var s=t.matchPrefix(i,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:e.fmt,maxMessageSize:a};var o=t.matchPrefix(i,"a=sctpmap:");if(o.length>0){var u=o[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:a}}},t.writeSctpDescription=function(i,e){var n=[];return i.protocol!=="DTLS/SCTP"?n=["m="+i.kind+" 9 "+i.protocol+" "+e.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+e.port+`\r
`]:n=["m="+i.kind+" 9 "+i.protocol+" "+e.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+e.port+" "+e.protocol+` 65535\r
`],e.maxMessageSize!==void 0&&n.push("a=max-message-size:"+e.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,e,n){var a,s=e!==void 0?e:2;i?a=i:a=t.generateSessionId();var o=n||"thisisadapterortc";return`v=0\r
o=`+o+" "+a+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,e){for(var n=t.splitLines(i),a=0;a<n.length;a++)switch(n[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[a].substring(2)}return e?t.getDirection(e):"sendrecv"},t.getKind=function(i){var e=t.splitLines(i),n=e[0].split(" ");return n[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){var e=t.splitLines(i),n=e[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(i){var e=t.matchPrefix(i,"o=")[0],n=e.substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;for(var e=t.splitLines(i),n=0;n<e.length;n++)if(e[n].length<2||e[n].charAt(1)!=="=")return!1;return!0},r.exports=t})(uo);var co=uo.exports,Nn=Fu(co),ec=Do({__proto__:null,default:Nn},[co]);function Kt(r){if(!(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)){var t=r.RTCIceCandidate;r.RTCIceCandidate=function(e){if(j(e)==="object"&&e.candidate&&e.candidate.indexOf("a=")===0&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){var n=new t(e),a=Nn.parseCandidate(e.candidate);for(var s in a)s in n||Object.defineProperty(n,s,{value:a[s]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},r.RTCIceCandidate.prototype=t.prototype,Tn(r,"icecandidate",function(i){return i.candidate&&Object.defineProperty(i,"candidate",{value:new r.RTCIceCandidate(i.candidate),writable:"false"}),i})}}function br(r){!r.RTCIceCandidate||r.RTCIceCandidate&&"relayProtocol"in r.RTCIceCandidate.prototype||Tn(r,"icecandidate",function(t){if(t.candidate){var i=Nn.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function Yt(r,t){if(r.RTCPeerConnection){"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get:function(){return typeof this._sctp>"u"?null:this._sctp}});var i=function(u){if(!u||!u.sdp)return!1;var c=Nn.splitSections(u.sdp);return c.shift(),c.some(function(l){var d=Nn.parseMLine(l);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},e=function(u){var c=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;var l=parseInt(c[1],10);return l!==l?-1:l},n=function(u){var c=65536;return t.browser==="firefox"&&(t.version<57?u===-1?c=16384:c=2147483637:t.version<60?c=t.version===57?65535:65536:c=2147483637),c},a=function(u,c){var l=65536;t.browser==="firefox"&&t.version===57&&(l=65535);var d=Nn.matchPrefix(u.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substring(19),10):t.browser==="firefox"&&c!==-1&&(l=2147483637),l},s=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){var u=this.getConfiguration(),c=u.sdpSemantics;c==="plan-b"&&Object.defineProperty(this,"sctp",{get:function(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){var l=e(arguments[0]),d=n(l),f=a(arguments[0],l),h;d===0&&f===0?h=Number.POSITIVE_INFINITY:d===0||f===0?h=Math.max(d,f):h=Math.min(d,f);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return h}}),this._sctp=p}return s.apply(this,arguments)}}}function Qt(r){if(!(r.RTCPeerConnection&&"createDataChannel"in r.RTCPeerConnection.prototype))return;function t(e,n){var a=e.send;e.send=function(){var o=arguments[0],u=o.length||o.size||o.byteLength;if(e.readyState==="open"&&n.sctp&&u>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return a.apply(e,arguments)}}var i=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){var n=i.apply(this,arguments);return t(n,this),n},Tn(r,"datachannel",function(e){return t(e.channel,e.target),e})}function Tr(r){if(!(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)){var t=r.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(i){var e=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(n){var a=n.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;var s=new Event("connectionstatechange",n);a.dispatchEvent(s)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),e.apply(this,arguments)}})}}function Sr(r,t){if(r.RTCPeerConnection&&!(t.browser==="chrome"&&t.version>=71)&&!(t.browser==="safari"&&t._safariVersion>=13.1)){var i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){var a=n.sdp.split(`
`).filter(function(s){return s.trim()!=="a=extmap-allow-mixed"}).join(`
`);r.RTCSessionDescription&&n instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:n.type,sdp:a}):n.sdp=a}return i.apply(this,arguments)}}}function Xt(r,t){if(r.RTCPeerConnection&&r.RTCPeerConnection.prototype){var i=r.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}function Zt(r,t){if(r.RTCPeerConnection&&r.RTCPeerConnection.prototype){var i=r.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(r.RTCPeerConnection.prototype.setLocalDescription=function(){var n=this,a=arguments[0]||{};if(j(a)!=="object"||a.type&&a.sdp)return i.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer";break}if(a.sdp||a.type!=="offer"&&a.type!=="answer")return i.apply(this,[a]);var s=a.type==="offer"?this.createOffer:this.createAnswer;return s.apply(this).then(function(o){return i.apply(n,[o])})})}}var nc=Object.freeze({__proto__:null,removeExtmapAllowMixed:Sr,shimAddIceCandidateNullOrEmpty:Xt,shimConnectionState:Tr,shimMaxMessageSize:Yt,shimParameterlessSetLocalDescription:Zt,shimRTCIceCandidate:Kt,shimRTCIceCandidateRelayProtocol:br,shimSendThrowTypeError:Qt});function tc(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=r.window,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},e=As,n=Zu(t),a={browserDetails:n,commonShim:nc,extractVersion:nt,disableLog:Qu,disableWarnings:Xu,sdp:ec};switch(n.browser){case"chrome":if(!wa||!kr||!i.shimChrome)return e("Chrome shim is not included in this adapter release."),a;if(n.version===null)return e("Chrome shim can not determine version, not shimming."),a;e("adapter.js shimming chrome."),a.browserShim=wa,Xt(t,n),Zt(t),Ls(t,n),Us(t),kr(t,n),Js(t),js(t,n),Bs(t),Fs(t),_s(t),Vs(t,n),Kt(t),br(t),Tr(t),Yt(t,n),Qt(t),Sr(t,n);break;case"firefox":if(!Pa||!yr||!i.shimFirefox)return e("Firefox shim is not included in this adapter release."),a;e("adapter.js shimming firefox."),a.browserShim=Pa,Xt(t,n),Zt(t),Gs(t,n),yr(t,n),Ws(t),Ks(t),Hs(t),zs(t),Ys(t),Qs(t),Xs(t),Zs(t),$s(t),Kt(t),Tr(t),Yt(t,n),Qt(t);break;case"safari":if(!Ea||!i.shimSafari)return e("Safari shim is not included in this adapter release."),a;e("adapter.js shimming safari."),a.browserShim=Ea,Xt(t,n),Zt(t),ro(t),so(t),no(t),xs(t),eo(t),ao(t),to(t),oo(t),Kt(t),br(t),Yt(t,n),Qt(t),Sr(t,n);break;default:e("Unsupported browser!");break}return a}tc({window:typeof window>"u"?void 0:window});var ic=10,qt="lk_e2ee",rc="LKFrameEncryptionKey",ac={sharedKey:!1,ratchetSalt:rc,ratchetWindowSize:8,failureTolerance:ic,keyringSize:16},sn;(function(r){r.SetKey="setKey",r.RatchetRequest="ratchetRequest",r.KeyRatcheted="keyRatcheted"})(sn||(sn={}));var Ra;(function(r){r.KeyRatcheted="keyRatcheted"})(Ra||(Ra={}));var an;(function(r){r.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",r.EncryptionError="encryptionError"})(an||(an={}));var Ia;(function(r){r.Error="cryptorError"})(Ia||(Ia={}));function sc(){return oc()||Cr()}function Cr(){return typeof window.RTCRtpScriptTransform<"u"}function oc(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function uc(r){return b(this,void 0,void 0,v().m(function t(){var i,e;return v().w(function(n){for(;;)switch(n.n){case 0:return i=new TextEncoder,n.n=1,crypto.subtle.importKey("raw",i.encode(r),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);case 1:return e=n.v,n.a(2,e)}},t)}))}function cc(r){return b(this,void 0,void 0,v().m(function t(){var i;return v().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,crypto.subtle.importKey("raw",r,"HKDF",!1,["deriveBits","deriveKey"]);case 1:return i=e.v,e.a(2,i)}},t)}))}var lc=function(r){function t(){var i,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return P(this,t),i=O(this,t),i.onKeyRatcheted=function(n,a){Z.debug("key ratcheted event received",{material:n,keyIndex:a})},i.keyInfoMap=new Map,i.options=Object.assign(Object.assign({},ac),e),i.on(sn.KeyRatcheted,i.onKeyRatcheted),i}return N(t,r),E(t,[{key:"onSetEncryptionKey",value:function(e,n,a){var s={key:e,participantIdentity:n,keyIndex:a};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(a??0),s),this.emit(sn.SetKey,s)}},{key:"getKeys",value:function(){return Array.from(this.keyInfoMap.values())}},{key:"getOptions",value:function(){return this.options}},{key:"ratchetKey",value:function(e,n){this.emit(sn.RatchetRequest,e,n)}}])}(He.EventEmitter),Ll=function(r){function t(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};P(this,t);var e=Object.assign(Object.assign({},i),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1});return O(this,t,[e])}return N(t,r),E(t,[{key:"setKey",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s;return v().w(function(o){for(;;)switch(o.n){case 0:if(typeof e!="string"){o.n=2;break}return o.n=1,uc(e);case 1:s=o.v,o.n=4;break;case 2:return o.n=3,cc(e);case 3:s=o.v;case 4:a=s,this.onSetEncryptionKey(a);case 5:return o.a(2)}},n,this)}))}}])}(lc),Sn=function(r){function t(i,e){var n;return P(this,t),n=O(this,t,[e||"an error has occured"]),n.code=i,n}return N(t,r),E(t)}(lt(Error)),ie=function(r){function t(i,e,n,a){var s;return P(this,t),s=O(this,t,[1,i]),s.status=n,s.reason=e,s.context=a,s}return N(t,r),E(t)}(Sn),Yr=function(r){function t(i){return P(this,t),O(this,t,[21,i??"device is unsupported"])}return N(t,r),E(t)}(Sn),Xe=function(r){function t(i){return P(this,t),O(this,t,[20,i??"track is invalid"])}return N(t,r),E(t)}(Sn),dc=function(r){function t(i){return P(this,t),O(this,t,[10,i??"unsupported server"])}return N(t,r),E(t)}(Sn),de=function(r){function t(i){return P(this,t),O(this,t,[12,i??"unexpected connection state"])}return N(t,r),E(t)}(Sn),wr=function(r){function t(i){return P(this,t),O(this,t,[13,i??"unable to negotiate"])}return N(t,r),E(t)}(Sn),Oa=function(r){function t(i,e){var n;return P(this,t),n=O(this,t,[15,i]),n.reason=e,n}return N(t,r),E(t)}(Sn),ii;(function(r){r.PermissionDenied="PermissionDenied",r.NotFound="NotFound",r.DeviceInUse="DeviceInUse",r.Other="Other"})(ii||(ii={}));(function(r){function t(i){if(i&&"name"in i)return i.name==="NotFoundError"||i.name==="DevicesNotFoundError"?r.NotFound:i.name==="NotAllowedError"||i.name==="PermissionDeniedError"?r.PermissionDenied:i.name==="NotReadableError"||i.name==="TrackStartError"?r.DeviceInUse:r.Other}r.getFailure=t})(ii||(ii={}));var Na;(function(r){r[r.InvalidKey=0]="InvalidKey",r[r.MissingKey=1]="MissingKey",r[r.InternalError=2]="InternalError"})(Na||(Na={}));var B;(function(r){r.Connected="connected",r.Reconnecting="reconnecting",r.SignalReconnecting="signalReconnecting",r.Reconnected="reconnected",r.Disconnected="disconnected",r.ConnectionStateChanged="connectionStateChanged",r.MediaDevicesChanged="mediaDevicesChanged",r.ParticipantConnected="participantConnected",r.ParticipantDisconnected="participantDisconnected",r.TrackPublished="trackPublished",r.TrackSubscribed="trackSubscribed",r.TrackSubscriptionFailed="trackSubscriptionFailed",r.TrackUnpublished="trackUnpublished",r.TrackUnsubscribed="trackUnsubscribed",r.TrackMuted="trackMuted",r.TrackUnmuted="trackUnmuted",r.LocalTrackPublished="localTrackPublished",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalAudioSilenceDetected="localAudioSilenceDetected",r.ActiveSpeakersChanged="activeSpeakersChanged",r.ParticipantMetadataChanged="participantMetadataChanged",r.ParticipantNameChanged="participantNameChanged",r.ParticipantAttributesChanged="participantAttributesChanged",r.RoomMetadataChanged="roomMetadataChanged",r.DataReceived="dataReceived",r.SipDTMFReceived="sipDTMFReceived",r.TranscriptionReceived="transcriptionReceived",r.ConnectionQualityChanged="connectionQualityChanged",r.TrackStreamStateChanged="trackStreamStateChanged",r.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",r.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",r.AudioPlaybackStatusChanged="audioPlaybackChanged",r.VideoPlaybackStatusChanged="videoPlaybackChanged",r.MediaDevicesError="mediaDevicesError",r.ParticipantPermissionsChanged="participantPermissionsChanged",r.SignalConnected="signalConnected",r.RecordingStatusChanged="recordingStatusChanged",r.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",r.EncryptionError="encryptionError",r.DCBufferStatusChanged="dcBufferStatusChanged",r.ActiveDeviceChanged="activeDeviceChanged",r.ChatMessage="chatMessage",r.ReconnectPrimaryDelay="reconnectPrimaryDelay",r.ReconnectSecondaryDelay="reconnectSecondaryDelay",r.ReconnectICEDelay="reconnectICEDelay",r.LocalTrackSubscribed="localTrackSubscribed",r.MetricsReceived="metricsReceived"})(B||(B={}));var q;(function(r){r.TrackPublished="trackPublished",r.TrackSubscribed="trackSubscribed",r.TrackSubscriptionFailed="trackSubscriptionFailed",r.TrackUnpublished="trackUnpublished",r.TrackUnsubscribed="trackUnsubscribed",r.TrackMuted="trackMuted",r.TrackUnmuted="trackUnmuted",r.LocalTrackPublished="localTrackPublished",r.LocalTrackUnpublished="localTrackUnpublished",r.ParticipantMetadataChanged="participantMetadataChanged",r.ParticipantNameChanged="participantNameChanged",r.DataReceived="dataReceived",r.SipDTMFReceived="sipDTMFReceived",r.TranscriptionReceived="transcriptionReceived",r.IsSpeakingChanged="isSpeakingChanged",r.ConnectionQualityChanged="connectionQualityChanged",r.TrackStreamStateChanged="trackStreamStateChanged",r.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",r.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",r.MediaDevicesError="mediaDevicesError",r.AudioStreamAcquired="audioStreamAcquired",r.ParticipantPermissionsChanged="participantPermissionsChanged",r.PCTrackAdded="pcTrackAdded",r.AttributesChanged="attributesChanged",r.ChatMessage="chatMessage",r.LocalTrackSubscribed="localTrackSubscribed"})(q||(q={}));var _;(function(r){r.TransportsCreated="transportsCreated",r.Connected="connected",r.Disconnected="disconnected",r.Resuming="resuming",r.Resumed="resumed",r.Restarting="restarting",r.Restarted="restarted",r.SignalResumed="signalResumed",r.SignalRestarted="signalRestarted",r.Closing="closing",r.MediaTrackAdded="mediaTrackAdded",r.ActiveSpeakersUpdate="activeSpeakersUpdate",r.DataPacketReceived="dataPacketReceived",r.PrimaryDelay="primaryDelay",r.SecondaryDelay="secondaryDelay",r.TranscriptionReceived="transcriptionReceived",r.RTPVideoMapUpdate="rtpVideoMapUpdate",r.DCBufferStatusChanged="dcBufferStatusChanged",r.ParticipantUpdate="participantUpdate",r.RoomUpdate="roomUpdate",r.SpeakersChanged="speakersChanged",r.StreamStateChanged="streamStateChanged",r.ConnectionQualityUpdate="connectionQualityUpdate",r.SubscriptionError="subscriptionError",r.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",r.RemoteMute="remoteMute",r.SubscribedQualityUpdate="subscribedQualityUpdate",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalTrackSubscribed="localTrackSubscribed",r.Offline="offline",r.SignalRequestResponse="signalRequestResponse"})(_||(_={}));var F;(function(r){r.Message="message",r.Muted="muted",r.Unmuted="unmuted",r.Restarted="restarted",r.Ended="ended",r.Subscribed="subscribed",r.Unsubscribed="unsubscribed",r.UpdateSettings="updateSettings",r.UpdateSubscription="updateSubscription",r.AudioPlaybackStarted="audioPlaybackStarted",r.AudioPlaybackFailed="audioPlaybackFailed",r.AudioSilenceDetected="audioSilenceDetected",r.VisibilityChanged="visibilityChanged",r.VideoDimensionsChanged="videoDimensionsChanged",r.VideoPlaybackStarted="videoPlaybackStarted",r.VideoPlaybackFailed="videoPlaybackFailed",r.ElementAttached="elementAttached",r.ElementDetached="elementDetached",r.UpstreamPaused="upstreamPaused",r.UpstreamResumed="upstreamResumed",r.SubscriptionPermissionChanged="subscriptionPermissionChanged",r.SubscriptionStatusChanged="subscriptionStatusChanged",r.SubscriptionFailed="subscriptionFailed",r.TrackProcessorUpdate="trackProcessorUpdate",r.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",r.TranscriptionReceived="transcriptionReceived",r.TimeSyncUpdate="timeSyncUpdate"})(F||(F={}));function Qr(r,t,i){var e,n,a;t===void 0&&(t=50),i===void 0&&(i={});var s=(e=i.isImmediate)!=null&&e,o=(n=i.callback)!=null&&n,u=i.maxWait,c=Date.now(),l=[];function d(){if(u!==void 0){var h=Date.now()-c;if(h+t>=u)return u-h}return t}var f=function(){var p=[].slice.call(arguments),g=this;return new Promise(function(k,y){var T=s&&a===void 0;if(a!==void 0&&clearTimeout(a),a=setTimeout(function(){if(a=void 0,c=Date.now(),!s){var w=r.apply(g,p);o&&o(w),l.forEach(function(C){return(0,C.resolve)(w)}),l=[]}},d()),T){var S=r.apply(g,p);return o&&o(S),k(S)}l.push({resolve:k,reject:y})})};return f.cancel=function(h){a!==void 0&&clearTimeout(a),l.forEach(function(p){return(0,p.reject)(h)}),l=[]},f}var fc=/version\/(\d+(\.?_?\d+)+)/i,$i;function We(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(typeof navigator>"u")){var i=navigator.userAgent.toLowerCase();if($i===void 0||t){var e=hc.find(function(n){var a=n.test;return a.test(i)});$i=e==null?void 0:e.describe(i)}return $i}}var hc=[{test:/firefox|iceweasel|fxios/i,describe:function(t){var i={name:"Firefox",version:$t(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:xi(t)};return i}},{test:/chrom|crios|crmo/i,describe:function(t){var i={name:"Chrome",version:$t(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:xi(t)};return i}},{test:/safari|applewebkit/i,describe:function(t){var i={name:"Safari",version:$t(fc,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:xi(t)};return i}}];function $t(r,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,e=t.match(r);return e&&e.length>=i&&e[i]||""}function xi(r){return r.includes("mac os")?$t(/\(.+?(\d+_\d+(:?_\d+)?)/,r,1).replace(/_/g,"."):void 0}var mc="25.3.8",vc=mc,pc=15,pe=E(function r(){P(this,r)});pe.setTimeout=function(){return setTimeout.apply(void 0,arguments)};pe.setInterval=function(){return setInterval.apply(void 0,arguments)};pe.clearTimeout=function(){return clearTimeout.apply(void 0,arguments)};pe.clearInterval=function(){return clearInterval.apply(void 0,arguments)};var Ce=function(){function r(t,i,e,n,a){if(P(this,r),j(t)==="object")this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else if(i!==void 0&&e!==void 0)this.width=t,this.height=i,this.aspectRatio=t/i,this.encoding={maxBitrate:e,maxFramerate:n,priority:a};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}return E(r,[{key:"resolution",get:function(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}])}(),gc=["vp8","h264"],kc=["vp8","h264","vp9","av1"];function yc(r){return!!gc.find(function(t){return t===r})}var Pr;(function(r){r.telephone={maxBitrate:12e3},r.speech={maxBitrate:24e3},r.music={maxBitrate:48e3},r.musicStereo={maxBitrate:64e3},r.musicHighQuality={maxBitrate:96e3},r.musicHighQualityStereo={maxBitrate:128e3}})(Pr||(Pr={}));var pt={h540:new Ce(960,540,5e5,25),h720:new Ce(1280,720,125e4,30)},Er={h540:new Ce(720,540,55e4,25),h720:new Ce(960,720,12e5,30)},Xr={h360fps3:new Ce(640,360,2e5,3,"medium"),h360fps15:new Ce(640,360,4e5,15,"medium"),h720fps5:new Ce(1280,720,8e5,5,"medium"),h720fps15:new Ce(1280,720,15e5,15,"medium"),h720fps30:new Ce(1280,720,2e6,30,"medium"),h1080fps15:new Ce(1920,1080,25e5,15,"medium"),h1080fps30:new Ce(1920,1080,5e6,30,"medium"),original:new Ce(0,0,7e6,30,"medium")};function bc(r){if(!(typeof r>"u"))return typeof structuredClone=="function"?structuredClone(r):JSON.parse(JSON.stringify(r))}var Tc=5e3,Zn=[],Ne;(function(r){r[r.LOW=0]="LOW",r[r.MEDIUM=1]="MEDIUM",r[r.HIGH=2]="HIGH"})(Ne||(Ne={}));var A=function(r){function t(i,e){var n,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};P(this,t);var s;return n=O(this,t),n.attachedElements=[],n.isMuted=!1,n.streamState=t.StreamState.Active,n.isInBackground=!1,n._currentBitrate=0,n.log=Z,n.appVisibilityChangedListener=function(){n.backgroundTimeout&&clearTimeout(n.backgroundTimeout),document.visibilityState==="hidden"?n.backgroundTimeout=setTimeout(function(){return n.handleAppVisibilityChanged()},Tc):n.handleAppVisibilityChanged()},n.log=xe((s=a.loggerName)!==null&&s!==void 0?s:_e.Track),n.loggerContextCb=a.loggerContextCb,n.setMaxListeners(100),n.kind=e,n._mediaStreamTrack=i,n._mediaStreamID=i.id,n.source=t.Source.Unknown,n}return N(t,r),E(t,[{key:"logContext",get:function(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),re(this))}},{key:"currentBitrate",get:function(){return this._currentBitrate}},{key:"mediaStreamTrack",get:function(){return this._mediaStreamTrack}},{key:"mediaStreamID",get:function(){return this._mediaStreamID}},{key:"attach",value:function(e){var n=this,a="audio";this.kind===t.Kind.Video&&(a="video"),this.attachedElements.length===0&&this.kind===t.Kind.Video&&this.addAppVisibilityListener(),e||(a==="audio"&&(Zn.forEach(function(u){u.parentElement===null&&!e&&(e=u)}),e&&Zn.splice(Zn.indexOf(e),1)),e||(e=document.createElement(a))),this.attachedElements.includes(e)||this.attachedElements.push(e),In(this.mediaStreamTrack,e);var s=e.srcObject.getTracks(),o=s.some(function(u){return u.kind==="audio"});return e.play().then(function(){n.emit(o?F.AudioPlaybackStarted:F.VideoPlaybackStarted)}).catch(function(u){u.name==="NotAllowedError"?n.emit(o?F.AudioPlaybackFailed:F.VideoPlaybackFailed,u):u.name==="AbortError"?Z.debug("".concat(o?"audio":"video"," playback aborted, likely due to new play request")):Z.warn("could not playback ".concat(o?"audio":"video"),u),o&&e&&s.some(function(c){return c.kind==="video"})&&u.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(function(){}))}),this.emit(F.ElementAttached,e),e}},{key:"detach",value:function(e){var n=this;try{if(e){Dn(this.mediaStreamTrack,e);var a=this.attachedElements.indexOf(e);return a>=0&&(this.attachedElements.splice(a,1),this.recycleElement(e),this.emit(F.ElementDetached,e)),e}var s=[];return this.attachedElements.forEach(function(o){Dn(n.mediaStreamTrack,o),s.push(o),n.recycleElement(o),n.emit(F.ElementDetached,o)}),this.attachedElements=[],s}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}},{key:"stop",value:function(){this.stopMonitor(),this._mediaStreamTrack.stop()}},{key:"enable",value:function(){this._mediaStreamTrack.enabled=!0}},{key:"disable",value:function(){this._mediaStreamTrack.enabled=!1}},{key:"stopMonitor",value:function(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}},{key:"updateLoggerOptions",value:function(e){e.loggerName&&(this.log=xe(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}},{key:"recycleElement",value:function(e){if(e instanceof HTMLAudioElement){var n=!0;e.pause(),Zn.forEach(function(a){a.parentElement||(n=!1)}),n&&Zn.push(e)}}},{key:"handleAppVisibilityChanged",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this;return v().w(function(a){for(;;)switch(a.n){case 0:this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===t.Kind.Video&&setTimeout(function(){return n.attachedElements.forEach(function(s){return s.play().catch(function(){})})},0);case 1:return a.a(2)}},e,this)}))}},{key:"addAppVisibilityListener",value:function(){we()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}},{key:"removeAppVisibilityListener",value:function(){we()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}])}(He.EventEmitter);function In(r,t){var i;t.srcObject instanceof MediaStream?i=t.srcObject:i=new MediaStream;var e;r.kind==="audio"?e=i.getAudioTracks():e=i.getVideoTracks(),e.includes(r)||(e.forEach(function(n){i.removeTrack(n)}),i.addTrack(r)),(!ln()||!(t instanceof HTMLVideoElement))&&(t.autoplay=!0),t.muted=i.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==i&&(t.srcObject=i,(ln()||qn())&&t instanceof HTMLVideoElement&&setTimeout(function(){t.srcObject=i,t.play().catch(function(){})},0))}function Dn(r,t){if(t.srcObject instanceof MediaStream){var i=t.srcObject;i.removeTrack(r),i.getTracks().length>0?t.srcObject=i:t.srcObject=null}}(function(r){var t;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(t=r.Kind||(r.Kind={}));var i;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(i=r.Source||(r.Source={}));var e;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(e=r.StreamState||(r.StreamState={}));function n(c){switch(c){case t.Audio:return ke.AUDIO;case t.Video:return ke.VIDEO;default:return ke.DATA}}r.kindToProto=n;function a(c){switch(c){case ke.AUDIO:return t.Audio;case ke.VIDEO:return t.Video;default:return t.Unknown}}r.kindFromProto=a;function s(c){switch(c){case i.Camera:return ue.CAMERA;case i.Microphone:return ue.MICROPHONE;case i.ScreenShare:return ue.SCREEN_SHARE;case i.ScreenShareAudio:return ue.SCREEN_SHARE_AUDIO;default:return ue.UNKNOWN}}r.sourceToProto=s;function o(c){switch(c){case ue.CAMERA:return i.Camera;case ue.MICROPHONE:return i.Microphone;case ue.SCREEN_SHARE:return i.ScreenShare;case ue.SCREEN_SHARE_AUDIO:return i.ScreenShareAudio;default:return i.Unknown}}r.sourceFromProto=o;function u(c){switch(c){case kn.ACTIVE:return e.Active;case kn.PAUSED:return e.Paused;default:return e.Unknown}}r.streamStateFromProto=u})(A||(A={}));function lo(r,t,i){var e,n,a,s,o,u=$r(r??{}),c=u.optionsWithoutProcessor,l=u.audioProcessor,d=u.videoProcessor,f=(e=bc(c))!==null&&e!==void 0?e:{};return f.audio===!0&&(f.audio={}),f.video===!0&&(f.video={}),f.audio&&(Rr(f.audio,t),(n=(s=f.audio).deviceId)!==null&&n!==void 0||(s.deviceId="default"),l&&(f.audio.processor=l)),f.video&&(Rr(f.video,i),(a=(o=f.video).deviceId)!==null&&a!==void 0||(o.deviceId="default"),d&&(f.video.processor=d)),f}function Rr(r,t){return Object.keys(t).forEach(function(i){r[i]===void 0&&(r[i]=t[i])}),r}function Ki(r){var t,i,e,n,a={};if(r.video)if(j(r.video)==="object"){var s={},o=s,u=r.video;Object.keys(u).forEach(function(c){switch(c){case"resolution":Rr(o,u.resolution);break;default:o[c]=u[c]}}),a.video=s,(t=(e=a.video).deviceId)!==null&&t!==void 0||(e.deviceId="default")}else a.video=r.video?{deviceId:"default"}:!1;else a.video=!1;return r.audio?j(r.audio)==="object"?(a.audio=r.audio,(i=(n=a.audio).deviceId)!==null&&i!==void 0||(n.deviceId="default")):a.audio={deviceId:"default"}:a.audio=!1,a}function Sc(r){return b(this,arguments,void 0,function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return v().m(function e(){var n,a,s,o,u,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(n=Zr(),!n){l.n=2;break}return a=n.createAnalyser(),a.fftSize=2048,s=a.frequencyBinCount,o=new Uint8Array(s),u=n.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])),u.connect(a),l.n=1,Be(i);case 1:return a.getByteTimeDomainData(o),c=o.some(function(d){return d!==128&&d!==0}),n.close(),l.a(2,!c);case 2:return l.a(2,!1)}},e)})()})}function Zr(){var r=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(r)return new r({latencyHint:"interactive"})}function Da(r){return r===A.Source.Microphone?"audioinput":r===A.Source.Camera?"videoinput":void 0}function Cc(r){var t,i,e=(t=r.video)!==null&&t!==void 0?t:!0;return r.resolution&&r.resolution.width>0&&r.resolution.height>0&&(e=typeof e=="boolean"?{}:e,ln()?e=Object.assign(Object.assign({},e),{width:{max:r.resolution.width},height:{max:r.resolution.height},frameRate:r.resolution.frameRate}):e=Object.assign(Object.assign({},e),{width:{ideal:r.resolution.width},height:{ideal:r.resolution.height},frameRate:r.resolution.frameRate})),{audio:(i=r.audio)!==null&&i!==void 0?i:!1,video:e,controller:r.controller,selfBrowserSurface:r.selfBrowserSurface,surfaceSwitching:r.surfaceSwitching,systemAudio:r.systemAudio,preferCurrentTab:r.preferCurrentTab}}function xt(r){return r.split("/")[1].toLowerCase()}function wc(r){var t=[];return r.forEach(function(i){i.track!==void 0&&t.push(new Hn({cid:i.track.mediaStreamID,track:i.trackInfo}))}),t}function re(r){return r instanceof A?{trackID:r.sid,source:r.source,muted:r.isMuted,enabled:r.mediaStreamTrack.enabled,kind:r.kind,streamID:r.mediaStreamID,streamTrackID:r.mediaStreamTrack.id}:{trackID:r.trackSid,enabled:r.isEnabled,muted:r.isMuted,trackInfo:Object.assign({mimeType:r.mimeType,name:r.trackName,encrypted:r.isEncrypted,kind:r.kind,source:r.source},r.track?re(r.track):{})}}function Pc(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function $r(r){var t=Object.assign({},r),i,e;return j(t.audio)==="object"&&t.audio.processor&&(i=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),j(t.video)==="object"&&t.video.processor&&(e=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:i,videoProcessor:e,optionsWithoutProcessor:t}}function Ec(r,t){var i,e=[].concat(Oe(Object.keys(t)),Oe(Object.keys(r))),n={},a=z(e),s;try{for(a.s();!(s=a.n()).done;){var o=s.value;r[o]!==t[o]&&(n[o]=(i=t[o])!==null&&i!==void 0?i:"")}}catch(u){a.e(u)}finally{a.f()}return n}var Rc="|",Aa="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Ic(r){var t=r.split(Rc);return t.length>1?[t[0],r.substr(t[0].length+1)]:[r,""]}function Be(r){return b(this,void 0,void 0,v().m(function t(){return v().w(function(i){for(;;)switch(i.n){case 0:return i.a(2,new Promise(function(e){return pe.setTimeout(e,r)}))}},t)}))}function Ir(){return"addTransceiver"in RTCPeerConnection.prototype}function Or(){return"addTrack"in RTCPeerConnection.prototype}function Oc(){if(!("getCapabilities"in RTCRtpSender)||ln())return!1;var r=RTCRtpSender.getCapabilities("video"),t=!1;if(r){var i=z(r.codecs),e;try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.mimeType==="video/AV1"){t=!0;break}}}catch(a){i.e(a)}finally{i.f()}}return t}function Nc(){if(!("getCapabilities"in RTCRtpSender)||qn())return!1;if(ln()){var r=We();if(r!=null&&r.version&&jn(r.version,"16")<0)return!1}var t=RTCRtpSender.getCapabilities("video"),i=!1;if(t){var e=z(t.codecs),n;try{for(e.s();!(n=e.n()).done;){var a=n.value;if(a.mimeType==="video/VP9"){i=!0;break}}}catch(s){e.e(s)}finally{e.f()}}return i}function at(r){return r==="av1"||r==="vp9"}function Nr(r){return document?(r||(r=document.createElement("audio")),"setSinkId"in r):!1}function Dc(){return typeof RTCPeerConnection>"u"?!1:Ir()||Or()}function qn(){var r;return((r=We())===null||r===void 0?void 0:r.name)==="Firefox"}function ln(){var r;return((r=We())===null||r===void 0?void 0:r.name)==="Safari"}function Ac(){var r=We();return(r==null?void 0:r.name)==="Safari"&&r.version.startsWith("17.")}function fo(){var r,t;return we()?(t=(r=navigator.userAgentData)===null||r===void 0?void 0:r.mobile)!==null&&t!==void 0?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Mc(){var r=We(),t="17.2";if(r)return r.name!=="Safari"&&r.os!=="iOS"||r.os==="iOS"&&r.osVersion&&jn(t,r.osVersion)>=0?!0:r.name==="Safari"&&jn(t,r.version)>=0}function we(){return typeof document<"u"}function en(){return navigator.product=="ReactNative"}function Dr(r){return r.hostname.endsWith(".livekit.cloud")||r.hostname.endsWith(".livekit.run")}function ho(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function mo(){if(en()){var r=ho();if(r)return r.platform}}function Ma(){if(we())return window.devicePixelRatio;if(en()){var r=ho();if(r)return r.devicePixelRatio}return 1}function jn(r,t){for(var i=r.split("."),e=t.split("."),n=Math.min(i.length,e.length),a=0;a<n;++a){var s=parseInt(i[a],10),o=parseInt(e[a],10);if(s>o)return 1;if(s<o)return-1;if(a===n-1&&s===o)return 0}return r===""&&t!==""?-1:t===""?1:i.length==e.length?0:i.length<e.length?-1:1}function Lc(r){var t=z(r),i;try{for(t.s();!(i=t.n()).done;){var e=i.value;e.target.handleResize(e)}}catch(n){t.e(n)}finally{t.f()}}function Uc(r){var t=z(r),i;try{for(t.s();!(i=t.n()).done;){var e=i.value;e.target.handleVisibilityChanged(e)}}catch(n){t.e(n)}finally{t.f()}}var er=null,La=function(){return er||(er=new ResizeObserver(Lc)),er},nr=null,Ua=function(){return nr||(nr=new IntersectionObserver(Uc,{root:null,rootMargin:"0px"})),nr};function Jc(){var r,t=new hi({sdk:Bn.JS,protocol:pc,version:vc});return en()&&(t.os=(r=mo())!==null&&r!==void 0?r:""),t}function Ja(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,n=document.createElement("canvas");n.width=r,n.height=t;var a=n.getContext("2d");a==null||a.fillRect(0,0,n.width,n.height),e&&a&&(a.beginPath(),a.arc(r/2,t/2,50,0,Math.PI*2,!0),a.closePath(),a.fillStyle="grey",a.fill());var s=n.captureStream(),o=s.getTracks(),u=x(o,1),c=u[0];if(!c)throw Error("Could not get empty media stream video track");return c.enabled=i,c}var $n;function tr(){if(!$n){var r=new AudioContext,t=r.createOscillator(),i=r.createGain();i.gain.setValueAtTime(0,0);var e=r.createMediaStreamDestination();t.connect(i),i.connect(e),t.start();var n=e.stream.getAudioTracks(),a=x(n,1);if($n=a[0],!$n)throw Error("Could not get empty media stream audio track");$n.enabled=!1}return $n.clone()}var vo=E(function r(t,i){var e=this;P(this,r),this.onFinally=i,this.promise=new Promise(function(n,a){return b(e,void 0,void 0,v().m(function s(){return v().w(function(o){for(;;)switch(o.n){case 0:if(this.resolve=n,this.reject=a,!t){o.n=1;break}return o.n=1,t(n,a);case 1:return o.a(2)}},s,this)}))}).finally(function(){var n;return(n=e.onFinally)===null||n===void 0?void 0:n.call(e)})});function Ul(r,t){var i=this,e=Object.assign({cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80},t),n=Zr();if(!n)throw new Error("Audio Context not supported on this browser");var a=e.cloneTrack?r.mediaStreamTrack.clone():r.mediaStreamTrack,s=n.createMediaStreamSource(new MediaStream([a])),o=n.createAnalyser();o.minDecibels=e.minDecibels,o.maxDecibels=e.maxDecibels,o.fftSize=e.fftSize,o.smoothingTimeConstant=e.smoothingTimeConstant,s.connect(o);var u=new Uint8Array(o.frequencyBinCount),c=function(){o.getByteFrequencyData(u);var f=0,h=z(u),p;try{for(h.s();!(p=h.n()).done;){var g=p.value;f+=Math.pow(g/255,2)}}catch(y){h.e(y)}finally{h.f()}var k=Math.sqrt(f/u.length);return k},l=function(){return b(i,void 0,void 0,v().m(function f(){return v().w(function(h){for(;;)switch(h.n){case 0:return h.n=1,n.close();case 1:e.cloneTrack&&a.stop();case 2:return h.a(2)}},f)}))};return{calculateVolume:c,analyser:o,cleanup:l}}var Ie=function(){function r(){P(this,r),this._locking=Promise.resolve(),this._locks=0}return E(r,[{key:"isLocked",value:function(){return this._locks>0}},{key:"lock",value:function(){var i=this;this._locks+=1;var e,n=new Promise(function(s){return e=function(){i._locks-=1,s()}}),a=this._locking.then(function(){return e});return this._locking=this._locking.then(function(){return n}),a}}])}();function Bc(r){return kc.includes(r)}function mn(r){if(typeof r=="string"||typeof r=="number")return r;if(Array.isArray(r))return r[0];if(r.exact)return Array.isArray(r.exact)?r.exact[0]:r.exact;if(r.ideal)return Array.isArray(r.ideal)?r.ideal[0]:r.ideal;throw Error("could not unwrap constraint")}function Fc(r){return r.startsWith("http")?r.replace(/^(http)/,"ws"):r}function Ba(r){return r.startsWith("ws")?r.replace(/^(ws)/,"http"):r}function _c(r,t){return r.segments.map(function(i){var e=i.id,n=i.text,a=i.startTime,s=i.endTime,o=i.final,u=i.language,c=i.error,l=i.failureReason,d,f=(d=t.get(e))!==null&&d!==void 0?d:Date.now(),h=Date.now();return o?t.delete(e):t.set(e,f),{id:e,text:n,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(s.toString()),final:o,language:u,firstReceivedTime:f,lastReceivedTime:h,error:c,failureReason:l}})}function qc(r){var t=r.id,i=r.timestamp,e=r.message,n=r.editTimestamp;return{id:t,timestamp:Number.parseInt(i.toString()),editTimestamp:n?Number.parseInt(n.toString()):void 0,message:e}}function Fa(r){switch(r.reason){case 4:return r.context;case 3:return be.CLIENT_INITIATED;case 0:return be.USER_REJECTED;case 1:return be.JOIN_FAILURE;default:return be.UNKNOWN_REASON}}var ir="default",Je=function(){function r(){P(this,r),this._previousDevices=[]}return E(r,[{key:"previousDevices",get:function(){return this._previousDevices}},{key:"getDevices",value:function(i){return b(this,arguments,void 0,function(e){var n=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return v().m(function s(){var o,u,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:if(!(((o=r.userMediaPromiseMap)===null||o===void 0?void 0:o.size)>0)){f.n=6;break}if(Z.debug("awaiting getUserMedia promise"),f.p=1,!e){f.n=3;break}return f.n=2,r.userMediaPromiseMap.get(e);case 2:f.n=4;break;case 3:return f.n=4,Promise.all(r.userMediaPromiseMap.values());case 4:f.n=6;break;case 5:f.p=5,f.v,Z.warn("error waiting for media permissons");case 6:return f.n=7,navigator.mediaDevices.enumerateDevices();case 7:if(u=f.v,!(a&&!(ln()&&n.hasDeviceInUse(e)))){f.n=10;break}if(c=u.filter(function(h){return h.kind===e}).length===0||u.some(function(h){var p=h.label==="",g=e?h.kind===e:!0;return p&&g}),!c){f.n=10;break}return l={video:e!=="audioinput"&&e!=="audiooutput",audio:e!=="videoinput"&&{deviceId:"default"}},f.n=8,navigator.mediaDevices.getUserMedia(l);case 8:return d=f.v,f.n=9,navigator.mediaDevices.enumerateDevices();case 9:u=f.v,d.getTracks().forEach(function(h){h.stop()});case 10:return n._previousDevices=u,e&&(u=u.filter(function(h){return h.kind===e})),f.a(2,u)}},s,null,[[1,5]])})()})}},{key:"normalizeDeviceId",value:function(i,e,n){return b(this,void 0,void 0,v().m(function a(){var s,o,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(e===ir){c.n=1;break}return c.a(2,e);case 1:return c.n=2,this.getDevices(i);case 2:if(s=c.v,o=s.find(function(l){return l.deviceId===ir}),o){c.n=3;break}return Z.warn("could not reliably determine default device"),c.a(2,void 0);case 3:if(u=s.find(function(l){return l.deviceId!==ir&&l.groupId===(n??o.groupId)}),u){c.n=4;break}return Z.warn("could not reliably determine default device"),c.a(2,void 0);case 4:return c.a(2,u==null?void 0:u.deviceId)}},a,this)}))}},{key:"hasDeviceInUse",value:function(i){return i?r.userMediaPromiseMap.has(i):r.userMediaPromiseMap.size>0}}],[{key:"getInstance",value:function(){return this.instance===void 0&&(this.instance=new r),this.instance}}])}();Je.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Je.userMediaPromiseMap=new Map;var jc=1e3,An=function(r){function t(i,e,n){var a,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;return P(this,t),a=O(this,t,[i,e,o]),a.manuallyStopped=!1,a._isUpstreamPaused=!1,a.handleTrackMuteEvent=function(){return a.debouncedTrackMuteHandler().catch(function(){return a.log.debug("track mute bounce got cancelled by an unmute event",a.logContext)})},a.debouncedTrackMuteHandler=Qr(function(){return b(a,void 0,void 0,v().m(function u(){return v().w(function(c){for(;;)switch(c.n){case 0:return c.n=1,this.pauseUpstream();case 1:return c.a(2)}},u,this)}))},5e3),a.handleTrackUnmuteEvent=function(){return b(a,void 0,void 0,v().m(function u(){return v().w(function(c){for(;;)switch(c.n){case 0:return this.debouncedTrackMuteHandler.cancel("unmute"),c.n=1,this.resumeUpstream();case 1:return c.a(2)}},u,this)}))},a.handleEnded=function(){a.isInBackground&&(a.reacquireTrack=!0),a._mediaStreamTrack.removeEventListener("mute",a.handleTrackMuteEvent),a._mediaStreamTrack.removeEventListener("unmute",a.handleTrackUnmuteEvent),a.emit(F.Ended,a)},a.reacquireTrack=!1,a.providedByUser=s,a.muteLock=new Ie,a.pauseUpstreamLock=new Ie,a.processorLock=new Ie,a.restartLock=new Ie,a.setMediaStreamTrack(i,!0),a._constraints=i.getConstraints(),n&&(a._constraints=n),a}return N(t,r),E(t,[{key:"sender",get:function(){return this._sender},set:function(e){this._sender=e}},{key:"constraints",get:function(){return this._constraints}},{key:"id",get:function(){return this._mediaStreamTrack.id}},{key:"dimensions",get:function(){if(this.kind===A.Kind.Video){var e=this._mediaStreamTrack.getSettings(),n=e.width,a=e.height;if(n&&a)return{width:n,height:a}}}},{key:"isUpstreamPaused",get:function(){return this._isUpstreamPaused}},{key:"isUserProvided",get:function(){return this.providedByUser}},{key:"mediaStreamTrack",get:function(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}},{key:"getSourceTrackSettings",value:function(){return this._mediaStreamTrack.getSettings()}},{key:"setMediaStreamTrack",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s=this,o,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(!(e===this._mediaStreamTrack&&!n)){c.n=1;break}return c.a(2);case 1:if(this._mediaStreamTrack&&(this.attachedElements.forEach(function(l){Dn(s._mediaStreamTrack,l)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),!(this.processor&&e)){c.n=7;break}return c.n=2,this.processorLock.lock();case 2:if(u=c.v,c.p=3,this.log.debug("restarting processor",this.logContext),this.kind!=="unknown"){c.n=4;break}throw TypeError("cannot set processor on track of unknown kind");case 4:return this.processorElement&&(In(e,this.processorElement),this.processorElement.muted=!0),c.n=5,this.processor.restart({track:e,kind:this.kind,element:this.processorElement});case 5:o=this.processor.processedTrack;case 6:return c.p=6,u(),c.f(6);case 7:if(!this.sender){c.n=8;break}return c.n=8,this.sender.replaceTrack(o??e);case 8:if(!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,!e){c.n=10;break}return this._mediaStreamTrack.enabled=!this.isMuted,c.n=9,this.resumeUpstream();case 9:this.attachedElements.forEach(function(l){In(o??e,l)});case 10:return c.a(2)}},a,this,[[3,,6,7]])}))}},{key:"waitForDimensions",value:function(){return b(this,arguments,void 0,function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:jc;return v().m(function a(){var s,o,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(e.kind!==A.Kind.Audio){c.n=1;break}throw new Error("cannot get dimensions for audio tracks");case 1:if(((s=We())===null||s===void 0?void 0:s.os)!=="iOS"){c.n=2;break}return c.n=2,Be(10);case 2:o=Date.now();case 3:if(!(Date.now()-o<n)){c.n=6;break}if(u=e.dimensions,!u){c.n=4;break}return c.a(2,u);case 4:return c.n=5,Be(50);case 5:c.n=3;break;case 6:throw new Xe("unable to get track dimensions after timeout");case 7:return c.a(2)}},a)})()})}},{key:"setDeviceId",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(!(this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===mn(e))){a.n=1;break}return a.a(2,!0);case 1:if(this._constraints.deviceId=e,!this.isMuted){a.n=2;break}return a.a(2,!0);case 2:return a.n=3,this.restartTrack();case 3:return a.a(2,mn(e)===this._mediaStreamTrack.getSettings().deviceId)}},n,this)}))}},{key:"getDeviceId",value:function(){return b(this,arguments,void 0,function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return v().m(function a(){var s,o,u,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(e.source!==A.Source.ScreenShare){l.n=1;break}return l.a(2);case 1:return s=e._mediaStreamTrack.getSettings(),o=s.deviceId,u=s.groupId,c=e.kind===A.Kind.Audio?"audioinput":"videoinput",l.a(2,n?Je.getInstance().normalizeDeviceId(c,o,u):o)}},a)})()})}},{key:"mute",value:function(){return b(this,void 0,void 0,v().m(function e(){return v().w(function(n){for(;;)switch(n.n){case 0:return this.setTrackMuted(!0),n.a(2,this)}},e,this)}))}},{key:"unmute",value:function(){return b(this,void 0,void 0,v().m(function e(){return v().w(function(n){for(;;)switch(n.n){case 0:return this.setTrackMuted(!1),n.a(2,this)}},e,this)}))}},{key:"replaceTrack",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s,o;return v().w(function(u){for(;;)switch(u.n){case 0:if(this.sender){u.n=1;break}throw new Xe("unable to replace an unpublished track");case 1:return typeof n=="boolean"?s=n:n!==void 0&&(s=n.userProvidedTrack,o=n.stopProcessor),this.providedByUser=s??!0,this.log.debug("replace MediaStreamTrack",this.logContext),u.n=2,this.setMediaStreamTrack(e);case 2:if(!(o&&this.processor)){u.n=3;break}return u.n=3,this.stopProcessor();case 3:return u.a(2,this)}},a,this)}))}},{key:"restart",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,o,u,c;return v().w(function(l){for(;;)switch(l.n){case 0:return this.manuallyStopped=!1,l.n=1,this.restartLock.lock();case 1:return s=l.v,l.p=2,e||(e=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e})),o={audio:!1,video:!1},this.kind===A.Kind.Video?o.video=e:o.audio=e,this.attachedElements.forEach(function(d){Dn(a.mediaStreamTrack,d)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop(),l.n=3,navigator.mediaDevices.getUserMedia(o);case 3:return u=l.v,c=u.getTracks()[0],c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),l.n=4,this.setMediaStreamTrack(c);case 4:return this._constraints=e,this.emit(F.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),l.a(2,this);case 5:return l.p=5,s(),l.f(5);case 6:return l.a(2)}},n,this,[[2,,5,6]])}))}},{key:"setTrackMuted",value:function(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?F.Muted:F.Unmuted,this))}},{key:"needsReAcquisition",get:function(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}},{key:"handleAppVisibilityChanged",value:function(){var e=this,n=Object.create(null,{handleAppVisibilityChanged:{get:function(){return Q(t,"handleAppVisibilityChanged",e,1)}}});return b(this,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,n.handleAppVisibilityChanged.call(this);case 1:if(fo()){s.n=2;break}return s.a(2);case 2:if(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!(!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted)){s.n=4;break}return this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),s.n=3,this.restart();case 3:this.reacquireTrack=!1;case 4:return s.a(2)}},a,this)}))}},{key:"stop",value:function(){var e;this.manuallyStopped=!0,Q(t,"stop",this,3)([]),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}},{key:"pauseUpstream",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,this.pauseUpstreamLock.lock();case 1:if(n=s.v,s.p=2,this._isUpstreamPaused!==!0){s.n=3;break}return s.a(2);case 3:if(this.sender){s.n=4;break}return this.log.warn("unable to pause upstream for an unpublished track",this.logContext),s.a(2);case 4:if(this._isUpstreamPaused=!0,this.emit(F.UpstreamPaused,this),a=We(),!((a==null?void 0:a.name)==="Safari"&&jn(a.version,"12.0")<0)){s.n=5;break}throw new Yr("pauseUpstream is not supported on Safari < 12.");case 5:return s.n=6,this.sender.replaceTrack(null);case 6:return s.p=6,n(),s.f(6);case 7:return s.a(2)}},e,this,[[2,,6,7]])}))}},{key:"resumeUpstream",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,this.pauseUpstreamLock.lock();case 1:if(n=a.v,a.p=2,this._isUpstreamPaused!==!1){a.n=3;break}return a.a(2);case 3:if(this.sender){a.n=4;break}return this.log.warn("unable to resume upstream for an unpublished track",this.logContext),a.a(2);case 4:return this._isUpstreamPaused=!1,this.emit(F.UpstreamResumed,this),a.n=5,this.sender.replaceTrack(this.mediaStreamTrack);case 5:return a.p=5,n(),a.f(5);case 6:return a.a(2)}},e,this,[[2,,5,6]])}))}},{key:"getRTCStatsReport",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:if(!((n=this.sender)===null||n===void 0)&&n.getStats){s.n=1;break}return s.a(2);case 1:return s.n=2,this.sender.getStats();case 2:return a=s.v,s.a(2,a)}},e,this)}))}},{key:"setProcessor",value:function(e){return b(this,arguments,void 0,function(n){var a=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return v().m(function o(){var u,c,l,d,f,h,p;return v().w(function(g){for(;;)switch(g.n){case 0:return g.n=1,a.processorLock.lock();case 1:return l=g.v,g.p=2,a.log.debug("setting up processor",a.logContext),a.processorElement=(u=a.processorElement)!==null&&u!==void 0?u:document.createElement(a.kind),d={kind:a.kind,track:a._mediaStreamTrack,element:a.processorElement,audioContext:a.audioContext},g.n=3,n.init(d);case 3:if(!a.processor){g.n=4;break}return g.n=4,a.stopProcessor();case 4:if(a.kind!=="unknown"){g.n=5;break}throw TypeError("cannot set processor on track of unknown kind");case 5:if(In(a._mediaStreamTrack,a.processorElement),a.processorElement.muted=!0,a.processorElement.play().catch(function(k){return a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{error:k}))}),a.processor=n,!a.processor.processedTrack){g.n=6;break}f=z(a.attachedElements);try{for(f.s();!(h=f.n()).done;)p=h.value,p!==a.processorElement&&s&&(Dn(a._mediaStreamTrack,p),In(a.processor.processedTrack,p))}catch(k){f.e(k)}finally{f.f()}return g.n=6,(c=a.sender)===null||c===void 0?void 0:c.replaceTrack(a.processor.processedTrack);case 6:a.emit(F.TrackProcessorUpdate,a.processor);case 7:return g.p=7,l(),g.f(7);case 8:return g.a(2)}},o,null,[[2,,7,8]])})()})}},{key:"getProcessor",value:function(){return this.processor}},{key:"stopProcessor",value:function(){return b(this,arguments,void 0,function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return v().m(function a(){var s,o;return v().w(function(u){for(;;)switch(u.n){case 0:if(e.processor){u.n=1;break}return u.a(2);case 1:return e.log.debug("stopping processor",e.logContext),(s=e.processor.processedTrack)===null||s===void 0||s.stop(),u.n=2,e.processor.destroy();case 2:return e.processor=void 0,n||((o=e.processorElement)===null||o===void 0||o.remove(),e.processorElement=void 0),u.n=3,e._mediaStreamTrack.applyConstraints(e._constraints);case 3:return u.n=4,e.setMediaStreamTrack(e._mediaStreamTrack,!0);case 4:e.emit(F.TrackProcessorUpdate);case 5:return u.a(2)}},a)})()})}}])}(A),Vc=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.onWorkerMessage=function(n){var a,s,o=n.data,u=o.kind,c=o.data;switch(u){case"error":Z.error(c.error.message),e.emit(an.EncryptionError,c.error);break;case"initAck":c.enabled&&e.keyProvider.getKeys().forEach(function(d){e.postKey(d)});break;case"enable":if(c.enabled&&e.keyProvider.getKeys().forEach(function(d){e.postKey(d)}),e.encryptionEnabled!==c.enabled&&c.participantIdentity===((a=e.room)===null||a===void 0?void 0:a.localParticipant.identity))e.emit(an.ParticipantEncryptionStatusChanged,c.enabled,e.room.localParticipant),e.encryptionEnabled=c.enabled;else if(c.participantIdentity){var l=(s=e.room)===null||s===void 0?void 0:s.getParticipantByIdentity(c.participantIdentity);if(!l)throw TypeError("couldn't set encryption status, participant not found".concat(c.participantIdentity));e.emit(an.ParticipantEncryptionStatusChanged,c.enabled,l)}break;case"ratchetKey":e.keyProvider.emit(sn.KeyRatcheted,c.material,c.keyIndex);break}},e.onWorkerError=function(n){Z.error("e2ee worker encountered an error:",{error:n.error}),e.emit(an.EncryptionError,n.error)},e.keyProvider=i.keyProvider,e.worker=i.worker,e.encryptionEnabled=!1,e}return N(t,r),E(t,[{key:"setup",value:function(e){if(!sc())throw new Yr("tried to setup end-to-end encryption on an unsupported browser");if(Z.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);var n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:qu.getLevel()}};this.worker&&(Z.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}},{key:"setParticipantCryptorEnabled",value:function(e,n){Z.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}},{key:"setSifTrailer",value:function(e){!e||e.length===0?Z.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}},{key:"setupEngine",value:function(e){var n=this;e.on(_.RTPVideoMapUpdate,function(a){n.postRTPMap(a)})}},{key:"setupEventListeners",value:function(e,n){var a=this;e.on(B.TrackPublished,function(s,o){return a.setParticipantCryptorEnabled(s.trackInfo.encryption!==fe.NONE,o.identity)}),e.on(B.ConnectionStateChanged,function(s){s===ee.Connected&&e.remoteParticipants.forEach(function(o){o.trackPublications.forEach(function(u){a.setParticipantCryptorEnabled(u.trackInfo.encryption!==fe.NONE,o.identity)})})}).on(B.TrackUnsubscribed,function(s,o,u){var c,l={kind:"removeTransform",data:{participantIdentity:u.identity,trackId:s.mediaStreamID}};(c=a.worker)===null||c===void 0||c.postMessage(l)}).on(B.TrackSubscribed,function(s,o,u){a.setupE2EEReceiver(s,u.identity,o.trackInfo)}).on(B.SignalConnected,function(){if(!a.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(function(s){a.postKey(s)}),a.setParticipantCryptorEnabled(a.room.localParticipant.isE2EEEnabled,a.room.localParticipant.identity)}),e.localParticipant.on(q.LocalTrackPublished,function(s){return b(a,void 0,void 0,v().m(function o(){return v().w(function(u){for(;;)switch(u.n){case 0:this.setupE2EESender(s.track,s.track.sender);case 1:return u.a(2)}},o,this)}))}),n.on(sn.SetKey,function(s){return a.postKey(s)}).on(sn.RatchetRequest,function(s,o){return a.postRatchetRequest(s,o)})}},{key:"postRatchetRequest",value:function(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");var a={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(a)}},{key:"postKey",value:function(e){var n=e.key,a=e.participantIdentity,s=e.keyIndex,o;if(!this.worker)throw Error("could not set key, worker is missing");var u={kind:"setKey",data:{participantIdentity:a,isPublisher:a===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:n,keyIndex:s}};this.worker.postMessage(u)}},{key:"postEnable",value:function(e,n){if(this.worker){var a={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(a)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}},{key:"postRTPMap",value:function(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");var a={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a)}},{key:"postSifTrailer",value:function(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");var n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}},{key:"setupE2EEReceiver",value:function(e,n,a){if(e.receiver){if(!(a!=null&&a.mimeType)||a.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?xt(a.mimeType):void 0)}}},{key:"setupE2EESender",value:function(e,n){if(!(e instanceof An)||!n){n||Z.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}},{key:"handleReceiver",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function o(){var u,c,l,d,f,h;return v().w(function(p){for(;;)switch(p.n){case 0:if(this.worker){p.n=1;break}return p.a(2);case 1:if(!Cr()){p.n=2;break}u={kind:"decode",participantIdentity:a,trackId:n,codec:s},e.transform=new RTCRtpScriptTransform(this.worker,u),p.n=4;break;case 2:if(!(qt in e&&s)){p.n=3;break}return c={kind:"updateCodec",data:{trackId:n,codec:s,participantIdentity:a}},this.worker.postMessage(c),p.a(2);case 3:l=e.writableStream,d=e.readableStream,(!l||!d)&&(f=e.createEncodedStreams(),e.writableStream=f.writable,l=f.writable,e.readableStream=f.readable,d=f.readable),h={kind:"decode",data:{readableStream:d,writableStream:l,trackId:n,codec:s,participantIdentity:a}},this.worker.postMessage(h,[d,l]);case 4:e[qt]=!0;case 5:return p.a(2)}},o,this)}))}},{key:"handleSender",value:function(e,n,a){var s;if(!(qt in e||!this.worker)){if(!(!((s=this.room)===null||s===void 0)&&s.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Cr()){Z.info("initialize script transform");var o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:a};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{Z.info("initialize encoded streams");var u=e.createEncodedStreams(),c={kind:"encode",data:{readableStream:u.readable,writableStream:u.writable,codec:a,trackId:n,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(c,[u.readable,u.writable])}e[qt]=!0}}}])}(He.EventEmitter),st;(function(r){r[r.WAITING=0]="WAITING",r[r.RUNNING=1]="RUNNING",r[r.COMPLETED=2]="COMPLETED"})(st||(st={}));var Gc=function(){function r(){P(this,r),this.pendingTasks=new Map,this.taskMutex=new Ie,this.nextTaskIndex=0}return E(r,[{key:"run",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:return n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:st.WAITING},this.pendingTasks.set(n.id,n),s.n=1,this.taskMutex.lock();case 1:return a=s.v,s.p=2,n.executedAt=Date.now(),n.status=st.RUNNING,s.n=3,i();case 3:return s.a(2,s.v);case 4:return s.p=4,n.status=st.COMPLETED,this.pendingTasks.delete(n.id),a(),s.f(4);case 5:return s.a(2)}},e,this,[[2,,4,5]])}))}},{key:"flush",value:function(){return b(this,void 0,void 0,v().m(function i(){var e=this;return v().w(function(n){for(;;)switch(n.n){case 0:return n.a(2,this.run(function(){return b(e,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:return s.a(2)}},a)}))}))}},i,this)}))}},{key:"snapshot",value:function(){return Array.from(this.pendingTasks.values())}}])}(),Wc=["syncState","trickle","offer","answer","simulate","leave"];function Hc(r){var t=Wc.indexOf(r.case)>=0;return Z.trace("request allowed to bypass queue:",{canPass:t,req:r}),t}var ae;(function(r){r[r.CONNECTING=0]="CONNECTING",r[r.CONNECTED=1]="CONNECTED",r[r.RECONNECTING=2]="RECONNECTING",r[r.DISCONNECTING=3]="DISCONNECTING",r[r.DISCONNECTED=4]="DISCONNECTED"})(ae||(ae={}));var xr=function(){function r(){var t=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};P(this,r);var n;this.rtt=0,this.state=ae.DISCONNECTED,this.log=Z,this._requestId=0,this.resetCallbacks=function(){t.onAnswer=void 0,t.onLeave=void 0,t.onLocalTrackPublished=void 0,t.onLocalTrackUnpublished=void 0,t.onNegotiateRequested=void 0,t.onOffer=void 0,t.onRemoteMuteChanged=void 0,t.onSubscribedQualityUpdate=void 0,t.onTokenRefresh=void 0,t.onTrickle=void 0,t.onClose=void 0},this.log=xe((n=e.loggerName)!==null&&n!==void 0?n:_e.Signal),this.loggerContextCb=e.loggerContextCb,this.useJSON=i,this.requestQueue=new Gc,this.queuedRequests=[],this.closingLock=new Ie,this.connectionLock=new Ie,this.state=ae.DISCONNECTED}return E(r,[{key:"currentState",get:function(){return this.state}},{key:"isDisconnected",get:function(){return this.state===ae.DISCONNECTING||this.state===ae.DISCONNECTED}},{key:"isEstablishingConnection",get:function(){return this.state===ae.CONNECTING||this.state===ae.RECONNECTING}},{key:"getNextRequestId",value:function(){return this._requestId+=1,this._requestId}},{key:"logContext",get:function(){var i,e;return(e=(i=this.loggerContextCb)===null||i===void 0?void 0:i.call(this))!==null&&e!==void 0?e:{}}},{key:"join",value:function(i,e,n,a){return b(this,void 0,void 0,v().m(function s(){var o;return v().w(function(u){for(;;)switch(u.n){case 0:return this.state=ae.CONNECTING,this.options=n,u.n=1,this.connect(i,e,n,a);case 1:return o=u.v,u.a(2,o)}},s,this)}))}},{key:"reconnect",value:function(i,e,n,a){return b(this,void 0,void 0,v().m(function s(){var o;return v().w(function(u){for(;;)switch(u.n){case 0:if(this.options){u.n=1;break}return this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext),u.a(2);case 1:return this.state=ae.RECONNECTING,this.clearPingInterval(),u.n=2,this.connect(i,e,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:a}));case 2:return o=u.v,u.a(2,o)}},s,this)}))}},{key:"connect",value:function(i,e,n,a){var s=this;this.connectOptions=n,i=Fc(i),i=i.replace(/\/$/,""),i+="/rtc";var o=Jc(),u=zc(e,o,n);return new Promise(function(c,l){return b(s,void 0,void 0,v().m(function d(){var f=this,h,p,g;return v().w(function(k){for(;;)switch(k.n){case 0:return k.n=1,this.connectionLock.lock();case 1:if(h=k.v,k.p=2,p=function(){return b(f,void 0,void 0,v().m(function T(){return v().w(function(S){for(;;)switch(S.n){case 0:this.close(),clearTimeout(g),l(new ie("room connection has been cancelled (signal)",3));case 1:return S.a(2)}},T,this)}))},g=setTimeout(function(){f.close(),l(new ie("room connection has timed out (signal)",1))},n.websocketTimeout),a!=null&&a.aborted&&p(),a==null||a.addEventListener("abort",p),this.log.debug("connecting to ".concat(i+u),this.logContext),!this.ws){k.n=3;break}return k.n=3,this.close(!1);case 3:this.ws=new WebSocket(i+u),this.ws.binaryType="arraybuffer",this.ws.onopen=function(){clearTimeout(g)},this.ws.onerror=function(y){return b(f,void 0,void 0,v().m(function T(){var S,w;return v().w(function(C){for(;;)switch(C.n){case 0:if(this.state===ae.CONNECTED){C.n=8;break}return this.state=ae.DISCONNECTED,clearTimeout(g),C.p=1,C.n=2,fetch("http".concat(i.substring(2),"/validate").concat(u));case 2:if(S=C.v,!S.status.toFixed(0).startsWith("4")){C.n=4;break}return C.n=3,S.text();case 3:w=C.v,l(new ie(w,0,S.status)),C.n=5;break;case 4:l(new ie("Internal error",2,S.status));case 5:C.n=7;break;case 6:C.p=6,C.v,l(new ie("server was not reachable",1));case 7:return C.a(2);case 8:this.handleWSError(y);case 9:return C.a(2)}},T,this,[[1,6]])}))},this.ws.onmessage=function(y){return b(f,void 0,void 0,v().m(function T(){var S,w,C,I,R,L;return v().w(function(M){for(;;)switch(M.n){case 0:if(typeof y.data!="string"){M.n=1;break}R=JSON.parse(y.data),I=mt.fromJson(R,{ignoreUnknownFields:!0}),M.n=3;break;case 1:if(!(y.data instanceof ArrayBuffer)){M.n=2;break}I=mt.fromBinary(new Uint8Array(y.data)),M.n=3;break;case 2:return this.log.error("could not decode websocket message: ".concat(j(y.data)),this.logContext),M.a(2);case 3:if(this.state===ae.CONNECTED){M.n=4;break}if(L=!1,((S=I.message)===null||S===void 0?void 0:S.case)==="join"?(this.state=ae.CONNECTED,a==null||a.removeEventListener("abort",p),this.pingTimeoutDuration=I.message.value.pingTimeout,this.pingIntervalDuration=I.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),c(I.message.value)):this.state===ae.RECONNECTING&&I.message.case!=="leave"?(this.state=ae.CONNECTED,a==null||a.removeEventListener("abort",p),this.startPingInterval(),((w=I.message)===null||w===void 0?void 0:w.case)==="reconnect"?c(I.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),c(void 0),L=!0)):this.isEstablishingConnection&&I.message.case==="leave"?l(new ie("Received leave request while trying to (re)connect",4,void 0,I.message.value.reason)):n.reconnect||l(new ie("did not receive join response, got ".concat((C=I.message)===null||C===void 0?void 0:C.case," instead"),2)),L){M.n=4;break}return M.a(2);case 4:if(!this.signalLatency){M.n=5;break}return M.n=5,Be(this.signalLatency);case 5:this.handleSignalResponse(I);case 6:return M.a(2)}},T,this)}))},this.ws.onclose=function(y){f.isEstablishingConnection&&l(new ie("Websocket got closed during a (re)connection attempt",2)),f.log.warn("websocket closed",Object.assign(Object.assign({},f.logContext),{reason:y.reason,code:y.code,wasClean:y.wasClean,state:f.state})),f.handleOnClose(y.reason)};case 4:return k.p=4,h(),k.f(4);case 5:return k.a(2)}},d,this,[[2,,4,5]])}))})}},{key:"close",value:function(){return b(this,arguments,void 0,function(){var i=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return v().m(function n(){var a,s;return v().w(function(o){for(;;)switch(o.n){case 0:return o.n=1,i.closingLock.lock();case 1:if(a=o.v,o.p=2,i.clearPingInterval(),e&&(i.state=ae.DISCONNECTING),!i.ws){o.n=4;break}if(i.ws.onmessage=null,i.ws.onopen=null,i.ws.onclose=null,s=new Promise(function(u){i.ws?i.ws.onclose=function(){u()}:u()}),!(i.ws.readyState<i.ws.CLOSING)){o.n=3;break}return i.ws.close(),o.n=3,Promise.race([s,Be(250)]);case 3:i.ws=void 0;case 4:return o.p=4,e&&(i.state=ae.DISCONNECTED),a(),o.f(4);case 5:return o.a(2)}},n,null,[[2,,4,5]])})()})}},{key:"sendOffer",value:function(i){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:i.sdp})),this.sendRequest({case:"offer",value:ri(i)})}},{key:"sendAnswer",value:function(i){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:i.sdp})),this.sendRequest({case:"answer",value:ri(i)})}},{key:"sendIceCandidate",value:function(i,e){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:i})),this.sendRequest({case:"trickle",value:new Gn({candidateInit:JSON.stringify(i),target:e})})}},{key:"sendMuteTrack",value:function(i,e){return this.log.debug("sending Mute Track req to server",Object.assign(Object.assign({},this.logContext),{trackSid:i,muted:e})),this.sendRequest({case:"mute",value:new Wn({sid:i,muted:e})})}},{key:"sendAddTrack",value:function(i){return this.log.debug("sending Add Track req to server",Object.assign(Object.assign({},this.logContext),{req:i})),this.sendRequest({case:"addTrack",value:i})}},{key:"sendUpdateLocalMetadata",value:function(i,e){return b(this,arguments,void 0,function(n,a){var s=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return v().m(function u(){var c;return v().w(function(l){for(;;)switch(l.n){case 0:return c=s.getNextRequestId(),l.n=1,s.sendRequest({case:"updateMetadata",value:new Dt({requestId:c,metadata:n,name:a,attributes:o})});case 1:return l.a(2,c)}},u)})()})}},{key:"sendUpdateTrackSettings",value:function(i){this.log.debug("sending Update Track setting req to server",Object.assign(Object.assign({},this.logContext),{settings:i})),this.sendRequest({case:"trackSetting",value:i})}},{key:"sendUpdateSubscription",value:function(i){return this.log.debug("sending Update Subscription req to server",Object.assign(Object.assign({},this.logContext),{sub:i})),this.sendRequest({case:"subscription",value:i})}},{key:"sendSyncState",value:function(i){return this.log.debug("sending sync state req to server",Object.assign(Object.assign({},this.logContext),{sync:i})),this.sendRequest({case:"syncState",value:i})}},{key:"sendUpdateVideoLayers",value:function(i,e){return this.log.debug("sending update video layer req to server",Object.assign(Object.assign({},this.logContext),{trackSid:i,layers:e})),this.sendRequest({case:"updateLayers",value:new Nt({trackSid:i,layers:e})})}},{key:"sendUpdateSubscriptionPermissions",value:function(i,e){return this.log.debug("sending update subscription permission req to server",Object.assign(Object.assign({},this.logContext),{allParticipants:i,trackPermissions:e})),this.sendRequest({case:"subscriptionPermission",value:new Lt({allParticipants:i,trackPermissions:e})})}},{key:"sendSimulateScenario",value:function(i){return this.log.debug("sending simulate scenario req to server",Object.assign(Object.assign({},this.logContext),{scenario:i})),this.sendRequest({case:"simulate",value:i})}},{key:"sendPing",value:function(){return this.log.debug("sending ping req to server",this.logContext),Promise.all([this.sendRequest({case:"ping",value:V.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Bt({timestamp:V.parse(Date.now()),rtt:V.parse(this.rtt)})})])}},{key:"sendUpdateLocalAudioTrack",value:function(i,e){return this.sendRequest({case:"updateAudioTrack",value:new Ot({trackSid:i,features:e})})}},{key:"sendLeave",value:function(){return this.log.debug("sending leave req to server",this.logContext),this.sendRequest({case:"leave",value:new bn({canReconnect:!1,reason:be.CLIENT_INITIATED,action:Ve.DISCONNECT})})}},{key:"sendRequest",value:function(i){return b(this,arguments,void 0,function(e){var n=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return v().m(function s(){var o,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(n.log.debug("sending request  to server ",Object.assign(Object.assign({},n.logContext),{message:e})),o=!a&&!Hc(e),!(o&&n.state===ae.RECONNECTING)){c.n=1;break}return n.queuedRequests.push(function(){return b(n,void 0,void 0,v().m(function l(){return v().w(function(d){for(;;)switch(d.n){case 0:return d.n=1,this.sendRequest(e,!0);case 1:return d.a(2)}},l,this)}))}),c.a(2);case 1:if(a){c.n=2;break}return c.n=2,n.requestQueue.flush();case 2:if(!n.signalLatency){c.n=3;break}return c.n=3,Be(n.signalLatency);case 3:if(!(!n.ws||n.ws.readyState!==n.ws.OPEN)){c.n=4;break}return n.log.error("cannot send signal request before connected, type: ".concat(e==null?void 0:e.case),n.logContext),c.a(2);case 4:u=new Ci({message:e});try{n.useJSON?n.ws.send(u.toJsonString()):n.ws.send(u.toBinary())}catch(l){n.log.error("error sending signal message",Object.assign(Object.assign({},n.logContext),{error:l}))}case 5:return c.a(2)}},s)})()})}},{key:"handleSignalResponse",value:function(i){var e,n,a=i.message;if(a==null){this.log.debug("received unsupported message",this.logContext);return}var s=!1;if(a.case==="answer"){this.log.debug("the answer response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i}));var o=_a(a.value);this.onAnswer&&this.onAnswer(o)}else if(a.case==="offer"){this.log.debug("the offer response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i}));var u=_a(a.value);this.onOffer&&this.onOffer(u)}else if(a.case==="trickle"){this.log.debug("the trickle response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i}));var c=JSON.parse(a.value.candidateInit);this.onTrickle&&this.onTrickle(c,a.value.target)}else a.case==="update"?(this.log.debug("the update response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onParticipantUpdate&&this.onParticipantUpdate((e=a.value.participants)!==null&&e!==void 0?e:[])):a.case==="trackPublished"?(this.log.debug("the trackPublished response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onLocalTrackPublished&&this.onLocalTrackPublished(a.value)):a.case==="speakersChanged"?(this.log.debug("the speakersChanged response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onSpeakersChanged&&this.onSpeakersChanged((n=a.value.speakers)!==null&&n!==void 0?n:[])):a.case==="leave"?(this.log.debug("the leave response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onLeave&&this.onLeave(a.value)):a.case==="mute"?(this.log.debug("the mute response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onRemoteMuteChanged&&this.onRemoteMuteChanged(a.value.sid,a.value.muted)):a.case==="roomUpdate"?(this.log.debug("the roomUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onRoomUpdate&&a.value.room&&this.onRoomUpdate(a.value.room)):a.case==="connectionQuality"?(this.log.debug("the connectionQuality response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onConnectionQuality&&this.onConnectionQuality(a.value)):a.case==="streamStateUpdate"?(this.log.debug("the streamStateUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onStreamStateUpdate&&this.onStreamStateUpdate(a.value)):a.case==="subscribedQualityUpdate"?(this.log.debug("the subscribedQualityUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(a.value)):a.case==="subscriptionPermissionUpdate"?(this.log.debug("the subscriptionPermissionUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(a.value)):a.case==="refreshToken"?(this.log.debug("the refreshToken response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onTokenRefresh&&this.onTokenRefresh(a.value)):a.case==="trackUnpublished"?(this.log.debug("the trackUnpublished response from server is:",Object.assign(Object.assign({},this.logContext),{response:i})),this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(a.value)):a.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(a.value):a.case==="pong"||(a.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(a.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):a.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(a.value):a.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(a.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:a.case})));s||this.resetPingTimeout()}},{key:"setReconnected",value:function(){for(;this.queuedRequests.length>0;){var i=this.queuedRequests.shift();i&&this.requestQueue.run(i)}}},{key:"handleOnClose",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:if(this.state!==ae.DISCONNECTED){a.n=1;break}return a.a(2);case 1:return n=this.onClose,a.n=2,this.close();case 2:this.log.debug("websocket connection closed: ".concat(i),Object.assign(Object.assign({},this.logContext),{reason:i})),n&&n(i);case 3:return a.a(2)}},e,this)}))}},{key:"handleWSError",value:function(i){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:i}))}},{key:"resetPingTimeout",value:function(){var i=this;if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=pe.setTimeout(function(){i.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-i.pingTimeoutDuration*1e3).toUTCString()),i.logContext),i.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}},{key:"clearPingTimeout",value:function(){this.pingTimeout&&pe.clearTimeout(this.pingTimeout)}},{key:"startPingInterval",value:function(){var i=this;if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=pe.setInterval(function(){i.sendPing()},this.pingIntervalDuration*1e3)}},{key:"clearPingInterval",value:function(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&pe.clearInterval(this.pingInterval)}}])}();function _a(r){var t={type:"offer",sdp:r.sdp};switch(r.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=r.type;break}return t}function ri(r){var t=new Ge({sdp:r.sdp,type:r.type});return t}function zc(r,t,i){var e,n=new URLSearchParams;return n.set("access_token",r),i.reconnect&&(n.set("reconnect","1"),i.sid&&n.set("sid",i.sid)),n.set("auto_subscribe",i.autoSubscribe?"1":"0"),n.set("sdk",en()?"reactnative":"js"),n.set("version",t.version),n.set("protocol",t.protocol.toString()),t.deviceModel&&n.set("device_model",t.deviceModel),t.os&&n.set("os",t.os),t.osVersion&&n.set("os_version",t.osVersion),t.browser&&n.set("browser",t.browser),t.browserVersion&&n.set("browser_version",t.browserVersion),i.adaptiveStream&&n.set("adaptive_stream","1"),i.reconnectReason&&n.set("reconnect_reason",i.reconnectReason.toString()),!((e=navigator.connection)===null||e===void 0)&&e.type&&n.set("network",navigator.connection.type),"?".concat(n.toString())}var po={},go={exports:{}},qa=go.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var i="candidate:%s %d %s %d %s %d typ %s";return i+=t.raddr!=null?" raddr %s rport %d":"%v%v",i+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(i+=" generation %d"),i+=t["network-id"]!=null?" network-id %d":"%v",i+=t["network-cost"]!=null?" network-cost %d":"%v",i}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var i="ssrc:%d";return t.attribute!=null&&(i+=" %s",t.value!=null&&(i+=":%s")),i}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var i="mediaclk:";return i+=t.id!=null?"id=%s %s":"%v%s",i+=t.mediaClockValue!=null?"=%s":"",i+=t.rateNumerator!=null?" rate=%s":"",i+=t.rateDenominator!=null?"/%s":"",i}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(qa).forEach(function(r){var t=qa[r];t.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})});var ko=go.exports;(function(r){var t=function(u){return String(Number(u))===u?Number(u):u},i=function(u,c,l,d){if(d&&!l)c[d]=t(u[1]);else for(var f=0;f<l.length;f+=1)u[f+1]!=null&&(c[l[f]]=t(u[f+1]))},e=function(u,c,l){var d=u.name&&u.names;u.push&&!c[u.push]?c[u.push]=[]:d&&!c[u.name]&&(c[u.name]={});var f=u.push?{}:d?c[u.name]:c;i(l.match(u.reg),f,u.names,u.name),u.push&&c[u.push].push(f)},n=ko,a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(o){var u={},c=[],l=u;return o.split(/(\r\n|\r|\n)/).filter(a).forEach(function(d){var f=d[0],h=d.slice(2);f==="m"&&(c.push({rtp:[],fmtp:[]}),l=c[c.length-1]);for(var p=0;p<(n[f]||[]).length;p+=1){var g=n[f][p];if(g.reg.test(h))return e(g,l,h)}}),u.media=c,u};var s=function(u,c){var l=c.split(/=(.+)/,2);return l.length===2?u[l[0]]=t(l[1]):l.length===1&&c.length>1&&(u[l[0]]=void 0),u};r.parseParams=function(o){return o.split(/;\s?/).reduce(s,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(o){return o.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(o){for(var u=[],c=o.split(" ").map(t),l=0;l<c.length;l+=3)u.push({component:c[l],ip:c[l+1],port:c[l+2]});return u},r.parseImageAttributes=function(o){return o.split(" ").map(function(u){return u.substring(1,u.length-1).split(",").reduce(s,{})})},r.parseSimulcastStreamList=function(o){return o.split(";").map(function(u){return u.split(",").map(function(c){var l,d=!1;return c[0]!=="~"?l=t(c):(l=t(c.substring(1,c.length)),d=!0),{scid:l,paused:d}})})}})(po);var rr=ko,Kc=/%[sdv%]/g,Yc=function(t){var i=1,e=arguments,n=e.length;return t.replace(Kc,function(a){if(i>=n)return a;var s=e[i];switch(i+=1,a){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},xn=function(t,i,e){var n=i.format instanceof Function?i.format(i.push?e:e[i.name]):i.format,a=[t+"="+n];if(i.names)for(var s=0;s<i.names.length;s+=1){var o=i.names[s];i.name?a.push(e[i.name][o]):a.push(e[i.names[s]])}else a.push(e[i.name]);return Yc.apply(null,a)},Qc=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Xc=["i","c","b","a"],Zc=function(t,i){i=i||{},t.version==null&&(t.version=0),t.name==null&&(t.name=" "),t.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var e=i.outerOrder||Qc,n=i.innerOrder||Xc,a=[];return e.forEach(function(s){rr[s].forEach(function(o){o.name in t&&t[o.name]!=null?a.push(xn(s,o,t)):o.push in t&&t[o.push]!=null&&t[o.push].forEach(function(u){a.push(xn(s,o,u))})})}),t.media.forEach(function(s){a.push(xn("m",rr.m[0],s)),n.forEach(function(o){rr[o].forEach(function(u){u.name in s&&s[u.name]!=null?a.push(xn(o,u,s)):u.push in s&&s[u.push]!=null&&s[u.push].forEach(function(c){a.push(xn(o,u,c))})})})}),a.join(`\r
`)+`\r
`},$c=po,xc=Zc,ar=xc,tt=$c.parse,el=.7,nl=20,Mn={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"},ja=function(r){function t(i){var e,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};P(this,t);var a;return e=O(this,t),e.log=Z,e.ddExtID=0,e.pendingCandidates=[],e.restartingIce=!1,e.renegotiate=!1,e.trackBitrates=[],e.remoteStereoMids=[],e.remoteNackMids=[],e.negotiate=Qr(function(s){return b(e,void 0,void 0,v().m(function o(){var u;return v().w(function(c){for(;;)switch(c.n){case 0:return this.emit(Mn.NegotiationStarted),c.p=1,c.n=2,this.createAndSendOffer();case 2:c.n=5;break;case 3:if(c.p=3,u=c.v,!s){c.n=4;break}s(u),c.n=5;break;case 4:throw u;case 5:return c.a(2)}},o,this,[[1,3]])}))},nl),e.close=function(){e._pc&&(e._pc.close(),e._pc.onconnectionstatechange=null,e._pc.oniceconnectionstatechange=null,e._pc.onicegatheringstatechange=null,e._pc.ondatachannel=null,e._pc.onnegotiationneeded=null,e._pc.onsignalingstatechange=null,e._pc.onicecandidate=null,e._pc.ondatachannel=null,e._pc.ontrack=null,e._pc.onconnectionstatechange=null,e._pc.oniceconnectionstatechange=null,e._pc=null)},e.log=xe((a=n.loggerName)!==null&&a!==void 0?a:_e.PCTransport),e.loggerOptions=n,e.config=i,e._pc=e.createPC(),e}return N(t,r),E(t,[{key:"pc",get:function(){return this._pc||(this._pc=this.createPC()),this._pc}},{key:"createPC",value:function(){var e=this,n=new RTCPeerConnection(this.config);return n.onicecandidate=function(a){var s;a.candidate&&((s=e.onIceCandidate)===null||s===void 0||s.call(e,a.candidate))},n.onicecandidateerror=function(a){var s;(s=e.onIceCandidateError)===null||s===void 0||s.call(e,a)},n.oniceconnectionstatechange=function(){var a;(a=e.onIceConnectionStateChange)===null||a===void 0||a.call(e,n.iceConnectionState)},n.onsignalingstatechange=function(){var a;(a=e.onSignalingStatechange)===null||a===void 0||a.call(e,n.signalingState)},n.onconnectionstatechange=function(){var a;(a=e.onConnectionStateChange)===null||a===void 0||a.call(e,n.connectionState)},n.ondatachannel=function(a){var s;(s=e.onDataChannel)===null||s===void 0||s.call(e,a)},n.ontrack=function(a){var s;(s=e.onTrack)===null||s===void 0||s.call(e,a)},n}},{key:"logContext",get:function(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}},{key:"isICEConnected",get:function(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}},{key:"addIceCandidate",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(!(this.pc.remoteDescription&&!this.restartingIce)){a.n=1;break}return a.a(2,this.pc.addIceCandidate(e));case 1:this.pendingCandidates.push(e);case 2:return a.a(2)}},n,this)}))}},{key:"setRemoteDescription",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,o,u,c,l,d,f;return v().w(function(h){for(;;)switch(h.n){case 0:return o=void 0,e.type==="offer"?(u=tl(e),c=u.stereoMids,l=u.nackMids,this.remoteStereoMids=c,this.remoteNackMids=l):e.type==="answer"&&(d=tt((s=e.sdp)!==null&&s!==void 0?s:""),d.media.forEach(function(p){p.type==="audio"&&a.trackBitrates.some(function(g){if(!g.transceiver||p.mid!=g.transceiver.mid)return!1;var k=0;if(p.rtp.some(function(C){return C.codec.toUpperCase()===g.codec.toUpperCase()?(k=C.payload,!0):!1}),k===0)return!0;var y=!1,T=z(p.fmtp),S;try{for(T.s();!(S=T.n()).done;){var w=S.value;if(w.payload===k){w.config=w.config.split(";").filter(function(C){return!C.includes("maxaveragebitrate")}).join(";"),g.maxbr>0&&(w.config+=";maxaveragebitrate=".concat(g.maxbr*1e3)),y=!0;break}}}catch(C){T.e(C)}finally{T.f()}return y||g.maxbr>0&&p.fmtp.push({payload:k,config:"maxaveragebitrate=".concat(g.maxbr*1e3)}),!0})}),o=ar(d)),h.n=1,this.setMungedSDP(e,o,!0);case 1:if(this.pendingCandidates.forEach(function(p){a.pc.addIceCandidate(p)}),this.pendingCandidates=[],this.restartingIce=!1,!this.renegotiate){h.n=3;break}return this.renegotiate=!1,h.n=2,this.createAndSendOffer();case 2:h.n=4;break;case 3:e.type==="answer"&&(this.emit(Mn.NegotiationComplete),e.sdp&&(f=tt(e.sdp),f.media.forEach(function(p){p.type==="video"&&a.emit(Mn.RTPVideoPayloadTypes,p.rtp)})));case 4:return h.a(2)}},n,this)}))}},{key:"createAndSendOffer",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,o,u,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(this.onOffer!==void 0){l.n=1;break}return l.a(2);case 1:if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),!(this._pc&&this._pc.signalingState==="have-local-offer")){l.n=5;break}if(o=this._pc.remoteDescription,!(e!=null&&e.iceRestart&&o)){l.n=3;break}return l.n=2,this._pc.setRemoteDescription(o);case 2:l.n=4;break;case 3:return this.renegotiate=!0,l.a(2);case 4:l.n=6;break;case 5:if(!(!this._pc||this._pc.signalingState==="closed")){l.n=6;break}return this.log.warn("could not createOffer with closed peer connection",this.logContext),l.a(2);case 6:return this.log.debug("starting to negotiate",this.logContext),l.n=7,this.pc.createOffer(e);case 7:return u=l.v,this.log.debug("original offer",Object.assign({sdp:u.sdp},this.logContext)),c=tt((s=u.sdp)!==null&&s!==void 0?s:""),c.media.forEach(function(d){Ga(d),d.type==="audio"?Va(d,[],[]):d.type==="video"&&a.trackBitrates.some(function(f){if(!d.msid||!f.cid||!d.msid.includes(f.cid))return!1;var h=0;if(d.rtp.some(function(T){return T.codec.toUpperCase()===f.codec.toUpperCase()?(h=T.payload,!0):!1}),h===0||(at(f.codec)&&a.ensureVideoDDExtensionForSVC(d,c),f.codec!=="av1"))return!0;var p=Math.round(f.maxbr*el),g=z(d.fmtp),k;try{for(g.s();!(k=g.n()).done;){var y=k.value;if(y.payload===h){y.config.includes("x-google-start-bitrate")||(y.config+=";x-google-start-bitrate=".concat(p));break}}}catch(T){g.e(T)}finally{g.f()}return!0})}),l.n=8,this.setMungedSDP(u,ar(c));case 8:this.onOffer(u);case 9:return l.a(2)}},n,this)}))}},{key:"createAndSetAnswer",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this,a,s,o;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,this.pc.createAnswer();case 1:return s=u.v,o=tt((a=s.sdp)!==null&&a!==void 0?a:""),o.media.forEach(function(c){Ga(c),c.type==="audio"&&Va(c,n.remoteStereoMids,n.remoteNackMids)}),u.n=2,this.setMungedSDP(s,ar(o));case 2:return u.a(2,s)}},e,this)}))}},{key:"createDataChannel",value:function(e,n){return this.pc.createDataChannel(e,n)}},{key:"addTransceiver",value:function(e,n){return this.pc.addTransceiver(e,n)}},{key:"addTrack",value:function(e){if(!this._pc)throw new de("PC closed, cannot add track");return this._pc.addTrack(e)}},{key:"setTrackCodecBitrate",value:function(e){this.trackBitrates.push(e)}},{key:"setConfiguration",value:function(e){var n;if(!this._pc)throw new de("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}},{key:"canRemoveTrack",value:function(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}},{key:"removeTrack",value:function(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}},{key:"getConnectionState",value:function(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}},{key:"getICEConnectionState",value:function(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}},{key:"getSignallingState",value:function(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}},{key:"getTransceivers",value:function(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}},{key:"getSenders",value:function(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}},{key:"getLocalDescription",value:function(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}},{key:"getRemoteDescription",value:function(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}},{key:"getStats",value:function(){return this.pc.getStats()}},{key:"getConnectedAddress",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,o,u,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(this._pc){l.n=1;break}return l.a(2);case 1:return a="",s=new Map,o=new Map,l.n=2,this._pc.getStats();case 2:if(u=l.v,u.forEach(function(d){switch(d.type){case"transport":a=d.selectedCandidatePairId;break;case"candidate-pair":a===""&&d.selected&&(a=d.id),s.set(d.id,d);break;case"remote-candidate":o.set(d.id,"".concat(d.address,":").concat(d.port));break}}),a!==""){l.n=3;break}return l.a(2,void 0);case 3:if(c=(n=s.get(a))===null||n===void 0?void 0:n.remoteCandidateId,c!==void 0){l.n=4;break}return l.a(2,void 0);case 4:return l.a(2,o.get(c))}},e,this)}))}},{key:"setMungedSDP",value:function(e,n,a){return b(this,void 0,void 0,v().m(function s(){var o,u,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:if(!n){f.n=6;break}if(o=e.sdp,e.sdp=n,f.p=1,this.log.debug("setting munged ".concat(a?"remote":"local"," description"),this.logContext),!a){f.n=3;break}return f.n=2,this.pc.setRemoteDescription(e);case 2:f.n=4;break;case 3:return f.n=4,this.pc.setLocalDescription(e);case 4:return f.a(2);case 5:f.p=5,l=f.v,this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:l,sdp:n})),e.sdp=o;case 6:if(f.p=6,!a){f.n=8;break}return f.n=7,this.pc.setRemoteDescription(e);case 7:f.n=9;break;case 8:return f.n=9,this.pc.setLocalDescription(e);case 9:f.n=11;break;case 10:throw f.p=10,d=f.v,u="unknown error",d instanceof Error?u=d.message:typeof d=="string"&&(u=d),c={error:u,sdp:e.sdp},!a&&this.pc.remoteDescription&&(c.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:c})),new wr(u);case 11:return f.a(2)}},s,this,[[6,10],[1,5]])}))}},{key:"ensureVideoDDExtensionForSVC",value:function(e,n){var a,s,o=(a=e.ext)===null||a===void 0?void 0:a.some(function(c){return c.uri===Aa});if(!o){if(this.ddExtID===0){var u=0;n.media.forEach(function(c){var l;c.type==="video"&&((l=c.ext)===null||l===void 0||l.forEach(function(d){d.value>u&&(u=d.value)}))}),this.ddExtID=u+1}(s=e.ext)===null||s===void 0||s.push({value:this.ddExtID,uri:Aa})}}}])}(He.EventEmitter);function Va(r,t,i){var e=0;r.rtp.some(function(n){return n.codec==="opus"?(e=n.payload,!0):!1}),e>0&&(r.rtcpFb||(r.rtcpFb=[]),i.includes(r.mid)&&!r.rtcpFb.some(function(n){return n.payload===e&&n.type==="nack"})&&r.rtcpFb.push({payload:e,type:"nack"}),t.includes(r.mid)&&r.fmtp.some(function(n){return n.payload===e?(n.config.includes("stereo=1")||(n.config+=";stereo=1"),!0):!1}))}function tl(r){var t,i=[],e=[],n=tt((t=r.sdp)!==null&&t!==void 0?t:""),a=0;return n.media.forEach(function(s){var o;s.type==="audio"&&(s.rtp.some(function(u){return u.codec==="opus"?(a=u.payload,!0):!1}),!((o=s.rtcpFb)===null||o===void 0)&&o.some(function(u){return u.payload===a&&u.type==="nack"})&&e.push(s.mid),s.fmtp.some(function(u){return u.payload===a?(u.config.includes("sprop-stereo=1")&&i.push(s.mid),!0):!1}))}),{stereoMids:i,nackMids:e}}function Ga(r){if(r.connection){var t=r.connection.ip.indexOf(":")>=0;(r.connection.version===4&&t||r.connection.version===6&&!t)&&(r.connection.ip="0.0.0.0",r.connection.version=4)}}var Ar="vp8",il={audioPreset:Pr.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Xr.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Ar,backupCodec:!0},yo={deviceId:"default",autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},bo={deviceId:"default",resolution:pt.h720.resolution},rl={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Vu,disconnectOnPageLeave:!0,webAudioMix:!1},ea={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3},se;(function(r){r[r.NEW=0]="NEW",r[r.CONNECTING=1]="CONNECTING",r[r.CONNECTED=2]="CONNECTED",r[r.FAILED=3]="FAILED",r[r.CLOSING=4]="CLOSING",r[r.CLOSED=5]="CLOSED"})(se||(se={}));var al=function(){function r(t,i,e){var n=this;P(this,r);var a;this.peerConnectionTimeout=ea.peerConnectionTimeout,this.log=Z,this.updateState=function(){var s,o=n.state,u=n.requiredTransports.map(function(c){return c.getConnectionState()});u.every(function(c){return c==="connected"})?n.state=se.CONNECTED:u.some(function(c){return c==="failed"})?n.state=se.FAILED:u.some(function(c){return c==="connecting"})?n.state=se.CONNECTING:u.every(function(c){return c==="closed"})?n.state=se.CLOSED:u.some(function(c){return c==="closed"})?n.state=se.CLOSING:u.every(function(c){return c==="new"})&&(n.state=se.NEW),o!==n.state&&(n.log.debug("pc state change: from ".concat(se[o]," to ").concat(se[n.state]),n.logContext),(s=n.onStateChange)===null||s===void 0||s.call(n,n.state,n.publisher.getConnectionState(),n.subscriber.getConnectionState()))},this.log=xe((a=e.loggerName)!==null&&a!==void 0?a:_e.PCManager),this.loggerOptions=e,this.isPublisherConnectionRequired=!i,this.isSubscriberConnectionRequired=i,this.publisher=new ja(t,e),this.subscriber=new ja(t,e),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=function(s){var o;(o=n.onIceCandidate)===null||o===void 0||o.call(n,s,ye.PUBLISHER)},this.subscriber.onIceCandidate=function(s){var o;(o=n.onIceCandidate)===null||o===void 0||o.call(n,s,ye.SUBSCRIBER)},this.subscriber.onDataChannel=function(s){var o;(o=n.onDataChannel)===null||o===void 0||o.call(n,s)},this.subscriber.onTrack=function(s){var o;(o=n.onTrack)===null||o===void 0||o.call(n,s)},this.publisher.onOffer=function(s){var o;(o=n.onPublisherOffer)===null||o===void 0||o.call(n,s)},this.state=se.NEW,this.connectionLock=new Ie,this.remoteOfferLock=new Ie}return E(r,[{key:"needsPublisher",get:function(){return this.isPublisherConnectionRequired}},{key:"needsSubscriber",get:function(){return this.isSubscriberConnectionRequired}},{key:"currentState",get:function(){return this.state}},{key:"logContext",get:function(){var i,e;return Object.assign({},(e=(i=this.loggerOptions).loggerContextCb)===null||e===void 0?void 0:e.call(i))}},{key:"requirePublisher",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=i,this.updateState()}},{key:"requireSubscriber",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=i,this.updateState()}},{key:"createAndSendPublisherOffer",value:function(i){return this.publisher.createAndSendOffer(i)}},{key:"setPublisherAnswer",value:function(i){return this.publisher.setRemoteDescription(i)}},{key:"removeTrack",value:function(i){return this.publisher.removeTrack(i)}},{key:"close",value:function(){return b(this,void 0,void 0,v().m(function i(){var e,n,a,s;return v().w(function(o){for(;;)switch(o.n){case 0:if(this.publisher&&this.publisher.getSignallingState()!=="closed"){e=this.publisher,n=z(e.getSenders());try{for(n.s();!(a=n.n()).done;){s=a.value;try{e.canRemoveTrack()&&e.removeTrack(s)}catch(u){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:u}))}}}catch(u){n.e(u)}finally{n.f()}}return o.n=1,Promise.all([this.publisher.close(),this.subscriber.close()]);case 1:this.updateState();case 2:return o.a(2)}},i,this)}))}},{key:"triggerIceRestart",value:function(){return b(this,void 0,void 0,v().m(function i(){return v().w(function(e){for(;;)switch(e.n){case 0:if(this.subscriber.restartingIce=!0,!this.needsPublisher){e.n=1;break}return e.n=1,this.createAndSendPublisherOffer({iceRestart:!0});case 1:return e.a(2)}},i,this)}))}},{key:"addIceCandidate",value:function(i,e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(e!==ye.PUBLISHER){a.n=2;break}return a.n=1,this.publisher.addIceCandidate(i);case 1:a.n=3;break;case 2:return a.n=3,this.subscriber.addIceCandidate(i);case 3:return a.a(2)}},n,this)}))}},{key:"createSubscriberAnswerFromOffer",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:return this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:i.type,sdp:i.sdp,signalingState:this.subscriber.getSignallingState().toString()})),s.n=1,this.remoteOfferLock.lock();case 1:return n=s.v,s.p=2,s.n=3,this.subscriber.setRemoteDescription(i);case 3:return s.n=4,this.subscriber.createAndSetAnswer();case 4:return a=s.v,s.a(2,a);case 5:return s.p=5,n(),s.f(5);case 6:return s.a(2)}},e,this,[[2,,5,6]])}))}},{key:"updateConfiguration",value:function(i,e){this.publisher.setConfiguration(i),this.subscriber.setConfiguration(i),e&&this.triggerIceRestart()}},{key:"ensurePCTransportConnection",value:function(i,e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,o;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,this.connectionLock.lock();case 1:return o=u.v,u.p=2,this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),u.n=3,Promise.all((s=this.requiredTransports)===null||s===void 0?void 0:s.map(function(c){return a.ensureTransportConnected(c,i,e)}));case 3:return u.p=3,o(),u.f(3);case 4:return u.a(2)}},n,this,[[2,,3,4]])}))}},{key:"negotiate",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n=this;return v().w(function(a){for(;;)switch(a.n){case 0:return a.a(2,new Promise(function(s,o){return b(n,void 0,void 0,v().m(function u(){var c=this,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return l=setTimeout(function(){o("negotiation timed out")},this.peerConnectionTimeout),d=function(){clearTimeout(l),o("negotiation aborted")},i.signal.addEventListener("abort",d),this.publisher.once(Mn.NegotiationStarted,function(){i.signal.aborted||c.publisher.once(Mn.NegotiationComplete,function(){clearTimeout(l),s()})}),f.n=1,this.publisher.negotiate(function(h){clearTimeout(l),o(h)});case 1:return f.a(2)}},u,this)}))}))}},e)}))}},{key:"addPublisherTransceiver",value:function(i,e){return this.publisher.addTransceiver(i,e)}},{key:"addPublisherTrack",value:function(i){return this.publisher.addTrack(i)}},{key:"createPublisherDataChannel",value:function(i,e){return this.publisher.createDataChannel(i,e)}},{key:"getConnectedAddress",value:function(i){return i===ye.PUBLISHER?this.publisher.getConnectedAddress():i===ye.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}},{key:"requiredTransports",get:function(){var i=[];return this.isPublisherConnectionRequired&&i.push(this.publisher),this.isSubscriberConnectionRequired&&i.push(this.subscriber),i}},{key:"ensureTransportConnected",value:function(i,e){return b(this,arguments,void 0,function(n,a){var s=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return v().m(function u(){var c;return v().w(function(l){for(;;)switch(l.n){case 0:if(c=n.getConnectionState(),c!=="connected"){l.n=1;break}return l.a(2);case 1:return l.a(2,new Promise(function(d,f){return b(s,void 0,void 0,v().m(function h(){var p=this,g,k;return v().w(function(y){for(;;)switch(y.n){case 0:g=function(){p.log.warn("abort transport connection",p.logContext),pe.clearTimeout(k),f(new ie("room connection has been cancelled",3))},a!=null&&a.signal.aborted&&g(),a==null||a.signal.addEventListener("abort",g),k=pe.setTimeout(function(){a==null||a.signal.removeEventListener("abort",g),f(new ie("could not establish pc connection",2))},o);case 1:if(this.state===se.CONNECTED){y.n=4;break}return y.n=2,Be(50);case 2:if(!(a!=null&&a.signal.aborted)){y.n=3;break}return f(new ie("room connection has been cancelled",3)),y.a(2);case 3:y.n=1;break;case 4:pe.clearTimeout(k),a==null||a.signal.removeEventListener("abort",g),d();case 5:return y.a(2)}},h,this)}))}))}},u)})()})}}])}(),na=2e3;function Yi(r,t){if(!t)return 0;var i,e;return"bytesReceived"in r?(i=r.bytesReceived,e=t.bytesReceived):"bytesSent"in r&&(i=r.bytesSent,e=t.bytesSent),i===void 0||e===void 0||r.timestamp===void 0||t.timestamp===void 0?0:(i-e)*8*1e3/(r.timestamp-t.timestamp)}var ve=function(r){function t(i,e){var n,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;return P(this,t),n=O(this,t,[i,A.Kind.Audio,e,a,o]),n.stopOnMute=!1,n.isKrispNoiseFilterEnabled=!1,n.monitorSender=function(){return b(n,void 0,void 0,v().m(function u(){var c,l;return v().w(function(d){for(;;)switch(d.n){case 0:if(this.sender){d.n=1;break}return this._currentBitrate=0,d.a(2);case 1:return d.p=1,d.n=2,this.getSenderStats();case 2:c=d.v,d.n=4;break;case 3:return d.p=3,l=d.v,this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l})),d.a(2);case 4:c&&this.prevStats&&(this._currentBitrate=Yi(c,this.prevStats)),this.prevStats=c;case 5:return d.a(2)}},u,this,[[1,3]])}))},n.handleKrispNoiseFilterEnable=function(){n.isKrispNoiseFilterEnabled=!0,n.log.debug("Krisp noise filter enabled",n.logContext),n.emit(F.AudioTrackFeatureUpdate,n,Re.TF_ENHANCED_NOISE_CANCELLATION,!0)},n.handleKrispNoiseFilterDisable=function(){n.isKrispNoiseFilterEnabled=!1,n.log.debug("Krisp noise filter disabled",n.logContext),n.emit(F.AudioTrackFeatureUpdate,n,Re.TF_ENHANCED_NOISE_CANCELLATION,!1)},n.audioContext=s,n.checkForSilence(),n}return N(t,r),E(t,[{key:"enhancedNoiseCancellation",get:function(){return this.isKrispNoiseFilterEnabled}},{key:"mute",value:function(){var e=this,n=Object.create(null,{mute:{get:function(){return Q(t,"mute",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s;return v().w(function(o){for(;;)switch(o.n){case 0:return o.n=1,this.muteLock.lock();case 1:if(s=o.v,o.p=2,!this.isMuted){o.n=3;break}return this.log.debug("Track already muted",this.logContext),o.a(2,this);case 3:return this.source===A.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),o.n=4,n.mute.call(this);case 4:return o.a(2,this);case 5:return o.p=5,s(),o.f(5);case 6:return o.a(2)}},a,this,[[2,,5,6]])}))}},{key:"unmute",value:function(){var e=this,n=Object.create(null,{unmute:{get:function(){return Q(t,"unmute",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s,o;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,this.muteLock.lock();case 1:if(s=u.v,u.p=2,this.isMuted){u.n=3;break}return this.log.debug("Track already unmuted",this.logContext),u.a(2,this);case 3:if(o=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==mn(this._constraints.deviceId),!(this.source===A.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||o)&&!this.isUserProvided)){u.n=4;break}return this.log.debug("reacquiring mic track",this.logContext),u.n=4,this.restartTrack();case 4:return u.n=5,n.unmute.call(this);case 5:return u.a(2,this);case 6:return u.p=6,s(),u.f(6);case 7:return u.a(2)}},a,this,[[2,,6,7]])}))}},{key:"restartTrack",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s;return v().w(function(o){for(;;)switch(o.n){case 0:return e&&(s=Ki({audio:e}),typeof s.audio!="boolean"&&(a=s.audio)),o.n=1,this.restart(a);case 1:return o.a(2)}},n,this)}))}},{key:"restart",value:function(e){var n=this,a=Object.create(null,{restart:{get:function(){return Q(t,"restart",n,1)}}});return b(this,void 0,void 0,v().m(function s(){var o;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,a.restart.call(this,e);case 1:return o=u.v,this.checkForSilence(),u.a(2,o)}},s,this)}))}},{key:"startMonitor",value:function(){var e=this;we()&&(this.monitorInterval||(this.monitorInterval=setInterval(function(){e.monitorSender()},na)))}},{key:"setProcessor",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,o;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,this.processorLock.lock();case 1:if(s=u.v,u.p=2,this.audioContext){u.n=3;break}throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");case 3:if(!this.processor){u.n=4;break}return u.n=4,this.stopProcessor();case 4:return o={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext},this.log.debug("setting up audio processor ".concat(e.name),this.logContext),u.n=5,e.init(o);case 5:if(this.processor=e,!this.processor.processedTrack){u.n=7;break}return u.n=6,(a=this.sender)===null||a===void 0?void 0:a.replaceTrack(this.processor.processedTrack);case 6:this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable);case 7:this.emit(F.TrackProcessorUpdate,this.processor);case 8:return u.p=8,s(),u.f(8);case 9:return u.a(2)}},n,this,[[2,,8,9]])}))}},{key:"setAudioContext",value:function(e){this.audioContext=e}},{key:"getSenderStats",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!((n=this.sender)===null||n===void 0)&&n.getStats){o.n=1;break}return o.a(2,void 0);case 1:return o.n=2,this.sender.getStats();case 2:return a=o.v,a.forEach(function(u){u.type==="outbound-rtp"&&(s={type:"audio",streamId:u.id,packetsSent:u.packetsSent,packetsLost:u.packetsLost,bytesSent:u.bytesSent,timestamp:u.timestamp,roundTripTime:u.roundTripTime,jitter:u.jitter})}),o.a(2,s)}},e,this)}))}},{key:"checkForSilence",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,Sc(this);case 1:return n=a.v,n&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(F.AudioSilenceDetected)),a.a(2,n)}},e,this)}))}}])}(An);function To(r,t,i){switch(r.kind){case"audio":return new ve(r,t,!1,void 0,i);case"video":return new me(r,t,!1,i);default:throw new Xe("unsupported track type: ".concat(r.kind))}}var sl=Object.values(pt),ol=Object.values(Er),ul=Object.values(Xr),cl=[pt.h540,pt.h720],ll=[Er.h540,Er.h720],dl=function(t){var i=[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}];return i.map(function(e){var n,a;return new Ce(Math.floor(t.width/e.scaleResolutionDownBy),Math.floor(t.height/e.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(e.scaleResolutionDownBy,2)*(((n=t.encoding.maxFramerate)!==null&&n!==void 0?n:30)/((a=e.fps)!==null&&a!==void 0?a:30))))),e.fps,t.encoding.priority)})},Mr=["q","h","f"];function Lr(r,t,i,e){var n,a,s=e==null?void 0:e.videoEncoding;r&&(s=e==null?void 0:e.screenShareEncoding);var o=e==null?void 0:e.simulcast,u=e==null?void 0:e.scalabilityMode,c=e==null?void 0:e.videoCodec;if(!s&&!o&&!u||!t||!i)return[{}];s||(s=So(r,t,i,c),Z.debug("using video encoding",s));var l=s.maxFramerate,d=new Ce(t,i,s.maxBitrate,s.maxFramerate,s.priority);if(u&&at(c)){var f=new Co(u),h=[];if(f.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(u));var p=We();if(ln()||en()||(p==null?void 0:p.name)==="Chrome"&&jn(p==null?void 0:p.version,"113")<0){for(var g=f.suffix=="h"?2:3,k=0;k<f.spatial;k+=1)h.push({rid:Mr[2-k],maxBitrate:s.maxBitrate/Math.pow(g,k),maxFramerate:d.encoding.maxFramerate});h[0].scalabilityMode=u}else h.push({maxBitrate:s.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:u});return d.encoding.priority&&(h[0].priority=d.encoding.priority,h[0].networkPriority=d.encoding.priority),Z.debug("using svc encoding",{encodings:h}),h}if(!o)return[s];var y=[];r?y=(n=Ha(e==null?void 0:e.screenShareSimulcastLayers))!==null&&n!==void 0?n:Wa(r,d):y=(a=Ha(e==null?void 0:e.videoSimulcastLayers))!==null&&a!==void 0?a:Wa(r,d);var T;if(y.length>0){var S=y[0];if(y.length>1){var w=y,C=x(w,2);T=C[1]}var I=Math.max(t,i);if(I>=960&&T)return sr(t,i,[S,T,d],l);if(I>=480)return sr(t,i,[S,d],l)}return sr(t,i,[d])}function fl(r,t,i){var e,n,a,s;if(!(!i.backupCodec||i.backupCodec===!0||i.backupCodec.codec===i.videoCodec)){t!==i.backupCodec.codec&&Z.warn("requested a different codec than specified as backup",{serverRequested:t,backup:i.backupCodec.codec}),i.videoCodec=t,i.videoEncoding=i.backupCodec.encoding;var o=r.mediaStreamTrack.getSettings(),u=(e=o.width)!==null&&e!==void 0?e:(n=r.dimensions)===null||n===void 0?void 0:n.width,c=(a=o.height)!==null&&a!==void 0?a:(s=r.dimensions)===null||s===void 0?void 0:s.height,l=Lr(r.source===A.Source.ScreenShare,u,c,i);return l}}function So(r,t,i,e){for(var n=hl(r,t,i),a=n[0].encoding,s=Math.max(t,i),o=0;o<n.length;o+=1){var u=n[o];if(a=u.encoding,u.width>=s)break}if(e)switch(e){case"av1":a=Object.assign({},a),a.maxBitrate=a.maxBitrate*.7;break;case"vp9":a=Object.assign({},a),a.maxBitrate=a.maxBitrate*.85;break}return a}function hl(r,t,i){if(r)return ul;var e=t>i?t/i:i/t;return Math.abs(e-16/9)<Math.abs(e-4/3)?sl:ol}function Wa(r,t){if(r)return dl(t);var i=t.width,e=t.height,n=i>e?i/e:e/i;return Math.abs(n-16/9)<Math.abs(n-4/3)?cl:ll}function sr(r,t,i,e){var n=[];if(i.forEach(function(o,u){if(!(u>=Mr.length)){var c=Math.min(r,t),l=Mr[u],d={rid:l,scaleResolutionDownBy:Math.max(1,c/Math.min(o.width,o.height)),maxBitrate:o.encoding.maxBitrate},f=e&&o.encoding.maxFramerate?Math.min(e,o.encoding.maxFramerate):o.encoding.maxFramerate;f&&(d.maxFramerate=f);var h=qn()||u===0;o.encoding.priority&&h&&(d.priority=o.encoding.priority,d.networkPriority=o.encoding.priority),n.push(d)}}),en()&&mo()==="ios"){var a=void 0;n.forEach(function(o){a?o.maxFramerate&&o.maxFramerate>a&&(a=o.maxFramerate):a=o.maxFramerate});var s=!0;n.forEach(function(o){var u;o.maxFramerate!=a&&(s&&(s=!1,Z.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Z.info('Setting framerate of encoding "'.concat((u=o.rid)!==null&&u!==void 0?u:"",'" to ').concat(a)),o.maxFramerate=a)})}return n}function Ha(r){if(r)return r.sort(function(t,i){var e=t.encoding,n=i.encoding;return e.maxBitrate>n.maxBitrate?1:e.maxBitrate<n.maxBitrate?-1:e.maxBitrate===n.maxBitrate&&e.maxFramerate&&n.maxFramerate?e.maxFramerate>n.maxFramerate?1:-1:0})}var Co=function(){function r(t){P(this,r);var i=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!i)throw new Error("invalid scalability mode");if(this.spatial=parseInt(i[1]),this.temporal=parseInt(i[2]),i.length>3)switch(i[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=i[3]}}return E(r,[{key:"toString",value:function(){var i;return"L".concat(this.spatial,"T").concat(this.temporal).concat((i=this.suffix)!==null&&i!==void 0?i:"")}}])}();function ml(r){return r.source===A.Source.ScreenShare||r.constraints.height&&mn(r.constraints.height)>=1080?"maintain-resolution":"balanced"}var vl=5e3,me=function(r){function t(i,e){var n,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3?arguments[3]:void 0;return P(this,t),n=O(this,t,[i,A.Kind.Video,e,a,s]),n.simulcastCodecs=new Map,n.degradationPreference="balanced",n.monitorSender=function(){return b(n,void 0,void 0,v().m(function o(){var u=this,c,l,d,f;return v().w(function(h){for(;;)switch(h.n){case 0:if(this.sender){h.n=1;break}return this._currentBitrate=0,h.a(2);case 1:return h.p=1,h.n=2,this.getSenderStats();case 2:c=h.v,h.n=4;break;case 3:return h.p=3,f=h.v,this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:f})),h.a(2);case 4:l=new Map(c.map(function(p){return[p.rid,p]})),this.prevStats&&(d=0,l.forEach(function(p,g){var k,y=(k=u.prevStats)===null||k===void 0?void 0:k.get(g);d+=Yi(p,y)}),this._currentBitrate=d),this.prevStats=l;case 5:return h.a(2)}},o,this,[[1,3]])}))},n.senderLock=new Ie,n}return N(t,r),E(t,[{key:"sender",get:function(){return this._sender},set:function(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}},{key:"isSimulcast",get:function(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}},{key:"startMonitor",value:function(e){var n=this,a;if(this.signalClient=e,!!we()){var s=(a=this.sender)===null||a===void 0?void 0:a.getParameters();s&&(this.encodings=s.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(function(){n.monitorSender()},na))}}},{key:"stop",value:function(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(function(e){e.mediaStreamTrack.stop()}),Q(t,"stop",this,3)([])}},{key:"pauseUpstream",value:function(){var e=this,n=Object.create(null,{pauseUpstream:{get:function(){return Q(t,"pauseUpstream",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s,o,u,c,l,d,f,h,p,g;return v().w(function(k){for(;;)switch(k.n){case 0:return k.n=1,n.pauseUpstream.call(this);case 1:k.p=1,d=!0,f=Rn(this.simulcastCodecs.values());case 2:return k.n=3,f.next();case 3:if(h=k.v,s=h.done,s){k.n=5;break}return c=h.value,d=!1,p=c,k.n=4,(l=p.sender)===null||l===void 0?void 0:l.replaceTrack(null);case 4:d=!0,k.n=2;break;case 5:k.n=7;break;case 6:k.p=6,g=k.v,o={error:g};case 7:if(k.p=7,k.p=8,!(!d&&!s&&(u=f.return))){k.n=9;break}return k.n=9,u.call(f);case 9:if(k.p=9,!o){k.n=10;break}throw o.error;case 10:return k.f(9);case 11:return k.f(7);case 12:return k.a(2)}},a,this,[[8,,9,11],[1,6,7,12]])}))}},{key:"resumeUpstream",value:function(){var e=this,n=Object.create(null,{resumeUpstream:{get:function(){return Q(t,"resumeUpstream",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s,o,u,c,l,d,f,h,p,g;return v().w(function(k){for(;;)switch(k.n){case 0:return k.n=1,n.resumeUpstream.call(this);case 1:k.p=1,d=!0,f=Rn(this.simulcastCodecs.values());case 2:return k.n=3,f.next();case 3:if(h=k.v,s=h.done,s){k.n=5;break}return c=h.value,d=!1,p=c,k.n=4,(l=p.sender)===null||l===void 0?void 0:l.replaceTrack(p.mediaStreamTrack);case 4:d=!0,k.n=2;break;case 5:k.n=7;break;case 6:k.p=6,g=k.v,o={error:g};case 7:if(k.p=7,k.p=8,!(!d&&!s&&(u=f.return))){k.n=9;break}return k.n=9,u.call(f);case 9:if(k.p=9,!o){k.n=10;break}throw o.error;case 10:return k.f(9);case 11:return k.f(7);case 12:return k.a(2)}},a,this,[[8,,9,11],[1,6,7,12]])}))}},{key:"mute",value:function(){var e=this,n=Object.create(null,{mute:{get:function(){return Q(t,"mute",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s;return v().w(function(o){for(;;)switch(o.n){case 0:return o.n=1,this.muteLock.lock();case 1:if(s=o.v,o.p=2,!this.isMuted){o.n=3;break}return this.log.debug("Track already muted",this.logContext),o.a(2,this);case 3:return this.source===A.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),o.n=4,n.mute.call(this);case 4:return o.a(2,this);case 5:return o.p=5,s(),o.f(5);case 6:return o.a(2)}},a,this,[[2,,5,6]])}))}},{key:"unmute",value:function(){var e=this,n=Object.create(null,{unmute:{get:function(){return Q(t,"unmute",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s;return v().w(function(o){for(;;)switch(o.n){case 0:return o.n=1,this.muteLock.lock();case 1:if(s=o.v,o.p=2,this.isMuted){o.n=3;break}return this.log.debug("Track already unmuted",this.logContext),o.a(2,this);case 3:if(!(this.source===A.Source.Camera&&!this.isUserProvided)){o.n=4;break}return this.log.debug("reacquiring camera track",this.logContext),o.n=4,this.restartTrack();case 4:return o.n=5,n.unmute.call(this);case 5:return o.a(2,this);case 6:return o.p=6,s(),o.f(6);case 7:return o.a(2)}},a,this,[[2,,6,7]])}))}},{key:"setTrackMuted",value:function(e){Q(t,"setTrackMuted",this,3)([e]);var n=z(this.simulcastCodecs.values()),a;try{for(n.s();!(a=n.n()).done;){var s=a.value;s.mediaStreamTrack.enabled=!e}}catch(o){n.e(o)}finally{n.f()}}},{key:"getSenderStats",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!((n=this.sender)===null||n===void 0)&&n.getStats){o.n=1;break}return o.a(2,[]);case 1:return a=[],o.n=2,this.sender.getStats();case 2:return s=o.v,s.forEach(function(u){var c;if(u.type==="outbound-rtp"){var l={type:"video",streamId:u.id,frameHeight:u.frameHeight,frameWidth:u.frameWidth,framesPerSecond:u.framesPerSecond,framesSent:u.framesSent,firCount:u.firCount,pliCount:u.pliCount,nackCount:u.nackCount,packetsSent:u.packetsSent,bytesSent:u.bytesSent,qualityLimitationReason:u.qualityLimitationReason,qualityLimitationDurations:u.qualityLimitationDurations,qualityLimitationResolutionChanges:u.qualityLimitationResolutionChanges,rid:(c=u.rid)!==null&&c!==void 0?c:u.id,retransmittedPacketsSent:u.retransmittedPacketsSent,targetBitrate:u.targetBitrate,timestamp:u.timestamp},d=s.get(u.remoteId);d&&(l.jitter=d.jitter,l.packetsLost=d.packetsLost,l.roundTripTime=d.roundTripTime),a.push(l)}}),a.sort(function(u,c){var l,d;return((l=c.frameWidth)!==null&&l!==void 0?l:0)-((d=u.frameWidth)!==null&&d!==void 0?d:0)}),o.a(2,a)}},e,this)}))}},{key:"setPublishingQuality",value:function(e){for(var n=[],a=Ne.LOW;a<=Ne.HIGH;a+=1)n.push(new zn({quality:a,enabled:a<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(n)}},{key:"restartTrack",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,o,u,c,l,d,f,h,p,g;return v().w(function(k){for(;;)switch(k.n){case 0:return e&&(l=Ki({video:e}),typeof l.video!="boolean"&&(c=l.video)),k.n=1,this.restart(c);case 1:k.p=1,d=!0,f=Rn(this.simulcastCodecs.values());case 2:return k.n=3,f.next();case 3:if(h=k.v,a=h.done,a){k.n=5;break}if(u=h.value,d=!1,p=u,!p.sender){k.n=4;break}return p.mediaStreamTrack=this.mediaStreamTrack.clone(),k.n=4,p.sender.replaceTrack(p.mediaStreamTrack);case 4:d=!0,k.n=2;break;case 5:k.n=7;break;case 6:k.p=6,g=k.v,s={error:g};case 7:if(k.p=7,k.p=8,!(!d&&!a&&(o=f.return))){k.n=9;break}return k.n=9,o.call(f);case 9:if(k.p=9,!s){k.n=10;break}throw s.error;case 10:return k.f(9);case 11:return k.f(7);case 12:return k.a(2)}},n,this,[[8,,9,11],[1,6,7,12]])}))}},{key:"setProcessor",value:function(e){var n=this,a=Object.create(null,{setProcessor:{get:function(){return Q(t,"setProcessor",n,1)}}});return b(this,arguments,void 0,function(s){var o=this,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return v().m(function c(){var l,d,f,h,p,g,k,y,T,S,w;return v().w(function(C){for(;;)switch(C.n){case 0:return C.n=1,a.setProcessor.call(o,s,u);case 1:if(!(!((p=o.processor)===null||p===void 0)&&p.processedTrack)){C.n=13;break}C.p=2,k=!0,y=Rn(o.simulcastCodecs.values());case 3:return C.n=4,y.next();case 4:if(T=C.v,l=T.done,l){C.n=6;break}return h=T.value,k=!1,S=h,C.n=5,(g=S.sender)===null||g===void 0?void 0:g.replaceTrack(o.processor.processedTrack);case 5:k=!0,C.n=3;break;case 6:C.n=8;break;case 7:C.p=7,w=C.v,d={error:w};case 8:if(C.p=8,C.p=9,!(!k&&!l&&(f=y.return))){C.n=10;break}return C.n=10,f.call(y);case 10:if(C.p=10,!d){C.n=11;break}throw d.error;case 11:return C.f(10);case 12:return C.f(8);case 13:return C.a(2)}},c,null,[[9,,10,12],[2,7,8,13]])})()})}},{key:"setDegradationPreference",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a;return v().w(function(s){for(;;)switch(s.n){case 0:if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext),a=this.sender.getParameters(),a.degradationPreference=e,this.sender.setParameters(a)}catch(o){this.log.warn("failed to set degradationPreference",Object.assign({error:o},this.logContext))}case 1:return s.a(2)}},n,this)}))}},{key:"addSimulcastTrack",value:function(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}var a={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,a),a}},{key:"setSimulcastTrackSender",value:function(e,n){var a=this,s=this.simulcastCodecs.get(e);s&&(s.sender=n,setTimeout(function(){a.subscribedCodecs&&a.setPublishingCodecs(a.subscribedCodecs)},vl))}},{key:"setPublishingCodecs",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,o,u,c,l,d,f,h,p,g,k,y,T,S;return v().w(function(w){for(;;)switch(w.n){case 0:if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!(!this.codec&&e.length>0)){w.n=2;break}return w.n=1,this.setPublishingLayers(e[0].qualities);case 1:return w.a(2,[]);case 2:this.subscribedCodecs=e,f=[],w.p=3,a=!0,s=Rn(e);case 4:return w.n=5,s.next();case 5:if(o=w.v,u=o.done,u){w.n=17;break}if(d=o.value,a=!1,h=d,!(!this.codec||this.codec===h.codec)){w.n=7;break}return w.n=6,this.setPublishingLayers(h.qualities);case 6:w.n=16;break;case 7:if(p=this.simulcastCodecs.get(h.codec),this.log.debug("try setPublishingCodec for ".concat(h.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:p})),!(!p||!p.sender)){w.n=15;break}g=z(h.qualities),w.p=8,g.s();case 9:if((k=g.n()).done){w.n=11;break}if(y=k.value,!y.enabled){w.n=10;break}return f.push(h.codec),w.a(3,11);case 10:w.n=9;break;case 11:w.n=13;break;case 12:w.p=12,T=w.v,g.e(T);case 13:return w.p=13,g.f(),w.f(13);case 14:w.n=16;break;case 15:if(!p.encodings){w.n=16;break}return this.log.debug("try setPublishingLayersForSender ".concat(h.codec),this.logContext),w.n=16,za(p.sender,p.encodings,h.qualities,this.senderLock,this.log,this.logContext);case 16:a=!0,w.n=4;break;case 17:w.n=19;break;case 18:w.p=18,S=w.v,c={error:S};case 19:if(w.p=19,w.p=20,!(!a&&!u&&(l=s.return))){w.n=21;break}return w.n=21,l.call(s);case 21:if(w.p=21,!c){w.n=22;break}throw c.error;case 22:return w.f(21);case 23:return w.f(19);case 24:return w.a(2,f)}},n,this,[[20,,21,23],[8,12,13,14],[3,18,19,24]])}))}},{key:"setPublishingLayers",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),!(!this.sender||!this.encodings)){a.n=1;break}return a.a(2);case 1:return a.n=2,za(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext);case 2:return a.a(2)}},n,this)}))}},{key:"handleAppVisibilityChanged",value:function(){var e=this,n=Object.create(null,{handleAppVisibilityChanged:{get:function(){return Q(t,"handleAppVisibilityChanged",e,1)}}});return b(this,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,n.handleAppVisibilityChanged.call(this);case 1:if(fo()){s.n=2;break}return s.a(2);case 2:this.isInBackground&&this.source===A.Source.Camera&&(this._mediaStreamTrack.enabled=!1);case 3:return s.a(2)}},a,this)}))}}])}(An);function za(r,t,i,e,n,a){return b(this,void 0,void 0,v().m(function s(){var o,u,c,l,d,f,h;return v().w(function(p){for(;;)switch(p.n){case 0:return p.n=1,e.lock();case 1:if(o=p.v,n.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:r,qualities:i,senderEncodings:t})),p.p=2,u=r.getParameters(),c=u.encodings,c){p.n=3;break}return p.a(2);case 3:if(c.length===t.length){p.n=4;break}return n.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:c,senderEncodings:t})),p.a(2);case 4:if(l=!1,d=!1,d&&c[0].scalabilityMode?(f=c[0],h=De.OFF,i.forEach(function(g){g.enabled&&(h===De.OFF||g.quality>h)&&(h=g.quality)}),h===De.OFF?f.active&&(f.active=!1,l=!0):f.active||(l=!0,f.active=!0)):c.forEach(function(g,k){var y,T=(y=g.rid)!==null&&y!==void 0?y:"";T===""&&(T="q");var S=wo(T),w=i.find(function(C){return C.quality===S});w&&g.active!==w.enabled&&(l=!0,g.active=w.enabled,n.debug("setting layer ".concat(w.quality," to ").concat(g.active?"enabled":"disabled"),a),qn()&&(w.enabled?(g.scaleResolutionDownBy=t[k].scaleResolutionDownBy,g.maxBitrate=t[k].maxBitrate,g.maxFrameRate=t[k].maxFrameRate):(g.scaleResolutionDownBy=4,g.maxBitrate=10,g.maxFrameRate=2)))}),!l){p.n=5;break}return u.encodings=c,n.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:u.encodings})),p.n=5,r.setParameters(u);case 5:return p.p=5,o(),p.f(5);case 6:return p.a(2)}},s,null,[[2,,5,6]])}))}function wo(r){switch(r){case"f":return Ne.HIGH;case"h":return Ne.MEDIUM;case"q":return Ne.LOW;default:return Ne.HIGH}}function Ka(r,t,i,e){if(!i)return[new je({quality:Ne.HIGH,width:r,height:t,bitrate:0,ssrc:0})];if(e){for(var n=i[0].scalabilityMode,a=new Co(n),s=[],o=a.suffix=="h"?1.5:2,u=a.suffix=="h"?2:3,c=0;c<a.spatial;c+=1)s.push(new je({quality:Math.min(Ne.HIGH,a.spatial-1)-c,width:Math.ceil(r/Math.pow(o,c)),height:Math.ceil(t/Math.pow(o,c)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(u,c)):0,ssrc:0}));return s}return i.map(function(l){var d,f,h,p=(d=l.scaleResolutionDownBy)!==null&&d!==void 0?d:1,g=wo((f=l.rid)!==null&&f!==void 0?f:"");return new je({quality:g,width:Math.ceil(r/p),height:Math.ceil(t/p),bitrate:(h=l.maxBitrate)!==null&&h!==void 0?h:0,ssrc:0})})}var Ya="_lossy",Qa="_reliable",Xa=2*1e3,or="leave-reconnect",Me;(function(r){r[r.New=0]="New",r[r.Connected=1]="Connected",r[r.Disconnected=2]="Disconnected",r[r.Reconnecting=3]="Reconnecting",r[r.Closed=4]="Closed"})(Me||(Me={}));var pl=function(r){function t(i){var e;P(this,t);var n;return e=O(this,t),e.options=i,e.rtcConfig={},e.peerConnectionTimeout=ea.peerConnectionTimeout,e.fullReconnectOnNext=!1,e.subscriberPrimary=!1,e.hasPublished=!1,e.pcState=Me.New,e._isClosed=!0,e.pendingTrackResolvers={},e.reconnectAttempts=0,e.reconnectStart=0,e.attemptingReconnect=!1,e.joinAttempts=0,e.maxJoinAttempts=1,e.firstReconnectAttempt=!0,e.shouldFailNext=!1,e.log=Z,e.disconnectStartTimePrimary=0,e.disconnectStartTimeSecondary=0,e.handleDataChannel=function(a){return b(e,[a],void 0,function(s){var o=this,u=s.channel;return v().m(function c(){return v().w(function(l){for(;;)switch(l.n){case 0:if(u){l.n=1;break}return l.a(2);case 1:if(u.label!==Qa){l.n=2;break}o.reliableDCSub=u,l.n=4;break;case 2:if(u.label!==Ya){l.n=3;break}o.lossyDCSub=u,l.n=4;break;case 3:return l.a(2);case 4:o.log.debug("on data channel ".concat(u.id,", ").concat(u.label),o.logContext),u.onmessage=o.handleDataMessage;case 5:return l.a(2)}},c)})()})},e.handleDataMessage=function(a){return b(e,void 0,void 0,v().m(function s(){var o,u,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return f.n=1,this.dataProcessLock.lock();case 1:if(c=f.v,f.p=2,!(a.data instanceof ArrayBuffer)){f.n=3;break}l=a.data,f.n=6;break;case 3:if(!(a.data instanceof Blob)){f.n=5;break}return f.n=4,a.data.arrayBuffer();case 4:l=f.v,f.n=6;break;case 5:return this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:a.data})),f.a(2);case 6:d=Le.fromBinary(new Uint8Array(l)),((o=d.value)===null||o===void 0?void 0:o.case)==="speaker"?this.emit(_.ActiveSpeakersUpdate,d.value.value.speakers):(((u=d.value)===null||u===void 0?void 0:u.case)==="user"&&kl(d,d.value.value),this.emit(_.DataPacketReceived,d));case 7:return f.p=7,c(),f.f(7);case 8:return f.a(2)}},s,this,[[2,,7,8]])}))},e.handleDataError=function(a){var s=a.currentTarget,o=s.maxRetransmits===0?"lossy":"reliable";if(a instanceof ErrorEvent&&a.error){var u=a.error.error;e.log.error("DataChannel error on ".concat(o,": ").concat(a.message),Object.assign(Object.assign({},e.logContext),{error:u}))}else e.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},e.logContext),{event:a}))},e.handleBufferedAmountLow=function(a){var s=a.currentTarget,o=s.maxRetransmits===0?ne.LOSSY:ne.RELIABLE;e.updateAndEmitDCBufferStatus(o)},e.handleDisconnect=function(a,s){if(!e._isClosed){e.log.warn("".concat(a," disconnected"),e.logContext),e.reconnectAttempts===0&&(e.reconnectStart=Date.now());var o=function(d){e.log.warn("could not recover connection after ".concat(e.reconnectAttempts," attempts, ").concat(d,"ms. giving up"),e.logContext),e.emit(_.Disconnected),e.close()},u=Date.now()-e.reconnectStart,c=e.getNextRetryDelay({elapsedMs:u,retryCount:e.reconnectAttempts});if(c===null){o(u);return}a===or&&(c=0),e.log.debug("reconnecting in ".concat(c,"ms"),e.logContext),e.clearReconnectTimeout(),e.token&&e.regionUrlProvider&&e.regionUrlProvider.updateToken(e.token),e.reconnectTimeout=pe.setTimeout(function(){return e.attemptReconnect(s).finally(function(){return e.reconnectTimeout=void 0})},c)}},e.waitForRestarted=function(){return new Promise(function(a,s){e.pcState===Me.Connected&&a();var o=function(){e.off(_.Disconnected,u),a()},u=function(){e.off(_.Restarted,o),s()};e.once(_.Restarted,o),e.once(_.Disconnected,u)})},e.updateAndEmitDCBufferStatus=function(a){var s=e.isBufferStatusLow(a);typeof s<"u"&&s!==e.dcBufferStatus.get(a)&&(e.dcBufferStatus.set(a,s),e.emit(_.DCBufferStatusChanged,s,a))},e.isBufferStatusLow=function(a){var s=e.dataChannelForKind(a);if(s)return s.bufferedAmount<=s.bufferedAmountLowThreshold},e.handleBrowserOnLine=function(){e.client.currentState===ae.RECONNECTING&&(e.clearReconnectTimeout(),e.attemptReconnect(ze.RR_SIGNAL_DISCONNECTED))},e.log=xe((n=i.loggerName)!==null&&n!==void 0?n:_e.Engine),e.loggerOptions={loggerName:i.loggerName,loggerContextCb:function(){return e.logContext}},e.client=new xr(void 0,e.loggerOptions),e.client.signalLatency=e.options.expSignalLatency,e.reconnectPolicy=e.options.reconnectPolicy,e.registerOnLineListener(),e.closingLock=new Ie,e.dataProcessLock=new Ie,e.dcBufferStatus=new Map([[ne.LOSSY,!0],[ne.RELIABLE,!0]]),e.client.onParticipantUpdate=function(a){return e.emit(_.ParticipantUpdate,a)},e.client.onConnectionQuality=function(a){return e.emit(_.ConnectionQualityUpdate,a)},e.client.onRoomUpdate=function(a){return e.emit(_.RoomUpdate,a)},e.client.onSubscriptionError=function(a){return e.emit(_.SubscriptionError,a)},e.client.onSubscriptionPermissionUpdate=function(a){return e.emit(_.SubscriptionPermissionUpdate,a)},e.client.onSpeakersChanged=function(a){return e.emit(_.SpeakersChanged,a)},e.client.onStreamStateUpdate=function(a){return e.emit(_.StreamStateChanged,a)},e.client.onRequestResponse=function(a){return e.emit(_.SignalRequestResponse,a)},e}return N(t,r),E(t,[{key:"isClosed",get:function(){return this._isClosed}},{key:"pendingReconnect",get:function(){return!!this.reconnectTimeout}},{key:"logContext",get:function(){var e,n,a,s,o,u,c,l;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(s=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.room)===null||s===void 0?void 0:s.sid,participant:(u=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||u===void 0?void 0:u.identity,pID:(l=(c=this.latestJoinResponse)===null||c===void 0?void 0:c.participant)===null||l===void 0?void 0:l.sid}}},{key:"join",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function o(){var u,c;return v().w(function(l){for(;;)switch(l.n){case 0:return this.url=e,this.token=n,this.signalOpts=a,this.maxJoinAttempts=a.maxRetries,l.p=1,this.joinAttempts+=1,this.setupSignalClientCallbacks(),l.n=2,this.client.join(e,n,a,s);case 2:if(u=l.v,this._isClosed=!1,this.latestJoinResponse=u,this.subscriberPrimary=u.subscriberPrimary,this.pcManager){l.n=3;break}return l.n=3,this.configure(u);case 3:return(!this.subscriberPrimary||u.fastPublish)&&this.negotiate(),this.clientConfiguration=u.clientConfiguration,l.a(2,u);case 4:if(l.p=4,c=l.v,!(c instanceof ie)){l.n=5;break}if(c.reason!==1){l.n=5;break}if(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),!(this.joinAttempts<this.maxJoinAttempts)){l.n=5;break}return l.a(2,this.join(e,n,a,s));case 5:throw c;case 6:return l.a(2)}},o,this,[[1,4]])}))}},{key:"close",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,this.closingLock.lock();case 1:if(n=a.v,!this.isClosed){a.n=2;break}return n(),a.a(2);case 2:return a.p=2,this._isClosed=!0,this.joinAttempts=0,this.emit(_.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),a.n=3,this.cleanupPeerConnections();case 3:return a.n=4,this.cleanupClient();case 4:return a.p=4,n(),a.f(4);case 5:return a.a(2)}},e,this,[[2,,4,5]])}))}},{key:"cleanupPeerConnections",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,(n=this.pcManager)===null||n===void 0?void 0:n.close();case 1:this.pcManager=void 0,a=function(u){u&&(u.close(),u.onbufferedamountlow=null,u.onclose=null,u.onclosing=null,u.onerror=null,u.onmessage=null,u.onopen=null)},a(this.lossyDC),a(this.lossyDCSub),a(this.reliableDC),a(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0;case 2:return s.a(2)}},e,this)}))}},{key:"cleanupClient",value:function(){return b(this,void 0,void 0,v().m(function e(){return v().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,this.client.close();case 1:this.client.resetCallbacks();case 2:return n.a(2)}},e,this)}))}},{key:"addTrack",value:function(e){var n=this;if(this.pendingTrackResolvers[e.cid])throw new Xe("a track with the same ID has already been published");return new Promise(function(a,s){var o=setTimeout(function(){delete n.pendingTrackResolvers[e.cid],s(new ie("publication of local track timed out, no response from server",2))},1e4);n.pendingTrackResolvers[e.cid]={resolve:function(c){clearTimeout(o),a(c)},reject:function(){clearTimeout(o),s(new Error("Cancelled publication by calling unpublish"))}},n.client.sendAddTrack(e)})}},{key:"removeTrack",value:function(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){var n=this.pendingTrackResolvers[e.track.id].reject;n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(a){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:a}))}return!1}},{key:"updateMuteStatus",value:function(e,n){this.client.sendMuteTrack(e,n)}},{key:"dataSubscriberReadyState",get:function(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}},{key:"getConnectedServerAddress",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.a(2,(n=this.pcManager)===null||n===void 0?void 0:n.getConnectedAddress())}},e,this)}))}},{key:"setRegionUrlProvider",value:function(e){this.regionUrlProvider=e}},{key:"configure",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,o,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(!(this.pcManager&&this.pcManager.currentState!==se.NEW)){c.n=1;break}return c.a(2);case 1:this.participantSid=(s=e.participant)===null||s===void 0?void 0:s.sid,u=this.makeRTCConfiguration(e),this.pcManager=new al(u,e.subscriberPrimary,this.loggerOptions),this.emit(_.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=function(l,d){a.client.sendIceCandidate(l,d)},this.pcManager.onPublisherOffer=function(l){a.client.sendOffer(l)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=function(l,d,f){return b(a,void 0,void 0,v().m(function h(){var p,g,k;return v().w(function(y){for(;;)switch(y.n){case 0:this.log.debug("primary PC state changed ".concat(l),this.logContext),["closed","disconnected","failed"].includes(d)&&(this.publisherConnectionPromise=void 0),l===se.CONNECTED?(p=this.pcState===Me.New,this.pcState=Me.Connected,p&&this.emit(_.Connected,e)):l===se.FAILED&&this.pcState===Me.Connected&&(this.pcState=Me.Disconnected,this.handleDisconnect("peerconnection failed",f==="failed"?ze.RR_SUBSCRIBER_FAILED:ze.RR_PUBLISHER_FAILED)),g=this.client.isDisconnected||this.client.currentState===ae.RECONNECTING,k=[se.FAILED,se.CLOSING,se.CLOSED].includes(l),g&&k&&!this._isClosed&&this.emit(_.Offline);case 1:return y.a(2)}},h,this)}))},this.pcManager.onTrack=function(l){a.emit(_.MediaTrackAdded,l.track,l.streams[0],l.receiver)},gl((o=e.serverInfo)===null||o===void 0?void 0:o.protocol)||this.createDataChannels();case 2:return c.a(2)}},n,this)}))}},{key:"setupSignalClientCallbacks",value:function(){var e=this;this.client.onAnswer=function(n){return b(e,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:if(this.pcManager){s.n=1;break}return s.a(2);case 1:return this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:n.type})),s.n=2,this.pcManager.setPublisherAnswer(n);case 2:return s.a(2)}},a,this)}))},this.client.onTrickle=function(n,a){e.pcManager&&(e.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},e.logContext),{candidate:n,target:a})),e.pcManager.addIceCandidate(n,a))},this.client.onOffer=function(n){return b(e,void 0,void 0,v().m(function a(){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(this.pcManager){o.n=1;break}return o.a(2);case 1:return o.n=2,this.pcManager.createSubscriberAnswerFromOffer(n);case 2:s=o.v,this.client.sendAnswer(s);case 3:return o.a(2)}},a,this)}))},this.client.onLocalTrackPublished=function(n){var a;if(e.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},e.logContext),{cid:n.cid,track:(a=n.track)===null||a===void 0?void 0:a.sid})),!e.pendingTrackResolvers[n.cid]){e.log.error("missing track resolver for ".concat(n.cid),Object.assign(Object.assign({},e.logContext),{cid:n.cid}));return}var s=e.pendingTrackResolvers[n.cid].resolve;delete e.pendingTrackResolvers[n.cid],s(n.track)},this.client.onLocalTrackUnpublished=function(n){e.emit(_.LocalTrackUnpublished,n)},this.client.onLocalTrackSubscribed=function(n){e.emit(_.LocalTrackSubscribed,n)},this.client.onTokenRefresh=function(n){e.token=n,sessionStorage.setItem("token",e.token)},this.client.onRemoteMuteChanged=function(n,a){e.emit(_.RemoteMute,n,a)},this.client.onSubscribedQualityUpdate=function(n){e.emit(_.SubscribedQualityUpdate,n)},this.client.onClose=function(){e.handleDisconnect("signal",ze.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=function(n){switch(e.log.debug("client leave request",Object.assign(Object.assign({},e.logContext),{reason:n==null?void 0:n.reason})),sessionStorage.removeItem("token"),sessionStorage.removeItem("isAudioMuted"),sessionStorage.removeItem("isVideoMuted"),n.regions&&e.regionUrlProvider&&(e.log.debug("updating regions",e.logContext),e.regionUrlProvider.setServerReportedRegions(n.regions)),n.action){case Ve.DISCONNECT:e.emit(_.Disconnected,n==null?void 0:n.reason),e.close();break;case Ve.RECONNECT:e.fullReconnectOnNext=!0,e.handleDisconnect(or);break;case Ve.RESUME:e.handleDisconnect(or)}}}},{key:"makeRTCConfiguration",value:function(e){var n,a=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),a.encodedInsertableStreams=!0),e.iceServers&&!a.iceServers){var s=[];e.iceServers.forEach(function(o){var u={urls:o.urls};o.username&&(u.username=o.username),o.credential&&(u.credential=o.credential),s.push(u)}),a.iceServers=s}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Fe.ENABLED&&(a.iceTransportPolicy="relay"),a.sdpSemantics="unified-plan",a.continualGatheringPolicy="gather_continually",a}},{key:"createDataChannels",value:function(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Ya,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Qa,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}},{key:"createSender",value:function(e,n,a){return b(this,void 0,void 0,v().m(function s(){var o,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(!Ir()){c.n=2;break}return c.n=1,this.createTransceiverRTCRtpSender(e,n,a);case 1:return o=c.v,c.a(2,o);case 2:if(!Or()){c.n=4;break}return this.log.warn("using add-track fallback",this.logContext),c.n=3,this.createRTCRtpSender(e.mediaStreamTrack);case 3:return u=c.v,c.a(2,u);case 4:throw new de("Required webRTC APIs not supported on this device");case 5:return c.a(2)}},s,this)}))}},{key:"createSimulcastSender",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function o(){return v().w(function(u){for(;;)switch(u.n){case 0:if(!Ir()){u.n=1;break}return u.a(2,this.createSimulcastTransceiverSender(e,n,a,s));case 1:if(!Or()){u.n=2;break}return this.log.debug("using add-track fallback",this.logContext),u.a(2,this.createRTCRtpSender(e.mediaStreamTrack));case 2:throw new de("Cannot stream on this device");case 3:return u.a(2)}},o,this)}))}},{key:"createTransceiverRTCRtpSender",value:function(e,n,a){return b(this,void 0,void 0,v().m(function s(){var o,u,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(this.pcManager){l.n=1;break}throw new de("publisher is closed");case 1:return o=[],e.mediaStream&&o.push(e.mediaStream),e instanceof me&&(e.codec=n.videoCodec),u={direction:"sendonly",streams:o},a&&(u.sendEncodings=a),l.n=2,this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,u);case 2:return c=l.v,l.a(2,c.sender)}},s,this)}))}},{key:"createSimulcastTransceiverSender",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function o(){var u,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(this.pcManager){l.n=1;break}throw new de("publisher is closed");case 1:return u={direction:"sendonly"},s&&(u.sendEncodings=s),l.n=2,this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,u);case 2:if(c=l.v,a.videoCodec){l.n=3;break}return l.a(2);case 3:return e.setSimulcastTrackSender(a.videoCodec,c.sender),l.a(2,c.sender)}},o,this)}))}},{key:"createRTCRtpSender",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(this.pcManager){a.n=1;break}throw new de("publisher is closed");case 1:return a.a(2,this.pcManager.addPublisherTrack(e))}},n,this)}))}},{key:"attemptReconnect",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,o,u,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(!this._isClosed){l.n=1;break}return l.a(2);case 1:if(!this.attemptingReconnect){l.n=2;break}return Z.warn("already attempting reconnect, returning early",this.logContext),l.a(2);case 2:if((((a=this.clientConfiguration)===null||a===void 0?void 0:a.resumeConnection)===Fe.DISABLED||((o=(s=this.pcManager)===null||s===void 0?void 0:s.currentState)!==null&&o!==void 0?o:se.NEW)===se.NEW)&&(this.fullReconnectOnNext=!0),l.p=3,this.attemptingReconnect=!0,!this.fullReconnectOnNext){l.n=5;break}return l.n=4,this.restartConnection();case 4:l.n=6;break;case 5:return l.n=6,this.resumeConnection(e);case 6:this.clearPendingReconnect(),this.fullReconnectOnNext=!1,l.n=9;break;case 7:if(l.p=7,c=l.v,this.reconnectAttempts+=1,u=!0,c instanceof de?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:c})),u=!1):c instanceof En||(this.fullReconnectOnNext=!0),!u){l.n=8;break}this.handleDisconnect("reconnect",ze.RR_UNKNOWN),l.n=9;break;case 8:return this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(_.Disconnected),l.n=9,this.close();case 9:return l.p=9,this.attemptingReconnect=!1,l.f(9);case 10:return l.a(2)}},n,this,[[3,7,9,10]])}))}},{key:"getNextRetryDelay",value:function(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}},{key:"restartConnection",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,o,u,c,l,d,f;return v().w(function(h){for(;;)switch(h.n){case 0:if(h.p=0,!(!this.url||!this.token)){h.n=1;break}throw new de("could not reconnect, url or token not saved");case 1:if(this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(_.Restarting),this.client.isDisconnected){h.n=2;break}return h.n=2,this.client.sendLeave();case 2:return h.n=3,this.cleanupPeerConnections();case 3:return h.n=4,this.cleanupClient();case 4:if(h.p=4,this.signalOpts){h.n=5;break}throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new En;case 5:return h.n=6,this.join(e??this.url,this.token,this.signalOpts);case 6:u=h.v,h.n=9;break;case 7:if(h.p=7,d=h.v,!(d instanceof ie&&d.reason===0)){h.n=8;break}throw new de("could not reconnect, token might be expired");case 8:throw new En;case 9:if(!this.shouldFailNext){h.n=10;break}throw this.shouldFailNext=!1,new Error("simulated failure");case 10:return this.client.setReconnected(),this.emit(_.SignalRestarted,u),h.n=11,this.waitForPCReconnected();case 11:if(this.client.currentState===ae.CONNECTED){h.n=12;break}throw new En("Signal connection got severed during reconnect");case 12:this.client.setReconnected(),this.emit(_.SignalRestarted,u),(a=this.regionUrlProvider)===null||a===void 0||a.resetAttempts(),this.emit(_.Restarted),c=Date.now(),this.disconnectStartTimePrimary==0&&(this.disconnectStartTimePrimary=c),this.disconnectStartTimeSecondary==0&&(this.disconnectStartTimeSecondary=c),this.emit(_.PrimaryDelay,c-this.disconnectStartTimePrimary),this.emit(_.SecondaryDelay,c-this.disconnectStartTimeSecondary),this.disconnectStartTimePrimary=this.disconnectStartTimeSecondary=0,h.n=17;break;case 13:return h.p=13,f=h.v,h.n=14,(s=this.regionUrlProvider)===null||s===void 0?void 0:s.getNextBestRegionUrl();case 14:if(l=h.v,!l){h.n=16;break}return h.n=15,this.restartConnection(l);case 15:return h.a(2);case 16:throw(o=this.regionUrlProvider)===null||o===void 0||o.resetAttempts(),f;case 17:return h.a(2)}},n,this,[[4,7],[0,13]])}))}},{key:"resumeConnection",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,o,u,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(!(!this.url||!this.token)){l.n=1;break}throw new de("could not reconnect, url or token not saved");case 1:if(this.pcManager){l.n=2;break}throw new de("publisher and subscriber connections unset");case 2:return this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(_.Resuming),l.p=3,this.setupSignalClientCallbacks(),l.n=4,this.client.reconnect(this.url,this.token,this.participantSid,e);case 4:s=l.v,l.n=8;break;case 5:if(l.p=5,c=l.v,o="",c instanceof Error&&(o=c.message,this.log.error(c.message,Object.assign(Object.assign({},this.logContext),{error:c}))),!(c instanceof ie&&c.reason===0)){l.n=6;break}throw new de("could not reconnect, token might be expired");case 6:if(!(c instanceof ie&&c.reason===4)){l.n=7;break}throw c;case 7:throw new En(o);case 8:if(this.emit(_.SignalResumed),s?(u=this.makeRTCConfiguration(s),this.pcManager.updateConfiguration(u)):this.log.warn("Did not receive reconnect response",this.logContext),!this.shouldFailNext){l.n=9;break}throw this.shouldFailNext=!1,new Error("simulated failure");case 9:return l.n=10,this.pcManager.triggerIceRestart();case 10:return l.n=11,this.waitForPCReconnected();case 11:if(this.client.currentState===ae.CONNECTED){l.n=12;break}throw new En("Signal connection got severed during reconnect");case 12:this.hasPublished&&(this.disconnectStartTimePrimary==0||this.disconnectStartTimeSecondary==0)&&this.firstReconnectAttempt&&(this.disconnectStartTimePrimary=this.disconnectStartTimeSecondary=Date.now(),this.firstReconnectAttempt=!1),this.client.setReconnected(),((a=this.reliableDC)===null||a===void 0?void 0:a.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(_.Resumed);case 13:return l.a(2)}},n,this,[[3,5]])}))}},{key:"waitForPCInitialConnection",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:if(this.pcManager){s.n=1;break}throw new de("PC manager is closed");case 1:return s.n=2,this.pcManager.ensurePCTransportConnection(n,e);case 2:return s.a(2)}},a,this)}))}},{key:"waitForPCReconnected",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,o,u;return v().w(function(c){for(;;)switch(c.n){case 0:return this.pcState=Me.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext),c.p=1,c.n=2,Be(Xa);case 2:if(this.pcManager){c.n=3;break}throw new de("PC manager is closed");case 3:return c.n=4,this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout);case 4:a=Date.now(),s=a,this.pcState=Me.Reconnecting;case 5:if(!(s-a<this.peerConnectionTimeout)){c.n=8;break}if(this.primaryPC!==void 0){c.n=6;break}return c.a(3,8);case 6:s-a>Xa&&((n=this.primaryPC)===null||n===void 0?void 0:n.connectionState)==="connected"&&(o=Date.now(),this.disconnectStartTimePrimary==0&&(this.disconnectStartTimePrimary=o),this.disconnectStartTimeSecondary==0&&(this.disconnectStartTimeSecondary=o),this.emit(_.PrimaryDelay,o-this.disconnectStartTimePrimary),this.emit(_.SecondaryDelay,o-this.disconnectStartTimeSecondary),this.disconnectStartTimePrimary=0,this.disconnectStartTimeSecondary=0,this.firstReconnectAttempt=!0);case 7:c.n=5;break;case 8:c.n=10;break;case 9:throw c.p=9,u=c.v,this.pcState=Me.Disconnected,new ie("could not establish PC connection, ".concat(u.message),2);case 10:return c.a(2)}},e,this,[[1,9]])}))}},{key:"sendDataPacket",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s,o;return v().w(function(u){for(;;)switch(u.n){case 0:return s=e.toBinary(),u.n=1,this.ensurePublisherConnected(n);case 1:o=this.dataChannelForKind(n),o&&o.send(s),this.updateAndEmitDCBufferStatus(n);case 2:return u.a(2)}},a,this)}))}},{key:"ensureDataTransportConnected",value:function(e){return b(this,arguments,void 0,function(n){var a=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return v().m(function o(){var u,c,l,d,f,h;return v().w(function(p){for(;;)switch(p.n){case 0:if(a.pcManager){p.n=1;break}throw new de("PC manager is closed");case 1:if(c=s?a.pcManager.subscriber:a.pcManager.publisher,l=s?"Subscriber":"Publisher",c){p.n=2;break}throw new ie("".concat(l," connection not set"),2);case 2:if(d=!1,!s&&!a.dataChannelForKind(n,s)&&(a.createDataChannels(),d=!0),!d&&!s&&!a.pcManager.publisher.isICEConnected&&a.pcManager.publisher.getICEConnectionState()!=="checking"&&(d=!0),d&&a.negotiate(),f=a.dataChannelForKind(n,s),(f==null?void 0:f.readyState)!=="open"){p.n=3;break}return p.a(2);case 3:h=new Date().getTime()+a.peerConnectionTimeout;case 4:if(!(new Date().getTime()<h)){p.n=7;break}if(!(c.isICEConnected&&((u=a.dataChannelForKind(n,s))===null||u===void 0?void 0:u.readyState)==="open")){p.n=5;break}return p.a(2);case 5:return p.n=6,Be(50);case 6:p.n=4;break;case 7:throw new ie("could not establish ".concat(l," connection, state: ").concat(c.getICEConnectionState()),2);case 8:return p.a(2)}},o)})()})}},{key:"ensurePublisherConnected",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),a.n=1,this.publisherConnectionPromise;case 1:return a.a(2)}},n,this)}))}},{key:"verifyTransport",value:function(){return!(!this.pcManager||this.pcManager.currentState!==se.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}},{key:"negotiate",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this;return v().w(function(a){for(;;)switch(a.n){case 0:return a.a(2,new Promise(function(s,o){return b(n,void 0,void 0,v().m(function u(){var c=this,l,d,f;return v().w(function(h){for(;;)switch(h.n){case 0:if(this.pcManager){h.n=1;break}return o(new wr("PC manager is closed")),h.a(2);case 1:return this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels(),l=new AbortController,d=function(){l.abort(),c.log.debug("engine disconnected while negotiation was ongoing",c.logContext),s()},this.isClosed&&o("cannot negotiate on closed engine"),this.on(_.Closing,d),this.pcManager.publisher.once(Mn.RTPVideoPayloadTypes,function(p){var g=new Map;p.forEach(function(k){var y=k.codec.toLowerCase();Bc(y)&&g.set(k.payload,y)}),c.emit(_.RTPVideoMapUpdate,g)}),h.p=2,h.n=3,this.pcManager.negotiate(l);case 3:s(),h.n=5;break;case 4:h.p=4,f=h.v,f instanceof wr&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ze.RR_UNKNOWN),o(f);case 5:return h.p=5,this.off(_.Closing,d),h.f(5);case 6:return h.a(2)}},u,this,[[2,4,5,6]])}))}))}},e)}))}},{key:"dataChannelForKind",value:function(e,n){if(n){if(e===ne.LOSSY)return this.lossyDCSub;if(e===ne.RELIABLE)return this.reliableDCSub}else{if(e===ne.LOSSY)return this.lossyDC;if(e===ne.RELIABLE)return this.reliableDC}}},{key:"sendSyncState",value:function(e,n){var a,s;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}var o=this.pcManager.subscriber.getLocalDescription(),u=this.pcManager.subscriber.getRemoteDescription(),c=(s=(a=this.signalOpts)===null||a===void 0?void 0:a.autoSubscribe)!==null&&s!==void 0?s:!0,l=new Array,d=new Array;e.forEach(function(f){f.isDesired!==c&&l.push(f.trackSid),f.isEnabled||d.push(f.trackSid)}),this.client.sendSyncState(new Ut({answer:o?ri({sdp:o.sdp,type:o.type}):void 0,offer:u?ri({sdp:u.sdp,type:u.type}):void 0,subscription:new yn({trackSids:l,subscribe:!c,participantTracks:[]}),publishTracks:wc(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:d}))}},{key:"failNext",value:function(){this.shouldFailNext=!0}},{key:"dataChannelsInfo",value:function(){var e=[],n=function(s,o){(s==null?void 0:s.id)!==void 0&&s.id!==null&&e.push(new Jt({label:s.label,id:s.id,target:o}))};return n(this.dataChannelForKind(ne.LOSSY),ye.PUBLISHER),n(this.dataChannelForKind(ne.RELIABLE),ye.PUBLISHER),n(this.dataChannelForKind(ne.LOSSY,!0),ye.SUBSCRIBER),n(this.dataChannelForKind(ne.RELIABLE,!0),ye.SUBSCRIBER),e}},{key:"clearReconnectTimeout",value:function(){this.reconnectTimeout&&pe.clearTimeout(this.reconnectTimeout)}},{key:"clearPendingReconnect",value:function(){this.clearReconnectTimeout(),this.reconnectAttempts=0}},{key:"registerOnLineListener",value:function(){we()&&window.addEventListener("online",this.handleBrowserOnLine)}},{key:"deregisterOnLineListener",value:function(){we()&&window.removeEventListener("online",this.handleBrowserOnLine)}}])}(He.EventEmitter),En=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t)}(lt(Error));function gl(r){return r!==void 0&&r>13}function kl(r,t){var i=r.participantIdentity?r.participantIdentity:t.participantIdentity;r.participantIdentity=i,t.participantIdentity=i;var e=r.destinationIdentities.length!==0?r.destinationIdentities:t.destinationIdentities;r.destinationIdentities=e,t.destinationIdentities=e}var Za=function(){function r(t,i){P(this,r),this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=i}return E(r,[{key:"updateToken",value:function(i){this.token=i}},{key:"isCloud",value:function(){return Dr(this.serverUrl)}},{key:"getServerUrl",value:function(){return this.serverUrl}},{key:"getNextBestRegionUrl",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n=this,a,s;return v().w(function(o){for(;;)switch(o.n){case 0:if(this.isCloud()){o.n=1;break}throw Error("region availability is only supported for LiveKit Cloud domains");case 1:if(!(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)){o.n=3;break}return o.n=2,this.fetchRegionSettings(i);case 2:this.regionSettings=o.v;case 3:if(a=this.regionSettings.regions.filter(function(u){return!n.attemptedRegions.find(function(c){return c.url===u.url})}),!(a.length>0)){o.n=4;break}return s=a[0],this.attemptedRegions.push(s),Z.debug("next region: ".concat(s.region)),o.a(2,s.url);case 4:return o.a(2,null);case 5:return o.a(2)}},e,this)}))}},{key:"resetAttempts",value:function(){this.attemptedRegions=[]}},{key:"fetchRegionSettings",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,fetch("".concat(yl(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:i});case 1:if(n=s.v,!n.ok){s.n=3;break}return s.n=2,n.json();case 2:return a=s.v,this.lastUpdateAt=Date.now(),s.a(2,a);case 3:throw new ie("Could not fetch region settings: ".concat(n.statusText),n.status===401?0:2,n.status);case 4:return s.a(2)}},e,this)}))}},{key:"setServerReportedRegions",value:function(i){this.regionSettings=i,this.lastUpdateAt=Date.now()}}])}();function yl(r){return"".concat(r.protocol.replace("ws","http"),"//").concat(r.host,"/settings")}var Se=function(r){function t(i,e,n){var a;return P(this,t),a=O(this,t,[e]),a.code=i,a.message=xa(e,t.MAX_MESSAGE_BYTES),a.data=n?xa(n,t.MAX_DATA_BYTES):void 0,a}return N(t,r),E(t,[{key:"toProto",value:function(){return new wt({code:this.code,message:this.message,data:this.data})}}],[{key:"fromProto",value:function(e){return new t(e.code,e.message,e.data)}},{key:"builtIn",value:function(e,n){return new t(t.ErrorCode[e],t.ErrorMessage[e],n)}}])}(lt(Error));Se.MAX_MESSAGE_BYTES=256;Se.MAX_DATA_BYTES=15360;Se.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403};Se.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server"};var $a=15360;function Ur(r){var t=new TextEncoder;return t.encode(r).length}function xa(r,t){if(Ur(r)<=t)return r;for(var i=0,e=r.length,n=new TextEncoder;i<e;){var a=Math.floor((i+e+1)/2);n.encode(r.slice(0,a)).length<=t?i=a:e=a-1}return r.slice(0,i)}var Po=function(r){function t(i,e,n,a,s){var o;return P(this,t),o=O(this,t,[i,n,s]),o.sid=e,o.receiver=a,o}return N(t,r),E(t,[{key:"setMuted",value:function(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?F.Muted:F.Unmuted,this))}},{key:"setMediaStream",value:function(e){var n=this;this.mediaStream=e;var a=function(o){o.track===n._mediaStreamTrack&&(e.removeEventListener("removetrack",a),n.receiver&&"playoutDelayHint"in n.receiver&&(n.receiver.playoutDelayHint=void 0),n.receiver=void 0,n._currentBitrate=0,n.emit(F.Ended,n))};e.addEventListener("removetrack",a)}},{key:"start",value:function(){this.startMonitor(),Q(t,"enable",this,3)([])}},{key:"stop",value:function(){this.stopMonitor(),Q(t,"disable",this,3)([])}},{key:"getRTCStatsReport",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:if(!((n=this.receiver)===null||n===void 0)&&n.getStats){s.n=1;break}return s.a(2);case 1:return s.n=2,this.receiver.getStats();case 2:return a=s.v,s.a(2,a)}},e,this)}))}},{key:"setPlayoutDelay",value:function(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}},{key:"getPlayoutDelay",value:function(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}},{key:"startMonitor",value:function(){var e=this;this.monitorInterval||(this.monitorInterval=setInterval(function(){return e.monitorReceiver()},na)),Pc()&&this.registerTimeSyncUpdate()}},{key:"registerTimeSyncUpdate",value:function(){var e=this,n=function(){var s;e.timeSyncHandle=requestAnimationFrame(function(){return n()});var o=(s=e.receiver)===null||s===void 0?void 0:s.getSynchronizationSources()[0];if(o){var u=o.timestamp,c=o.rtpTimestamp;c&&e.rtpTimestamp!==c&&(e.emit(F.TimeSyncUpdate,{timestamp:u,rtpTimestamp:c}),e.rtpTimestamp=c)}};n()}}])}(A),ot=function(r){function t(i,e,n,a,s,o){var u;return P(this,t),u=O(this,t,[i,e,A.Kind.Audio,n,o]),u.monitorReceiver=function(){return b(u,void 0,void 0,v().m(function c(){var l;return v().w(function(d){for(;;)switch(d.n){case 0:if(this.receiver){d.n=1;break}return this._currentBitrate=0,d.a(2);case 1:return d.n=2,this.getReceiverStats();case 2:l=d.v,l&&this.prevStats&&this.receiver&&(this._currentBitrate=Yi(l,this.prevStats)),this.prevStats=l;case 3:return d.a(2)}},c,this)}))},u.audioContext=a,u.webAudioPluginNodes=[],s&&(u.sinkId=s.deviceId),u}return N(t,r),E(t,[{key:"setVolume",value:function(e){var n,a=z(this.attachedElements),s;try{for(a.s();!(s=a.n()).done;){var o=s.value;this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):o.volume=e}}catch(u){a.e(u)}finally{a.f()}en()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}},{key:"getVolume",value:function(){if(this.elementVolume)return this.elementVolume;if(en())return 1;var e=0;return this.attachedElements.forEach(function(n){n.volume>e&&(e=n.volume)}),e}},{key:"setSinkId",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return this.sinkId=e,a.n=1,Promise.all(this.attachedElements.map(function(s){if(Nr(s))return s.setSinkId(e)}));case 1:return a.a(2)}},n,this)}))}},{key:"attach",value:function(e){var n=this.attachedElements.length===0;return e?Q(t,"attach",this,3)([e]):e=Q(t,"attach",this,3)([]),this.sinkId&&Nr(e)&&e.setSinkId(this.sinkId),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}},{key:"detach",value:function(e){var n;return e?(n=Q(t,"detach",this,3)([e]),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=Q(t,"detach",this,3)([]),this.disconnectWebAudio()),n}},{key:"setAudioContext",value:function(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}},{key:"setWebAudioPlugins",value:function(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}},{key:"connectWebAudio",value:function(e,n){var a=this;this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);var s=this.sourceNode;this.webAudioPluginNodes.forEach(function(o){s.connect(o),s=o}),this.gainNode=e.createGain(),s.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(function(){e.state!=="running"&&a.emit(F.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(function(o){a.emit(F.AudioPlaybackFailed,o)})}},{key:"disconnectWebAudio",value:function(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}},{key:"getReceiverStats",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:if(!(!this.receiver||!this.receiver.getStats)){s.n=1;break}return s.a(2);case 1:return s.n=2,this.receiver.getStats();case 2:return n=s.v,n.forEach(function(o){o.type==="inbound-rtp"&&(a={type:"audio",streamId:o.id,timestamp:o.timestamp,jitter:o.jitter,bytesReceived:o.bytesReceived,concealedSamples:o.concealedSamples,concealmentEvents:o.concealmentEvents,silentConcealedSamples:o.silentConcealedSamples,silentConcealmentEvents:o.silentConcealmentEvents,totalAudioEnergy:o.totalAudioEnergy,totalSamplesDuration:o.totalSamplesDuration})}),s.a(2,a)}},e,this)}))}}])}(Po),ur=100,ut=function(r){function t(i,e,n,a,s){var o;return P(this,t),o=O(this,t,[i,e,A.Kind.Video,n,s]),o.elementInfos=[],o.monitorReceiver=function(){return b(o,void 0,void 0,v().m(function u(){var c;return v().w(function(l){for(;;)switch(l.n){case 0:if(this.receiver){l.n=1;break}return this._currentBitrate=0,l.a(2);case 1:return l.n=2,this.getReceiverStats();case 2:c=l.v,c&&this.prevStats&&this.receiver&&(this._currentBitrate=Yi(c,this.prevStats)),this.prevStats=c;case 3:return l.a(2)}},u,this)}))},o.debouncedHandleResize=Qr(function(){o.updateDimensions()},ur),o.adaptiveStreamSettings=a,o}return N(t,r),E(t,[{key:"isAdaptiveStream",get:function(){return this.adaptiveStreamSettings!==void 0}},{key:"mediaStreamTrack",get:function(){return this._mediaStreamTrack}},{key:"setMuted",value:function(e){var n=this;Q(t,"setMuted",this,3)([e]),this.attachedElements.forEach(function(a){e?Dn(n._mediaStreamTrack,a):In(n._mediaStreamTrack,a)})}},{key:"attach",value:function(e){if(e?Q(t,"attach",this,3)([e]):e=Q(t,"attach",this,3)([]),this.adaptiveStreamSettings&&this.elementInfos.find(function(a){return a.element===e})===void 0){var n=new bl(e);this.observeElementInfo(n)}return e}},{key:"observeElementInfo",value:function(e){var n=this;this.adaptiveStreamSettings&&this.elementInfos.find(function(a){return a===e})===void 0?(e.handleResize=function(){n.debouncedHandleResize()},e.handleVisibilityChanged=function(){n.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}},{key:"stopObservingElementInfo",value:function(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}var n=this.elementInfos.filter(function(u){return u===e}),a=z(n),s;try{for(a.s();!(s=a.n()).done;){var o=s.value;o.stopObserving()}}catch(u){a.e(u)}finally{a.f()}this.elementInfos=this.elementInfos.filter(function(u){return u!==e}),this.updateVisibility(),this.debouncedHandleResize()}},{key:"detach",value:function(e){var n=[];if(e)return this.stopObservingElement(e),Q(t,"detach",this,3)([e]);n=Q(t,"detach",this,3)([]);var a=z(n),s;try{for(a.s();!(s=a.n()).done;){var o=s.value;this.stopObservingElement(o)}}catch(u){a.e(u)}finally{a.f()}return n}},{key:"getDecoderImplementation",value:function(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}},{key:"getReceiverStats",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,o;return v().w(function(u){for(;;)switch(u.n){case 0:if(!(!this.receiver||!this.receiver.getStats)){u.n=1;break}return u.a(2);case 1:return u.n=2,this.receiver.getStats();case 2:return n=u.v,s="",o=new Map,n.forEach(function(c){c.type==="inbound-rtp"?(s=c.codecId,a={type:"video",streamId:c.id,framesDecoded:c.framesDecoded,framesDropped:c.framesDropped,framesReceived:c.framesReceived,packetsReceived:c.packetsReceived,packetsLost:c.packetsLost,frameWidth:c.frameWidth,frameHeight:c.frameHeight,pliCount:c.pliCount,firCount:c.firCount,nackCount:c.nackCount,jitter:c.jitter,timestamp:c.timestamp,bytesReceived:c.bytesReceived,decoderImplementation:c.decoderImplementation}):c.type==="codec"&&o.set(c.id,c)}),a&&s!==""&&o.get(s)&&(a.mimeType=o.get(s).mimeType),u.a(2,a)}},e,this)}))}},{key:"stopObservingElement",value:function(e){var n=this.elementInfos.filter(function(u){return u.element===e}),a=z(n),s;try{for(a.s();!(s=a.n()).done;){var o=s.value;this.stopObservingElementInfo(o)}}catch(u){a.e(u)}finally{a.f()}}},{key:"handleAppVisibilityChanged",value:function(){var e=this,n=Object.create(null,{handleAppVisibilityChanged:{get:function(){return Q(t,"handleAppVisibilityChanged",e,1)}}});return b(this,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,n.handleAppVisibilityChanged.call(this);case 1:if(this.isAdaptiveStream){s.n=2;break}return s.a(2);case 2:this.updateVisibility();case 3:return s.a(2)}},a,this)}))}},{key:"updateVisibility",value:function(){var e=this,n,a,s=this.elementInfos.reduce(function(l,d){return Math.max(l,d.visibilityChangedAt||0)},0),o=!((a=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&a!==void 0)||a?this.isInBackground:!1,u=this.elementInfos.some(function(l){return l.pictureInPicture}),c=this.elementInfos.some(function(l){return l.visible})&&!o||u;if(this.lastVisible!==c){if(!c&&Date.now()-s<ur){pe.setTimeout(function(){e.updateVisibility()},ur);return}this.lastVisible=c,this.emit(F.VisibilityChanged,c,this)}}},{key:"updateDimensions",value:function(){var e,n,a=0,s=0,o=this.getPixelDensity(),u=z(this.elementInfos),c;try{for(u.s();!(c=u.n()).done;){var l=c.value,d=l.width()*o,f=l.height()*o;d+f>a+s&&(a=d,s=f)}}catch(h){u.e(h)}finally{u.f()}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===a&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===s||(this.lastDimensions={width:a,height:s},this.emit(F.VideoDimensionsChanged,this.lastDimensions,this))}},{key:"getPixelDensity",value:function(){var e,n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;if(n==="screen")return Ma();if(!n){var a=Ma();return a>2?2:1}return n}}])}(Po),bl=function(){function r(t,i){var e=this;P(this,r),this.onVisibilityChanged=function(n){var a,s=n.target,o=n.isIntersecting;s===e.element&&(e.isIntersecting=o,e.isPiP=et(e.element),e.visibilityChangedAt=Date.now(),(a=e.handleVisibilityChanged)===null||a===void 0||a.call(e))},this.onEnterPiP=function(){var n,a,s;(a=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||a===void 0||a.addEventListener("pagehide",e.onLeavePiP),e.isPiP=et(e.element),(s=e.handleVisibilityChanged)===null||s===void 0||s.call(e)},this.onLeavePiP=function(){var n;e.isPiP=et(e.element),(n=e.handleVisibilityChanged)===null||n===void 0||n.call(e)},this.element=t,this.isIntersecting=i??Jr(t),this.isPiP=we()&&et(t),this.visibilityChangedAt=0}return E(r,[{key:"visible",get:function(){return this.isPiP||this.isIntersecting}},{key:"pictureInPicture",get:function(){return this.isPiP}},{key:"width",value:function(){return this.element.clientWidth}},{key:"height",value:function(){return this.element.clientHeight}},{key:"observe",value:function(){var i=this,e,n,a;this.isIntersecting=Jr(this.element),this.isPiP=et(this.element),this.element.handleResize=function(){var s;(s=i.handleResize)===null||s===void 0||s.call(i)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Ua().observe(this.element),La().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(a=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||a===void 0||a.addEventListener("pagehide",this.onLeavePiP)}},{key:"stopObserving",value:function(){var i,e,n,a,s;(i=Ua())===null||i===void 0||i.unobserve(this.element),(e=La())===null||e===void 0||e.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(n=window.documentPictureInPicture)===null||n===void 0||n.removeEventListener("enter",this.onEnterPiP),(s=(a=window.documentPictureInPicture)===null||a===void 0?void 0:a.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}])}();function et(r){var t,i;return document.pictureInPictureElement===r?!0:!((t=window.documentPictureInPicture)===null||t===void 0)&&t.window?Jr(r,(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window):!1}function Jr(r,t){for(var i=t||window,e=r.offsetTop,n=r.offsetLeft,a=r.offsetWidth,s=r.offsetHeight,o=r,u=o.hidden,c=getComputedStyle(r),l=c.display;r.offsetParent;)r=r.offsetParent,e+=r.offsetTop,n+=r.offsetLeft;return e<i.pageYOffset+i.innerHeight&&n<i.pageXOffset+i.innerWidth&&e+s>i.pageYOffset&&n+a>i.pageXOffset&&!u&&l!=="none"}var Ke=function(r){function t(i,e,n,a){var s;P(this,t);var o;return s=O(this,t),s.metadataMuted=!1,s.encryption=fe.NONE,s.log=Z,s.handleMuted=function(){s.emit(F.Muted)},s.handleUnmuted=function(){s.emit(F.Unmuted)},s.log=xe((o=a==null?void 0:a.loggerName)!==null&&o!==void 0?o:_e.Publication),s.loggerContextCb=s.loggerContextCb,s.setMaxListeners(100),s.kind=i,s.trackSid=e,s.trackName=n,s.source=A.Source.Unknown,s}return N(t,r),E(t,[{key:"setTrack",value:function(e){this.track&&(this.track.off(F.Muted,this.handleMuted),this.track.off(F.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(F.Muted,this.handleMuted),e.on(F.Unmuted,this.handleUnmuted))}},{key:"logContext",get:function(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),re(this))}},{key:"isMuted",get:function(){return this.metadataMuted}},{key:"isEnabled",get:function(){return!0}},{key:"isSubscribed",get:function(){return this.track!==void 0}},{key:"isEncrypted",get:function(){return this.encryption!==fe.NONE}},{key:"audioTrack",get:function(){if(this.track instanceof ve||this.track instanceof ot)return this.track}},{key:"videoTrack",get:function(){if(this.track instanceof me||this.track instanceof ut)return this.track}},{key:"updateInfo",value:function(e){this.trackSid=e.sid,this.trackName=e.name,this.source=A.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===A.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}])}(He.EventEmitter);(function(r){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(r.SubscriptionStatus||(r.SubscriptionStatus={})),function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"}(r.PermissionStatus||(r.PermissionStatus={}))})(Ke||(Ke={}));var ai=function(r){function t(i,e,n,a){var s;return P(this,t),s=O(this,t,[i,e.sid,e.name,a]),s.track=void 0,s.handleTrackEnded=function(){s.emit(F.Ended)},s.updateInfo(e),s.setTrack(n),s}return N(t,r),E(t,[{key:"isUpstreamPaused",get:function(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}},{key:"setTrack",value:function(e){this.track&&this.track.off(F.Ended,this.handleTrackEnded),Q(t,"setTrack",this,3)([e]),e&&e.on(F.Ended,this.handleTrackEnded)}},{key:"isMuted",get:function(){return this.track?this.track.isMuted:Q(t,"isMuted",this,1)}},{key:"audioTrack",get:function(){return Q(t,"audioTrack",this,1)}},{key:"videoTrack",get:function(){return Q(t,"videoTrack",this,1)}},{key:"mute",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.a(2,(n=this.track)===null||n===void 0?void 0:n.mute())}},e,this)}))}},{key:"unmute",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.a(2,(n=this.track)===null||n===void 0?void 0:n.unmute())}},e,this)}))}},{key:"pauseUpstream",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,(n=this.track)===null||n===void 0?void 0:n.pauseUpstream();case 1:return a.a(2)}},e,this)}))}},{key:"resumeUpstream",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,(n=this.track)===null||n===void 0?void 0:n.resumeUpstream();case 1:return a.a(2)}},e,this)}))}},{key:"getTrackFeatures",value:function(){var e;if(this.track instanceof ve){var n=this.track.getSourceTrackSettings(),a=new Set;return n.autoGainControl&&a.add(Re.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&a.add(Re.TF_ECHO_CANCELLATION),n.noiseSuppression&&a.add(Re.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&a.add(Re.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||a.add(Re.TF_NO_DTX),this.track.enhancedNoiseCancellation&&a.add(Re.TF_ENHANCED_NOISE_CANCELLATION),Array.from(a.values())}else return[]}}])}(Ke),rn;(function(r){r.Excellent="excellent",r.Good="good",r.Poor="poor",r.Lost="lost",r.Unknown="unknown"})(rn||(rn={}));function Tl(r){switch(r){case Ze.EXCELLENT:return rn.Excellent;case Ze.GOOD:return rn.Good;case Ze.POOR:return rn.Poor;case Ze.LOST:return rn.Lost;default:return rn.Unknown}}var Eo=function(r){function t(i,e,n,a,s,o){var u,c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:cn.STANDARD;P(this,t);var l;return u=O(this,t),u.audioLevel=0,u.isSpeaking=!1,u._connectionQuality=rn.Unknown,u.log=Z,u.log=xe((l=o==null?void 0:o.loggerName)!==null&&l!==void 0?l:_e.Participant),u.loggerOptions=o,u.setMaxListeners(100),u.sid=i,u.identity=e,u.name=n,u.metadata=a,u.audioTrackPublications=new Map,u.videoTrackPublications=new Map,u.trackPublications=new Map,u._kind=c,u._attributes=s??{},u}return N(t,r),E(t,[{key:"logContext",get:function(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}},{key:"isEncrypted",get:function(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(function(e){return e.isEncrypted})}},{key:"isAgent",get:function(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===cn.AGENT}},{key:"kind",get:function(){return this._kind}},{key:"attributes",get:function(){return Object.freeze(Object.assign({},this._attributes))}},{key:"getTrackPublications",value:function(){return Array.from(this.trackPublications.values())}},{key:"getTrackPublication",value:function(e){var n=z(this.trackPublications),a;try{for(n.s();!(a=n.n()).done;){var s=x(a.value,2),o=s[1];if(o.source===e)return o}}catch(u){n.e(u)}finally{n.f()}}},{key:"getTrackPublicationByName",value:function(e){var n=z(this.trackPublications),a;try{for(n.s();!(a=n.n()).done;){var s=x(a.value,2),o=s[1];if(o.trackName===e)return o}}catch(u){n.e(u)}finally{n.f()}}},{key:"connectionQuality",get:function(){return this._connectionQuality}},{key:"isCameraEnabled",get:function(){var e,n=this.getTrackPublication(A.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}},{key:"isMicrophoneEnabled",get:function(){var e,n=this.getTrackPublication(A.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}},{key:"isScreenShareEnabled",get:function(){var e=this.getTrackPublication(A.Source.ScreenShare);return!!e}},{key:"isLocal",get:function(){return!1}},{key:"joinedAt",get:function(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}},{key:"updateInfo",value:function(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}},{key:"_setMetadata",value:function(e){var n=this.metadata!==e,a=this.metadata;this.metadata=e,n&&this.emit(q.ParticipantMetadataChanged,a)}},{key:"_setName",value:function(e){var n=this.name!==e;this.name=e,n&&this.emit(q.ParticipantNameChanged,e)}},{key:"_setAttributes",value:function(e){var n=Ec(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(q.AttributesChanged,n)}},{key:"setPermissions",value:function(e){var n=this,a,s,o,u,c,l,d=this.permissions,f=e.canPublish!==((a=this.permissions)===null||a===void 0?void 0:a.canPublish)||e.canSubscribe!==((s=this.permissions)===null||s===void 0?void 0:s.canSubscribe)||e.canPublishData!==((o=this.permissions)===null||o===void 0?void 0:o.canPublishData)||e.hidden!==((u=this.permissions)===null||u===void 0?void 0:u.hidden)||e.recorder!==((c=this.permissions)===null||c===void 0?void 0:c.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some(function(h,p){var g;return h!==((g=n.permissions)===null||g===void 0?void 0:g.canPublishSources[p])})||e.canSubscribeMetrics!==((l=this.permissions)===null||l===void 0?void 0:l.canSubscribeMetrics);return this.permissions=e,f&&this.emit(q.ParticipantPermissionsChanged,d,e),f}},{key:"setIsSpeaking",value:function(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(q.IsSpeakingChanged,e))}},{key:"setConnectionQuality",value:function(e){var n=this;this._lastProtoQuality=e,this._qualityChangeTimeout&&clearTimeout(this._qualityChangeTimeout),this._qualityChangeTimeout=setTimeout(function(){var a=Tl(n._lastProtoQuality),s=n._connectionQuality;s!==a&&(n._connectionQuality=a,console.log("Connection quality changed from ".concat(s," to ").concat(a)),n.emit(q.ConnectionQualityChanged,a)),n._qualityChangeTimeout=void 0},15e3)}},{key:"setAudioContext",value:function(e){this.audioContext=e,this.audioTrackPublications.forEach(function(n){return(n.track instanceof ot||n.track instanceof ve)&&n.track.setAudioContext(e)})}},{key:"addTrackPublication",value:function(e){var n=this;e.on(F.Muted,function(){n.emit(q.TrackMuted,e)}),e.on(F.Unmuted,function(){n.emit(q.TrackUnmuted,e)});var a=e;switch(a.track&&(a.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case A.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case A.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}])}(He.EventEmitter);function Sl(r){var t,i,e;if(!r.participantSid&&!r.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Mt({participantIdentity:(t=r.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(i=r.participantSid)!==null&&i!==void 0?i:"",allTracks:(e=r.allowAll)!==null&&e!==void 0?e:!1,trackSids:r.allowedTrackSids||[]})}var es=function(r){function t(i,e,n,a){var s;return P(this,t),s=O(this,t,[i,e,void 0,void 0,void 0,{loggerName:a.loggerName,loggerContextCb:function(){return s.engine.logContext}}]),s.pendingPublishing=new Set,s.pendingPublishPromises=new Map,s.participantTrackPermissions=[],s.allParticipantsAllowedToSubscribe=!0,s.encryptionType=fe.NONE,s.audioMuted=!1,s.videoMuted=!1,s.enabledPublishVideoCodecs=[],s.rpcHandlers=new Map,s.pendingAcks=new Map,s.pendingResponses=new Map,s.handleReconnecting=function(){s.reconnectFuture||(s.reconnectFuture=new vo)},s.handleReconnected=function(){var o,u;(u=(o=s.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||u===void 0||u.call(o),s.reconnectFuture=void 0,s.updateTrackSubscriptionPermissions()},s.handleDisconnected=function(){var o,u;s.reconnectFuture&&(s.reconnectFuture.promise.catch(function(c){return s.log.warn(c.message,s.logContext)}),(u=(o=s.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||u===void 0||u.call(o,"Got disconnected during reconnection attempt"),s.reconnectFuture=void 0)},s.handleSignalRequestResponse=function(o){var u=o.requestId,c=o.reason,l=o.message,d=s.pendingSignalRequests.get(u);d&&(c!==_n.OK&&d.reject(new Oa(l,c)),s.pendingSignalRequests.delete(u))},s.handleDataPacket=function(o){switch(o.value.case){case"rpcRequest":var u=o.value.value;s.handleIncomingRpcRequest(o.participantIdentity,u.id,u.method,u.payload,u.responseTimeoutMs);break;case"rpcResponse":var c=o.value.value,l=null,d=null;c.value.case==="payload"?l=c.value.value:c.value.case==="error"&&(d=Se.fromProto(c.value.value)),s.handleIncomingRpcResponse(c.requestId,l,d);break;case"rpcAck":var f=o.value.value;s.handleIncomingRpcAck(f.requestId);break}},s.updateTrackSubscriptionPermissions=function(){s.log.debug("updating track subscription permissions",Object.assign(Object.assign({},s.logContext),{allParticipantsAllowed:s.allParticipantsAllowedToSubscribe,participantTrackPermissions:s.participantTrackPermissions})),s.engine.client.sendUpdateSubscriptionPermissions(s.allParticipantsAllowedToSubscribe,s.participantTrackPermissions.map(function(o){return Sl(o)}))},s.onTrackUnmuted=function(o){s.onTrackMuted(o,o.isUpstreamPaused)},s.onTrackMuted=function(o,u){if(u===void 0&&(u=!0),!o.sid){s.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},s.logContext),re(o)));return}o.kind==A.Kind.Audio?u?sessionStorage.setItem("isAudioMuted","true"):sessionStorage.setItem("isAudioMuted","false"):u?sessionStorage.setItem("isVideoMuted","true"):sessionStorage.setItem("isVideoMuted","false"),s.engine.updateMuteStatus(o.sid,u)},s.onTrackUpstreamPaused=function(o){s.log.debug("upstream paused",Object.assign(Object.assign({},s.logContext),re(o))),s.onTrackMuted(o,!0)},s.onTrackUpstreamResumed=function(o){s.log.debug("upstream resumed",Object.assign(Object.assign({},s.logContext),re(o))),s.onTrackMuted(o,o.isMuted)},s.onTrackFeatureUpdate=function(o){var u=s.audioTrackPublications.get(o.sid);if(!u){s.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),s.logContext);return}s.engine.client.sendUpdateLocalAudioTrack(u.trackSid,u.getTrackFeatures())},s.handleSubscribedQualityUpdate=function(o){return b(s,void 0,void 0,v().m(function u(){var c,l,d,f,h,p,g,k,y,T,S,w,C;return v().w(function(I){for(;;)switch(I.n){case 0:if(!((h=this.roomOptions)===null||h===void 0)&&h.dynacast){I.n=1;break}return I.a(2);case 1:if(g=this.videoTrackPublications.get(o.trackSid),g){I.n=2;break}return this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid})),I.a(2);case 2:if(!(o.subscribedCodecs.length>0)){I.n=17;break}if(g.videoTrack){I.n=3;break}return I.a(2);case 3:return I.n=4,g.videoTrack.setPublishingCodecs(o.subscribedCodecs);case 4:k=I.v,I.p=5,y=!0,T=Rn(k);case 6:return I.n=7,T.next();case 7:if(S=I.v,c=S.done,c){I.n=9;break}if(f=S.value,y=!1,w=f,!yc(w)){I.n=8;break}return this.log.debug("publish ".concat(w," for ").concat(g.videoTrack.sid),Object.assign(Object.assign({},this.logContext),re(g))),I.n=8,this.publishAdditionalCodecForTrack(g.videoTrack,w,g.options);case 8:y=!0,I.n=6;break;case 9:I.n=11;break;case 10:I.p=10,C=I.v,l={error:C};case 11:if(I.p=11,I.p=12,!(!y&&!c&&(d=T.return))){I.n=13;break}return I.n=13,d.call(T);case 13:if(I.p=13,!l){I.n=14;break}throw l.error;case 14:return I.f(13);case 15:return I.f(11);case 16:I.n=18;break;case 17:if(!(o.subscribedQualities.length>0)){I.n=18;break}return I.n=18,(p=g.videoTrack)===null||p===void 0?void 0:p.setPublishingLayers(o.subscribedQualities);case 18:return I.a(2)}},u,this,[[12,,13,15],[5,10,11,16]])}))},s.handleLocalTrackUnpublished=function(o){var u=s.trackPublications.get(o.trackSid);if(!u){s.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},s.logContext),{trackSid:o.trackSid}));return}s.unpublishTrack(u.track)},s.handleTrackEnded=function(o){return b(s,void 0,void 0,v().m(function u(){var c;return v().w(function(l){for(;;)switch(l.n){case 0:if(!(o.source===A.Source.ScreenShare||o.source===A.Source.ScreenShareAudio)){l.n=1;break}this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),re(o))),this.unpublishTrack(o),l.n=12;break;case 1:if(!o.isUserProvided){l.n=3;break}return l.n=2,o.mute();case 2:l.n=12;break;case 3:if(!(o instanceof ve||o instanceof me)){l.n=12;break}if(l.p=4,!we()){l.n=9;break}return l.p=5,l.n=6,navigator==null?void 0:navigator.permissions.query({name:o.source===A.Source.Camera?"camera":"microphone"});case 6:if(c=l.v,!(c&&c.state==="denied")){l.n=7;break}throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),re(o))),c.onchange=function(){c.state!=="denied"&&(o.isMuted||o.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied");case 7:l.n=9;break;case 8:l.p=8,l.v;case 9:if(o.isMuted){l.n=10;break}return this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),re(o))),l.n=10,o.restartTrack();case 10:l.n=12;break;case 11:return l.p=11,l.v,this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),re(o))),l.n=12,o.mute();case 12:return l.a(2)}},u,this,[[5,8],[4,11]])}))},s.audioTrackPublications=new Map,s.videoTrackPublications=new Map,s.trackPublications=new Map,s.engine=n,s.roomOptions=a,s.setupEngine(n),s.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),s.pendingSignalRequests=new Map,s}return N(t,r),E(t,[{key:"lastCameraError",get:function(){return this.cameraError}},{key:"lastMicrophoneError",get:function(){return this.microphoneError}},{key:"isE2EEEnabled",get:function(){return this.encryptionType!==fe.NONE}},{key:"getTrackPublication",value:function(e){var n=Q(t,"getTrackPublication",this,3)([e]);if(n)return n}},{key:"getTrackPublicationByName",value:function(e){var n=Q(t,"getTrackPublicationByName",this,3)([e]);if(n)return n}},{key:"setupEngine",value:function(e){var n=this;this.engine=e,this.engine.on(_.RemoteMute,function(a,s){var o=n.trackPublications.get(a);!o||!o.track||(s?(o.kind=="audio"?(n.audioMuted=!0,sessionStorage.setItem("isAudioMuted","true")):(n.videoMuted=!0,sessionStorage.setItem("isVideoMuted","true")),o.mute()):(o.kind=="audio"?sessionStorage.setItem("isAudioMuted","false"):sessionStorage.setItem("isVideoMuted","false"),o.unmute()))}),this.engine.on(_.Connected,this.handleReconnected).on(_.SignalRestarted,this.handleReconnected).on(_.SignalResumed,this.handleReconnected).on(_.Restarting,this.handleReconnecting).on(_.Resuming,this.handleReconnecting).on(_.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(_.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(_.Disconnected,this.handleDisconnected).on(_.SignalRequestResponse,this.handleSignalRequestResponse).on(_.DataPacketReceived,this.handleDataPacket)}},{key:"setMetadata",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,this.requestMetadataUpdate({metadata:e});case 1:return a.a(2)}},n,this)}))}},{key:"setName",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,this.requestMetadataUpdate({name:e});case 1:return a.a(2)}},n,this)}))}},{key:"setAttributes",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,this.requestMetadataUpdate({attributes:e});case 1:return a.a(2)}},n,this)}))}},{key:"requestMetadataUpdate",value:function(e){return b(this,arguments,void 0,function(n){var a=this,s=n.metadata,o=n.name,u=n.attributes;return v().m(function c(){return v().w(function(l){for(;;)switch(l.n){case 0:return l.a(2,new Promise(function(d,f){return b(a,void 0,void 0,v().m(function h(){var p=this,g,k,y,T,S,w;return v().w(function(C){for(;;)switch(C.n){case 0:return C.p=0,y=!1,C.n=1,this.engine.client.sendUpdateLocalMetadata((g=s??this.metadata)!==null&&g!==void 0?g:"",(k=o??this.name)!==null&&k!==void 0?k:"",u);case 1:T=C.v,S=performance.now(),this.pendingSignalRequests.set(T,{resolve:d,reject:function(R){f(R),y=!0},values:{name:o,metadata:s,attributes:u}});case 2:if(!(performance.now()-S<5e3&&!y)){C.n=5;break}if(!((!o||this.name===o)&&(!s||this.metadata===s)&&(!u||Object.entries(u).every(function(I){var R=x(I,2),L=R[0],M=R[1];return p.attributes[L]===M||M===""&&!p.attributes[L]})))){C.n=3;break}return this.pendingSignalRequests.delete(T),d(),C.a(2);case 3:return C.n=4,Be(50);case 4:C.n=2;break;case 5:f(new Oa("Request to update local metadata timed out","TimeoutError")),C.n=7;break;case 6:C.p=6,w=C.v,w instanceof Error&&f(w);case 7:return C.a(2)}},h,this,[[0,6]])}))}))}},c)})()})}},{key:"setCameraEnabled",value:function(e,n,a){return this.setTrackEnabled(A.Source.Camera,e,n,a)}},{key:"setMicrophoneEnabled",value:function(e,n,a){return this.setTrackEnabled(A.Source.Microphone,e,n,a)}},{key:"setScreenShareEnabled",value:function(e,n,a){return this.setTrackEnabled(A.Source.ScreenShare,e,n,a)}},{key:"setPermissions",value:function(e){var n=this.permissions,a=Q(t,"setPermissions",this,3)([e]);return a&&n&&this.emit(q.ParticipantPermissionsChanged,n),a}},{key:"setE2EEEnabled",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return this.encryptionType=e?fe.GCM:fe.NONE,a.n=1,this.republishAllTracks(void 0,!1);case 1:return a.a(2)}},n,this)}))}},{key:"setTrackEnabled",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function o(){var u,c,l,d,f,h,p,g,k,y,T,S,w,C,I;return v().w(function(R){for(;;)switch(R.n){case 0:if(this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),!this.republishPromise){R.n=1;break}return R.n=1,this.republishPromise;case 1:if(l=this.getTrackPublication(e),!n){R.n=21;break}if(!(l&&l.track)){R.n=2;break}this.onTrackMuted(l.track,!1),R.n=20;break;case 2:if(!this.pendingPublishing.has(e)){R.n=5;break}return R.n=3,this.waitForPendingPublicationOfSource(e);case 3:return f=R.v,f||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),R.n=4,f==null?void 0:f.unmute();case 4:return R.a(2,f);case 5:this.pendingPublishing.add(e),R.p=6,w=e,R.n=w===A.Source.Camera?7:w===A.Source.Microphone?9:w===A.Source.ScreenShare?11:13;break;case 7:return R.n=8,this.createTracks({video:(u=a)!==null&&u!==void 0?u:!0});case 8:return d=R.v,R.a(3,14);case 9:return R.n=10,this.createTracks({audio:(c=a)!==null&&c!==void 0?c:!0});case 10:return d=R.v,R.a(3,14);case 11:return R.n=12,this.createScreenTracks(Object.assign({},a));case 12:return d=R.v,R.a(3,14);case 13:throw new Xe(e);case 14:R.n=16;break;case 15:throw R.p=15,C=R.v,d==null||d.forEach(function(L){L.stop()}),C instanceof Error&&this.emit(q.MediaDevicesError,C),this.pendingPublishing.delete(e),C;case 16:R.p=16,h=[],p=z(d);try{for(p.s();!(g=p.n()).done;)k=g.value,this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),re(k))),h.push(this.publishTrack(k,s))}catch(L){p.e(L)}finally{p.f()}return R.n=17,Promise.all(h);case 17:y=R.v,T=x(y,1),l=T[0],R.n=19;break;case 18:throw R.p=18,I=R.v,d==null||d.forEach(function(L){L.stop()}),I;case 19:return R.p=19,this.pendingPublishing.delete(e),R.f(19);case 20:R.n=26;break;case 21:if(!(!(l!=null&&l.track)&&this.pendingPublishing.has(e))){R.n=23;break}return R.n=22,this.waitForPendingPublicationOfSource(e);case 22:l=R.v,l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}));case 23:if(!(l&&l.track)){R.n=26;break}if(e!==A.Source.ScreenShare){R.n=25;break}return R.n=24,this.unpublishTrack(l.track);case 24:l=R.v,S=this.getTrackPublication(A.Source.ScreenShareAudio),S&&S.track&&this.unpublishTrack(S.track),R.n=26;break;case 25:l.source=="microphone"&&(this.audioMuted=!0),l.source=="camera"&&(this.videoMuted=!0),this.onTrackMuted(l.track,!0);case 26:return R.a(2,l)}},o,this,[[16,18,19,20],[6,15]])}))}},{key:"enableCameraAndMicrophone",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this,a;return v().w(function(s){for(;;)switch(s.n){case 0:if(!(this.pendingPublishing.has(A.Source.Camera)||this.pendingPublishing.has(A.Source.Microphone))){s.n=1;break}return s.a(2);case 1:return this.pendingPublishing.add(A.Source.Camera),this.pendingPublishing.add(A.Source.Microphone),s.p=2,s.n=3,this.createTracks({audio:!0,video:!0});case 3:return a=s.v,s.n=4,Promise.all(a.map(function(o){return n.publishTrack(o)}));case 4:return s.p=4,this.pendingPublishing.delete(A.Source.Camera),this.pendingPublishing.delete(A.Source.Microphone),s.f(4);case 5:return s.a(2)}},e,this,[[2,,4,5]])}))}},{key:"createTracks",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,o,u,c,l,d,f,h,p,g;return v().w(function(k){for(;;)switch(k.n){case 0:return e??(e={}),u=$r(e),c=u.audioProcessor,l=u.videoProcessor,d=u.optionsWithoutProcessor,f=lo(d,(s=this.roomOptions)===null||s===void 0?void 0:s.audioCaptureDefaults,(o=this.roomOptions)===null||o===void 0?void 0:o.videoCaptureDefaults),h=Ki(f),k.p=1,k.n=2,navigator.mediaDevices.getUserMedia(h);case 2:p=k.v,k.n=4;break;case 3:throw k.p=3,g=k.v,g instanceof Error&&(h.audio&&(this.microphoneError=g),h.video&&(this.cameraError=g)),g;case 4:return h.audio&&(this.microphoneError=void 0,this.emit(q.AudioStreamAcquired)),h.video&&(this.cameraError=void 0),k.a(2,Promise.all(p.getTracks().map(function(y){return b(a,void 0,void 0,v().m(function T(){var S=this,w,C,I,R;return v().w(function(L){for(;;)switch(L.n){case 0:if(w=y.kind==="audio",w?f.audio:f.video,I=w?h.audio:h.video,typeof I!="boolean"&&(C=I),R=To(y,C,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return S.logContext}}),R.kind===A.Kind.Video?R.source=A.Source.Camera:R.kind===A.Kind.Audio&&(R.source=A.Source.Microphone,R.setAudioContext(this.audioContext)),R.mediaStream=p,!(R instanceof ve&&c)){L.n=2;break}return L.n=1,R.setProcessor(c);case 1:L.n=3;break;case 2:if(!(R instanceof me&&l)){L.n=3;break}return L.n=3,R.setProcessor(l);case 3:return L.a(2,R)}},T,this)}))})))}},n,this,[[1,3]])}))}},{key:"createScreenTracks",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,o,u,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia!==void 0){f.n=1;break}throw new Yr("getDisplayMedia not supported");case 1:return e.resolution===void 0&&!Ac()&&(e.resolution=Xr.h1080fps30.resolution),s=Cc(e),f.n=2,navigator.mediaDevices.getDisplayMedia(s);case 2:if(o=f.v,u=o.getVideoTracks(),u.length!==0){f.n=3;break}throw new Xe("no video track found");case 3:return c=new me(u[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return a.logContext}}),c.source=A.Source.ScreenShare,e.contentHint&&(c.mediaStreamTrack.contentHint=e.contentHint),l=[c],o.getAudioTracks().length>0&&(this.emit(q.AudioStreamAcquired),d=new ve(o.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return a.logContext}}),d.source=A.Source.ScreenShareAudio,l.push(d)),f.a(2,l)}},n,this)}))}},{key:"publishTrack",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:return s.a(2,this.publishOrRepublishTrack(e,n))}},a,this)}))}},{key:"publishOrRepublishTrack",value:function(e,n){return b(this,arguments,void 0,function(a,s){var o=this,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return v().m(function c(){var l,d,f,h,p,g,k,y,T,S,w,C,I,R,L;return v().w(function(M){for(;;)switch(M.n){case 0:return a instanceof ve&&a.setAudioContext(o.audioContext),M.n=1,(l=o.reconnectFuture)===null||l===void 0?void 0:l.promise;case 1:if(!(o.republishPromise&&!u)){M.n=2;break}return M.n=2,o.republishPromise;case 2:if(!(a instanceof An&&o.pendingPublishPromises.has(a))){M.n=3;break}return M.n=3,o.pendingPublishPromises.get(a);case 3:if(!(a instanceof MediaStreamTrack)){M.n=4;break}p=a.getConstraints(),M.n=9;break;case 4:p=a.constraints,g=void 0,I=a.source,M.n=I===A.Source.Microphone?5:I===A.Source.Camera?6:7;break;case 5:return g="audioinput",M.a(3,8);case 6:g="videoinput";case 7:return M.a(3,8);case 8:g&&o.activeDeviceMap.has(g)&&(p=Object.assign(Object.assign({},p),{deviceId:o.activeDeviceMap.get(g)}));case 9:if(!(a instanceof MediaStreamTrack)){M.n=14;break}R=a.kind,M.n=R==="audio"?10:R==="video"?11:12;break;case 10:return a=new ve(a,p,!0,o.audioContext,{loggerName:o.roomOptions.loggerName,loggerContextCb:function(){return o.logContext}}),M.a(3,13);case 11:return a=new me(a,p,!0,{loggerName:o.roomOptions.loggerName,loggerContextCb:function(){return o.logContext}}),M.a(3,13);case 12:throw new Xe("unsupported MediaStreamTrack kind ".concat(a.kind));case 13:M.n=15;break;case 14:a.updateLoggerOptions({loggerName:o.roomOptions.loggerName,loggerContextCb:function(){return o.logContext}});case 15:if(o.trackPublications.forEach(function(H){H.track&&H.track===a&&(k=H)}),!k){M.n=16;break}return o.log.warn("track has already been published, skipping",Object.assign(Object.assign({},o.logContext),re(k))),M.a(2,k);case 16:return y="channelCount"in a.mediaStreamTrack.getSettings()&&a.mediaStreamTrack.getSettings().channelCount===2||a.mediaStreamTrack.getConstraints().channelCount===2,T=(d=s==null?void 0:s.forceStereo)!==null&&d!==void 0?d:y,T&&(s||(s={}),s.dtx===void 0&&o.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},o.logContext),re(a))),s.red===void 0&&o.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(f=s.dtx)!==null&&f!==void 0||(s.dtx=!1),(h=s.red)!==null&&h!==void 0||(s.red=!1)),S=Object.assign(Object.assign({},o.roomOptions.publishDefaults),s),!Mc()&&o.roomOptions.e2ee&&(o.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},o.logContext)),S.simulcast=!1),S.source&&(a.source=S.source),w=o.publish(a,S,T),o.pendingPublishPromises.set(a,w),M.p=17,M.n=18,w;case 18:return C=M.v,M.a(2,C);case 19:throw M.p=19,L=M.v,L;case 20:return M.p=20,o.pendingPublishPromises.delete(a),M.f(20);case 21:return M.a(2)}},c,null,[[17,19,20,21]])})()})}},{key:"publish",value:function(e,n,a){return b(this,void 0,void 0,v().m(function s(){var o=this,u,c,l,d,f,h,p,g,k,y,T,S,w,C,I,R,L,M,H,U,W,Y,X;return v().w(function(G){for(;;)switch(G.n){case 0:if(T=Array.from(this.trackPublications.values()).find(function(K){return e instanceof An&&K.source===e.source}),T&&e.source!==A.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),re(e))),n.stopMicTrackOnMute&&e instanceof ve&&(e.stopOnMute=!0),e.source===A.Source.ScreenShare&&qn()&&(n.simulcast=!1),n.videoCodec==="av1"&&!Oc()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!Nc()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Ar),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(function(K){return n.videoCodec===xt(K.mime)})||(n.videoCodec=xt(this.enabledPublishVideoCodecs[0].mime))),S=n.videoCodec,e.on(F.Muted,this.onTrackMuted),e.on(F.Unmuted,this.onTrackUnmuted),e.on(F.Ended,this.handleTrackEnded),e.on(F.UpstreamPaused,this.onTrackUpstreamPaused),e.on(F.UpstreamResumed,this.onTrackUpstreamResumed),e.on(F.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),w=new Fn({cid:e.mediaStreamTrack.id,name:n.name,type:A.kindToProto(e.kind),muted:e.isMuted,source:A.sourceToProto(e.source),disableDtx:!(!((u=n.dtx)!==null&&u!==void 0)||u),encryption:this.encryptionType,stereo:a,disableRed:this.isE2EEEnabled||!(!((c=n.red)!==null&&c!==void 0)||c),stream:n==null?void 0:n.stream}),e.kind!==A.Kind.Video){G.n=5;break}return R={width:0,height:0},G.p=1,G.n=2,e.waitForDimensions();case 2:R=G.v,G.n=4;break;case 3:G.p=3,G.v,L=(d=(l=this.roomOptions.videoCaptureDefaults)===null||l===void 0?void 0:l.resolution)!==null&&d!==void 0?d:pt.h720.resolution,R={width:L.width,height:L.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),re(e)),{dims:R}));case 4:w.width=R.width,w.height=R.height,e instanceof me&&(at(S)&&(e.source===A.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),re(e))))),n.scalabilityMode=(f=n.scalabilityMode)!==null&&f!==void 0?f:"L3T3_KEY"),w.simulcastCodecs=[new hn({codec:S,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Ar}),n.backupCodec&&S!==n.backupCodec.codec&&w.encryption===fe.NONE?(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),w.simulcastCodecs.push(new hn({codec:n.backupCodec.codec,cid:""}))):n.videoCodec&&(w.simulcastCodecs=[new hn({codec:n.videoCodec,cid:e.mediaStreamTrack.id})])),C=Lr(e.source===A.Source.ScreenShare,w.width,w.height,n),w.layers=Ka(w.width,w.height,C,at(n.videoCodec)),C.length==1&&(I=So(e.source===A.Source.ScreenShare,w.width,w.height,n.videoCodec),C=[{maxBitrate:I.maxBitrate,maxFramerate:I.maxFramerate,active:!0}]),G.n=6;break;case 5:e.kind===A.Kind.Audio&&n.audioBitrate&&(C=[{maxBitrate:(h=n.audioPreset)===null||h===void 0?void 0:h.maxBitrate,priority:(g=(p=n.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&g!==void 0?g:"high",networkPriority:(y=(k=n.audioPreset)===null||k===void 0?void 0:k.priority)!==null&&y!==void 0?y:"high"}]);case 6:if(!(!this.engine||this.engine.isClosed)){G.n=7;break}throw new de("cannot publish track when not connected");case 7:if(M=function(){return b(o,void 0,void 0,v().m(function $(){var he,Ae,Cn,dn,nn,Yn,ge,wn;return v().w(function(le){for(;;)switch(le.n){case 0:if(this.engine.pcManager){le.n=1;break}throw new de("pcManager is not ready");case 1:return le.n=2,this.engine.createSender(e,n,C);case 2:if(e.sender=le.v,e instanceof me&&((he=n.degradationPreference)!==null&&he!==void 0||(n.degradationPreference=ml(e)),e.setDegradationPreference(n.degradationPreference)),!C){le.n=11;break}if(!(qn()&&e.kind===A.Kind.Audio)){le.n=10;break}dn=void 0,nn=z(this.engine.pcManager.publisher.getTransceivers()),le.p=3,nn.s();case 4:if((Yn=nn.n()).done){le.n=6;break}if(ge=Yn.value,ge.sender!==e.sender){le.n=5;break}return dn=ge,le.a(3,6);case 5:le.n=4;break;case 6:le.n=8;break;case 7:le.p=7,wn=le.v,nn.e(wn);case 8:return le.p=8,nn.f(),le.f(8);case 9:dn&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:dn,codec:"opus",maxbr:!((Ae=C[0])===null||Ae===void 0)&&Ae.maxBitrate?C[0].maxBitrate/1e3:0}),le.n=11;break;case 10:e.codec&&at(e.codec)&&(!((Cn=C[0])===null||Cn===void 0)&&Cn.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:w.cid,codec:e.codec,maxbr:C[0].maxBitrate/1e3});case 11:return le.n=12,this.engine.negotiate();case 12:return le.a(2)}},$,this,[[3,7,8,9]])}))},!(this.enabledPublishVideoCodecs.length>0)){G.n=9;break}return G.n=8,Promise.all([this.engine.addTrack(w),M()]);case 8:U=G.v,H=U[0],G.n=11;break;case 9:return G.n=10,this.engine.addTrack(w);case 10:return H=G.v,H.codecs.forEach(function(K){W===void 0&&(W=K.mimeType)}),W&&e.kind===A.Kind.Video&&(Y=xt(W),Y!==S&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),re(e)),{codec:Y})),n.videoCodec=Y,C=Lr(e.source===A.Source.ScreenShare,w.width,w.height,n))),G.n=11,M();case 11:return X=new ai(e.kind,H,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return o.logContext}}),X.options=n,e.sid=H.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:C,trackInfo:H})),e instanceof me?e.startMonitor(this.engine.client):e instanceof ve&&e.startMonitor(),this.addTrackPublication(X),this.emit(q.LocalTrackPublished,X),G.a(2,X)}},s,this,[[1,3]])}))}},{key:"isLocal",get:function(){return!0}},{key:"publishAdditionalCodecForTrack",value:function(e,n,a){return b(this,void 0,void 0,v().m(function s(){var o=this,u,c,l,d,f,h,p,g,k;return v().w(function(y){for(;;)switch(y.n){case 0:if(this.encryptionType===fe.NONE){y.n=1;break}return y.a(2);case 1:if(this.trackPublications.forEach(function(T){T.track&&T.track===e&&(c=T)}),c){y.n=2;break}throw new Xe("track is not published");case 2:if(e instanceof me){y.n=3;break}throw new Xe("track is not a video track");case 3:if(l=Object.assign(Object.assign({},(u=this.roomOptions)===null||u===void 0?void 0:u.publishDefaults),a),d=fl(e,n,l),d){y.n=4;break}return this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),re(e))),y.a(2);case 4:if(f=e.addSimulcastTrack(n,d),f){y.n=5;break}return y.a(2);case 5:if(h=new Fn({cid:f.mediaStreamTrack.id,type:A.kindToProto(e.kind),muted:e.isMuted,source:A.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:l.videoCodec,cid:f.mediaStreamTrack.id}]}),h.layers=Ka(h.width,h.height,d),!(!this.engine||this.engine.isClosed)){y.n=6;break}throw new de("cannot publish track when not connected");case 6:return p=function(){return b(o,void 0,void 0,v().m(function S(){var w;return v().w(function(C){for(;;)switch(C.n){case 0:return w={direction:"sendonly"},d&&(w.sendEncodings=d),C.n=1,this.engine.createSimulcastSender(e,f,l,d);case 1:return C.n=2,this.engine.negotiate();case 2:return C.a(2)}},S,this)}))},y.n=7,Promise.all([this.engine.addTrack(h),p()]);case 7:g=y.v,k=g[0],this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:d,trackInfo:k}));case 8:return y.a(2)}},s,this)}))}},{key:"unpublishTrack",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s,o,u,c,l,d,f,h,p,g,k,y,T,S,w;return v().w(function(C){for(;;)switch(C.n){case 0:if(!(e instanceof An)){C.n=1;break}if(u=this.pendingPublishPromises.get(e),!u){C.n=1;break}return this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),re(e))),C.n=1,u;case 1:if(c=this.getPublicationForTrack(e),l=c?re(c):void 0,this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),l)),!(!c||!c.track)){C.n=2;break}return this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),l)),C.a(2,void 0);case 2:if(e=c.track,e.off(F.Muted,this.onTrackMuted),e.off(F.Unmuted,this.onTrackUnmuted),e.off(F.Ended,this.handleTrackEnded),e.off(F.UpstreamPaused,this.onTrackUpstreamPaused),e.off(F.UpstreamResumed,this.onTrackUpstreamResumed),e.off(F.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),d=e.sender,e.sender=void 0,!(e.isUpstreamPaused&&e.mediaStreamTrack&&d)){C.n=3;break}return C.n=3,d.replaceTrack(e.mediaStreamTrack);case 3:if(n===void 0&&(n=(o=(s=this.roomOptions)===null||s===void 0?void 0:s.stopLocalTrackOnUnpublish)!==null&&o!==void 0?o:!0),n?e.stop():e.stopMonitor(),f=!1,this.engine.pcManager&&this.engine.pcManager.currentState<se.FAILED&&d)try{h=z(this.engine.pcManager.publisher.getTransceivers());try{for(h.s();!(p=h.n()).done;)g=p.value,g.sender===d&&(g.direction="inactive",f=!0)}catch(I){h.e(I)}finally{h.f()}if(this.engine.removeTrack(d)&&(f=!0),e instanceof me){k=z(e.simulcastCodecs);try{for(k.s();!(y=k.n()).done;)T=x(y.value,2),S=T[1],S.sender&&(this.engine.removeTrack(S.sender)&&(f=!0),S.sender=void 0)}catch(I){k.e(I)}finally{k.f()}e.simulcastCodecs.clear()}}catch(I){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),l),{error:I}))}this.trackPublications.delete(c.trackSid),w=c.kind,C.n=w===A.Kind.Audio?4:w===A.Kind.Video?5:6;break;case 4:return this.audioTrackPublications.delete(c.trackSid),C.a(3,7);case 5:return this.videoTrackPublications.delete(c.trackSid),C.a(3,7);case 6:return C.a(3,7);case 7:if(this.emit(q.LocalTrackUnpublished,c),c.setTrack(void 0),!f){C.n=8;break}return C.n=8,this.engine.negotiate();case 8:return C.a(2,c)}},a,this)}))}},{key:"sendChatMessage",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s;return v().w(function(o){for(;;)switch(o.n){case 0:return a={id:crypto.randomUUID(),message:e,timestamp:Date.now()},s=new Le({value:{case:"chatMessage",value:new Un(Object.assign(Object.assign({},a),{timestamp:V.parse(a.timestamp)}))}}),o.n=1,this.engine.sendDataPacket(s,ne.RELIABLE);case 1:return this.emit(q.ChatMessage,a),o.a(2,a)}},n,this)}))}},{key:"editChatMessage",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s,o;return v().w(function(u){for(;;)switch(u.n){case 0:return s=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),o=new Le({value:{case:"chatMessage",value:new Un(Object.assign(Object.assign({},s),{timestamp:V.parse(s.timestamp),editTimestamp:V.parse(s.editTimestamp)}))}}),u.n=1,this.engine.sendDataPacket(o,ne.RELIABLE);case 1:return this.emit(q.ChatMessage,s),u.a(2,s)}},a,this)}))}},{key:"unpublishTracks",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s;return v().w(function(o){for(;;)switch(o.n){case 0:return o.n=1,Promise.all(e.map(function(u){return a.unpublishTrack(u)}));case 1:return s=o.v,o.a(2,s.filter(function(u){return u instanceof ai}))}},n)}))}},{key:"republishAllTracks",value:function(e){return b(this,arguments,void 0,function(n){var a=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return v().m(function o(){return v().w(function(u){for(;;)switch(u.n){case 0:if(!a.republishPromise){u.n=1;break}return u.n=1,a.republishPromise;case 1:return a.republishPromise=new Promise(function(c,l){return b(a,void 0,void 0,v().m(function d(){var f=this,h,p;return v().w(function(g){for(;;)switch(g.n){case 0:return g.p=0,h=[],this.trackPublications.forEach(function(k){k.track&&(n&&(k.options=Object.assign(Object.assign({},k.options),n)),h.push(k))}),g.n=1,Promise.all(h.map(function(k){return b(f,void 0,void 0,v().m(function y(){var T;return v().w(function(S){for(;;)switch(S.n){case 0:return T=k.track,S.n=1,this.unpublishTrack(T,!1);case 1:if(!(s&&!T.isMuted&&T.source!==A.Source.ScreenShare&&T.source!==A.Source.ScreenShareAudio&&(T instanceof ve||T instanceof me)&&!T.isUserProvided)){S.n=2;break}return this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:k.trackSid})),S.n=2,T.restartTrack();case 2:return S.n=3,this.publishOrRepublishTrack(T,k.options,!0);case 3:return S.a(2)}},y,this)}))}));case 1:c(),g.n=3;break;case 2:g.p=2,p=g.v,l(p);case 3:return g.p=3,this.republishPromise=void 0,g.f(3);case 4:return g.a(2)}},d,this,[[0,2,3,4]])}))}),u.n=2,a.republishPromise;case 2:return u.a(2)}},o)})()})}},{key:"publishData",value:function(e){return b(this,arguments,void 0,function(n){var a=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return v().m(function o(){var u,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return u=s.reliable?ne.RELIABLE:ne.LOSSY,c=s.destinationIdentities,l=s.topic,d=new Le({kind:u,value:{case:"user",value:new yt({participantIdentity:a.identity,payload:n,destinationIdentities:c,destinationSids:c,topic:l})}}),f.n=1,a.engine.sendDataPacket(d,u);case 1:return f.a(2)}},o)})()})}},{key:"publishDtmf",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s;return v().w(function(o){for(;;)switch(o.n){case 0:return s=new Le({kind:ne.RELIABLE,value:{case:"sipDtmf",value:new bt({code:e,digit:n})}}),o.n=1,this.engine.sendDataPacket(s,ne.RELIABLE);case 1:return o.a(2)}},a,this)}))}},{key:"performRpc",value:function(e,n,a){return b(this,arguments,void 0,function(s,o,u){var c=this,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;return v().m(function d(){var f;return v().w(function(h){for(;;)switch(h.n){case 0:return f=2e3,h.a(2,new Promise(function(p,g){return b(c,void 0,void 0,v().m(function k(){var y=this,T,S,w,C,I,R,L;return v().w(function(M){for(;;)switch(M.n){case 0:if(!(Ur(u)>$a)){M.n=1;break}return g(Se.builtIn("REQUEST_PAYLOAD_TOO_LARGE")),M.a(2);case 1:if(!(!((S=(T=this.engine.latestJoinResponse)===null||T===void 0?void 0:T.serverInfo)===null||S===void 0)&&S.version&&jn((C=(w=this.engine.latestJoinResponse)===null||w===void 0?void 0:w.serverInfo)===null||C===void 0?void 0:C.version,"1.8.0")<0)){M.n=2;break}return g(Se.builtIn("UNSUPPORTED_SERVER")),M.a(2);case 2:return I=crypto.randomUUID(),M.n=3,this.publishRpcRequest(s,I,o,u,l-f);case 3:R=setTimeout(function(){y.pendingAcks.delete(I),g(Se.builtIn("CONNECTION_TIMEOUT")),y.pendingResponses.delete(I),clearTimeout(L)},f),this.pendingAcks.set(I,{resolve:function(){clearTimeout(R)},participantIdentity:s}),L=setTimeout(function(){y.pendingResponses.delete(I),g(Se.builtIn("RESPONSE_TIMEOUT"))},l),this.pendingResponses.set(I,{resolve:function(U,W){clearTimeout(L),y.pendingAcks.has(I)&&(console.warn("RPC response received before ack",I),y.pendingAcks.delete(I),clearTimeout(R)),W?g(W):p(U??"")},participantIdentity:s});case 4:return M.a(2)}},k,this)}))}))}},d)})()})}},{key:"registerRpcMethod",value:function(e,n){this.rpcHandlers.set(e,n)}},{key:"unregisterRpcMethod",value:function(e){this.rpcHandlers.delete(e)}},{key:"setTrackSubscriptionPermissions",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}},{key:"handleIncomingRpcAck",value:function(e){var n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}},{key:"handleIncomingRpcResponse",value:function(e,n,a){var s=this.pendingResponses.get(e);s?(s.resolve(n,a),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}},{key:"handleIncomingRpcRequest",value:function(e,n,a,s,o){return b(this,void 0,void 0,v().m(function u(){var c,l,d,f,h;return v().w(function(p){for(;;)switch(p.n){case 0:return p.n=1,this.publishRpcAck(e,n);case 1:if(c=this.rpcHandlers.get(a),c){p.n=3;break}return p.n=2,this.publishRpcResponse(e,n,null,Se.builtIn("UNSUPPORTED_METHOD"));case 2:return p.a(2);case 3:return l=null,d=null,p.p=4,p.n=5,c(n,e,s,o);case 5:f=p.v,Ur(f)>$a?(l=Se.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(a))):d=f,p.n=7;break;case 6:p.p=6,h=p.v,h instanceof Se?l=h:(console.warn("Uncaught error returned by RPC handler for ".concat(a,". Returning APPLICATION_ERROR instead."),h),l=Se.builtIn("APPLICATION_ERROR"));case 7:return p.n=8,this.publishRpcResponse(e,n,d,l);case 8:return p.a(2)}},u,this,[[4,6]])}))}},{key:"publishRpcRequest",value:function(e,n,a,s,o){return b(this,void 0,void 0,v().m(function u(){var c;return v().w(function(l){for(;;)switch(l.n){case 0:return c=new Le({destinationIdentities:[e],kind:ne.RELIABLE,value:{case:"rpcRequest",value:new Tt({id:n,method:a,payload:s,responseTimeoutMs:o})}}),l.n=1,this.engine.sendDataPacket(c,ne.RELIABLE);case 1:return l.a(2)}},u,this)}))}},{key:"publishRpcResponse",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function o(){var u;return v().w(function(c){for(;;)switch(c.n){case 0:return u=new Le({destinationIdentities:[e],kind:ne.RELIABLE,value:{case:"rpcResponse",value:new Ct({requestId:n,value:s?{case:"error",value:s.toProto()}:{case:"payload",value:a??""}})}}),c.n=1,this.engine.sendDataPacket(u,ne.RELIABLE);case 1:return c.a(2)}},o,this)}))}},{key:"publishRpcAck",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s;return v().w(function(o){for(;;)switch(o.n){case 0:return s=new Le({destinationIdentities:[e],kind:ne.RELIABLE,value:{case:"rpcAck",value:new St({requestId:n})}}),o.n=1,this.engine.sendDataPacket(s,ne.RELIABLE);case 1:return o.a(2)}},a,this)}))}},{key:"handleParticipantDisconnected",value:function(e){var n=z(this.pendingAcks),a;try{for(n.s();!(a=n.n()).done;){var s=x(a.value,2),o=s[0],u=s[1].participantIdentity;u===e&&this.pendingAcks.delete(o)}}catch(k){n.e(k)}finally{n.f()}var c=z(this.pendingResponses),l;try{for(c.s();!(l=c.n()).done;){var d=x(l.value,2),f=d[0],h=d[1],p=h.participantIdentity,g=h.resolve;p===e&&(g(null,Se.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(f))}}catch(k){c.e(k)}finally{c.f()}}},{key:"setEnabledPublishCodecs",value:function(e){this.enabledPublishVideoCodecs=e.filter(function(n){return n.mime.split("/")[0].toLowerCase()==="video"})}},{key:"updateInfo",value:function(e){var n=this;return e.sid!==this.sid||!Q(t,"updateInfo",this,3)([e])?!1:(e.tracks.forEach(function(a){var s,o=n.trackPublications.get(a.sid);if(o){console.log("Track type is: "+o.kind+" & Sid is: "+a.sid+" & Mute value is: "+a.muted);var u=/^TR_VS.*/,c=/^TR_As.*/;if(u.test(a.sid)||c.test(a.sid))return;var l=o.track;o.kind==A.Kind.Audio?(sessionStorage.getItem("isAudioMuted")&&sessionStorage.getItem("isAudioMuted")==="true"&&(n.log.debug("updating server audio mute state after reloading",Object.assign(Object.assign({},n.logContext),{sid:a.sid,muted:!0})),n.engine.client.sendMuteTrack(a.sid,!0),n.audioMuted=!0),a.muted?l instanceof ve&&l.mute().then(function(){n.emit(q.TrackMuted,o)}):(n.audioMuted&&l instanceof ve&&l.unmute().then(function(){n.emit(q.TrackUnmuted,o)}),n.audioMuted=!1)):!((s=o.track)===null||s===void 0)&&s.isUpstreamPaused||(sessionStorage.getItem("isVideoMuted")&&sessionStorage.getItem("isVideoMuted")==="true"&&(n.log.debug("updating server video mute state after reloading",Object.assign(Object.assign({},n.logContext),{sid:a.sid,muted:!0})),n.engine.client.sendMuteTrack(a.sid,!0),n.videoMuted=!0),a.muted?l instanceof me&&l.mute().then(function(){n.emit(q.TrackMuted,o)}):(n.videoMuted&&l instanceof me&&l.unmute().then(function(){n.emit(q.TrackUnmuted,o)}),n.videoMuted=!1))}}),!0)}},{key:"getPublicationForTrack",value:function(e){var n;return this.trackPublications.forEach(function(a){var s=a.track;s&&(e instanceof MediaStreamTrack?(s instanceof ve||s instanceof me)&&s.mediaStreamTrack===e&&(n=a):e===s&&(n=a))}),n}},{key:"waitForPendingPublicationOfSource",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,o;return v().w(function(u){for(;;)switch(u.n){case 0:a=1e4,s=Date.now();case 1:if(!(Date.now()<s+a)){u.n=4;break}if(o=Array.from(this.pendingPublishPromises.entries()).find(function(c){var l=x(c,1),d=l[0];return d.source===e}),!o){u.n=2;break}return u.a(2,o[1]);case 2:return u.n=3,Be(20);case 3:u.n=1;break;case 4:return u.a(2)}},n,this)}))}}])}(Eo),Ro=function(r){function t(i,e,n,a){var s;return P(this,t),s=O(this,t,[i,e.sid,e.name,a]),s.track=void 0,s.allowed=!0,s.disabled=!1,s.currentVideoQuality=Ne.HIGH,s.handleEnded=function(o){s.setTrack(void 0),s.emit(F.Ended,o)},s.handleVisibilityChange=function(o){s.log.debug("adaptivestream video visibility ".concat(s.trackSid,", visible=").concat(o),s.logContext),s.disabled=!o,s.emitTrackUpdate()},s.handleVideoDimensionsChange=function(o){s.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),s.logContext),s.videoDimensions=o,s.emitTrackUpdate()},s.subscribed=n,s.updateInfo(e),s}return N(t,r),E(t,[{key:"setSubscribed",value:function(e){var n=this.subscriptionStatus,a=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);var s=new yn({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Pt({participantSid:"",trackSids:[this.trackSid]})]});this.emit(F.UpdateSubscription,s),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(a)}},{key:"subscriptionStatus",get:function(){return this.subscribed===!1?Ke.SubscriptionStatus.Unsubscribed:Q(t,"isSubscribed",this,1)?Ke.SubscriptionStatus.Subscribed:Ke.SubscriptionStatus.Desired}},{key:"permissionStatus",get:function(){return this.allowed?Ke.PermissionStatus.Allowed:Ke.PermissionStatus.NotAllowed}},{key:"isSubscribed",get:function(){return this.subscribed===!1?!1:Q(t,"isSubscribed",this,1)}},{key:"isDesired",get:function(){return this.subscribed!==!1}},{key:"isEnabled",get:function(){return!this.disabled}},{key:"setEnabled",value:function(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}},{key:"setVideoQuality",value:function(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}},{key:"setVideoDimensions",value:function(e){var n,a;this.isManualOperationAllowed()&&(((n=this.videoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((a=this.videoDimensions)===null||a===void 0?void 0:a.height)===e.height||(this.track instanceof ut&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}},{key:"setVideoFPS",value:function(e){this.isManualOperationAllowed()&&this.track instanceof ut&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}},{key:"videoQuality",get:function(){return this.currentVideoQuality}},{key:"setTrack",value:function(e){var n=this.subscriptionStatus,a=this.permissionStatus,s=this.track;s!==e&&(s&&(s.off(F.VideoDimensionsChanged,this.handleVideoDimensionsChange),s.off(F.VisibilityChanged,this.handleVisibilityChange),s.off(F.Ended,this.handleEnded),s.detach(),s.stopMonitor(),this.emit(F.Unsubscribed,s)),Q(t,"setTrack",this,3)([e]),e&&(e.sid=this.trackSid,e.on(F.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(F.VisibilityChanged,this.handleVisibilityChange),e.on(F.Ended,this.handleEnded),this.emit(F.Subscribed,e)),this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(n))}},{key:"setAllowed",value:function(e){var n=this.subscriptionStatus,a=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(n)}},{key:"setSubscriptionError",value:function(e){this.emit(F.SubscriptionFailed,e)}},{key:"updateInfo",value:function(e){Q(t,"updateInfo",this,3)([e]);var n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?F.Muted:F.Unmuted)}},{key:"emitSubscriptionUpdateIfChanged",value:function(e){var n=this.subscriptionStatus;e!==n&&this.emit(F.SubscriptionStatusChanged,n,e)}},{key:"emitPermissionUpdateIfChanged",value:function(e){var n=this.permissionStatus;n!==e&&this.emit(F.SubscriptionPermissionChanged,this.permissionStatus,e)}},{key:"isManualOperationAllowed",value:function(){return this.kind===A.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}},{key:"isAdaptiveStream",get:function(){return this.track instanceof ut&&this.track.isAdaptiveStream}},{key:"emitTrackUpdate",value:function(){var e=new It({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=Ne.HIGH,this.emit(F.UpdateSettings,e)}}])}(Ke),ns=function(r){function t(i,e,n,a,s,o,u){var c,l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:cn.STANDARD;return P(this,t),c=O(this,t,[e,n||"",a,s,o,u,l]),c.signalClient=i,c.trackPublications=new Map,c.audioTrackPublications=new Map,c.videoTrackPublications=new Map,c.volumeMap=new Map,c}return N(t,r),E(t,[{key:"logContext",get:function(){return Object.assign(Object.assign({},Q(t,"logContext",this,1)),{rpID:this.sid,remoteParticipant:this.identity})}},{key:"addTrackPublication",value:function(e){var n=this;Q(t,"addTrackPublication",this,3)([e]),e.on(F.UpdateSettings,function(a){n.log.debug("send update settings",Object.assign(Object.assign({},n.logContext),re(e))),n.signalClient.sendUpdateTrackSettings(a)}),e.on(F.UpdateSubscription,function(a){a.participantTracks.forEach(function(s){s.participantSid=n.sid}),n.signalClient.sendUpdateSubscription(a)}),e.on(F.SubscriptionPermissionChanged,function(a){n.emit(q.TrackSubscriptionPermissionChanged,e,a)}),e.on(F.SubscriptionStatusChanged,function(a){n.emit(q.TrackSubscriptionStatusChanged,e,a)}),e.on(F.Subscribed,function(a){n.emit(q.TrackSubscribed,a,e)}),e.on(F.Unsubscribed,function(a){n.emit(q.TrackUnsubscribed,a,e)}),e.on(F.SubscriptionFailed,function(a){n.emit(q.TrackSubscriptionFailed,e.trackSid,a)})}},{key:"getTrackPublication",value:function(e){var n=Q(t,"getTrackPublication",this,3)([e]);if(n)return n}},{key:"getTrackPublicationByName",value:function(e){var n=Q(t,"getTrackPublicationByName",this,3)([e]);if(n)return n}},{key:"setVolume",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:A.Source.Microphone;this.volumeMap.set(n,e);var a=this.getTrackPublication(n);a&&a.track&&a.track.setVolume(e)}},{key:"getVolume",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:A.Source.Microphone,n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}},{key:"addSubscribedMediaTrack",value:function(e,n,a,s,o,u){var c=this,l=this.getTrackPublicationBySid(n);if(l||n.startsWith("TR")||this.trackPublications.forEach(function(h){!l&&e.kind===h.kind.toString()&&(l=h)}),!l){if(u===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(q.TrackSubscriptionFailed,n);return}u===void 0&&(u=20),setTimeout(function(){c.addSubscribedMediaTrack(e,n,a,s,o,u-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),re(l))),this.emit(q.TrackSubscriptionFailed,n);return}var d=e.kind==="video",f;return d?f=new ut(e,n,s,o):f=new ot(e,n,s,this.audioContext,this.audioOutput),f.source=l.source,f.isMuted=l.isMuted,f.setMediaStream(a),f.start(),l.setTrack(f),this.volumeMap.has(l.source)&&f instanceof ot&&f.setVolume(this.volumeMap.get(l.source)),l}},{key:"hasMetadata",get:function(){return!!this.participantInfo}},{key:"getTrackPublicationBySid",value:function(e){return this.trackPublications.get(e)}},{key:"updateInfo",value:function(e){var n=this;if(!Q(t,"updateInfo",this,3)([e]))return!1;var a=new Map,s=new Map;return e.tracks.forEach(function(o){var u,c,l=n.getTrackPublicationBySid(o.sid);if(l)l.updateInfo(o);else{var d=A.kindFromProto(o.type);if(!d)return;l=new Ro(d,o,(u=n.signalClient.connectOptions)===null||u===void 0?void 0:u.autoSubscribe,{loggerContextCb:function(){return n.logContext},loggerName:(c=n.loggerOptions)===null||c===void 0?void 0:c.loggerName}),l.updateInfo(o),s.set(o.sid,l);var f=Array.from(n.trackPublications.values()).find(function(h){return h.source===(l==null?void 0:l.source)});f&&l.source!==A.Source.Unknown&&n.log.debug("received a second track publication for ".concat(n.identity," with the same source: ").concat(l.source),Object.assign(Object.assign({},n.logContext),{oldTrack:re(f),newTrack:re(l)})),n.addTrackPublication(l)}a.set(o.sid,l)}),this.trackPublications.forEach(function(o){a.has(o.trackSid)||(n.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},n.logContext),re(o))),n.unpublishTrack(o.trackSid,!0))}),s.forEach(function(o){n.emit(q.TrackPublished,o)}),!0}},{key:"unpublishTrack",value:function(e,n){var a=this.trackPublications.get(e);if(a){var s=a.track;switch(s&&(s.stop(),a.setTrack(void 0)),this.trackPublications.delete(e),a.kind){case A.Kind.Audio:this.audioTrackPublications.delete(e);break;case A.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(q.TrackUnpublished,a)}}},{key:"setAudioOutput",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a;return v().w(function(s){for(;;)switch(s.n){case 0:return this.audioOutput=e,a=[],this.audioTrackPublications.forEach(function(o){var u;o.track instanceof ot&&a.push(o.track.setSinkId((u=e.deviceId)!==null&&u!==void 0?u:"default"))}),s.n=1,Promise.all(a);case 1:return s.a(2)}},n,this)}))}},{key:"emit",value:function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:a})),Q(t,"emit",this,3)([e].concat(a))}}],[{key:"fromParticipantInfo",value:function(e,n,a){return new t(e,n.sid,n.identity,n.name,n.metadata,n.attributes,a,n.kind)}}])}(Eo),ee;(function(r){r.Disconnected="disconnected",r.Connecting="connecting",r.Connected="connected",r.Reconnecting="reconnecting",r.SignalReconnecting="signalReconnecting"})(ee||(ee={}));var Cl=4*1e3,Io=function(r){function t(i){var e;P(this,t);var n,a,s;if(e=O(this,t),e.state=ee.Disconnected,e.activeSpeakers=[],e.isE2EEEnabled=!1,e.audioEnabled=!0,e.isVideoPlaybackBlocked=!1,e.log=Z,e.bufferedEvents=[],e.isResuming=!1,e.connect=function(u,c,l){return b(e,void 0,void 0,v().m(function d(){var f=this,h,p,g,k,y;return v().w(function(T){for(;;)switch(T.n){case 0:if(Dc()){T.n=2;break}if(!en()){T.n=1;break}throw Error("WebRTC isn't detected, have you called registerGlobals?");case 1:throw Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");case 2:return p=sessionStorage.getItem("token"),(!c||c.trim().length===0)&&p!=null&&(Z.info("Reload Performed, using latest token to refresh: "+p),c=p),T.n=3,this.disconnectLock.lock();case 3:if(g=T.v,this.state!==ee.Connected){T.n=4;break}return this.log.info("already connected to room ".concat(this.name),this.logContext),g(),T.a(2,Promise.resolve());case 4:if(!this.connectFuture){T.n=5;break}return g(),T.a(2,this.connectFuture.promise);case 5:return this.setAndEmitConnectionState(ee.Connecting),((h=this.regionUrlProvider)===null||h===void 0?void 0:h.getServerUrl().toString())!==u&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Dr(new URL(u))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Za(u,c):this.regionUrlProvider.updateToken(c),this.regionUrlProvider.fetchRegionSettings().then(function(S){var w;(w=f.regionUrlProvider)===null||w===void 0||w.setServerReportedRegions(S)}).catch(function(S){f.log.warn("could not fetch region settings",Object.assign(Object.assign({},f.logContext),{error:S}))})),k=function(w,C,I){return b(f,void 0,void 0,v().m(function R(){var L,M,H,U,W,Y,X;return v().w(function(G){for(;;)switch(G.n){case 0:return this.abortController&&this.abortController.abort(),H=new AbortController,this.abortController=H,g==null||g(),G.p=1,G.n=2,this.attemptConnection(I??u,c,l,H);case 2:this.abortController=void 0,w(),G.n=12;break;case 3:if(G.p=3,Y=G.v,!(this.regionUrlProvider&&Y instanceof ie&&Y.reason!==3&&Y.reason!==0)){G.n=11;break}return U=null,G.p=4,G.n=5,this.regionUrlProvider.getNextBestRegionUrl((L=this.abortController)===null||L===void 0?void 0:L.signal);case 5:U=G.v,G.n=7;break;case 6:if(G.p=6,X=G.v,!(X instanceof ie&&(X.status===401||X.reason===3))){G.n=7;break}return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),C(X),G.a(2);case 7:if(!(U&&!(!((M=this.abortController)===null||M===void 0)&&M.signal.aborted))){G.n=9;break}return this.log.info("Initial connection failed with ConnectionError: ".concat(Y.message,". Retrying with another region: ").concat(U),this.logContext),this.recreateEngine(),G.n=8,k(w,C,U);case 8:G.n=10;break;case 9:this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Fa(Y)),C(Y);case 10:G.n=12;break;case 11:W=be.UNKNOWN_REASON,Y instanceof ie&&(W=Fa(Y)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,W),C(Y);case 12:return G.a(2)}},R,this,[[4,6],[1,3]])}))},y=this.regionUrl,this.regionUrl=void 0,this.connectFuture=new vo(function(S,w){k(S,w,y)},function(){f.clearConnectionFutures()}),T.a(2,this.connectFuture.promise)}},d,this)}))},e.connectSignal=function(u,c,l,d,f,h){return b(e,void 0,void 0,v().m(function p(){var g,k,y,T,S;return v().w(function(w){for(;;)switch(w.n){case 0:return w.n=1,l.join(u,c,{autoSubscribe:d.autoSubscribe,adaptiveStream:j(f.adaptiveStream)==="object"?!0:f.adaptiveStream,maxRetries:d.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:d.websocketTimeout},h.signal);case 1:if(T=w.v,S=T.serverInfo,S||(S={version:T.serverVersion,region:T.serverRegion}),this.serverInfo=S,this.log.debug("connected to Livekit Server ".concat(Object.entries(S).map(function(C){var I=x(C,2),R=I[0],L=I[1];return"".concat(R,": ").concat(L)}).join(", ")),{room:(g=T.room)===null||g===void 0?void 0:g.name,roomSid:(k=T.room)===null||k===void 0?void 0:k.sid,identity:(y=T.participant)===null||y===void 0?void 0:y.identity}),S.version){w.n=2;break}throw new dc("unknown server version");case 2:return S.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),f.dynacast=!1),w.a(2,T)}},p,this)}))},e.applyJoinResponse=function(u){var c=u.participant;if(e.localParticipant.sid=c.sid,e.localParticipant.identity=c.identity,e.localParticipant.setEnabledPublishCodecs(u.enabledPublishCodecs),e.options.e2ee&&e.e2eeManager)try{e.e2eeManager.setSifTrailer(u.sifTrailer)}catch(l){e.log.error(l instanceof Error?l.message:"Could not set SifTrailer",Object.assign(Object.assign({},e.logContext),{error:l}))}e.handleParticipantUpdates([c].concat(Oe(u.otherParticipants))),u.room&&e.handleRoomUpdate(u.room)},e.attemptConnection=function(u,c,l,d){return b(e,void 0,void 0,v().m(function f(){var h,p,g,k,y,T;return v().w(function(S){for(;;)switch(S.n){case 0:return this.state===ee.Reconnecting||this.isResuming||!((h=this.engine)===null||h===void 0)&&h.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((p=this.regionUrlProvider)===null||p===void 0)&&p.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},ea),l),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout),S.p=1,S.n=2,this.connectSignal(u,c,this.engine,this.connOptions,this.options,d);case 2:g=S.v,this.applyJoinResponse(g),this.setupLocalParticipantEvents(),this.emit(B.SignalConnected),S.n=5;break;case 3:return S.p=3,y=S.v,S.n=4,this.engine.close();case 4:throw this.recreateEngine(),k=new ie("could not establish signal connection",1),y instanceof Error&&(k.message="".concat(k.message,": ").concat(y.message)),y instanceof ie&&(k.reason=y.reason,k.status=y.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:y})),k;case 5:if(!d.signal.aborted){S.n=7;break}return S.n=6,this.engine.close();case 6:throw this.recreateEngine(),new ie("Connection attempt aborted",3);case 7:return S.p=7,S.n=8,this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,d);case 8:S.n=11;break;case 9:return S.p=9,T=S.v,S.n=10,this.engine.close();case 10:throw this.recreateEngine(),T;case 11:we()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),we()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ee.Connected),this.emit(B.Connected),this.registerConnectionReconcile();case 12:return S.a(2)}},f,this,[[7,9],[1,3]])}))},e.disconnect=function(){for(var u=arguments.length,c=new Array(u),l=0;l<u;l++)c[l]=arguments[l];return b(e,[].concat(c),void 0,function(){var d=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return v().m(function h(){var p,g,k,y,T;return v().w(function(S){for(;;)switch(S.n){case 0:return sessionStorage.removeItem("token"),sessionStorage.removeItem("isAudioMuted"),sessionStorage.removeItem("isVideoMuted"),S.n=1,d.disconnectLock.lock();case 1:if(T=S.v,S.p=2,d.state!==ee.Disconnected){S.n=3;break}return d.log.debug("already disconnected",d.logContext),S.a(2);case 3:if(d.log.info("disconnect from room",Object.assign({},d.logContext)),(d.state===ee.Connecting||d.state===ee.Reconnecting||d.isResuming)&&(d.log.warn("abort connection attempt",d.logContext),(p=d.abortController)===null||p===void 0||p.abort(),(k=(g=d.connectFuture)===null||g===void 0?void 0:g.reject)===null||k===void 0||k.call(g,new ie("Client initiated disconnect",3)),d.connectFuture=void 0),!((y=d.engine)===null||y===void 0)&&y.client.isDisconnected){S.n=4;break}return S.n=4,d.engine.client.sendLeave();case 4:if(!d.engine){S.n=5;break}return S.n=5,d.engine.close();case 5:d.handleDisconnect(f,be.CLIENT_INITIATED),d.engine=void 0;case 6:return S.p=6,T(),S.f(6);case 7:return S.a(2)}},h,null,[[2,,6,7]])})()})},e.onPageLeave=function(){return b(e,void 0,void 0,v().m(function u(){var c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:alert("on page leave"),this.log.info("Page leave detected, disconnecting",this.logContext),c=sessionStorage.getItem("token"),l=sessionStorage.getItem("isAudioMuted"),d=sessionStorage.getItem("isVideoMuted"),this.disconnect(),sessionStorage.setItem("token",c),sessionStorage.setItem("isAudioMuted",l),sessionStorage.setItem("isVideoMuted",d);case 1:return f.a(2)}},u,this)}))},e.startAudio=function(){return b(e,void 0,void 0,v().m(function u(){var c=this,l,d,f,h,p,g,k;return v().w(function(y){for(;;)switch(y.n){case 0:return l=[],d=We(),d&&d.os==="iOS"&&(f="livekit-dummy-audio-el",h=document.getElementById(f),h||(h=document.createElement("audio"),h.id=f,h.autoplay=!0,h.hidden=!0,p=tr(),p.enabled=!0,g=new MediaStream([p]),h.srcObject=g,document.addEventListener("visibilitychange",function(){h&&(h.srcObject=document.hidden?null:g,document.hidden||(c.log.debug("page visible again, triggering startAudio to resume playback and update playback status",c.logContext),c.startAudio()))}),document.body.append(h),this.once(B.Disconnected,function(){h==null||h.remove(),h=null})),l.push(h)),this.remoteParticipants.forEach(function(T){T.audioTrackPublications.forEach(function(S){S.track&&S.track.attachedElements.forEach(function(w){l.push(w)})})}),y.p=1,y.n=2,Promise.all([this.acquireAudioContext()].concat(Oe(l.map(function(T){return T.muted=!1,T.play()}))));case 2:this.handleAudioPlaybackStarted(),y.n=4;break;case 3:throw y.p=3,k=y.v,this.handleAudioPlaybackFailed(k),k;case 4:return y.a(2)}},u,this,[[1,3]])}))},e.startVideo=function(){return b(e,void 0,void 0,v().m(function u(){var c=this,l,d,f,h;return v().w(function(p){for(;;)switch(p.n){case 0:l=[],d=z(this.remoteParticipants.values());try{for(d.s();!(f=d.n()).done;)h=f.value,h.videoTrackPublications.forEach(function(g){var k;(k=g.track)===null||k===void 0||k.attachedElements.forEach(function(y){l.includes(y)||l.push(y)})})}catch(g){d.e(g)}finally{d.f()}return p.n=1,Promise.all(l.map(function(g){return g.play()})).then(function(){c.handleVideoPlaybackStarted()}).catch(function(g){g.name==="NotAllowedError"?c.handleVideoPlaybackFailed():c.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",c.logContext)});case 1:return p.a(2)}},u,this)}))},e.handleRestarting=function(){e.clearConnectionReconcile(),e.isResuming=!1;var u=z(e.remoteParticipants.values()),c;try{for(u.s();!(c=u.n()).done;){var l=c.value;e.handleParticipantDisconnected(l.identity,l)}}catch(d){u.e(d)}finally{u.f()}e.setAndEmitConnectionState(ee.Reconnecting)&&e.emit(B.Reconnecting)},e.handleSignalRestarted=function(u){return b(e,void 0,void 0,v().m(function c(){var l;return v().w(function(d){for(;;)switch(d.n){case 0:return this.log.debug("signal reconnected to server, region ".concat(u.serverRegion),Object.assign(Object.assign({},this.logContext),{region:u.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(u),d.p=1,d.n=2,this.localParticipant.republishAllTracks(void 0,!0);case 2:d.n=4;break;case 3:d.p=3,l=d.v,this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}));case 4:return d.p=4,d.n=5,this.engine.waitForRestarted();case 5:this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:u.serverRegion})),d.n=7;break;case 6:return d.p=6,d.v,d.a(2);case 7:this.setAndEmitConnectionState(ee.Connected),this.emit(B.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents();case 8:return d.a(2)}},c,this,[[4,6],[1,3]])}))},e.handleParticipantUpdates=function(u){u.forEach(function(c){var l;if(c.identity===e.localParticipant.identity){e.localParticipant.updateInfo(c);return}c.identity===""&&(c.identity=(l=e.sidToIdentity.get(c.sid))!==null&&l!==void 0?l:"");var d=e.remoteParticipants.get(c.identity);c.state===gn.DISCONNECTED?e.handleParticipantDisconnected(c.identity,d):d=e.getOrCreateParticipant(c.identity,c)})},e.handleActiveSpeakersUpdate=function(u){var c=[],l={};u.forEach(function(d){if(l[d.sid]=!0,d.sid===e.localParticipant.sid)e.localParticipant.audioLevel=d.level,e.localParticipant.setIsSpeaking(!0),c.push(e.localParticipant);else{var f=e.getRemoteParticipantBySid(d.sid);f&&(f.audioLevel=d.level,f.setIsSpeaking(!0),c.push(f))}}),l[e.localParticipant.sid]||(e.localParticipant.audioLevel=0,e.localParticipant.setIsSpeaking(!1)),e.remoteParticipants.forEach(function(d){l[d.sid]||(d.audioLevel=0,d.setIsSpeaking(!1))}),e.activeSpeakers=c,e.emitWhenConnected(B.ActiveSpeakersChanged,c)},e.handleSpeakersChanged=function(u){var c=new Map;e.activeSpeakers.forEach(function(d){var f=e.remoteParticipants.get(d.identity);f&&f.sid!==d.sid||c.set(d.sid,d)}),u.forEach(function(d){var f=e.getRemoteParticipantBySid(d.sid);d.sid===e.localParticipant.sid&&(f=e.localParticipant),f&&(f.audioLevel=d.level,f.setIsSpeaking(d.active),d.active?c.set(d.sid,f):c.delete(d.sid))});var l=Array.from(c.values());l.sort(function(d,f){return f.audioLevel-d.audioLevel}),e.activeSpeakers=l,e.emitWhenConnected(B.ActiveSpeakersChanged,l)},e.handleStreamStateUpdate=function(u){u.streamStates.forEach(function(c){var l=e.getRemoteParticipantBySid(c.participantSid);if(l){var d=l.getTrackPublicationBySid(c.trackSid);if(!(!d||!d.track)){var f=A.streamStateFromProto(c.state);f!==d.track.streamState&&(d.track.streamState=f,l.emit(q.TrackStreamStateChanged,d,d.track.streamState),e.emitWhenConnected(B.TrackStreamStateChanged,d,d.track.streamState,l))}}})},e.handleSubscriptionPermissionUpdate=function(u){var c=e.getRemoteParticipantBySid(u.participantSid);if(c){var l=c.getTrackPublicationBySid(u.trackSid);l&&l.setAllowed(u.allowed)}},e.handleSubscriptionError=function(u){var c=Array.from(e.remoteParticipants.values()).find(function(d){return d.trackPublications.has(u.trackSid)});if(c){var l=c.getTrackPublicationBySid(u.trackSid);l&&l.setSubscriptionError(u.err)}},e.handleDataPacket=function(u){var c=e.remoteParticipants.get(u.participantIdentity);u.value.case==="user"?e.handleUserPacket(c,u.value.value,u.kind):u.value.case==="transcription"?e.handleTranscription(c,u.value.value):u.value.case==="sipDtmf"?e.handleSipDtmf(c,u.value.value):u.value.case==="metrics"?e.handleMetrics(u.value.value,c):u.value.case==="chatMessage"&&e.handleChatMessage(c,u.value.value)},e.handleUserPacket=function(u,c,l){e.emit(B.DataReceived,c.payload,u,l,c.topic),u==null||u.emit(q.DataReceived,c.payload,l,c.destinationIdentities)},e.handleSipDtmf=function(u,c){e.emit(B.SipDTMFReceived,c,u),u==null||u.emit(q.SipDTMFReceived,c)},e.bufferedSegments=new Map,e.handleTranscription=function(u,c){var l=c.transcribedParticipantIdentity===e.localParticipant.identity?e.localParticipant:e.getParticipantByIdentity(c.transcribedParticipantIdentity),d=l==null?void 0:l.trackPublications.get(c.trackId),f=_c(c,e.transcriptionReceivedTimes);d==null||d.emit(F.TranscriptionReceived,f),l==null||l.emit(q.TranscriptionReceived,f,d),e.emit(B.TranscriptionReceived,f,l,d)},e.handleMetrics=function(u,c){e.emit(B.MetricsReceived,u,c)},e.handleChatMessage=function(u,c){var l=qc(c);e.emit(B.ChatMessage,l,u)},e.handleAudioPlaybackStarted=function(){e.canPlaybackAudio||(e.audioEnabled=!0,e.emit(B.AudioPlaybackStatusChanged,!0))},e.handleAudioPlaybackFailed=function(u){e.log.warn("could not playback audio",Object.assign(Object.assign({},e.logContext),{error:u})),e.canPlaybackAudio&&(e.audioEnabled=!1,e.emit(B.AudioPlaybackStatusChanged,!1))},e.handleVideoPlaybackStarted=function(){e.isVideoPlaybackBlocked&&(e.isVideoPlaybackBlocked=!1,e.emit(B.VideoPlaybackStatusChanged,!0))},e.handleVideoPlaybackFailed=function(){e.isVideoPlaybackBlocked||(e.isVideoPlaybackBlocked=!0,e.emit(B.VideoPlaybackStatusChanged,!1))},e.handleDeviceChange=function(){return b(e,void 0,void 0,v().m(function u(){var c=this,l,d,f,h,p,g,k,y,T,S,w,C,I,R;return v().w(function(L){for(;;)switch(L.n){case 0:return f=Je.getInstance().previousDevices,L.n=1,Je.getInstance().getDevices(void 0,!1);case 1:if(h=L.v,p=We(),!((p==null?void 0:p.name)==="Chrome"&&p.os!=="iOS")){L.n=8;break}g=z(h),L.p=2,y=v().m(function M(){var H,U;return v().w(function(W){for(;;)switch(W.n){case 0:H=k.value,U=f.find(function(Y){return Y.deviceId===H.deviceId}),U&&U.label!==""&&U.kind===H.kind&&U.label!==H.label&&c.getActiveDevice(H.kind)==="default"&&c.emit(B.ActiveDeviceChanged,H.kind,H.deviceId);case 1:return W.a(2)}},M)}),g.s();case 3:if((k=g.n()).done){L.n=5;break}return L.d(ra(y()),4);case 4:L.n=3;break;case 5:L.n=7;break;case 6:L.p=6,R=L.v,g.e(R);case 7:return L.p=7,g.f(),L.f(7);case 8:T=["audiooutput","audioinput","videoinput"],S=v().m(function M(){var H,U,W;return v().w(function(Y){for(;;)switch(Y.n){case 0:if(H=I[C],U=h.filter(function(X){return X.kind===H}),W=c.getActiveDevice(H),W!==((l=f.filter(function(X){return X.kind===H})[0])===null||l===void 0?void 0:l.deviceId)){Y.n=2;break}if(!(U.length>0&&((d=U[0])===null||d===void 0?void 0:d.deviceId)!==W)){Y.n=2;break}return Y.n=1,c.switchActiveDevice(H,U[0].deviceId);case 1:return Y.a(2,0);case 2:if(!(H==="audioinput"&&!ln()||H==="videoinput")){Y.n=3;break}return Y.a(2,0);case 3:if(!(U.length>0&&!U.find(function(X){return X.deviceId===c.getActiveDevice(H)}))){Y.n=4;break}return Y.n=4,c.switchActiveDevice(H,U[0].deviceId);case 4:return Y.a(2)}},M)}),C=0,I=T;case 9:if(!(C<I.length)){L.n=12;break}return L.d(ra(S()),10);case 10:if(w=L.v,w!==0){L.n=11;break}return L.a(3,11);case 11:C++,L.n=9;break;case 12:this.emit(B.MediaDevicesChanged);case 13:return L.a(2)}},u,this,[[2,6,7,8]])}))},e.handleRoomUpdate=function(u){var c=e.roomInfo;e.roomInfo=u,c&&c.metadata!==u.metadata&&e.emitWhenConnected(B.RoomMetadataChanged,u.metadata),(c==null?void 0:c.activeRecording)!==u.activeRecording&&e.emitWhenConnected(B.RecordingStatusChanged,u.activeRecording)},e.handleConnectionQualityUpdate=function(u){u.updates.forEach(function(c){if(c.participantSid===e.localParticipant.sid){e.localParticipant.setConnectionQuality(c.quality);return}var l=e.getRemoteParticipantBySid(c.participantSid);l&&l.setConnectionQuality(c.quality)})},e.onLocalParticipantMetadataChanged=function(u){e.emit(B.ParticipantMetadataChanged,u,e.localParticipant)},e.onLocalParticipantNameChanged=function(u){e.emit(B.ParticipantNameChanged,u,e.localParticipant)},e.onLocalAttributesChanged=function(u){e.emit(B.ParticipantAttributesChanged,u,e.localParticipant)},e.onLocalTrackMuted=function(u){e.emit(B.TrackMuted,u,e.localParticipant)},e.onLocalTrackUnmuted=function(u){e.emit(B.TrackUnmuted,u,e.localParticipant)},e.onTrackProcessorUpdate=function(u){var c;(c=u==null?void 0:u.onPublish)===null||c===void 0||c.call(u,e)},e.onLocalTrackPublished=function(u){return b(e,void 0,void 0,v().m(function c(){var l,d,f,h,p,g,k,y,T;return v().w(function(S){for(;;)switch(S.n){case 0:if((l=u.track)===null||l===void 0||l.on(F.TrackProcessorUpdate,this.onTrackProcessorUpdate),(d=u.track)===null||d===void 0||d.on(F.Restarted,this.onLocalTrackRestarted),(p=(h=(f=u.track)===null||f===void 0?void 0:f.getProcessor())===null||h===void 0?void 0:h.onPublish)===null||p===void 0||p.call(h,this),this.emit(B.LocalTrackPublished,u,this.localParticipant),!(u.track instanceof ve)){S.n=2;break}return S.n=1,u.track.checkForSilence();case 1:k=S.v,k&&this.emit(B.LocalAudioSilenceDetected,u);case 2:return S.n=3,(g=u.track)===null||g===void 0?void 0:g.getDeviceId(!1);case 3:y=S.v,T=Da(u.source),T&&y&&y!==this.localParticipant.activeDeviceMap.get(T)&&(this.localParticipant.activeDeviceMap.set(T,y),this.emit(B.ActiveDeviceChanged,T,y));case 4:return S.a(2)}},c,this)}))},e.onLocalTrackUnpublished=function(u){var c,l;(c=u.track)===null||c===void 0||c.off(F.TrackProcessorUpdate,e.onTrackProcessorUpdate),(l=u.track)===null||l===void 0||l.off(F.Restarted,e.onLocalTrackRestarted),e.emit(B.LocalTrackUnpublished,u,e.localParticipant)},e.onLocalTrackRestarted=function(u){return b(e,void 0,void 0,v().m(function c(){var l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return f.n=1,u.getDeviceId(!1);case 1:l=f.v,d=Da(u.source),d&&l&&l!==this.localParticipant.activeDeviceMap.get(d)&&(this.log.debug("local track restarted, setting ".concat(d," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(d,l),this.emit(B.ActiveDeviceChanged,d,l));case 2:return f.a(2)}},c,this)}))},e.onLocalConnectionQualityChanged=function(u){e.emit(B.ConnectionQualityChanged,u,e.localParticipant)},e.onMediaDevicesError=function(u){e.emit(B.MediaDevicesError,u)},e.onLocalParticipantPermissionsChanged=function(u){e.emit(B.ParticipantPermissionsChanged,u,e.localParticipant)},e.onLocalChatMessageSent=function(u){e.emit(B.ChatMessage,u,e.localParticipant)},e.setMaxListeners(100),e.remoteParticipants=new Map,e.sidToIdentity=new Map,e.options=Object.assign(Object.assign({},rl),i),e.log=xe((n=e.options.loggerName)!==null&&n!==void 0?n:_e.Room),e.transcriptionReceivedTimes=new Map,e.options.audioCaptureDefaults=Object.assign(Object.assign({},yo),i==null?void 0:i.audioCaptureDefaults),e.options.videoCaptureDefaults=Object.assign(Object.assign({},bo),i==null?void 0:i.videoCaptureDefaults),e.options.publishDefaults=Object.assign(Object.assign({},il),i==null?void 0:i.publishDefaults),e.maybeCreateEngine(),e.disconnectLock=new Ie,e.localParticipant=new es("","",e.engine,e.options),e.options.videoCaptureDefaults.deviceId&&e.localParticipant.activeDeviceMap.set("videoinput",mn(e.options.videoCaptureDefaults.deviceId)),e.options.audioCaptureDefaults.deviceId&&e.localParticipant.activeDeviceMap.set("audioinput",mn(e.options.audioCaptureDefaults.deviceId)),!((a=e.options.audioOutput)===null||a===void 0)&&a.deviceId&&e.switchActiveDevice("audiooutput",mn(e.options.audioOutput.deviceId)).catch(function(u){return e.log.warn("Could not set audio output: ".concat(u.message),e.logContext)}),e.options.e2ee&&e.setupE2EE(),we()){var o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",e.handleDeviceChange,{signal:o.signal}),t.cleanupRegistry&&t.cleanupRegistry.register(e,function(){o.abort()})}return e}return N(t,r),E(t,[{key:"setE2EEEnabled",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(!this.e2eeManager){a.n=2;break}return a.n=1,Promise.all([this.localParticipant.setE2EEEnabled(e)]);case 1:this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity),a.n=3;break;case 2:throw Error("e2ee not configured, please set e2ee settings within the room options");case 3:return a.a(2)}},n,this)}))}},{key:"setupE2EE",value:function(){var e=this,n;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new Vc(this.options.e2ee),this.e2eeManager.on(an.ParticipantEncryptionStatusChanged,function(a,s){s instanceof es&&(e.isE2EEEnabled=a),e.emit(B.ParticipantEncryptionStatusChanged,a,s)}),this.e2eeManager.on(an.EncryptionError,function(a){return e.emit(B.EncryptionError,a)}),(n=this.e2eeManager)===null||n===void 0||n.setup(this))}},{key:"logContext",get:function(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}},{key:"isRecording",get:function(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}},{key:"getSid",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this;return v().w(function(a){for(;;)switch(a.n){case 0:if(this.state!==ee.Disconnected){a.n=1;break}return a.a(2,"");case 1:if(!(this.roomInfo&&this.roomInfo.sid!=="")){a.n=2;break}return a.a(2,this.roomInfo.sid);case 2:return a.a(2,new Promise(function(s,o){var u=function(l){l.sid!==""&&(n.engine.off(_.RoomUpdate,u),s(l.sid))};n.engine.on(_.RoomUpdate,u),n.once(B.Disconnected,function(){n.engine.off(_.RoomUpdate,u),o("Room disconnected before room server id was available")})}))}},e,this)}))}},{key:"name",get:function(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}},{key:"metadata",get:function(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}},{key:"numParticipants",get:function(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}},{key:"numPublishers",get:function(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}},{key:"maybeCreateEngine",value:function(){var e=this;if(!(this.engine&&!this.engine.isClosed)){var n=0;this.engine=new pl(this.options),this.engine.on(_.ParticipantUpdate,this.handleParticipantUpdates).on(_.RoomUpdate,this.handleRoomUpdate).on(_.SpeakersChanged,this.handleSpeakersChanged).on(_.StreamStateChanged,this.handleStreamStateUpdate).on(_.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(_.SubscriptionError,this.handleSubscriptionError).on(_.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(_.MediaTrackAdded,function(a,s,o){e.onTrackAdded(a,s,o)}).on(_.Disconnected,function(a){e.handleDisconnect(e.options.stopLocalTrackOnUnpublish,a)}).on(_.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(_.DataPacketReceived,this.handleDataPacket).on(_.Resuming,function(){e.clearConnectionReconcile(),e.isResuming=!0,e.log.info("Resuming signal connection",e.logContext),e.setAndEmitConnectionState(ee.SignalReconnecting)&&e.emit(B.SignalReconnecting)}).on(_.Resumed,function(){e.registerConnectionReconcile(),e.isResuming=!1,e.log.info("Resumed signal connection",e.logContext),e.updateSubscriptions(),e.emitBufferedEvents(),e.setAndEmitConnectionState(ee.Connected)&&e.emit(B.Reconnected)}).on(_.SignalResumed,function(){e.bufferedEvents=[],(e.state===ee.Reconnecting||e.isResuming)&&e.sendSyncState()}).on(_.Restarting,this.handleRestarting).on(_.SignalRestarted,this.handleSignalRestarted).on(_.Offline,function(){e.setAndEmitConnectionState(ee.Reconnecting)&&e.emit(B.Reconnecting)}).on(_.DCBufferStatusChanged,function(a,s){e.emit(B.DCBufferStatusChanged,a,s)}).on(_.PrimaryDelay,function(a){n=Math.max(n,a)}).on(_.SecondaryDelay,function(a){n=Math.max(n,a),e.emit(B.ReconnectICEDelay,n/1e3),n=0}).on(_.LocalTrackSubscribed,function(a){var s=e.localParticipant.getTrackPublications().find(function(o){var u=o.trackSid;return u===a});if(!s){e.log.warn("could not find local track subscription for subscribed event",e.logContext);return}e.localParticipant.emit(q.LocalTrackSubscribed,s),e.emitWhenConnected(B.LocalTrackSubscribed,s,e.localParticipant)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine)}}},{key:"prepareConnection",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s,o;return v().w(function(u){for(;;)switch(u.n){case 0:if(this.state===ee.Disconnected){u.n=1;break}return u.a(2);case 1:if(this.log.debug("prepareConnection to ".concat(e),this.logContext),u.p=2,!(Dr(new URL(e))&&n)){u.n=6;break}return this.regionUrlProvider=new Za(e,n),u.n=3,this.regionUrlProvider.getNextBestRegionUrl();case 3:if(s=u.v,!(s&&this.state===ee.Disconnected)){u.n=5;break}return this.regionUrl=s,u.n=4,fetch(Ba(s),{method:"HEAD"});case 4:this.log.debug("prepared connection to ".concat(s),this.logContext);case 5:u.n=7;break;case 6:return u.n=7,fetch(Ba(e),{method:"HEAD"});case 7:u.n=9;break;case 8:u.p=8,o=u.v,this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:o}));case 9:return u.a(2)}},a,this,[[2,8]])}))}},{key:"getParticipantByIdentity",value:function(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}},{key:"clearConnectionFutures",value:function(){this.connectFuture=void 0}},{key:"simulateScenario",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s=this,o,u,c;return v().w(function(l){for(;;)switch(l.n){case 0:o=function(){},c=e,l.n=c==="signal-reconnect"?1:c==="speaker"?3:c==="node-failure"?4:c==="server-leave"?5:c==="migration"?6:c==="resume-reconnect"?7:c==="disconnect-signal-on-resume"?9:c==="disconnect-signal-on-resume-no-messages"?10:c==="full-reconnect"?11:c==="force-tcp"||c==="force-tls"?13:c==="subscriber-bandwidth"?14:c==="leave-full-reconnect"?16:17;break;case 1:return l.n=2,this.engine.client.handleOnClose("simulate disconnect");case 2:return l.a(3,17);case 3:return u=new Ee({scenario:{case:"speakerUpdate",value:3}}),l.a(3,17);case 4:return u=new Ee({scenario:{case:"nodeFailure",value:!0}}),l.a(3,17);case 5:return u=new Ee({scenario:{case:"serverLeave",value:!0}}),l.a(3,17);case 6:return u=new Ee({scenario:{case:"migration",value:!0}}),l.a(3,17);case 7:return this.engine.failNext(),l.n=8,this.engine.client.handleOnClose("simulate resume-disconnect");case 8:return l.a(3,17);case 9:return o=function(){return b(s,void 0,void 0,v().m(function f(){return v().w(function(h){for(;;)switch(h.n){case 0:return h.n=1,this.engine.client.handleOnClose("simulate resume-disconnect");case 1:return h.a(2)}},f,this)}))},u=new Ee({scenario:{case:"disconnectSignalOnResume",value:!0}}),l.a(3,17);case 10:return o=function(){return b(s,void 0,void 0,v().m(function f(){return v().w(function(h){for(;;)switch(h.n){case 0:return h.n=1,this.engine.client.handleOnClose("simulate resume-disconnect");case 1:return h.a(2)}},f,this)}))},u=new Ee({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}}),l.a(3,17);case 11:return this.engine.fullReconnectOnNext=!0,l.n=12,this.engine.client.handleOnClose("simulate full-reconnect");case 12:return l.a(3,17);case 13:return u=new Ee({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),o=function(){return b(s,void 0,void 0,v().m(function f(){var h;return v().w(function(p){for(;;)switch(p.n){case 0:h=this.engine.client.onLeave,h&&h(new bn({reason:be.CLIENT_INITIATED,action:Ve.RECONNECT}));case 1:return p.a(2)}},f,this)}))},l.a(3,17);case 14:if(!(n===void 0||typeof n!="number")){l.n=15;break}throw new Error("subscriber-bandwidth requires a number as argument");case 15:return u=new Ee({scenario:{case:"subscriberBandwidth",value:BigInt(n)}}),l.a(3,17);case 16:u=new Ee({scenario:{case:"leaveRequestFullReconnect",value:!0}});case 17:if(!u){l.n=19;break}return l.n=18,this.engine.client.sendSimulateScenario(u);case 18:return l.n=19,o();case 19:return l.a(2)}},a,this)}))}},{key:"canPlaybackAudio",get:function(){return this.audioEnabled}},{key:"canPlaybackVideo",get:function(){return!this.isVideoPlaybackBlocked}},{key:"getActiveDevice",value:function(e){return this.localParticipant.activeDeviceMap.get(e)}},{key:"switchActiveDevice",value:function(e,n){return b(this,arguments,void 0,function(a,s){var o=this,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return v().m(function c(){var l,d,f,h,p,g,k,y,T,S,w,C,I,R,L,M,H,U,W,Y,X,G;return v().w(function(K){for(;;)switch(K.n){case 0:if(T=!0,S=!1,w=u?{exact:s}:s,a!=="audioinput"){K.n=5;break}return S=o.localParticipant.audioTrackPublications.size===0,C=(l=o.getActiveDevice(a))!==null&&l!==void 0?l:o.options.audioCaptureDefaults.deviceId,o.options.audioCaptureDefaults.deviceId=w,I=Array.from(o.localParticipant.audioTrackPublications.values()).filter(function($){return $.source===A.Source.Microphone}),K.p=1,K.n=2,Promise.all(I.map(function($){var he;return(he=$.audioTrack)===null||he===void 0?void 0:he.setDeviceId(w)}));case 2:T=K.v.every(function($){return $===!0}),K.n=4;break;case 3:throw K.p=3,H=K.v,o.options.audioCaptureDefaults.deviceId=C,H;case 4:K.n=20;break;case 5:if(a!=="videoinput"){K.n=10;break}return S=o.localParticipant.videoTrackPublications.size===0,R=(d=o.getActiveDevice(a))!==null&&d!==void 0?d:o.options.videoCaptureDefaults.deviceId,o.options.videoCaptureDefaults.deviceId=w,L=Array.from(o.localParticipant.videoTrackPublications.values()).filter(function($){return $.source===A.Source.Camera}),K.p=6,K.n=7,Promise.all(L.map(function($){var he;return(he=$.videoTrack)===null||he===void 0?void 0:he.setDeviceId(w)}));case 7:T=K.v.every(function($){return $===!0}),K.n=9;break;case 8:throw K.p=8,U=K.v,o.options.videoCaptureDefaults.deviceId=R,U;case 9:K.n=20;break;case 10:if(a!=="audiooutput"){K.n=20;break}if(!(!Nr()&&!o.options.webAudioMix||o.options.webAudioMix&&o.audioContext&&!("setSinkId"in o.audioContext))){K.n=11;break}throw new Error("cannot switch audio output, setSinkId not supported");case 11:if(!o.options.webAudioMix){K.n=16;break}return K.n=12,Je.getInstance().normalizeDeviceId("audiooutput",s);case 12:if(Y=f=K.v,W=Y!==null,!W){K.n=13;break}W=f!==void 0;case 13:if(!W){K.n=14;break}X=f,K.n=15;break;case 14:X="";case 15:s=X;case 16:return(h=(y=o.options).audioOutput)!==null&&h!==void 0||(y.audioOutput={}),M=(p=o.getActiveDevice(a))!==null&&p!==void 0?p:o.options.audioOutput.deviceId,o.options.audioOutput.deviceId=s,K.p=17,o.options.webAudioMix&&((g=o.audioContext)===null||g===void 0||g.setSinkId(s)),K.n=18,Promise.all(Array.from(o.remoteParticipants.values()).map(function($){return $.setAudioOutput({deviceId:s})}));case 18:K.n=20;break;case 19:throw K.p=19,G=K.v,o.options.audioOutput.deviceId=M,G;case 20:return(S||a==="audiooutput")&&(o.localParticipant.activeDeviceMap.set(a,a==="audiooutput"&&((k=o.options.audioOutput)===null||k===void 0?void 0:k.deviceId)||s),o.emit(B.ActiveDeviceChanged,a,s)),K.a(2,T)}},c,null,[[17,19],[6,8],[1,3]])})()})}},{key:"setupLocalParticipantEvents",value:function(){this.localParticipant.on(q.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(q.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(q.AttributesChanged,this.onLocalAttributesChanged).on(q.TrackMuted,this.onLocalTrackMuted).on(q.TrackUnmuted,this.onLocalTrackUnmuted).on(q.LocalTrackPublished,this.onLocalTrackPublished).on(q.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(q.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(q.MediaDevicesError,this.onMediaDevicesError).on(q.AudioStreamAcquired,this.startAudio).on(q.ChatMessage,this.onLocalChatMessageSent).on(q.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}},{key:"recreateEngine",value:function(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}},{key:"onTrackAdded",value:function(e,n,a){var s=this;if(this.state===ee.Connecting||this.state===ee.Reconnecting){var o=function(){s.onTrackAdded(e,n,a),u()},u=function(){s.off(B.Reconnected,o),s.off(B.Connected,o),s.off(B.Disconnected,u)};this.once(B.Reconnected,o),this.once(B.Connected,o),this.once(B.Disconnected,u);return}if(this.state===ee.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}var c=Ic(n.id),l=c[0],d=c[1],f=e.id;if(d&&d.startsWith("TR")&&(f=d),l===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}var h=Array.from(this.remoteParticipants.values()).find(function(g){return g.sid===l});if(!h){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(l),this.logContext);return}var p;this.options.adaptiveStream&&(j(this.options.adaptiveStream)==="object"?p=this.options.adaptiveStream:p={}),h.addSubscribedMediaTrack(e,f,n,a,p)}},{key:"handleDisconnect",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,a=arguments.length>1?arguments[1]:void 0,s;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==ee.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(function(o){o.trackPublications.forEach(function(u){o.unpublishTrack(u.trackSid)})}),this.localParticipant.trackPublications.forEach(function(o){var u,c,l;o.track&&e.localParticipant.unpublishTrack(o.track,n),n?((u=o.track)===null||u===void 0||u.detach(),(c=o.track)===null||c===void 0||c.stop()):(l=o.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off(q.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(q.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(q.AttributesChanged,this.onLocalAttributesChanged).off(q.TrackMuted,this.onLocalTrackMuted).off(q.TrackUnmuted,this.onLocalTrackUnmuted).off(q.LocalTrackPublished,this.onLocalTrackPublished).off(q.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(q.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(q.MediaDevicesError,this.onMediaDevicesError).off(q.AudioStreamAcquired,this.startAudio).off(q.ChatMessage,this.onLocalChatMessageSent).off(q.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),we()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(s=navigator.mediaDevices)===null||s===void 0||s.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ee.Disconnected),this.emit(B.Disconnected,a)}}}},{key:"handleParticipantDisconnected",value:function(e,n){var a;this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(function(s){n.unpublishTrack(s.trackSid,!0)}),this.emit(B.ParticipantDisconnected,n),(a=this.localParticipant)===null||a===void 0||a.handleParticipantDisconnected(n.identity))}},{key:"acquireAudioContext",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this,a,s,o,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(a=Zr())!==null&&a!==void 0?a:void 0),!(this.audioContext&&this.audioContext.state==="suspended")){c.n=4;break}return c.p=1,c.n=2,this.audioContext.resume();case 2:c.n=4;break;case 3:c.p=3,u=c.v,this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:u}));case 4:this.options.webAudioMix&&this.remoteParticipants.forEach(function(l){return l.setAudioContext(n.audioContext)}),this.localParticipant.setAudioContext(this.audioContext),o=((s=this.audioContext)===null||s===void 0?void 0:s.state)==="running",o!==this.canPlaybackAudio&&(this.audioEnabled=o,this.emit(B.AudioPlaybackStatusChanged,o));case 5:return c.a(2)}},e,this,[[1,3]])}))}},{key:"createParticipant",value:function(e,n){var a=this,s,o;return n?o=ns.fromParticipantInfo(this.engine.client,n,{loggerContextCb:function(){return a.logContext},loggerName:this.options.loggerName}):o=new ns(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:function(){return a.logContext},loggerName:this.options.loggerName}),this.options.webAudioMix&&o.setAudioContext(this.audioContext),!((s=this.options.audioOutput)===null||s===void 0)&&s.deviceId&&o.setAudioOutput(this.options.audioOutput).catch(function(u){return a.log.warn("Could not set audio output: ".concat(u.message),a.logContext)}),o}},{key:"getOrCreateParticipant",value:function(e,n){var a=this;if(this.remoteParticipants.has(e)){var s=this.remoteParticipants.get(e);if(n){var o=s.updateInfo(n);o&&this.sidToIdentity.set(n.sid,n.identity)}return s}var u=this.createParticipant(e,n);return this.remoteParticipants.set(e,u),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(B.ParticipantConnected,u),u.on(q.TrackPublished,function(c){a.emitWhenConnected(B.TrackPublished,c,u)}).on(q.TrackSubscribed,function(c,l){c.kind===A.Kind.Audio?(c.on(F.AudioPlaybackStarted,a.handleAudioPlaybackStarted),c.on(F.AudioPlaybackFailed,a.handleAudioPlaybackFailed)):c.kind===A.Kind.Video&&(c.on(F.VideoPlaybackFailed,a.handleVideoPlaybackFailed),c.on(F.VideoPlaybackStarted,a.handleVideoPlaybackStarted)),a.emit(B.TrackSubscribed,c,l,u)}).on(q.TrackUnpublished,function(c){a.emit(B.TrackUnpublished,c,u)}).on(q.TrackUnsubscribed,function(c,l){a.emit(B.TrackUnsubscribed,c,l,u)}).on(q.TrackSubscriptionFailed,function(c){a.emit(B.TrackSubscriptionFailed,c,u)}).on(q.TrackMuted,function(c){a.emitWhenConnected(B.TrackMuted,c,u)}).on(q.TrackUnmuted,function(c){a.emitWhenConnected(B.TrackUnmuted,c,u)}).on(q.ParticipantMetadataChanged,function(c){a.emitWhenConnected(B.ParticipantMetadataChanged,c,u)}).on(q.ParticipantNameChanged,function(c){a.emitWhenConnected(B.ParticipantNameChanged,c,u)}).on(q.AttributesChanged,function(c){a.emitWhenConnected(B.ParticipantAttributesChanged,c,u)}).on(q.ConnectionQualityChanged,function(c){a.emitWhenConnected(B.ConnectionQualityChanged,c,u)}).on(q.ParticipantPermissionsChanged,function(c){a.emitWhenConnected(B.ParticipantPermissionsChanged,c,u)}).on(q.TrackSubscriptionStatusChanged,function(c,l){a.emitWhenConnected(B.TrackSubscriptionStatusChanged,c,l,u)}).on(q.TrackSubscriptionFailed,function(c,l){a.emit(B.TrackSubscriptionFailed,c,u,l)}).on(q.TrackSubscriptionPermissionChanged,function(c,l){a.emitWhenConnected(B.TrackSubscriptionPermissionChanged,c,l,u)}),n&&u.updateInfo(n),u}},{key:"sendSyncState",value:function(){var e=Array.from(this.remoteParticipants.values()).reduce(function(a,s){return a.push.apply(a,Oe(s.getTrackPublications())),a},[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}},{key:"updateSubscriptions",value:function(){var e=z(this.remoteParticipants.values()),n;try{for(e.s();!(n=e.n()).done;){var a=n.value,s=z(a.videoTrackPublications.values()),o;try{for(s.s();!(o=s.n()).done;){var u=o.value;u.isSubscribed&&u instanceof Ro&&u.emitTrackUpdate()}}catch(c){s.e(c)}finally{s.f()}}}catch(c){e.e(c)}finally{e.f()}}},{key:"getRemoteParticipantBySid",value:function(e){var n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}},{key:"registerConnectionReconcile",value:function(){var e=this;this.clearConnectionReconcile();var n=0;this.connectionReconcileInterval=pe.setInterval(function(){!e.engine||e.engine.isClosed||!e.engine.verifyTransport()?(n++,e.log.warn("detected connection state mismatch",Object.assign(Object.assign({},e.logContext),{numFailures:n,engine:e.engine?{closed:e.engine.isClosed,transportsConnected:e.engine.verifyTransport()}:void 0})),n>=3&&(e.recreateEngine(),e.handleDisconnect(e.options.stopLocalTrackOnUnpublish,be.STATE_MISMATCH))):n=0},Cl)}},{key:"clearConnectionReconcile",value:function(){this.connectionReconcileInterval&&pe.clearInterval(this.connectionReconcileInterval)}},{key:"setAndEmitConnectionState",value:function(e){return e===this.state?!1:(this.state=e,this.emit(B.ConnectionStateChanged,this.state),!0)}},{key:"emitBufferedEvents",value:function(){var e=this;this.bufferedEvents.forEach(function(n){var a=x(n,2),s=a[0],o=a[1];e.emit.apply(e,[s].concat(Oe(o)))}),this.bufferedEvents=[]}},{key:"emitWhenConnected",value:function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];if(this.state===ee.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,a]);else if(this.state===ee.Connected)return this.emit.apply(this,[e].concat(a));return!1}},{key:"simulateParticipants",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,o,u,c,l,d,f,h,p,g,k,y,T,S,w,C,I,R,L,M,H,U,W,Y,X,G,K,$,he,Ae,Cn,dn,nn,Yn;return v().w(function(ge){for(;;)switch(ge.n){case 0:if(u=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),c=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants),this.handleDisconnect(),this.roomInfo=new Vn({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:V.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new un({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(B.SignalConnected),this.emit(B.Connected),this.setAndEmitConnectionState(ee.Connected),!u.video){ge.n=4;break}if(S=ai,w=A.Kind.Video,C=new $e({source:ue.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ke.AUDIO,name:"video-dummy"}),I=me,!u.useRealTracks){ge.n=2;break}return ge.n=1,window.navigator.mediaDevices.getUserMedia({video:!0});case 1:R=ge.v.getVideoTracks()[0],ge.n=3;break;case 2:R=Ja(160*((s=c.aspectRatios[0])!==null&&s!==void 0?s:1),160,!0,!0);case 3:L=R,M=void 0,H={loggerName:this.options.loggerName,loggerContextCb:function(){return a.logContext}},U=new I(L,M,!1,H),W={loggerName:this.options.loggerName,loggerContextCb:function(){return a.logContext}},l=new S(w,C,U,W),this.localParticipant.addTrackPublication(l),this.localParticipant.emit(q.LocalTrackPublished,l);case 4:if(!u.audio){ge.n=8;break}if(Y=ai,X=A.Kind.Audio,G=new $e({source:ue.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ke.AUDIO}),K=ve,!u.useRealTracks){ge.n=6;break}return ge.n=5,navigator.mediaDevices.getUserMedia({audio:!0});case 5:$=ge.v.getAudioTracks()[0],ge.n=7;break;case 6:$=tr();case 7:he=$,Ae=void 0,Cn=this.audioContext,dn={loggerName:this.options.loggerName,loggerContextCb:function(){return a.logContext}},nn=new K(he,Ae,!1,Cn,dn),Yn={loggerName:this.options.loggerName,loggerContextCb:function(){return a.logContext}},d=new Y(X,G,nn,Yn),this.localParticipant.addTrackPublication(d),this.localParticipant.emit(q.LocalTrackPublished,d);case 8:for(f=0;f<c.count-1;f+=1)h=new un({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(f),state:gn.ACTIVE,tracks:[],joinedAt:V.parse(Date.now())}),p=this.getOrCreateParticipant(h.identity,h),c.video&&(g=Ja(160*((o=c.aspectRatios[f%c.aspectRatios.length])!==null&&o!==void 0?o:1),160,!1,!0),k=new $e({source:ue.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ke.AUDIO}),p.addSubscribedMediaTrack(g,k.sid,new MediaStream([g]),new RTCRtpReceiver),h.tracks=[].concat(Oe(h.tracks),[k])),c.audio&&(y=tr(),T=new $e({source:ue.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ke.AUDIO}),p.addSubscribedMediaTrack(y,T.sid,new MediaStream([y]),new RTCRtpReceiver),h.tracks=[].concat(Oe(h.tracks),[T])),p.updateInfo(h);case 9:return ge.a(2)}},n,this)}))}},{key:"emit",value:function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];if(e!==B.ActiveSpeakersChanged){var o=Oo(a).filter(function(u){return u!==void 0});this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return Q(t,"emit",this,3)([e].concat(a))}}],[{key:"getLocalDevices",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Je.getInstance().getDevices(e,n)}}])}(He.EventEmitter);Io.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(function(r){r()});function Oo(r){return r.map(function(t){if(t)return Array.isArray(t)?Oo(t):j(t)==="object"?"logContext"in t&&t.logContext:t})}var Ue;(function(r){r[r.IDLE=0]="IDLE",r[r.RUNNING=1]="RUNNING",r[r.SKIPPED=2]="SKIPPED",r[r.SUCCESS=3]="SUCCESS",r[r.FAILED=4]="FAILED"})(Ue||(Ue={}));var Kn=function(r){function t(i,e){var n,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return P(this,t),n=O(this,t),n.status=Ue.IDLE,n.logs=[],n.errorsAsWarnings=!1,n.url=i,n.token=e,n.name=n.constructor.name,n.room=new Io(a.roomOptions),n.connectOptions=a.connectOptions,a.errorsAsWarnings&&(n.errorsAsWarnings=a.errorsAsWarnings),n}return N(t,r),E(t,[{key:"run",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a;return v().w(function(s){for(;;)switch(s.n){case 0:if(this.status===Ue.IDLE){s.n=1;break}throw Error("check is running already");case 1:return this.setStatus(Ue.RUNNING),s.p=2,s.n=3,this.perform();case 3:s.n=5;break;case 4:s.p=4,a=s.v,a instanceof Error&&(this.errorsAsWarnings?this.appendWarning(a.message):this.appendError(a.message));case 5:return s.n=6,this.disconnect();case 6:return s.n=7,new Promise(function(o){return setTimeout(o,500)});case 7:return this.status!==Ue.SKIPPED&&this.setStatus(this.isSuccess()?Ue.SUCCESS:Ue.FAILED),e&&e(),s.a(2,this.getInfo())}},n,this,[[2,4]])}))}},{key:"isSuccess",value:function(){return!this.logs.some(function(e){return e.level==="error"})}},{key:"connect",value:function(){return b(this,void 0,void 0,v().m(function e(){return v().w(function(n){for(;;)switch(n.n){case 0:if(this.room.state!==ee.Connected){n.n=1;break}return n.a(2,this.room);case 1:return n.n=2,this.room.connect(this.url,this.token,this.connectOptions);case 2:return n.a(2,this.room)}},e,this)}))}},{key:"disconnect",value:function(){return b(this,void 0,void 0,v().m(function e(){return v().w(function(n){for(;;)switch(n.n){case 0:if(!(this.room&&this.room.state!==ee.Disconnected)){n.n=2;break}return n.n=1,this.room.disconnect();case 1:return n.n=2,new Promise(function(a){return setTimeout(a,500)});case 2:return n.a(2)}},e,this)}))}},{key:"skip",value:function(){this.setStatus(Ue.SKIPPED)}},{key:"appendMessage",value:function(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}},{key:"appendWarning",value:function(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}},{key:"appendError",value:function(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}},{key:"setStatus",value:function(e){this.status=e,this.emit("update",this.getInfo())}},{key:"engine",get:function(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}},{key:"getInfo",value:function(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}])}(He.EventEmitter);function No(r){return b(this,void 0,void 0,v().m(function t(){var i=this,e,n,a,s,o,u,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return r??(r={}),(e=r.audio)!==null&&e!==void 0||(r.audio={deviceId:"default"}),(n=r.video)!==null&&n!==void 0||(r.video={deviceId:"default"}),a=$r(r),s=a.audioProcessor,o=a.videoProcessor,u=lo(r,yo,bo),c=Ki(u),l=navigator.mediaDevices.getUserMedia(c),r.audio&&(Je.userMediaPromiseMap.set("audioinput",l),l.catch(function(){return Je.userMediaPromiseMap.delete("audioinput")})),r.video&&(Je.userMediaPromiseMap.set("videoinput",l),l.catch(function(){return Je.userMediaPromiseMap.delete("videoinput")})),f.n=1,l;case 1:return d=f.v,f.a(2,Promise.all(d.getTracks().map(function(h){return b(i,void 0,void 0,v().m(function p(){var g,k,y,T;return v().w(function(S){for(;;)switch(S.n){case 0:if(g=h.kind==="audio",g?u.audio:u.video,y=g?c.audio:c.video,typeof y!="boolean"&&(k=y),k?k.deviceId=h.getSettings().deviceId:k={deviceId:h.getSettings().deviceId},T=To(h,k),T.kind===A.Kind.Video?T.source=A.Source.Camera:T.kind===A.Kind.Audio&&(T.source=A.Source.Microphone),T.mediaStream=d,!(T instanceof ve&&s)){S.n=2;break}return S.n=1,T.setProcessor(s);case 1:S.n=3;break;case 2:if(!(T instanceof me&&o)){S.n=3;break}return S.n=3,T.setProcessor(o);case 3:return S.a(2,T)}},p)}))})))}},t)}))}function wl(r){return b(this,void 0,void 0,v().m(function t(){var i;return v().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,No({audio:!1,video:r});case 1:return i=e.v,e.a(2,i[0])}},t)}))}function Pl(r){return b(this,void 0,void 0,v().m(function t(){var i;return v().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,No({audio:r,video:!1});case 1:return i=e.v,e.a(2,i[0])}},t)}))}var El=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Can publish audio"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,o,u;return v().w(function(c){for(;;)switch(c.n){case 0:return c.n=1,this.connect();case 1:return a=c.v,c.n=2,Pl();case 2:return s=c.v,a.localParticipant.publishTrack(s),c.n=3,new Promise(function(l){return setTimeout(l,3e3)});case 3:return c.n=4,(n=s.sender)===null||n===void 0?void 0:n.getStats();case 4:if(o=c.v,o){c.n=5;break}throw new Error("Could not get RTCStats");case 5:if(u=0,o.forEach(function(l){l.type==="outbound-rtp"&&(l.kind==="audio"||!l.kind&&l.mediaType)}),u!==0){c.n=6;break}throw new Error("Could not determine packets are sent");case 6:this.appendMessage("published ".concat(u," audio packets"));case 7:return c.a(2)}},e,this)}))}}])}(Kn),Rl=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Can publish video"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,o,u;return v().w(function(c){for(;;)switch(c.n){case 0:return c.n=1,this.connect();case 1:return a=c.v,c.n=2,wl();case 2:return s=c.v,a.localParticipant.publishTrack(s),c.n=3,new Promise(function(l){return setTimeout(l,5e3)});case 3:return c.n=4,(n=s.sender)===null||n===void 0?void 0:n.getStats();case 4:if(o=c.v,o){c.n=5;break}throw new Error("Could not get RTCStats");case 5:if(u=0,o.forEach(function(l){l.type==="outbound-rtp"&&(l.kind==="video"||!l.kind&&l.mediaType==="video")&&(u+=l.packetsSent)}),u!==0){c.n=6;break}throw new Error("Could not determine packets are sent");case 6:this.appendMessage("published ".concat(u," video packets"));case 7:return c.a(2)}},e,this)}))}}])}(Kn),Il=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Resuming connection after interruption"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,o,u,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return f.n=1,this.connect();case 1:return a=f.v,s=!1,o=!1,c=new Promise(function(h){setTimeout(h,5e3),u=h}),l=function(){s=!0},a.on(B.SignalReconnecting,l).on(B.Reconnecting,l).on(B.Reconnected,function(){o=!0,u(!0)}),(n=a.engine.client.ws)===null||n===void 0||n.close(),d=a.engine.client.onClose,d&&d(""),f.n=2,c;case 2:if(s){f.n=3;break}throw new Error("Did not attempt to reconnect");case 3:if(!(!o||a.state!==ee.Connected)){f.n=4;break}throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect");case 4:return f.a(2)}},e,this)}))}}])}(Kn),Ol=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Can connect via TURN"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,o,u,c,l,d,f,h,p,g,k;return v().w(function(y){for(;;)switch(y.n){case 0:return s=new xr,y.n=1,s.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});case 1:o=y.v,u=!1,c=!1,l=!1,d=z(o.iceServers);try{for(d.s();!(f=d.n()).done;){h=f.value,p=z(h.urls);try{for(p.s();!(g=p.n()).done;)k=g.value,k.startsWith("turn:")?(c=!0,l=!0):k.startsWith("turns:")&&(c=!0,l=!0,u=!0),k.startsWith("stun:")&&(l=!0)}catch(T){p.e(T)}finally{p.f()}}}catch(T){d.e(T)}finally{d.f()}return l?c&&!u&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),y.n=2,s.close();case 2:if(!(!((a=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||a===void 0)&&a.iceServers||c)){y.n=4;break}return y.n=3,this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}});case 3:y.n=5;break;case 4:return this.appendWarning("No TURN servers configured."),this.skip(),y.n=5,new Promise(function(T){return setTimeout(T,0)});case 5:return y.a(2)}},e,this)}))}}])}(Kn),Nl=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Establishing WebRTC connection"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this,a,s,o;return v().w(function(u){for(;;)switch(u.n){case 0:return a=!1,s=!1,this.room.on(B.SignalConnected,function(){var c=n.room.engine.client.onTrickle;n.room.engine.client.onTrickle=function(l,d){if(l.candidate){var f=new RTCIceCandidate(l),h="".concat(f.protocol," ").concat(f.address,":").concat(f.port," ").concat(f.type);f.address&&(Dl(f.address)?h+=" (private)":f.protocol==="tcp"&&f.tcpType==="passive"?(a=!0,h+=" (passive)"):f.protocol==="udp"&&(s=!0)),n.appendMessage(h)}c&&c(l,d)},n.room.engine.pcManager&&(n.room.engine.pcManager.subscriber.onIceCandidateError=function(l){l instanceof RTCPeerConnectionIceErrorEvent&&n.appendWarning("error with ICE candidate: ".concat(l.errorCode," ").concat(l.errorText," ").concat(l.url))})}),u.p=1,u.n=2,this.connect();case 2:Z.info("now the room is connected"),u.n=4;break;case 3:throw u.p=3,o=u.v,this.appendWarning("ports need to be open on firewall in order to connect."),o;case 4:a||this.appendWarning("Server is not configured for ICE/TCP"),s||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly");case 5:return u.a(2)}},e,this,[[1,3]])}))}}])}(Kn);function Dl(r){var t=r.split(".");if(t.length===4){if(t[0]==="10")return!0;if(t[0]==="192"&&t[1]==="168")return!0;if(t[0]==="172"){var i=parseInt(t[1],10);if(i>=16&&i<=31)return!0}}return!1}var Al=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Connecting to signal connection via WebSocket"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,o,u;return v().w(function(c){for(;;)switch(c.n){case 0:return(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it"),o=new xr,c.n=1,o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});case 1:return u=c.v,this.appendMessage("Connected to server, version ".concat(u.serverVersion,".")),((n=u.serverInfo)===null||n===void 0?void 0:n.edition)===Jn.Cloud&&(!((a=u.serverInfo)===null||a===void 0)&&a.region)&&this.appendMessage("LiveKit Cloud: ".concat((s=u.serverInfo)===null||s===void 0?void 0:s.region)),c.n=2,o.close();case 2:return c.a(2)}},e,this)}))}}])}(Kn);He.EventEmitter;export{rn as C,Ll as E,ve as L,ii as M,q as P,Io as R,Xr as S,A as T,Ne as V,B as a,pt as b,Ul as c,vr as d,Nc as e,Oc as f,es as g,ns as h,ee as i,ut as j,Ml as s};
