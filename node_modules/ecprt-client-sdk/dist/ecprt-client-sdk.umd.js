!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).EcprtClientSdk={})}(this,function(e){"use strict";function t(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function i(e,t,n){return t=d(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,f()?Reflect.construct(t,n||[],d(e).constructor):t.apply(e,n))}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,b(i.key),i)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=S(e))||t){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function c(e,t,n){return(t=b(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},u.apply(null,arguments)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(f=function(){return!!e})()}function h(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,t,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function a(n,i,r,a){var c=i&&i.prototype instanceof s?i:s,u=Object.create(c.prototype);return m(u,"_invoke",function(n,i,r){var a,s,c,u=0,d=r||[],l=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,o}};function h(n,i){for(s=n,c=i,t=0;!l&&u&&!r&&t<d.length;t++){var r,a=d[t],h=f.p,m=a[2];n>3?(r=m===i)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=h&&((r=n<2&&h<a[1])?(s=0,f.v=i,f.n=a[1]):h<m&&(r=n<3||a[0]>i||i>m)&&(a[4]=n,a[5]=i,f.n=m,s=0))}if(r||n>1)return o;throw l=!0,i}return function(r,d,m){if(u>1)throw TypeError("Generator is already running");for(l&&1===d&&h(d,m),s=d,c=m;(t=s<2?e:c)||!l;){a||(s?s<3?(s>1&&(f.n=-1),h(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(r="next"),t=a[r]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),s=1);a=e}else if((t=(l=f.n<0)?c:n.call(i,f))!==o)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:l}}}(n,r,a),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var d=[][i]?t(t([][i]())):(m(t={},i,function(){return this}),t),l=u.prototype=s.prototype=Object.create(d);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,m(e,r,"GeneratorFunction")),e.prototype=Object.create(l),e}return c.prototype=u,m(l,"constructor",u),m(u,"constructor",c),c.displayName="GeneratorFunction",m(u,r,"GeneratorFunction"),m(l),m(l,r,"Generator"),m(l,i,function(){return this}),m(l,"toString",function(){return"[object Generator]"}),(h=function(){return{w:a,m:f}})()}function m(e,t,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}m=function(e,t,n,i){if(t)r?r(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n;else{function a(t,n){m(e,t,function(e){return this._invoke(t,n,e)})}a("next",0),a("throw",1),a("return",2)}},m(e,t,n,i)}function v(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(typeof e+" is not iterable")}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw r}}return s}}(e,t)||S(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t,n,i){var r=u(d(1&i?e.prototype:e),t,n);return 2&i&&"function"==typeof r?function(e){return r.apply(n,e)}:r}function y(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function S(e,t){if(e){if("string"==typeof e)return n(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function w(e){var t="function"==typeof Map?new Map:void 0;return w=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(f())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var r=new(e.bind.apply(e,i));return n&&p(r,n.prototype),r}(e,arguments,d(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),p(n,e)},w(e)}function C(e,t){if(!e)throw new Error(t)}function E(e){if("number"!=typeof e)throw new Error("invalid int 32: "+T(e));if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function P(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+T(e));if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function R(e){if("number"!=typeof e)throw new Error("invalid float 32: "+T(e));if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}var I=Symbol("@bufbuild/protobuf/enum-type");function O(e){var t=e[I];return C(t,"missing enum type on enum object"),t}function N(e,t,n,i){e[I]=D(t,n.map(function(t){return{no:t.no,name:t.name,localName:e[t.no]}}))}function D(e,t,n){var i,r=Object.create(null),a=Object.create(null),o=[],c=s(t);try{for(c.s();!(i=c.n()).done;){var u=i.value,d=A(u);o.push(d),r[u.name]=d,a[u.no]=d}}catch(e){c.e(e)}finally{c.f()}return{typeName:e,values:o,findName:function(e){return r[e]},findNumber:function(e){return a[e]}}}function _(e,t,n){var i,r={},a=s(t);try{for(a.s();!(i=a.n()).done;){var o=A(i.value);r[o.localName]=o.no,r[o.no]=o.localName}}catch(e){a.e(e)}finally{a.f()}return N(r,e,t),r}function A(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}var L=function(){return o(function e(){r(this,e)},[{key:"equals",value:function(e){return this.getType().runtime.util.equals(this.getType(),this,e)}},{key:"clone",value:function(){return this.getType().runtime.util.clone(this)}},{key:"fromBinary",value:function(e,t){var n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}},{key:"fromJson",value:function(e,t){var n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}},{key:"fromJsonString",value:function(e,t){var n;try{n=JSON.parse(e)}catch(e){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(e instanceof Error?e.message:String(e)))}return this.fromJson(n,t)}},{key:"toBinary",value:function(e){var t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}},{key:"toJson",value:function(e){var t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}},{key:"toJsonString",value:function(e){var t,n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null==e?void 0:e.prettySpaces)&&void 0!==t?t:0)}},{key:"toJSON",value:function(){return this.toJson({emitDefaultValues:!0})}},{key:"getType",value:function(){return Object.getPrototypeOf(this).constructor}}])}();function x(){for(var e=0,t=0,n=0;n<28;n+=7){var i=this.buf[this.pos++];if(e|=(127&i)<<n,!(128&i))return this.assertBounds(),[e,t]}var r=this.buf[this.pos++];if(e|=(15&r)<<28,t=(112&r)>>4,!(128&r))return this.assertBounds(),[e,t];for(var a=3;a<=31;a+=7){var o=this.buf[this.pos++];if(t|=(127&o)<<a,!(128&o))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function M(e,t,n){for(var i=0;i<28;i+=7){var r=e>>>i,a=!(r>>>7==0&&0==t),o=255&(a?128|r:r);if(n.push(o),!a)return}var s=e>>>28&15|(7&t)<<4,c=!!(t>>3);if(n.push(255&(c?128|s:s)),c){for(var u=3;u<31;u+=7){var d=t>>>u,l=!(d>>>7==0),f=255&(l?128|d:d);if(n.push(f),!l)return}n.push(t>>>31&1)}}var U=4294967296;function j(e){var t="-"===e[0];t&&(e=e.slice(1));var n=1e6,i=0,r=0;function a(t,a){var o=Number(e.slice(t,a));r*=n,(i=i*n+o)>=U&&(r+=i/U|0,i%=U)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),t?J(i,r):B(i,r)}function F(e,t){var n=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t);if(e=n.lo,(t=n.hi)<=2097151)return String(U*t+e);var i=16777215&(e>>>24|t<<8),r=t>>16&65535,a=(16777215&e)+6777216*i+6710656*r,o=i+8147497*r,s=2*r,c=1e7;return a>=c&&(o+=Math.floor(a/c),a%=c),o>=c&&(s+=Math.floor(o/c),o%=c),s.toString()+q(o)+q(a)}function B(e,t){return{lo:0|e,hi:0|t}}function J(e,t){return t=~t,e?e=1+~e:t+=1,B(e,t)}var q=function(e){var t=String(e);return"0000000".slice(t.length)+t};function V(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(var n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function K(){var e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(t|=(127&(e=this.buf[this.pos++]))<<7,!(128&e))return this.assertBounds(),t;if(t|=(127&(e=this.buf[this.pos++]))<<14,!(128&e))return this.assertBounds(),t;if(t|=(127&(e=this.buf[this.pos++]))<<21,!(128&e))return this.assertBounds(),t;t|=(15&(e=this.buf[this.pos++]))<<28;for(var n=5;128&e&&n<10;n++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}var W,G,H,z=function(){var e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=("undefined"==typeof process?"undefined":T(process))||"object"!=T(process.env)||"1"!==process.env.BUF_BIGINT_DISABLE)){var t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse:function(e){var i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse:function(e){var t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc:function(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc:function(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:function(t,n){return e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)},uDec:function(t,n){return e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0)}}}var a=function(e){return C(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e))},o=function(e){return C(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e))};return{zero:"0",supported:!1,parse:function(e){return"string"!=typeof e&&(e=e.toString()),a(e),e},uParse:function(e){return"string"!=typeof e&&(e=e.toString()),o(e),e},enc:function(e){return"string"!=typeof e&&(e=e.toString()),a(e),j(e)},uEnc:function(e){return"string"!=typeof e&&(e=e.toString()),o(e),j(e)},dec:function(e,t){return function(e,t){var n=B(e,t),i=2147483648&n.hi;i&&(n=J(n.lo,n.hi));var r=F(n.lo,n.hi);return i?"-"+r:r}(e,t)},uDec:function(e,t){return F(e,t)}}}();function Q(e,t,n){if(t===n)return!0;if(e==W.BYTES){if(!(t instanceof Uint8Array&&n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}switch(e){case W.UINT64:case W.FIXED64:case W.INT64:case W.SFIXED64:case W.SINT64:return t==n}return!1}function Y(e,t){switch(e){case W.BOOL:return!1;case W.UINT64:case W.FIXED64:case W.INT64:case W.SFIXED64:case W.SINT64:return 0==t?z.zero:"0";case W.DOUBLE:case W.FLOAT:return 0;case W.BYTES:return new Uint8Array(0);case W.STRING:return"";default:return 0}}function X(e,t){switch(e){case W.BOOL:return!1===t;case W.STRING:return""===t;case W.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(W||(W={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(G||(G={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(H||(H={}));var Z=function(){return o(function e(t){r(this,e),this.stack=[],this.textEncoder=null!=t?t:new TextEncoder,this.chunks=[],this.buf=[]},[{key:"finish",value:function(){this.chunks.push(new Uint8Array(this.buf));for(var e=0,t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;for(var n=new Uint8Array(e),i=0,r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}},{key:"fork",value:function(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}},{key:"join",value:function(){var e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}},{key:"tag",value:function(e,t){return this.uint32((e<<3|t)>>>0)}},{key:"raw",value:function(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}},{key:"uint32",value:function(e){for(P(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}},{key:"int32",value:function(e){return E(e),V(e,this.buf),this}},{key:"bool",value:function(e){return this.buf.push(e?1:0),this}},{key:"bytes",value:function(e){return this.uint32(e.byteLength),this.raw(e)}},{key:"string",value:function(e){var t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}},{key:"float",value:function(e){R(e);var t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}},{key:"double",value:function(e){var t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}},{key:"fixed32",value:function(e){P(e);var t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}},{key:"sfixed32",value:function(e){E(e);var t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}},{key:"sint32",value:function(e){return E(e),V(e=(e<<1^e>>31)>>>0,this.buf),this}},{key:"sfixed64",value:function(e){var t=new Uint8Array(8),n=new DataView(t.buffer),i=z.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}},{key:"fixed64",value:function(e){var t=new Uint8Array(8),n=new DataView(t.buffer),i=z.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}},{key:"int64",value:function(e){var t=z.enc(e);return M(t.lo,t.hi,this.buf),this}},{key:"sint64",value:function(e){var t=z.enc(e),n=t.hi>>31;return M(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}},{key:"uint64",value:function(e){var t=z.uEnc(e);return M(t.lo,t.hi,this.buf),this}}])}(),$=function(){return o(function e(t,n){r(this,e),this.varint64=x,this.uint32=K,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=null!=n?n:new TextDecoder},[{key:"tag",value:function(){var e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}},{key:"skip",value:function(e,t){var n=this.pos;switch(e){case H.Varint:for(;128&this.buf[this.pos++];);break;case H.Bit64:this.pos+=4;case H.Bit32:this.pos+=4;break;case H.LengthDelimited:var i=this.uint32();this.pos+=i;break;case H.StartGroup:for(;;){var r=g(this.tag(),2),a=r[0],o=r[1];if(o===H.EndGroup){if(void 0!==t&&a!==t)throw new Error("invalid end group tag");break}this.skip(o,a)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}},{key:"assertBounds",value:function(){if(this.pos>this.len)throw new RangeError("premature EOF")}},{key:"int32",value:function(){return 0|this.uint32()}},{key:"sint32",value:function(){var e=this.uint32();return e>>>1^-(1&e)}},{key:"int64",value:function(){return z.dec.apply(z,y(this.varint64()))}},{key:"uint64",value:function(){return z.uDec.apply(z,y(this.varint64()))}},{key:"sint64",value:function(){var e=g(this.varint64(),2),t=e[0],n=e[1],i=-(1&t);return t=(t>>>1|(1&n)<<31)^i,n=n>>>1^i,z.dec(t,n)}},{key:"bool",value:function(){var e=g(this.varint64(),2),t=e[0],n=e[1];return 0!==t||0!==n}},{key:"fixed32",value:function(){return this.view.getUint32((this.pos+=4)-4,!0)}},{key:"sfixed32",value:function(){return this.view.getInt32((this.pos+=4)-4,!0)}},{key:"fixed64",value:function(){return z.uDec(this.sfixed32(),this.sfixed32())}},{key:"sfixed64",value:function(){return z.dec(this.sfixed32(),this.sfixed32())}},{key:"float",value:function(){return this.view.getFloat32((this.pos+=4)-4,!0)}},{key:"double",value:function(){return this.view.getFloat64((this.pos+=8)-8,!0)}},{key:"bytes",value:function(){var e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}},{key:"string",value:function(){return this.textDecoder.decode(this.bytes())}}])}();function ee(e){var t=e.field.localName,n=Object.create(null);return n[t]=function(e){var t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return Y(t.T,t.L);case"message":var n=t.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,function(){return n[t]}]}for(var te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),ne=[],ie=0;ie<te.length;ie++)ne[te[ie].charCodeAt(0)]=ie;ne["-".charCodeAt(0)]=te.indexOf("+"),ne["_".charCodeAt(0)]=te.indexOf("/");var re=function(e){var t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);for(var n,i=new Uint8Array(t),r=0,a=0,o=0,s=0;s<e.length;s++){if(void 0===(n=ne[e.charCodeAt(s)]))switch(e[s]){case"=":a=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:o=n,a=1;break;case 1:i[r++]=o<<2|(48&n)>>4,o=n,a=2;break;case 2:i[r++]=(15&o)<<4|(60&n)>>2,o=n,a=3;break;case 3:i[r++]=(3&o)<<6|n,a=0}}if(1==a)throw Error("invalid base64 string.");return i.subarray(0,r)},ae=function(e){for(var t,n="",i=0,r=0,a=0;a<e.length;a++)switch(t=e[a],i){case 0:n+=te[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=te[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=te[r|t>>6],n+=te[63&t],i=0}return i&&(n+=te[r],n+="=",1==i&&(n+="=")),n};function oe(e,t,n){ue(t,e);var i,r=t.runtime.bin.makeReadOptions(n),a=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(var n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter(function(e){return e.no===t.no})}(e.getType().runtime.bin.listUnknownFields(e),t.field),o=g(ee(t),2),c=o[0],u=o[1],d=s(a);try{for(d.s();!(i=d.n()).done;){var l=i.value;t.runtime.bin.readField(c,r.readerFactory(l.data),t.field,l.wireType,r)}}catch(e){d.e(e)}finally{d.f()}return u()}function se(e,t,n,i){ue(t,e);var r=t.runtime.bin.makeReadOptions(i),a=t.runtime.bin.makeWriteOptions(i);if(ce(e,t)){var o=e.getType().runtime.bin.listUnknownFields(e).filter(function(e){return e.no!=t.field.no});e.getType().runtime.bin.discardUnknownFields(e);var c,u=s(o);try{for(u.s();!(c=u.n()).done;){var d=c.value;e.getType().runtime.bin.onUnknownField(e,d.no,d.wireType,d.data)}}catch(e){u.e(e)}finally{u.f()}}var l=a.writerFactory(),f=t.field;f.opt||f.repeated||"enum"!=f.kind&&"scalar"!=f.kind||(f=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(f,n,l,a);for(var h=r.readerFactory(l.finish());h.pos<h.len;){var m=g(h.tag(),2),v=m[0],p=m[1],k=h.skip(p,v);e.getType().runtime.bin.onUnknownField(e,v,p,k)}}function ce(e,t){var n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find(function(e){return e.no==t.field.no})}function ue(e,t){C(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function de(e,t){var n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!X(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function le(e,t){var n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?Y(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function fe(e,t){if(null===e||"object"!=T(e))return!1;if(!Object.getOwnPropertyNames(L.prototype).every(function(t){return t in e&&"function"==typeof e[t]}))return!1;var n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function he(e,t){return fe(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}W.DOUBLE,W.FLOAT,W.INT64,W.UINT64,W.INT32,W.UINT32,W.BOOL,W.STRING,W.BYTES;var me={ignoreUnknownFields:!1},ve={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function pe(e){return e?Object.assign(Object.assign({},me),e):me}function ge(e){return e?Object.assign(Object.assign({},ve),e):ve}var ke=Symbol(),ye=Symbol();function be(e){if(null===e)return"null";switch(T(e)){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function Te(e,t,n,i,r){var a=n.localName;if(n.repeated){if(C("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(t)));var o,c=e[a],u=s(t);try{for(u.s();!(o=u.n()).done;){var d=o.value;if(null===d)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(d)));switch(n.kind){case"message":c.push(n.T.fromJson(d,i));break;case"enum":var l=Ce(n.T,d,i.ignoreUnknownFields,!0);l!==ye&&c.push(l);break;case"scalar":try{c.push(we(n.T,d,n.L,!0))}catch(e){var f="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(d));throw e instanceof Error&&e.message.length>0&&(f+=": ".concat(e.message)),new Error(f)}}}}catch(e){u.e(e)}finally{u.f()}}else if("map"==n.kind){if(null===t)return;if("object"!=T(t)||Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(t)));for(var h=e[a],m=0,v=Object.entries(t);m<v.length;m++){var p=g(v[m],2),k=p[0],y=p[1];if(null===y)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));var b=void 0;try{b=Se(n.K,k)}catch(e){var S="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(t));throw e instanceof Error&&e.message.length>0&&(S+=": ".concat(e.message)),new Error(S)}switch(n.V.kind){case"message":h[b]=n.V.T.fromJson(y,i);break;case"enum":var w=Ce(n.V.T,y,i.ignoreUnknownFields,!0);w!==ye&&(h[b]=w);break;case"scalar":try{h[b]=we(n.V.T,y,G.BIGINT,!0)}catch(e){var E="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(t));throw e instanceof Error&&e.message.length>0&&(E+=": ".concat(e.message)),new Error(E)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:a},a="value"),n.kind){case"message":var P=n.T;if(null===t&&"google.protobuf.Value"!=P.typeName)return;var R=e[a];fe(R)?R.fromJson(t,i):(e[a]=R=P.fromJson(t,i),P.fieldWrapper&&!n.oneof&&(e[a]=P.fieldWrapper.unwrapField(R)));break;case"enum":var I=Ce(n.T,t,i.ignoreUnknownFields,!1);switch(I){case ke:le(n,e);break;case ye:break;default:e[a]=I}break;case"scalar":try{var O=we(n.T,t,n.L,!1);if(O===ke)le(n,e);else e[a]=O}catch(e){var N="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(t));throw e instanceof Error&&e.message.length>0&&(N+=": ".concat(e.message)),new Error(N)}}}function Se(e,t){if(e===W.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return we(e,t,G.BIGINT,!0).toString()}function we(e,t,n,i){if(null===t)return i?Y(e,n):ke;switch(e){case W.DOUBLE:case W.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;var r=Number(t);if(Number.isNaN(r))break;if(!Number.isFinite(r))break;return e==W.FLOAT&&R(r),r;case W.INT32:case W.FIXED32:case W.SFIXED32:case W.SINT32:case W.UINT32:var a;if("number"==typeof t?a=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(a=Number(t)),void 0===a)break;return e==W.UINT32||e==W.FIXED32?P(a):E(a),a;case W.INT64:case W.SFIXED64:case W.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;var o=z.parse(t);return n?o.toString():o;case W.FIXED64:case W.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;var s=z.uParse(t);return n?s.toString():s;case W.BOOL:if("boolean"!=typeof t)break;return t;case W.STRING:if("string"!=typeof t)break;try{encodeURIComponent(t)}catch(e){throw new Error("invalid UTF8")}return t;case W.BYTES:if(""===t)return new Uint8Array(0);if("string"!=typeof t)break;return re(t)}throw new Error}function Ce(e,t,n,i){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:i?e.values[0].no:ke;switch(T(t)){case"number":if(Number.isInteger(t))return t;break;case"string":var r=e.findName(t);if(void 0!==r)return r.no;if(n)return ye}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(be(t)))}function Ee(e){return!(!e.repeated&&"map"!=e.kind)||!e.oneof&&("message"!=e.kind&&(!e.opt&&!e.req))}function Pe(e,t,n){if("map"==e.kind){C("object"==T(t)&&null!=t);var i={},r=Object.entries(t);switch(e.V.kind){case"scalar":var a,o=s(r);try{for(o.s();!(a=o.n()).done;){var c=g(a.value,2),u=c[0],d=c[1];i[u.toString()]=Ie(e.V.T,d)}}catch(e){o.e(e)}finally{o.f()}break;case"message":var l,f=s(r);try{for(f.s();!(l=f.n()).done;){var h=g(l.value,2),m=h[0],v=h[1];i[m.toString()]=v.toJson(n)}}catch(e){f.e(e)}finally{f.f()}break;case"enum":var p,k=e.V.T,y=s(r);try{for(y.s();!(p=y.n()).done;){var b=g(p.value,2),S=b[0],w=b[1];i[S.toString()]=Re(k,w,n.enumAsInteger)}}catch(e){y.e(e)}finally{y.f()}}return n.emitDefaultValues||r.length>0?i:void 0}if(e.repeated){C(Array.isArray(t));var E=[];switch(e.kind){case"scalar":for(var P=0;P<t.length;P++)E.push(Ie(e.T,t[P]));break;case"enum":for(var R=0;R<t.length;R++)E.push(Re(e.T,t[R],n.enumAsInteger));break;case"message":for(var I=0;I<t.length;I++)E.push(t[I].toJson(n))}return n.emitDefaultValues||E.length>0?E:void 0}switch(e.kind){case"scalar":return Ie(e.T,t);case"enum":return Re(e.T,t,n.enumAsInteger);case"message":return he(e.T,t).toJson(n)}}function Re(e,t,n){var i;if(C("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;var r=e.findNumber(t);return null!==(i=null==r?void 0:r.name)&&void 0!==i?i:t}function Ie(e,t){switch(e){case W.INT32:case W.SFIXED32:case W.SINT32:case W.FIXED32:case W.UINT32:return C("number"==typeof t),t;case W.FLOAT:case W.DOUBLE:return C("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case W.STRING:return C("string"==typeof t),t;case W.BOOL:return C("boolean"==typeof t),t;case W.UINT64:case W.FIXED64:case W.INT64:case W.SFIXED64:case W.SINT64:return C("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case W.BYTES:return C(t instanceof Uint8Array),ae(t)}}var Oe=Symbol("@bufbuild/protobuf/unknown-fields"),Ne={readUnknownFields:!0,readerFactory:function(e){return new $(e)}},De={writeUnknownFields:!0,writerFactory:function(){return new Z}};function _e(e){return e?Object.assign(Object.assign({},Ne),e):Ne}function Ae(e){return e?Object.assign(Object.assign({},De),e):De}function Le(e,t,n,i,r){var a=n.repeated,o=n.localName;switch(n.oneof&&((e=e[n.oneof.localName]).case!=o&&delete e.value,e.case=o,o="value"),n.kind){case"scalar":case"enum":var s="enum"==n.kind?W.INT32:n.T,c=Ue;if("scalar"==n.kind&&n.L>0&&(c=Me),a){var u=e[o];if(i==H.LengthDelimited&&s!=W.STRING&&s!=W.BYTES)for(var d=t.uint32()+t.pos;t.pos<d;)u.push(c(t,s));else u.push(c(t,s))}else e[o]=c(t,s);break;case"message":var l=n.T;a?e[o].push(xe(t,new l,r,n)):fe(e[o])?xe(t,e[o],r,n):(e[o]=xe(t,new l,r,n),!l.fieldWrapper||n.oneof||n.repeated||(e[o]=l.fieldWrapper.unwrapField(e[o])));break;case"map":var f=function(e,t,n){var i,r,a=t.uint32(),o=t.pos+a;for(;t.pos<o;){switch(g(t.tag(),1)[0]){case 1:i=Ue(t,e.K);break;case 2:switch(e.V.kind){case"scalar":r=Ue(t,e.V.T);break;case"enum":r=t.int32();break;case"message":r=xe(t,new e.V.T,n,void 0)}}}void 0===i&&(i=Y(e.K,G.BIGINT));"string"!=typeof i&&"number"!=typeof i&&(i=i.toString());if(void 0===r)switch(e.V.kind){case"scalar":r=Y(e.V.T,G.BIGINT);break;case"enum":r=e.V.T.values[0].no;break;case"message":r=new e.V.T}return[i,r]}(n,t,r),h=g(f,2),m=h[0],v=h[1];e[o][m]=v}}function xe(e,t,n,i){var r=t.getType().runtime.bin,a=null==i?void 0:i.delimited;return r.readMessage(t,e,a?i.no:e.uint32(),n,a),t}function Me(e,t){var n=Ue(e,t);return"bigint"==typeof n?n.toString():n}function Ue(e,t){switch(t){case W.STRING:return e.string();case W.BOOL:return e.bool();case W.DOUBLE:return e.double();case W.FLOAT:return e.float();case W.INT32:return e.int32();case W.INT64:return e.int64();case W.UINT64:return e.uint64();case W.FIXED64:return e.fixed64();case W.BYTES:return e.bytes();case W.FIXED32:return e.fixed32();case W.SFIXED32:return e.sfixed32();case W.SFIXED64:return e.sfixed64();case W.SINT64:return e.sint64();case W.UINT32:return e.uint32();case W.SINT32:return e.sint32()}}function je(e,t,n,i){C(void 0!==t);var r=e.repeated;switch(e.kind){case"scalar":case"enum":var a="enum"==e.kind?W.INT32:e.T;if(r)if(C(Array.isArray(t)),e.packed)!function(e,t,n,i){if(!i.length)return;e.tag(n,H.LengthDelimited).fork();for(var r=g(qe(t),2)[1],a=0;a<i.length;a++)e[r](i[a]);e.join()}(n,a,e.no,t);else{var o,c=s(t);try{for(c.s();!(o=c.n()).done;){var u=o.value;Je(n,a,e.no,u)}}catch(e){c.e(e)}finally{c.f()}}else Je(n,a,e.no,t);break;case"message":if(r){C(Array.isArray(t));var d,l=s(t);try{for(l.s();!(d=l.n()).done;){Be(n,i,e,d.value)}}catch(e){l.e(e)}finally{l.f()}}else Be(n,i,e,t);break;case"map":C("object"==T(t)&&null!=t);for(var f=0,h=Object.entries(t);f<h.length;f++){var m=g(h[f],2);Fe(n,i,e,m[0],m[1])}}}function Fe(e,t,n,i,r){e.tag(n.no,H.LengthDelimited),e.fork();var a=i;switch(n.K){case W.INT32:case W.FIXED32:case W.UINT32:case W.SFIXED32:case W.SINT32:a=Number.parseInt(i);break;case W.BOOL:C("true"==i||"false"==i),a="true"==i}switch(Je(e,n.K,1,a),n.V.kind){case"scalar":Je(e,n.V.T,2,r);break;case"enum":Je(e,W.INT32,2,r);break;case"message":C(void 0!==r),e.tag(2,H.LengthDelimited).bytes(r.toBinary(t))}e.join()}function Be(e,t,n,i){var r=he(n.T,i);n.delimited?e.tag(n.no,H.StartGroup).raw(r.toBinary(t)).tag(n.no,H.EndGroup):e.tag(n.no,H.LengthDelimited).bytes(r.toBinary(t))}function Je(e,t,n,i){C(void 0!==i);var r=g(qe(t),2),a=r[0],o=r[1];e.tag(n,a)[o](i)}function qe(e){var t=H.Varint;switch(e){case W.BYTES:case W.STRING:t=H.LengthDelimited;break;case W.DOUBLE:case W.FIXED64:case W.SFIXED64:t=H.Bit64;break;case W.FIXED32:case W.SFIXED32:case W.FLOAT:t=H.Bit32}return[t,W[e].toLowerCase()]}function Ve(e){if(void 0===e)return e;if(fe(e))return e.clone();if(e instanceof Uint8Array){var t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function Ke(e){return e instanceof Uint8Array?e:new Uint8Array(e)}var We=function(){return o(function e(t,n){r(this,e),this._fields=t,this._normalizer=n},[{key:"findJsonName",value:function(e){if(!this.jsonNames){var t,n={},i=s(this.list());try{for(i.s();!(t=i.n()).done;){var r=t.value;n[r.jsonName]=n[r.name]=r}}catch(e){i.e(e)}finally{i.f()}this.jsonNames=n}return this.jsonNames[e]}},{key:"find",value:function(e){if(!this.numbers){var t,n={},i=s(this.list());try{for(i.s();!(t=i.n()).done;){var r=t.value;n[r.no]=r}}catch(e){i.e(e)}finally{i.f()}this.numbers=n}return this.numbers[e]}},{key:"list",value:function(){return this.all||(this.all=this._normalizer(this._fields)),this.all}},{key:"byNumber",value:function(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(function(e,t){return e.no-t.no})),this.numbersAsc}},{key:"byMember",value:function(){if(!this.members){this.members=[];var e,t,n=this.members,i=s(this.list());try{for(i.s();!(t=i.n()).done;){var r=t.value;r.oneof?r.oneof!==e&&(e=r.oneof,n.push(e)):n.push(r)}}catch(e){i.e(e)}finally{i.f()}}return this.members}}])}();function Ge(e,t){var n=ze(e);return t?n:$e(Ze(n))}var He=ze;function ze(e){for(var t=!1,n=[],i=0;i<e.length;i++){var r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}var Qe=new Set(["constructor","toString","toJSON","valueOf"]),Ye=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Xe=function(e){return"".concat(e,"$")},Ze=function(e){return Ye.has(e)?Xe(e):e},$e=function(e){return Qe.has(e)?Xe(e):e},et=function(){return o(function e(t){r(this,e),this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=Ge(t,!1)},[{key:"addField",value:function(e){C(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}},{key:"findField",value:function(e){if(!this._lookup){this._lookup=Object.create(null);for(var t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}])}();var tt,nt,it=(tt=function(e){return new We(e,function(e){return function(e,t){var n,i,r,a,o,c,u,d,l=[],f=s("function"==typeof e?e():e);try{for(f.s();!(d=f.n()).done;){var h=d.value,m=h;if(m.localName=Ge(h.name,void 0!==h.oneof),m.jsonName=null!==(n=h.jsonName)&&void 0!==n?n:He(h.name),m.repeated=null!==(i=h.repeated)&&void 0!==i&&i,"scalar"==h.kind&&(m.L=null!==(r=h.L)&&void 0!==r?r:G.BIGINT),m.delimited=null!==(a=h.delimited)&&void 0!==a&&a,m.req=null!==(o=h.req)&&void 0!==o&&o,m.opt=null!==(c=h.opt)&&void 0!==c&&c,void 0===h.packed&&t&&(m.packed="enum"==h.kind||"scalar"==h.kind&&h.T!=W.BYTES&&h.T!=W.STRING),void 0!==h.oneof){var v="string"==typeof h.oneof?h.oneof:h.oneof.name;u&&u.name==v||(u=new et(v)),m.oneof=u,u.addField(m)}l.push(m)}}catch(e){f.e(e)}finally{f.f()}return l}(e,!0)})},nt=function(e){var t,n=s(e.getType().fields.byMember());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!i.opt){var r=i.localName,a=e;if(i.repeated)a[r]=[];else switch(i.kind){case"oneof":a[r]={case:void 0};break;case"enum":a[r]=0;break;case"map":a[r]={};break;case"scalar":a[r]=Y(i.T,i.L)}}}}catch(e){n.e(e)}finally{n.f()}},{syntax:"proto3",json:{makeReadOptions:pe,makeWriteOptions:ge,readMessage:function(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=T(t))throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(be(t)));i=null!=i?i:new e;for(var r=new Map,a=n.typeRegistry,o=0,s=Object.entries(t);o<s.length;o++){var c=g(s[o],2),u=c[0],d=c[1],l=e.fields.findJsonName(u);if(l){if(l.oneof){if(null===d&&"scalar"==l.kind)continue;var f=r.get(l.oneof);if(void 0!==f)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(f,'", "').concat(u,'"'));r.set(l.oneof,u)}Te(i,d,l,n,e)}else{var h=!1;if((null==a?void 0:a.findExtension)&&u.startsWith("[")&&u.endsWith("]")){var m=a.findExtension(u.substring(1,u.length-1));if(m&&m.extendee.typeName==e.typeName){h=!0;var v=g(ee(m),2),p=v[0],k=v[1];Te(p,d,m.field,n,m),se(i,m,k(),n)}}if(!h&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(u,'" is unknown'))}}return i},writeMessage:function(e,t){var n,i=e.getType(),r={};try{var a,o=s(i.fields.byNumber());try{for(o.s();!(a=o.n()).done;){if(!de(n=a.value,e)){if(n.req)throw"required field not set";if(!t.emitDefaultValues)continue;if(!Ee(n))continue}var c=Pe(n,n.oneof?e[n.oneof.localName].value:e[n.localName],t);void 0!==c&&(r[t.useProtoFieldName?n.name:n.jsonName]=c)}}catch(e){o.e(e)}finally{o.f()}var u=t.typeRegistry;if(null==u?void 0:u.findExtensionFor){var d,l=s(i.runtime.bin.listUnknownFields(e));try{for(l.s();!(d=l.n()).done;){var f=d.value,h=u.findExtensionFor(i.typeName,f.no);if(h&&ce(e,h)){var m=oe(e,h,t),v=Pe(h.field,m,t);void 0!==v&&(r[h.field.jsonName]=v)}}}catch(e){l.e(e)}finally{l.f()}}}catch(e){var p=n?"cannot encode field ".concat(i.typeName,".").concat(n.name," to JSON"):"cannot encode message ".concat(i.typeName," to JSON"),g=e instanceof Error?e.message:String(e);throw new Error(p+(g.length>0?": ".concat(g):""))}return r},readScalar:function(e,t,n){return we(e,t,null!=n?n:G.BIGINT,!0)},writeScalar:function(e,t,n){if(void 0!==t)return n||X(e,t)?Ie(e,t):void 0},debug:be},bin:{makeReadOptions:_e,makeWriteOptions:Ae,listUnknownFields:function(e){var t;return null!==(t=e[Oe])&&void 0!==t?t:[]},discardUnknownFields:function(e){delete e[Oe]},writeUnknownFields:function(e,t){var n=e[Oe];if(n){var i,r=s(n);try{for(r.s();!(i=r.n()).done;){var a=i.value;t.tag(a.no,a.wireType).raw(a.data)}}catch(e){r.e(e)}finally{r.f()}}},onUnknownField:function(e,t,n,i){var r=e;Array.isArray(r[Oe])||(r[Oe]=[]),r[Oe].push({no:t,wireType:n,data:i})},readMessage:function(e,t,n,i,r){for(var a,o,s=e.getType(),c=r?t.len:t.pos+n;t.pos<c;){var u=g(t.tag(),2);if(a=u[0],o=u[1],!0===r&&o==H.EndGroup)break;var d=s.fields.find(a);if(d)Le(e,t,d,o,i);else{var l=t.skip(o,a);i.readUnknownFields&&this.onUnknownField(e,a,o,l)}}if(r&&(o!=H.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Le,writeMessage:function(e,t,n){var i,r=e.getType(),a=s(r.fields.byNumber());try{for(a.s();!(i=a.n()).done;){var o=i.value;if(de(o,e))je(o,o.oneof?e[o.oneof.localName].value:e[o.localName],t,n);else if(o.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(o.name," to binary: required field not set"))}}catch(e){a.e(e)}finally{a.f()}return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField:function(e,t,n,i){void 0!==t&&je(e,t,n,i)}},util:Object.assign(Object.assign({},{setEnumType:N,initPartial:function(e,t){if(void 0!==e){var n,i=s(t.getType().fields.byMember());try{var r=function(){var i=n.value,r=i.localName,a=t,o=e;if(null==o[r])return 0;switch(i.kind){case"oneof":var s=o[r].case;if(void 0===s)return 0;var c=i.findField(s),u=o[r].value;c&&"message"==c.kind&&!fe(u,c.T)?u=new c.T(u):c&&"scalar"===c.kind&&c.T===W.BYTES&&(u=Ke(u)),a[r]={case:s,value:u};break;case"scalar":case"enum":var d=o[r];i.T===W.BYTES&&(d=i.repeated?d.map(Ke):Ke(d)),a[r]=d;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===W.BYTES)for(var l=0,f=Object.entries(o[r]);l<f.length;l++){var h=g(f[l],2),m=h[0],v=h[1];a[r][m]=Ke(v)}else Object.assign(a[r],o[r]);break;case"message":for(var p=i.V.T,k=0,y=Object.keys(o[r]);k<y.length;k++){var b=y[k],T=o[r][b];p.fieldWrapper||(T=new p(T)),a[r][b]=T}}break;case"message":var S=i.T;if(i.repeated)a[r]=o[r].map(function(e){return fe(e,S)?e:new S(e)});else{var w=o[r];S.fieldWrapper?"google.protobuf.BytesValue"===S.typeName?a[r]=Ke(w):a[r]=w:a[r]=fe(w,S)?w:new S(w)}}};for(i.s();!(n=i.n()).done;)r()}catch(e){i.e(e)}finally{i.f()}}},equals:function(e,t,n){return t===n||!(!t||!n)&&e.fields.byMember().every(function(e){var i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every(function(t,n){return e.T.equals(t,r[n])});case"scalar":return i.every(function(t,n){return Q(e.T,t,r[n])});case"enum":return i.every(function(e,t){return Q(W.INT32,e,r[t])})}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":var a=i,o=r;return e.T.fieldWrapper&&(void 0===a||fe(a)||(a=e.T.fieldWrapper.wrapField(a)),void 0===o||fe(o)||(o=e.T.fieldWrapper.wrapField(o))),e.T.equals(a,o);case"enum":return Q(W.INT32,i,r);case"scalar":return Q(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;var s=e.findField(i.case);if(void 0===s)return!0;switch(s.kind){case"message":return s.T.equals(i.value,r.value);case"enum":return Q(W.INT32,i.value,r.value);case"scalar":return Q(s.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(s.kind));case"map":var c=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":var u=e.V.T;return c.every(function(e){return u.equals(i[e],r[e])});case"enum":return c.every(function(e){return Q(W.INT32,i[e],r[e])});case"scalar":var d=e.V.T;return c.every(function(e){return Q(d,i[e],r[e])})}}})},clone:function(e){var t,n=e.getType(),i=new n,r=i,a=s(n.fields.byMember());try{for(a.s();!(t=a.n()).done;){var o=t.value,c=e[o.localName],u=void 0;if(o.repeated)u=c.map(Ve);else if("map"==o.kind){u=r[o.localName];for(var d=0,l=Object.entries(c);d<l.length;d++){var f=g(l[d],2),h=f[0],m=f[1];u[h]=Ve(m)}}else u="oneof"==o.kind?o.findField(c.case)?{case:c.case,value:Ve(c.value)}:{case:void 0}:Ve(c);r[o.localName]=u}}catch(e){a.e(e)}finally{a.f()}var v,p=s(n.runtime.bin.listUnknownFields(e));try{for(p.s();!(v=p.n()).done;){var k=v.value;n.runtime.bin.onUnknownField(r,k.no,k.wireType,k.data)}}catch(e){p.e(e)}finally{p.f()}return i}}),{newFieldList:tt,initFields:nt}),makeMessageType:function(e,t,n){return function(e,t,n,i){var r,a=null!==(r=null==i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),o=c({},a,function(t){e.util.initFields(this),e.util.initPartial(t,this)})[a];return Object.setPrototypeOf(o.prototype,new L),Object.assign(o,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:function(e,t){return(new o).fromBinary(e,t)},fromJson:function(e,t){return(new o).fromJson(e,t)},fromJsonString:function(e,t){return(new o).fromJsonString(e,t)},equals:function(t,n){return e.util.equals(o,t,n)}}),o}(this,e,t,n)},makeEnum:_,makeEnumType:D,getEnumType:O,makeExtension:function(e,t,n){return function(e,t,n,i){var r;return{typeName:t,extendee:n,get field(){if(!r){var n="function"==typeof i?i():i;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),r=e.util.newFieldList([n]).list()[0]}return r},runtime:e}}(this,e,t,n)}}),rt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).seconds=z.zero,n.nanos=0,it.util.initPartial(e,n),n}return l(t,e),o(t,[{key:"fromJson",value:function(e,t){if("string"!=typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(it.json.debug(e)));var n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");var i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=z.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}},{key:"toJson",value:function(e){var t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");var n="Z";if(this.nanos>0){var i=(this.nanos+1e9).toString().substring(1);n="000000"===i.substring(3)?"."+i.substring(0,3)+"Z":"000"===i.substring(6)?"."+i.substring(0,6)+"Z":"."+i+"Z"}return new Date(t).toISOString().replace(".000Z",n)}},{key:"toDate",value:function(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}}],[{key:"now",value:function(){return t.fromDate(new Date)}},{key:"fromDate",value:function(e){var n=e.getTime();return new t({seconds:z.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}},{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);rt.runtime=it,rt.typeName="google.protobuf.Timestamp",rt.fields=it.util.newFieldList(function(){return[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]});var at,ot,st,ct,ut,dt,lt,ft,ht,mt,vt,pt,gt=it.makeMessageType("livekit.MetricsBatch",function(){return[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:rt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:kt,repeated:!0},{no:5,name:"events",kind:"message",T:bt,repeated:!0}]}),kt=it.makeMessageType("livekit.TimeSeriesMetric",function(){return[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:yt,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]}),yt=it.makeMessageType("livekit.MetricSample",function(){return[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:rt},{no:3,name:"value",kind:"scalar",T:2}]}),bt=it.makeMessageType("livekit.EventMetric",function(){return[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:rt},{no:7,name:"normalized_end_timestamp",kind:"message",T:rt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]});!function(e){e[e.DEFAULT_AC=0]="DEFAULT_AC",e[e.OPUS=1]="OPUS",e[e.AAC=2]="AAC"}(at||(at={})),it.util.setEnumType(at,"livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]),function(e){e[e.DEFAULT_VC=0]="DEFAULT_VC",e[e.H264_BASELINE=1]="H264_BASELINE",e[e.H264_MAIN=2]="H264_MAIN",e[e.H264_HIGH=3]="H264_HIGH",e[e.VP8=4]="VP8"}(ot||(ot={})),it.util.setEnumType(ot,"livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]),function(e){e[e.IC_DEFAULT=0]="IC_DEFAULT",e[e.IC_JPEG=1]="IC_JPEG"}(st||(st={})),it.util.setEnumType(st,"livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]),function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.DATA=2]="DATA"}(ct||(ct={})),it.util.setEnumType(ct,"livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.CAMERA=1]="CAMERA",e[e.MICROPHONE=2]="MICROPHONE",e[e.SCREEN_SHARE=3]="SCREEN_SHARE",e[e.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"}(ut||(ut={})),it.util.setEnumType(ut,"livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.OFF=3]="OFF"}(dt||(dt={})),it.util.setEnumType(dt,"livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),function(e){e[e.POOR=0]="POOR",e[e.GOOD=1]="GOOD",e[e.EXCELLENT=2]="EXCELLENT",e[e.LOST=3]="LOST"}(lt||(lt={})),it.util.setEnumType(lt,"livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),function(e){e[e.UNSET=0]="UNSET",e[e.DISABLED=1]="DISABLED",e[e.ENABLED=2]="ENABLED"}(ft||(ft={})),it.util.setEnumType(ft,"livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),e.DisconnectReason=void 0,(ht=e.DisconnectReason||(e.DisconnectReason={}))[ht.UNKNOWN_REASON=0]="UNKNOWN_REASON",ht[ht.CLIENT_INITIATED=1]="CLIENT_INITIATED",ht[ht.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",ht[ht.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",ht[ht.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",ht[ht.ROOM_DELETED=5]="ROOM_DELETED",ht[ht.STATE_MISMATCH=6]="STATE_MISMATCH",ht[ht.JOIN_FAILURE=7]="JOIN_FAILURE",ht[ht.MIGRATION=8]="MIGRATION",ht[ht.SIGNAL_CLOSE=9]="SIGNAL_CLOSE",ht[ht.ROOM_CLOSED=10]="ROOM_CLOSED",ht[ht.USER_UNAVAILABLE=11]="USER_UNAVAILABLE",ht[ht.USER_REJECTED=12]="USER_REJECTED",ht[ht.SIP_TRUNK_FAILURE=13]="SIP_TRUNK_FAILURE",it.util.setEnumType(e.DisconnectReason,"livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]),function(e){e[e.RR_UNKNOWN=0]="RR_UNKNOWN",e[e.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",e[e.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",e[e.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",e[e.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE"}(mt||(mt={})),it.util.setEnumType(mt,"livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),e.SubscriptionError=void 0,(vt=e.SubscriptionError||(e.SubscriptionError={}))[vt.SE_UNKNOWN=0]="SE_UNKNOWN",vt[vt.SE_CODEC_UNSUPPORTED=1]="SE_CODEC_UNSUPPORTED",vt[vt.SE_TRACK_NOTFOUND=2]="SE_TRACK_NOTFOUND",it.util.setEnumType(e.SubscriptionError,"livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),function(e){e[e.TF_STEREO=0]="TF_STEREO",e[e.TF_NO_DTX=1]="TF_NO_DTX",e[e.TF_AUTO_GAIN_CONTROL=2]="TF_AUTO_GAIN_CONTROL",e[e.TF_ECHO_CANCELLATION=3]="TF_ECHO_CANCELLATION",e[e.TF_NOISE_SUPPRESSION=4]="TF_NOISE_SUPPRESSION",e[e.TF_ENHANCED_NOISE_CANCELLATION=5]="TF_ENHANCED_NOISE_CANCELLATION"}(pt||(pt={})),it.util.setEnumType(pt,"livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]);var Tt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).sid="",n.name="",n.emptyTimeout=0,n.departureTimeout=0,n.maxParticipants=0,n.creationTime=z.zero,n.turnPassword="",n.enabledCodecs=[],n.metadata="",n.numParticipants=0,n.numPublishers=0,n.activeRecording=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Tt.runtime=it,Tt.typeName="livekit.Room",Tt.fields=it.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:St,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:sn}]});var St=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).mime="",n.fmtpLine="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);St.runtime=it,St.typeName="livekit.Codec",St.fields=it.util.newFieldList(function(){return[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]});var wt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).enabled=!1,n.min=0,n.max=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);wt.runtime=it,wt.typeName="livekit.PlayoutDelay",wt.fields=it.util.newFieldList(function(){return[{no:1,name:"enabled",kind:"scalar",T:8},{no:2,name:"min",kind:"scalar",T:13},{no:3,name:"max",kind:"scalar",T:13}]});var Ct=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).canSubscribe=!1,n.canPublish=!1,n.canPublishData=!1,n.canPublishSources=[],n.hidden=!1,n.recorder=!1,n.canUpdateMetadata=!1,n.agent=!1,n.canSubscribeMetrics=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Ct.runtime=it,Ct.typeName="livekit.ParticipantPermission",Ct.fields=it.util.newFieldList(function(){return[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:it.getEnumType(ut),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]});var Et,Pt,Rt=function(t){function n(t){var a;return r(this,n),(a=i(this,n)).sid="",a.identity="",a.state=Et.JOINING,a.tracks=[],a.metadata="",a.joinedAt=z.zero,a.name="",a.version=0,a.region="",a.isPublisher=!1,a.kind=e.ParticipantKind.STANDARD,a.attributes={},a.disconnectReason=e.DisconnectReason.UNKNOWN_REASON,it.util.initPartial(t,a),a}return l(n,t),o(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return it.util.equals(n,e,t)}}])}(L);Rt.runtime=it,Rt.typeName="livekit.ParticipantInfo",Rt.fields=it.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:it.getEnumType(Et)},{no:4,name:"tracks",kind:"message",T:Dt,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:Ct},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:it.getEnumType(e.ParticipantKind)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:it.getEnumType(e.DisconnectReason)}]}),function(e){e[e.JOINING=0]="JOINING",e[e.JOINED=1]="JOINED",e[e.ACTIVE=2]="ACTIVE",e[e.DISCONNECTED=3]="DISCONNECTED"}(Et||(Et={})),it.util.setEnumType(Et,"livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),e.ParticipantKind=void 0,(Pt=e.ParticipantKind||(e.ParticipantKind={}))[Pt.STANDARD=0]="STANDARD",Pt[Pt.INGRESS=1]="INGRESS",Pt[Pt.EGRESS=2]="EGRESS",Pt[Pt.SIP=3]="SIP",Pt[Pt.AGENT=4]="AGENT",it.util.setEnumType(e.ParticipantKind,"livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]);var It,Ot=function(e){function t(e){var n;return r(this,t),n=i(this,t),it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Ot.runtime=it,Ot.typeName="livekit.Encryption",Ot.fields=it.util.newFieldList(function(){return[]}),function(e){e[e.NONE=0]="NONE",e[e.GCM=1]="GCM",e[e.CUSTOM=2]="CUSTOM"}(It||(It={})),it.util.setEnumType(It,"livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]);var Nt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).mimeType="",n.mid="",n.cid="",n.layers=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Nt.runtime=it,Nt.typeName="livekit.SimulcastCodecInfo",Nt.fields=it.util.newFieldList(function(){return[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:_t,repeated:!0}]});var Dt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).sid="",n.type=ct.AUDIO,n.name="",n.muted=!1,n.width=0,n.height=0,n.simulcast=!1,n.disableDtx=!1,n.source=ut.UNKNOWN,n.layers=[],n.mimeType="",n.mid="",n.codecs=[],n.stereo=!1,n.disableRed=!1,n.encryption=It.NONE,n.stream="",n.audioFeatures=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Dt.runtime=it,Dt.typeName="livekit.TrackInfo",Dt.fields=it.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:it.getEnumType(ct)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:it.getEnumType(ut)},{no:10,name:"layers",kind:"message",T:_t,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Nt,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:it.getEnumType(It)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:sn},{no:19,name:"audio_features",kind:"enum",T:it.getEnumType(pt),repeated:!0}]});var _t=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).quality=dt.LOW,n.width=0,n.height=0,n.bitrate=0,n.ssrc=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);_t.runtime=it,_t.typeName="livekit.VideoLayer",_t.fields=it.util.newFieldList(function(){return[{no:1,name:"quality",kind:"enum",T:it.getEnumType(dt)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]});var At,Lt=function(t){function n(t){var a;return r(this,n),(a=i(this,n)).kind=e.DataPacket_Kind.RELIABLE,a.participantIdentity="",a.destinationIdentities=[],a.value={case:void 0},it.util.initPartial(t,a),a}return l(n,t),o(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return it.util.equals(n,e,t)}}])}(L);Lt.runtime=it,Lt.typeName="livekit.DataPacket",Lt.fields=it.util.newFieldList(function(){return[{no:1,name:"kind",kind:"enum",T:it.getEnumType(e.DataPacket_Kind)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Ut,oneof:"value"},{no:3,name:"speaker",kind:"message",T:xt,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:jt,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Ft,oneof:"value"},{no:8,name:"metrics",kind:"message",T:gt,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Jt,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:qt,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Vt,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Kt,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:fn,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:hn,oneof:"value"}]}),e.DataPacket_Kind=void 0,(At=e.DataPacket_Kind||(e.DataPacket_Kind={}))[At.RELIABLE=0]="RELIABLE",At[At.LOSSY=1]="LOSSY",it.util.setEnumType(e.DataPacket_Kind,"livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]);var xt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).speakers=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);xt.runtime=it,xt.typeName="livekit.ActiveSpeakerUpdate",xt.fields=it.util.newFieldList(function(){return[{no:1,name:"speakers",kind:"message",T:Mt,repeated:!0}]});var Mt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).sid="",n.level=0,n.active=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Mt.runtime=it,Mt.typeName="livekit.SpeakerInfo",Mt.fields=it.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]});var Ut=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).participantSid="",n.participantIdentity="",n.payload=new Uint8Array(0),n.destinationSids=[],n.destinationIdentities=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Ut.runtime=it,Ut.typeName="livekit.UserPacket",Ut.fields=it.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0}]});var jt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).code=0,n.digit="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);jt.runtime=it,jt.typeName="livekit.SipDTMF",jt.fields=it.util.newFieldList(function(){return[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]});var Ft=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).transcribedParticipantIdentity="",n.trackId="",n.segments=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Ft.runtime=it,Ft.typeName="livekit.Transcription",Ft.fields=it.util.newFieldList(function(){return[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Bt,repeated:!0}]});var Bt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).id="",n.text="",n.startTime=z.zero,n.endTime=z.zero,n.final=!1,n.language="",n.error=!1,n.failureReason="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Bt.runtime=it,Bt.typeName="livekit.TranscriptionSegment",Bt.fields=it.util.newFieldList(function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9},{no:7,name:"error",kind:"scalar",T:8},{no:8,name:"failure_reason",kind:"scalar",T:9}]});var Jt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).id="",n.timestamp=z.zero,n.message="",n.deleted=!1,n.generated=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Jt.runtime=it,Jt.typeName="livekit.ChatMessage",Jt.fields=it.util.newFieldList(function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]});var qt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).id="",n.method="",n.payload="",n.responseTimeoutMs=0,n.version=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);qt.runtime=it,qt.typeName="livekit.RpcRequest",qt.fields=it.util.newFieldList(function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]});var Vt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).requestId="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Vt.runtime=it,Vt.typeName="livekit.RpcAck",Vt.fields=it.util.newFieldList(function(){return[{no:1,name:"request_id",kind:"scalar",T:9}]});var Kt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).requestId="",n.value={case:void 0},it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Kt.runtime=it,Kt.typeName="livekit.RpcResponse",Kt.fields=it.util.newFieldList(function(){return[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Wt,oneof:"value"}]});var Wt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).code=0,n.message="",n.data="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Wt.runtime=it,Wt.typeName="livekit.RpcError",Wt.fields=it.util.newFieldList(function(){return[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]});var Gt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).participantSid="",n.trackSids=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Gt.runtime=it,Gt.typeName="livekit.ParticipantTracks",Gt.fields=it.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]});var Ht,zt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).edition=Ht.Standard,n.version="",n.protocol=0,n.region="",n.nodeId="",n.debugInfo="",n.agentProtocol=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);zt.runtime=it,zt.typeName="livekit.ServerInfo",zt.fields=it.util.newFieldList(function(){return[{no:1,name:"edition",kind:"enum",T:it.getEnumType(Ht)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]}),function(e){e[e.Standard=0]="Standard",e[e.Cloud=1]="Cloud"}(Ht||(Ht={})),it.util.setEnumType(Ht,"livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]);var Qt,Yt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).sdk=Qt.UNKNOWN,n.version="",n.protocol=0,n.os="",n.osVersion="",n.deviceModel="",n.browser="",n.browserVersion="",n.address="",n.network="",n.otherSdks="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Yt.runtime=it,Yt.typeName="livekit.ClientInfo",Yt.fields=it.util.newFieldList(function(){return[{no:1,name:"sdk",kind:"enum",T:it.getEnumType(Qt)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JS=1]="JS",e[e.SWIFT=2]="SWIFT",e[e.ANDROID=3]="ANDROID",e[e.FLUTTER=4]="FLUTTER",e[e.GO=5]="GO",e[e.UNITY=6]="UNITY",e[e.REACT_NATIVE=7]="REACT_NATIVE",e[e.RUST=8]="RUST",e[e.PYTHON=9]="PYTHON",e[e.CPP=10]="CPP",e[e.UNITY_WEB=11]="UNITY_WEB",e[e.NODE=12]="NODE"}(Qt||(Qt={})),it.util.setEnumType(Qt,"livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]);var Xt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).resumeConnection=ft.UNSET,n.forceRelay=ft.UNSET,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Xt.runtime=it,Xt.typeName="livekit.ClientConfiguration",Xt.fields=it.util.newFieldList(function(){return[{no:1,name:"video",kind:"message",T:Zt},{no:2,name:"screen",kind:"message",T:Zt},{no:3,name:"resume_connection",kind:"enum",T:it.getEnumType(ft)},{no:4,name:"disabled_codecs",kind:"message",T:$t},{no:5,name:"force_relay",kind:"enum",T:it.getEnumType(ft)}]});var Zt=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).hardwareEncoder=ft.UNSET,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Zt.runtime=it,Zt.typeName="livekit.VideoConfiguration",Zt.fields=it.util.newFieldList(function(){return[{no:1,name:"hardware_encoder",kind:"enum",T:it.getEnumType(ft)}]});var $t=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).codecs=[],n.publish=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);$t.runtime=it,$t.typeName="livekit.DisabledCodecs",$t.fields=it.util.newFieldList(function(){return[{no:1,name:"codecs",kind:"message",T:St,repeated:!0},{no:2,name:"publish",kind:"message",T:St,repeated:!0}]});var en=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).duration=0,n.startTimestamp=z.zero,n.endTimestamp=z.zero,n.rtpClockTicks=z.zero,n.driftSamples=z.zero,n.driftMs=0,n.clockRate=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);en.runtime=it,en.typeName="livekit.RTPDrift",en.fields=it.util.newFieldList(function(){return[{no:1,name:"start_time",kind:"message",T:rt},{no:2,name:"end_time",kind:"message",T:rt},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"start_timestamp",kind:"scalar",T:4},{no:5,name:"end_timestamp",kind:"scalar",T:4},{no:6,name:"rtp_clock_ticks",kind:"scalar",T:4},{no:7,name:"drift_samples",kind:"scalar",T:3},{no:8,name:"drift_ms",kind:"scalar",T:1},{no:9,name:"clock_rate",kind:"scalar",T:1}]});var tn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).duration=0,n.packets=0,n.packetRate=0,n.bytes=z.zero,n.headerBytes=z.zero,n.bitrate=0,n.packetsLost=0,n.packetLossRate=0,n.packetLossPercentage=0,n.packetsDuplicate=0,n.packetDuplicateRate=0,n.bytesDuplicate=z.zero,n.headerBytesDuplicate=z.zero,n.bitrateDuplicate=0,n.packetsPadding=0,n.packetPaddingRate=0,n.bytesPadding=z.zero,n.headerBytesPadding=z.zero,n.bitratePadding=0,n.packetsOutOfOrder=0,n.frames=0,n.frameRate=0,n.jitterCurrent=0,n.jitterMax=0,n.gapHistogram={},n.nacks=0,n.nackAcks=0,n.nackMisses=0,n.nackRepeated=0,n.plis=0,n.firs=0,n.rttCurrent=0,n.rttMax=0,n.keyFrames=0,n.layerLockPlis=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);tn.runtime=it,tn.typeName="livekit.RTPStats",tn.fields=it.util.newFieldList(function(){return[{no:1,name:"start_time",kind:"message",T:rt},{no:2,name:"end_time",kind:"message",T:rt},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"packets",kind:"scalar",T:13},{no:5,name:"packet_rate",kind:"scalar",T:1},{no:6,name:"bytes",kind:"scalar",T:4},{no:39,name:"header_bytes",kind:"scalar",T:4},{no:7,name:"bitrate",kind:"scalar",T:1},{no:8,name:"packets_lost",kind:"scalar",T:13},{no:9,name:"packet_loss_rate",kind:"scalar",T:1},{no:10,name:"packet_loss_percentage",kind:"scalar",T:2},{no:11,name:"packets_duplicate",kind:"scalar",T:13},{no:12,name:"packet_duplicate_rate",kind:"scalar",T:1},{no:13,name:"bytes_duplicate",kind:"scalar",T:4},{no:40,name:"header_bytes_duplicate",kind:"scalar",T:4},{no:14,name:"bitrate_duplicate",kind:"scalar",T:1},{no:15,name:"packets_padding",kind:"scalar",T:13},{no:16,name:"packet_padding_rate",kind:"scalar",T:1},{no:17,name:"bytes_padding",kind:"scalar",T:4},{no:41,name:"header_bytes_padding",kind:"scalar",T:4},{no:18,name:"bitrate_padding",kind:"scalar",T:1},{no:19,name:"packets_out_of_order",kind:"scalar",T:13},{no:20,name:"frames",kind:"scalar",T:13},{no:21,name:"frame_rate",kind:"scalar",T:1},{no:22,name:"jitter_current",kind:"scalar",T:1},{no:23,name:"jitter_max",kind:"scalar",T:1},{no:24,name:"gap_histogram",kind:"map",K:5,V:{kind:"scalar",T:13}},{no:25,name:"nacks",kind:"scalar",T:13},{no:37,name:"nack_acks",kind:"scalar",T:13},{no:26,name:"nack_misses",kind:"scalar",T:13},{no:38,name:"nack_repeated",kind:"scalar",T:13},{no:27,name:"plis",kind:"scalar",T:13},{no:28,name:"last_pli",kind:"message",T:rt},{no:29,name:"firs",kind:"scalar",T:13},{no:30,name:"last_fir",kind:"message",T:rt},{no:31,name:"rtt_current",kind:"scalar",T:13},{no:32,name:"rtt_max",kind:"scalar",T:13},{no:33,name:"key_frames",kind:"scalar",T:13},{no:34,name:"last_key_frame",kind:"message",T:rt},{no:35,name:"layer_lock_plis",kind:"scalar",T:13},{no:36,name:"last_layer_lock_pli",kind:"message",T:rt},{no:44,name:"packet_drift",kind:"message",T:en},{no:45,name:"ntp_report_drift",kind:"message",T:en},{no:46,name:"rebased_report_drift",kind:"message",T:en},{no:47,name:"received_report_drift",kind:"message",T:en}]});var nn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).rtpTimestamp=0,n.rtpTimestampExt=z.zero,n.ntpTimestamp=z.zero,n.at=z.zero,n.atAdjusted=z.zero,n.packets=0,n.octets=z.zero,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);nn.runtime=it,nn.typeName="livekit.RTCPSenderReportState",nn.fields=it.util.newFieldList(function(){return[{no:1,name:"rtp_timestamp",kind:"scalar",T:13},{no:2,name:"rtp_timestamp_ext",kind:"scalar",T:4},{no:3,name:"ntp_timestamp",kind:"scalar",T:4},{no:4,name:"at",kind:"scalar",T:3},{no:5,name:"at_adjusted",kind:"scalar",T:3},{no:6,name:"packets",kind:"scalar",T:13},{no:7,name:"octets",kind:"scalar",T:4}]});var rn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).started=!1,n.referenceLayerSpatial=0,n.preStartTime=z.zero,n.extFirstTimestamp=z.zero,n.dummyStartTimestampOffset=z.zero,n.codecMunger={case:void 0},n.senderReportState=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);rn.runtime=it,rn.typeName="livekit.RTPForwarderState",rn.fields=it.util.newFieldList(function(){return[{no:1,name:"started",kind:"scalar",T:8},{no:2,name:"reference_layer_spatial",kind:"scalar",T:5},{no:3,name:"pre_start_time",kind:"scalar",T:3},{no:4,name:"ext_first_timestamp",kind:"scalar",T:4},{no:5,name:"dummy_start_timestamp_offset",kind:"scalar",T:4},{no:6,name:"rtp_munger",kind:"message",T:an},{no:7,name:"vp8_munger",kind:"message",T:on,oneof:"codec_munger"},{no:8,name:"sender_report_state",kind:"message",T:nn,repeated:!0}]});var an=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).extLastSequenceNumber=z.zero,n.extSecondLastSequenceNumber=z.zero,n.extLastTimestamp=z.zero,n.extSecondLastTimestamp=z.zero,n.lastMarker=!1,n.secondLastMarker=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);an.runtime=it,an.typeName="livekit.RTPMungerState",an.fields=it.util.newFieldList(function(){return[{no:1,name:"ext_last_sequence_number",kind:"scalar",T:4},{no:2,name:"ext_second_last_sequence_number",kind:"scalar",T:4},{no:3,name:"ext_last_timestamp",kind:"scalar",T:4},{no:4,name:"ext_second_last_timestamp",kind:"scalar",T:4},{no:5,name:"last_marker",kind:"scalar",T:8},{no:6,name:"second_last_marker",kind:"scalar",T:8}]});var on=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).extLastPictureId=0,n.pictureIdUsed=!1,n.lastTl0PicIdx=0,n.tl0PicIdxUsed=!1,n.tidUsed=!1,n.lastKeyIdx=0,n.keyIdxUsed=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);on.runtime=it,on.typeName="livekit.VP8MungerState",on.fields=it.util.newFieldList(function(){return[{no:1,name:"ext_last_picture_id",kind:"scalar",T:5},{no:2,name:"picture_id_used",kind:"scalar",T:8},{no:3,name:"last_tl0_pic_idx",kind:"scalar",T:13},{no:4,name:"tl0_pic_idx_used",kind:"scalar",T:8},{no:5,name:"tid_used",kind:"scalar",T:8},{no:6,name:"last_key_idx",kind:"scalar",T:13},{no:7,name:"key_idx_used",kind:"scalar",T:8}]});var sn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).unixMicro=z.zero,n.ticks=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);sn.runtime=it,sn.typeName="livekit.TimedVersion",sn.fields=it.util.newFieldList(function(){return[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]});var cn,un=function(e){function t(e){var n;return r(this,t),n=i(this,t),it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);un.runtime=it,un.typeName="livekit.DataStream",un.fields=it.util.newFieldList(function(){return[]}),function(e){e[e.CREATE=0]="CREATE",e[e.UPDATE=1]="UPDATE",e[e.DELETE=2]="DELETE",e[e.REACTION=3]="REACTION"}(cn||(cn={})),it.util.setEnumType(cn,"livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]);var dn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).operationType=cn.CREATE,n.version=0,n.replyToStreamId="",n.attachedStreamIds=[],n.generated=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);dn.runtime=it,dn.typeName="livekit.DataStream.TextHeader",dn.fields=it.util.newFieldList(function(){return[{no:1,name:"operation_type",kind:"enum",T:it.getEnumType(cn)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}]});var ln=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).fileName="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);ln.runtime=it,ln.typeName="livekit.DataStream.FileHeader",ln.fields=it.util.newFieldList(function(){return[{no:1,name:"file_name",kind:"scalar",T:9}]});var fn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).streamId="",n.timestamp=z.zero,n.topic="",n.mimeType="",n.encryptionType=It.NONE,n.extensions={},n.contentHeader={case:void 0},it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);fn.runtime=it,fn.typeName="livekit.DataStream.Header",fn.fields=it.util.newFieldList(function(){return[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:it.getEnumType(It)},{no:8,name:"extensions",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:dn,oneof:"content_header"},{no:10,name:"file_header",kind:"message",T:ln,oneof:"content_header"}]});var hn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).streamId="",n.chunkIndex=z.zero,n.content=new Uint8Array(0),n.complete=!1,n.version=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);hn.runtime=it,hn.typeName="livekit.DataStream.Chunk",hn.fields=it.util.newFieldList(function(){return[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"complete",kind:"scalar",T:8},{no:5,name:"version",kind:"scalar",T:5},{no:6,name:"iv",kind:"scalar",T:12,opt:!0}]});var mn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function vn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var pn={exports:{}};!function(e){var t,n;t=mn,n=function(){var e=function(){},t="undefined",n=("undefined"==typeof window?"undefined":T(window))!==t&&T(window.navigator)!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},a=null;function o(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var a=i[r];this[a]=r<n?e:this.methodFactory(a,n,this.name)}if(this.log=this.debug,("undefined"==typeof console?"undefined":T(console))===t&&n<this.levels.SILENT)return"No console available for logging"}function u(e){return function(){("undefined"==typeof console?"undefined":T(console))!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(i,r,a){return function(i){return"debug"===i&&(i="log"),("undefined"==typeof console?"undefined":T(console))!==t&&("trace"===i&&n?s:void 0!==console[i]?o(console,i):void 0!==console.log?o(console,"log"):e)}(i)||u.apply(this,arguments)}function l(e,n){var o,s,u,l=this,f="loglevel";function h(){var e;if(("undefined"==typeof window?"undefined":T(window))!==t&&f){try{e=window.localStorage[f]}catch(e){}if(T(e)===t)try{var n=window.document.cookie,i=encodeURIComponent(f),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(e){}return void 0===l.levels[e]&&(e=void 0),e}}function m(e){var t=e;if("string"==typeof t&&void 0!==l.levels[t.toUpperCase()]&&(t=l.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=l.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?f+=":"+e:"symbol"===T(e)&&(f=void 0),l.name=e,l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=n||d,l.getLevel=function(){return null!=u?u:null!=s?s:o},l.setLevel=function(e,n){return u=m(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":T(window))!==t&&f){try{return void(window.localStorage[f]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(f)+"="+n+";"}catch(e){}}}(u),c.call(l)},l.setDefaultLevel=function(e){s=m(e),h()||l.setLevel(e,!1)},l.resetLevel=function(){u=null,function(){if(("undefined"==typeof window?"undefined":T(window))!==t&&f){try{window.localStorage.removeItem(f)}catch(e){}try{window.document.cookie=encodeURIComponent(f)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(l)},l.enableAll=function(e){l.setLevel(l.levels.TRACE,e)},l.disableAll=function(e){l.setLevel(l.levels.SILENT,e)},l.rebuild=function(){if(a!==l&&(o=m(a.getLevel())),c.call(l),a===l)for(var e in r)r[e].rebuild()},o=m(a?a.getLevel():"WARN");var v=h();null!=v&&(u=m(v)),c.call(l)}(a=new l).getLogger=function(e){if("symbol"!==T(e)&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new l(e,a.methodFactory)),t};var f=("undefined"==typeof window?"undefined":T(window))!==t?window.log:void 0;return a.noConflict=function(){return("undefined"==typeof window?"undefined":T(window))!==t&&window.log===a&&(window.log=f),a},a.getLoggers=function(){return r},a.default=a,a},e.exports?e.exports=n():t.log=n()}(pn);var gn,kn,yn=pn.exports;e.LogLevel=void 0,(gn=e.LogLevel||(e.LogLevel={}))[gn.trace=0]="trace",gn[gn.debug=1]="debug",gn[gn.info=2]="info",gn[gn.warn=3]="warn",gn[gn.error=4]="error",gn[gn.silent=5]="silent",e.LoggerNames=void 0,(kn=e.LoggerNames||(e.LoggerNames={})).Default="livekit",kn.Room="livekit-room",kn.Participant="livekit-participant",kn.Track="livekit-track",kn.Publication="livekit-track-publication",kn.Engine="livekit-engine",kn.Signal="livekit-signal",kn.PCManager="livekit-pc-manager",kn.PCTransport="livekit-pc-transport",kn.E2EE="lk-e2ee";var bn=yn.getLogger("livekit"),Tn=Object.values(e.LoggerNames).map(function(e){return yn.getLogger(e)});function Sn(e){var t=yn.getLogger(e);return t.setDefaultLevel(bn.getLevel()),t}bn.setDefaultLevel(e.LogLevel.info);var wn,Cn,En,Pn,Rn=yn.getLogger("lk-e2ee"),In=7e3,On=[0,300,1200,2700,4800,In,In,In,In,In],Nn=function(){return o(function e(t){r(this,e),this._retryDelays=void 0!==t?y(t):On},[{key:"nextRetryDelayInMs",value:function(e){if(e.retryCount>=this._retryDelays.length)return null;var t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}}])}();function Dn(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}c((i=i.apply(e,t||[])).next())})}function _n(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function An(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=_n(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,r){(function(e,t,n,i){Promise.resolve(i).then(function(t){e({value:t,done:n})},t)})(i,r,(t=e[n](t)).done,t.value)})}}}"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.PUBLISHER=0]="PUBLISHER",e[e.SUBSCRIBER=1]="SUBSCRIBER"}(wn||(wn={})),it.util.setEnumType(wn,"livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),function(e){e[e.ACTIVE=0]="ACTIVE",e[e.PAUSED=1]="PAUSED"}(Cn||(Cn={})),it.util.setEnumType(Cn,"livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.TLS=2]="TLS"}(En||(En={})),it.util.setEnumType(En,"livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),function(e){e[e.AddAudioTrack=0]="AddAudioTrack",e[e.AddVideoTrack=1]="AddVideoTrack",e[e.Join=2]="Join",e[e.Leave=3]="Leave",e[e.MuteAudio=4]="MuteAudio",e[e.MuteVideo=5]="MuteVideo",e[e.UnmuteAudio=6]="UnmuteAudio",e[e.UnmuteVideo=7]="UnmuteVideo"}(Pn||(Pn={})),it.util.setEnumType(Pn,"livekit.RequestType",[{no:0,name:"AddAudioTrack"},{no:1,name:"AddVideoTrack"},{no:2,name:"Join"},{no:3,name:"Leave"},{no:4,name:"MuteAudio"},{no:5,name:"MuteVideo"},{no:6,name:"UnmuteAudio"},{no:7,name:"UnmuteVideo"}]);var Ln=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).message={case:void 0},it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Ln.runtime=it,Ln.typeName="livekit.SignalRequest",Ln.fields=it.util.newFieldList(function(){return[{no:1,name:"offer",kind:"message",T:Kn,oneof:"message"},{no:2,name:"answer",kind:"message",T:Kn,oneof:"message"},{no:3,name:"trickle",kind:"message",T:jn,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Un,oneof:"message"},{no:5,name:"mute",kind:"message",T:Fn,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Gn,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Hn,oneof:"message"},{no:8,name:"leave",kind:"message",T:Xn,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Zn,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:li,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:hi,oneof:"message"},{no:13,name:"simulate",kind:"message",T:vi,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:$n,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:pi,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:zn,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Qn,oneof:"message"},{no:19,name:"health_check",kind:"message",T:Ci,oneof:"message"}]});var xn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).message={case:void 0},it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);xn.runtime=it,xn.typeName="livekit.SignalResponse",xn.fields=it.util.newFieldList(function(){return[{no:1,name:"join",kind:"message",T:Bn,oneof:"message"},{no:2,name:"answer",kind:"message",T:Kn,oneof:"message"},{no:3,name:"offer",kind:"message",T:Kn,oneof:"message"},{no:4,name:"trickle",kind:"message",T:jn,oneof:"message"},{no:5,name:"update",kind:"message",T:Wn,oneof:"message"},{no:6,name:"track_published",kind:"message",T:qn,oneof:"message"},{no:8,name:"leave",kind:"message",T:Xn,oneof:"message"},{no:9,name:"mute",kind:"message",T:Fn,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:ti,oneof:"message"},{no:11,name:"room_update",kind:"message",T:ni,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:ri,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:oi,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:ui,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:fi,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Vn,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Jn,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:gi,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:bi,oneof:"message"},{no:22,name:"health_check_response",kind:"message",T:Ei,oneof:"message"},{no:23,name:"request_response",kind:"message",T:Si,oneof:"message"},{no:24,name:"track_subscribed",kind:"message",T:wi,oneof:"message"}]});var Mn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).codec="",n.cid="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Mn.runtime=it,Mn.typeName="livekit.SimulcastCodec",Mn.fields=it.util.newFieldList(function(){return[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]});var Un=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).cid="",n.name="",n.type=ct.AUDIO,n.width=0,n.height=0,n.muted=!1,n.disableDtx=!1,n.source=ut.UNKNOWN,n.layers=[],n.simulcastCodecs=[],n.sid="",n.stereo=!1,n.disableRed=!1,n.encryption=It.NONE,n.stream="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Un.runtime=it,Un.typeName="livekit.AddTrackRequest",Un.fields=it.util.newFieldList(function(){return[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:it.getEnumType(ct)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:it.getEnumType(ut)},{no:9,name:"layers",kind:"message",T:_t,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Mn,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:it.getEnumType(It)},{no:15,name:"stream",kind:"scalar",T:9}]});var jn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).candidateInit="",n.target=wn.PUBLISHER,n.final=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);jn.runtime=it,jn.typeName="livekit.TrickleRequest",jn.fields=it.util.newFieldList(function(){return[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:it.getEnumType(wn)},{no:3,name:"final",kind:"scalar",T:8}]});var Fn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).sid="",n.muted=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Fn.runtime=it,Fn.typeName="livekit.MuteTrackRequest",Fn.fields=it.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]});var Bn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).otherParticipants=[],n.serverVersion="",n.iceServers=[],n.subscriberPrimary=!1,n.alternativeUrl="",n.serverRegion="",n.pingTimeout=0,n.pingInterval=0,n.sifTrailer=new Uint8Array(0),n.enabledPublishCodecs=[],n.fastPublish=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Bn.runtime=it,Bn.typeName="livekit.JoinResponse",Bn.fields=it.util.newFieldList(function(){return[{no:1,name:"room",kind:"message",T:Tt},{no:2,name:"participant",kind:"message",T:Rt},{no:3,name:"other_participants",kind:"message",T:Rt,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:ei,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Xt},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:zt},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:St,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]});var Jn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).iceServers=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Jn.runtime=it,Jn.typeName="livekit.ReconnectResponse",Jn.fields=it.util.newFieldList(function(){return[{no:1,name:"ice_servers",kind:"message",T:ei,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Xt}]});var qn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).cid="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);qn.runtime=it,qn.typeName="livekit.TrackPublishedResponse",qn.fields=it.util.newFieldList(function(){return[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Dt}]});var Vn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).trackSid="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Vn.runtime=it,Vn.typeName="livekit.TrackUnpublishedResponse",Vn.fields=it.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9}]});var Kn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).type="",n.sdp="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Kn.runtime=it,Kn.typeName="livekit.SessionDescription",Kn.fields=it.util.newFieldList(function(){return[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]});var Wn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).participants=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Wn.runtime=it,Wn.typeName="livekit.ParticipantUpdate",Wn.fields=it.util.newFieldList(function(){return[{no:1,name:"participants",kind:"message",T:Rt,repeated:!0}]});var Gn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).trackSids=[],n.subscribe=!1,n.participantTracks=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Gn.runtime=it,Gn.typeName="livekit.UpdateSubscription",Gn.fields=it.util.newFieldList(function(){return[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Gt,repeated:!0}]});var Hn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).trackSids=[],n.disabled=!1,n.quality=dt.LOW,n.width=0,n.height=0,n.fps=0,n.priority=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Hn.runtime=it,Hn.typeName="livekit.UpdateTrackSettings",Hn.fields=it.util.newFieldList(function(){return[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:it.getEnumType(dt)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]});var zn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).trackSid="",n.features=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);zn.runtime=it,zn.typeName="livekit.UpdateLocalAudioTrack",zn.fields=it.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:it.getEnumType(pt),repeated:!0}]});var Qn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).trackSid="",n.width=0,n.height=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Qn.runtime=it,Qn.typeName="livekit.UpdateLocalVideoTrack",Qn.fields=it.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]});var Yn,Xn=function(t){function n(t){var a;return r(this,n),(a=i(this,n)).canReconnect=!1,a.reason=e.DisconnectReason.UNKNOWN_REASON,a.action=Yn.DISCONNECT,it.util.initPartial(t,a),a}return l(n,t),o(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return it.util.equals(n,e,t)}}])}(L);Xn.runtime=it,Xn.typeName="livekit.LeaveRequest",Xn.fields=it.util.newFieldList(function(){return[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:it.getEnumType(e.DisconnectReason)},{no:3,name:"action",kind:"enum",T:it.getEnumType(Yn)},{no:4,name:"regions",kind:"message",T:ki}]}),function(e){e[e.DISCONNECT=0]="DISCONNECT",e[e.RESUME=1]="RESUME",e[e.RECONNECT=2]="RECONNECT"}(Yn||(Yn={})),it.util.setEnumType(Yn,"livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]);var Zn=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).trackSid="",n.layers=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Zn.runtime=it,Zn.typeName="livekit.UpdateVideoLayers",Zn.fields=it.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:_t,repeated:!0}]});var $n=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).metadata="",n.name="",n.attributes={},n.requestId=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);$n.runtime=it,$n.typeName="livekit.UpdateParticipantMetadata",$n.fields=it.util.newFieldList(function(){return[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]});var ei=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).urls=[],n.username="",n.credential="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);ei.runtime=it,ei.typeName="livekit.ICEServer",ei.fields=it.util.newFieldList(function(){return[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]});var ti=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).speakers=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);ti.runtime=it,ti.typeName="livekit.SpeakersChanged",ti.fields=it.util.newFieldList(function(){return[{no:1,name:"speakers",kind:"message",T:Mt,repeated:!0}]});var ni=function(e){function t(e){var n;return r(this,t),n=i(this,t),it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);ni.runtime=it,ni.typeName="livekit.RoomUpdate",ni.fields=it.util.newFieldList(function(){return[{no:1,name:"room",kind:"message",T:Tt}]});var ii=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).participantSid="",n.quality=lt.POOR,n.score=0,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);ii.runtime=it,ii.typeName="livekit.ConnectionQualityInfo",ii.fields=it.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:it.getEnumType(lt)},{no:3,name:"score",kind:"scalar",T:2}]});var ri=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).updates=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);ri.runtime=it,ri.typeName="livekit.ConnectionQualityUpdate",ri.fields=it.util.newFieldList(function(){return[{no:1,name:"updates",kind:"message",T:ii,repeated:!0}]});var ai=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).participantSid="",n.trackSid="",n.state=Cn.ACTIVE,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);ai.runtime=it,ai.typeName="livekit.StreamStateInfo",ai.fields=it.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:it.getEnumType(Cn)}]});var oi=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).streamStates=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);oi.runtime=it,oi.typeName="livekit.StreamStateUpdate",oi.fields=it.util.newFieldList(function(){return[{no:1,name:"stream_states",kind:"message",T:ai,repeated:!0}]});var si=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).quality=dt.LOW,n.enabled=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);si.runtime=it,si.typeName="livekit.SubscribedQuality",si.fields=it.util.newFieldList(function(){return[{no:1,name:"quality",kind:"enum",T:it.getEnumType(dt)},{no:2,name:"enabled",kind:"scalar",T:8}]});var ci=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).codec="",n.qualities=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);ci.runtime=it,ci.typeName="livekit.SubscribedCodec",ci.fields=it.util.newFieldList(function(){return[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:si,repeated:!0}]});var ui=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).trackSid="",n.subscribedQualities=[],n.subscribedCodecs=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);ui.runtime=it,ui.typeName="livekit.SubscribedQualityUpdate",ui.fields=it.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:si,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:ci,repeated:!0}]});var di=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).participantSid="",n.allTracks=!1,n.trackSids=[],n.participantIdentity="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);di.runtime=it,di.typeName="livekit.TrackPermission",di.fields=it.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]});var li=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).allParticipants=!1,n.trackPermissions=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);li.runtime=it,li.typeName="livekit.SubscriptionPermission",li.fields=it.util.newFieldList(function(){return[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:di,repeated:!0}]});var fi=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).participantSid="",n.trackSid="",n.allowed=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);fi.runtime=it,fi.typeName="livekit.SubscriptionPermissionUpdate",fi.fields=it.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]});var hi=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).publishTracks=[],n.dataChannels=[],n.trackSidsDisabled=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);hi.runtime=it,hi.typeName="livekit.SyncState",hi.fields=it.util.newFieldList(function(){return[{no:1,name:"answer",kind:"message",T:Kn},{no:2,name:"subscription",kind:"message",T:Gn},{no:3,name:"publish_tracks",kind:"message",T:qn,repeated:!0},{no:4,name:"data_channels",kind:"message",T:mi,repeated:!0},{no:5,name:"offer",kind:"message",T:Kn},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]});var mi=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).label="",n.id=0,n.target=wn.PUBLISHER,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);mi.runtime=it,mi.typeName="livekit.DataChannelInfo",mi.fields=it.util.newFieldList(function(){return[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:it.getEnumType(wn)}]});var vi=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).scenario={case:void 0},it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);vi.runtime=it,vi.typeName="livekit.SimulateScenario",vi.fields=it.util.newFieldList(function(){return[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:it.getEnumType(En),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]});var pi=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).timestamp=z.zero,n.rtt=z.zero,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);pi.runtime=it,pi.typeName="livekit.Ping",pi.fields=it.util.newFieldList(function(){return[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]});var gi=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).lastPingTimestamp=z.zero,n.timestamp=z.zero,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);gi.runtime=it,gi.typeName="livekit.Pong",gi.fields=it.util.newFieldList(function(){return[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]});var ki=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).regions=[],it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);ki.runtime=it,ki.typeName="livekit.RegionSettings",ki.fields=it.util.newFieldList(function(){return[{no:1,name:"regions",kind:"message",T:yi,repeated:!0}]});var yi=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).region="",n.url="",n.distance=z.zero,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);yi.runtime=it,yi.typeName="livekit.RegionInfo",yi.fields=it.util.newFieldList(function(){return[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]});var bi=function(t){function n(t){var a;return r(this,n),(a=i(this,n)).trackSid="",a.err=e.SubscriptionError.SE_UNKNOWN,it.util.initPartial(t,a),a}return l(n,t),o(n,null,[{key:"fromBinary",value:function(e,t){return(new n).fromBinary(e,t)}},{key:"fromJson",value:function(e,t){return(new n).fromJson(e,t)}},{key:"fromJsonString",value:function(e,t){return(new n).fromJsonString(e,t)}},{key:"equals",value:function(e,t){return it.util.equals(n,e,t)}}])}(L);bi.runtime=it,bi.typeName="livekit.SubscriptionResponse",bi.fields=it.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:it.getEnumType(e.SubscriptionError)}]});var Ti,Si=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).requestId=0,n.reason=Ti.OK,n.message="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Si.runtime=it,Si.typeName="livekit.RequestResponse",Si.fields=it.util.newFieldList(function(){return[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:it.getEnumType(Ti)},{no:3,name:"message",kind:"scalar",T:9}]}),function(e){e[e.OK=0]="OK",e[e.NOT_FOUND=1]="NOT_FOUND",e[e.NOT_ALLOWED=2]="NOT_ALLOWED",e[e.LIMIT_EXCEEDED=3]="LIMIT_EXCEEDED"}(Ti||(Ti={})),it.util.setEnumType(Ti,"livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]);var wi=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).trackSid="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);wi.runtime=it,wi.typeName="livekit.TrackSubscribed",wi.fields=it.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9}]});var Ci=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).sid="",n.roomName="",n.egressId="",n.nodeId="",n.timestamp=z.zero,n.connId="",n.errorMessage="",n.isNormalClosure=!1,it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Ci.runtime=it,Ci.typeName="livekit.HealthCheck",Ci.fields=it.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"room_name",kind:"scalar",T:9},{no:3,name:"egress_id",kind:"scalar",T:9},{no:4,name:"node_id",kind:"scalar",T:9},{no:5,name:"timestamp",kind:"scalar",T:3},{no:6,name:"conn_id",kind:"scalar",T:9},{no:7,name:"error_message",kind:"scalar",T:9},{no:8,name:"is_normal_closure",kind:"scalar",T:8}]});var Ei=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).connId="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Ei.runtime=it,Ei.typeName="livekit.HealthCheckResponse",Ei.fields=it.util.newFieldList(function(){return[{no:1,name:"conn_id",kind:"scalar",T:9}]});var Pi,Ri=function(e){function t(e){var n;return r(this,t),(n=i(this,t)).sdk=Pi.UNKNOWN,n.os="",n.deviceId="",n.date="",n.ipaddress="",n.nwSignalStrength="",it.util.initPartial(e,n),n}return l(t,e),o(t,null,[{key:"fromBinary",value:function(e,n){return(new t).fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return(new t).fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return(new t).fromJsonString(e,n)}},{key:"equals",value:function(e,n){return it.util.equals(t,e,n)}}])}(L);Ri.runtime=it,Ri.typeName="livekit.DeviceInfo",Ri.fields=it.util.newFieldList(function(){return[{no:1,name:"sdk",kind:"enum",T:it.getEnumType(Pi)},{no:2,name:"os",kind:"scalar",T:9},{no:3,name:"deviceId",kind:"scalar",T:9},{no:4,name:"date",kind:"scalar",T:9},{no:5,name:"ipaddress",kind:"scalar",T:9},{no:6,name:"nw_signal_strength",kind:"scalar",T:9}]}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JS=1]="JS",e[e.SWIFT=2]="SWIFT",e[e.ANDROID=3]="ANDROID",e[e.FLUTTER=4]="FLUTTER",e[e.GO=5]="GO",e[e.UNITY=6]="UNITY",e[e.REACT_NATIVE=7]="REACT_NATIVE",e[e.RUST=8]="RUST"}(Pi||(Pi={})),it.util.setEnumType(Pi,"livekit.DeviceInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"}]);var Ii,Oi={exports:{}},Ni="object"===("undefined"==typeof Reflect?"undefined":T(Reflect))?Reflect:null,Di=Ni&&"function"==typeof Ni.apply?Ni.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};Ii=Ni&&"function"==typeof Ni.ownKeys?Ni.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var _i=Number.isNaN||function(e){return e!=e};function Ai(){Ai.init.call(this)}Oi.exports=Ai,Oi.exports.once=function(e,t){return new Promise(function(n,i){function r(n){e.removeListener(t,a),i(n)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}Vi(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&Vi(e,"error",t,n)}(e,r,{once:!0})})},Ai.EventEmitter=Ai,Ai.prototype._events=void 0,Ai.prototype._eventsCount=0,Ai.prototype._maxListeners=void 0;var Li=10;function xi(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+T(e))}function Mi(e){return void 0===e._maxListeners?Ai.defaultMaxListeners:e._maxListeners}function Ui(e,t,n,i){var r,a,o,s;if(xi(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"==typeof o?o=a[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=Mi(e))>0&&o.length>r&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,s=c,console&&console.warn&&console.warn(s)}return e}function ji(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Fi(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=ji.bind(i);return r.listener=n,i.wrapFn=r,r}function Bi(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):qi(r,r.length)}function Ji(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function qi(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function Vi(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+T(e));e.addEventListener(t,function r(a){i.once&&e.removeEventListener(t,r),n(a)})}}Object.defineProperty(Ai,"defaultMaxListeners",{enumerable:!0,get:function(){return Li},set:function(e){if("number"!=typeof e||e<0||_i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Li=e}}),Ai.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ai.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||_i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},Ai.prototype.getMaxListeners=function(){return Mi(this)},Ai.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var s=r[e];if(void 0===s)return!1;if("function"==typeof s)Di(s,this,t);else{var c=s.length,u=qi(s,c);for(n=0;n<c;++n)Di(u[n],this,t)}return!0},Ai.prototype.addListener=function(e,t){return Ui(this,e,t,!1)},Ai.prototype.on=Ai.prototype.addListener,Ai.prototype.prependListener=function(e,t){return Ui(this,e,t,!0)},Ai.prototype.once=function(e,t){return xi(t),this.on(e,Fi(this,e,t)),this},Ai.prototype.prependOnceListener=function(e,t){return xi(t),this.prependListener(e,Fi(this,e,t)),this},Ai.prototype.removeListener=function(e,t){var n,i,r,a,o;if(xi(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,r=a;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},Ai.prototype.off=Ai.prototype.removeListener,Ai.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,a=Object.keys(n);for(i=0;i<a.length;++i)"removeListener"!==(r=a[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},Ai.prototype.listeners=function(e){return Bi(this,e,!0)},Ai.prototype.rawListeners=function(e){return Bi(this,e,!1)},Ai.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Ji.call(e,t)},Ai.prototype.listenerCount=Ji,Ai.prototype.eventNames=function(){return this._eventsCount>0?Ii(this._events):[]};var Ki=Oi.exports,Wi=!0,Gi=!0;function Hi(e,t,n){var i=e.match(t);return i&&i.length>=n&&parseFloat(i[n],10)}function zi(e,t,n){if(e.RTCPeerConnection){var i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);var a=function(e){var t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,a),r.apply(this,[e,a])};var a=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);var i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function Qi(e){return"boolean"!=typeof e?new Error("Argument type: "+T(e)+". Please use a boolean."):(Wi=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Yi(e){return"boolean"!=typeof e?new Error("Argument type: "+T(e)+". Please use a boolean."):(Gi=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Xi(){if("object"===("undefined"==typeof window?"undefined":T(window))){if(Wi)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Zi(e,t){Gi&&console.warn(e+" is deprecated, please use "+t+" instead.")}function $i(e){return"[object Object]"===Object.prototype.toString.call(e)}function er(e){return $i(e)?Object.keys(e).reduce(function(t,n){var i=$i(e[n]),r=i?er(e[n]):e[n],a=i&&!Object.keys(r).length;return void 0===r||a?t:Object.assign(t,c({},n,r))},{}):e}function tr(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(function(i){i.endsWith("Id")?tr(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(function(t){tr(e,e.get(t),n)})}))}function nr(e,t,n){var i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;var a=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(function(t){e.forEach(function(n){n.type===i&&n.trackId===t.id&&tr(e,n,r)})}),r}var ir=Xi;function rr(e,t){var n=e&&e.navigator;if(n.mediaDevices){var i=function(e){if("object"!==T(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"===T(e[n])?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};"number"==typeof i.ideal?(a[r("min",n)]=i.ideal,t.optional.push(a),(a={})[r("max",n)]=i.ideal,t.optional.push(a)):(a[r("",n)]=i.ideal,t.optional.push(a))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===T(e.audio)){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"===T(e.video)){var o=e.video.facingMode;o=o&&("object"===T(o)?o:{ideal:o});var s,c=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||c))if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?s=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(s=["front"]),s)return n.mediaDevices.enumerateDevices().then(function(t){var n=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return s.some(function(t){return e.label.toLowerCase().includes(t)})});return!n&&t.length&&s.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=o.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=i(e.video),ir("chrome: "+JSON.stringify(e)),r(e)});e.video=i(e.video)}return ir("chrome: "+JSON.stringify(e)),r(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,function(e){n.webkitGetUserMedia(e,t,function(e){i&&i(a(e))})})}.bind(n),n.mediaDevices.getUserMedia){var o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return r(e,function(e){return o(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(a(e))})})}}}}function ar(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function or(e){if("object"===T(e)&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(i){var r;r=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===i.track.id}):{track:i.track};var a=new Event("track");a.track=i.track,a.receiver=r,a.transceiver={receiver:r},a.streams=[t.stream],n.dispatchEvent(a)}),t.stream.getTracks().forEach(function(i){var r;r=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===i.id}):{track:i};var a=new Event("track");a.track=i,a.receiver=r,a.transceiver={receiver:r},a.streams=[t.stream],n.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else zi(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e})}function sr(e){if("object"===T(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){var r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"===T(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function cr(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),i=n[0],r=n[1],a=n[2];if(arguments.length>0&&"function"==typeof i)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof i))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return t.apply(this,[function(e){r(s(o(e)))},i])}return new Promise(function(n,i){t.apply(e,[function(e){n(s(o(e)))},i])}).then(r,a)}}}function ur(e){if("object"===T(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach(function(t){return t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return nr(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),zi(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return nr(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,i,a=arguments[0];return this.getSenders().forEach(function(e){e.track===a&&(t?i=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===a&&(n?i=!0:n=e),e.track===a}),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}}}function dr(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var i=this.getSenders();n.apply(this,arguments);var r=this.getSenders().filter(function(e){return-1===i.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(r)};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var i=t._shimmedLocalStreams[n].indexOf(e);-1!==i&&t._shimmedLocalStreams[n].splice(i,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]}),r.apply(this,arguments)}}function lr(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return dr(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}i.apply(this,[t])};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var i=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[n.id];if(a)a.addTrack(t),Promise.resolve().then(function(){i.dispatchEvent(new Event("negotiationneeded"))});else{var o=new e.MediaStream([t]);this._streams[n.id]=o,this._reverseStreams[o.id]=n,this.addStream(o)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t],i=c({},t,function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[function(n){var i=s(e,n);t[0].apply(null,[i])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then(function(t){return s(e,t)})});e.RTCPeerConnection.prototype[t]=i[t]});var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=o.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(function(i){n._streams[i].getTracks().find(function(t){return e.track===t})&&(t=n._streams[i])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}}function fr(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t],i=c({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=i[t]})}function hr(e,t){zi(e,"negotiationneeded",function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var mr=Object.freeze({__proto__:null,fixNegotiationNeeded:hr,shimAddTrackRemoveTrack:lr,shimAddTrackRemoveTrackWithNative:dr,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(function(t){var i=n.video&&n.video.width,r=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:sr,shimGetStats:cr,shimGetUserMedia:rr,shimMediaStream:ar,shimOnTrack:or,shimPeerConnection:fr,shimSenderReceiverGetStats:ur});function vr(e,t){var n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){Zi("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var r=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===T(e)&&"object"===T(e.audio)&&(e=JSON.parse(JSON.stringify(e)),r(e.audio,"autoGainControl","mozAutoGainControl"),r(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},i&&i.prototype.getSettings){var o=i.prototype.getSettings;i.prototype.getSettings=function(){var e=o.apply(this,arguments);return r(e,"mozAutoGainControl","autoGainControl"),r(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var s=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===T(e)&&(e=JSON.parse(JSON.stringify(e)),r(e,"autoGainControl","mozAutoGainControl"),r(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function pr(e){"object"===T(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function gr(e,t){if("object"===T(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t],i=c({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=i[t]});var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),r=e[0],a=e[1],o=e[2];return i.apply(this,[r||null]).then(function(e){if(t.version<53&&!a)try{e.forEach(function(e){e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,i){e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(a,o)}}}function kr(e){if("object"===T(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach(function(t){return t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function yr(e){if("object"===T(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach(function(t){return t._pc=e}),n}),zi(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function br(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;Zi("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)})})}function Tr(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Sr(e){if("object"===T(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var n=(e=y(e)).length>0;n&&e.forEach(function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var i=t.apply(this,arguments);if(n){var r=i.sender,a=r.getParameters();(!("encodings"in a)||1===a.encodings.length&&0===Object.keys(a.encodings[0]).length)&&(a.encodings=e,r.sendEncodings=e,this.setParametersPromises.push(r.setParameters(a).then(function(){delete r.sendEncodings}).catch(function(){delete r.sendEncodings})))}return i})}}function wr(e){if("object"===T(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function Cr(e){if("object"===T(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(n,e)}).finally(function(){n.setParametersPromises=[]}):t.apply(this,arguments)}}}function Er(e){if("object"===T(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(n,e)}).finally(function(){n.setParametersPromises=[]}):t.apply(this,arguments)}}}var Pr=Object.freeze({__proto__:null,shimAddTransceiver:Sr,shimCreateAnswer:Er,shimCreateOffer:Cr,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:wr,shimGetUserMedia:vr,shimOnTrack:pr,shimPeerConnection:gr,shimRTCDataChannel:Tr,shimReceiverGetStats:yr,shimRemoveStream:br,shimSenderGetStats:kr});function Rr(e){if("object"===T(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(i){return t.call(n,i,e)}),e.getVideoTracks().forEach(function(i){return t.call(n,i,e)})},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r&&r.forEach(function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var i=e.getTracks();this.getSenders().forEach(function(e){i.includes(e.track)&&t.removeTrack(e)})}})}}function Ir(e){if("object"===T(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}})}),t.apply(e,arguments)}}}function Or(e){if("object"===T(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};var s=function(e,t,n){var i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){var i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){var i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}}function Nr(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return i(Dr(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Dr(e){return e&&void 0!==e.video?Object.assign({},e,{video:er(e.video)}):e}function _r(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],r=0;r<e.iceServers.length;r++){var a=e.iceServers[r];void 0===a.urls&&a.url?(Zi("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[r])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function Ar(e){"object"===T(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Lr(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function xr(e){"object"!==T(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Mr=Object.freeze({__proto__:null,shimAudioContext:xr,shimCallbacksAPI:Or,shimConstraints:Dr,shimCreateOfferLegacy:Lr,shimGetUserMedia:Nr,shimLocalStreamsAPI:Rr,shimRTCIceServerUrls:_r,shimRemoteStreamsAPI:Ir,shimTrackEventTransceiver:Ar}),Ur={exports:{}};!function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},t.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(function(e){return 0===e.indexOf(n)})},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation);var n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){var t=e.substring(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){for(var t,n={},i=e.substring(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach(function(t){void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){var t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){var t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){var t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===T(e.keyParams)?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){var i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(var r=3;r<i.length;r++){var a=i[r],o=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var s=t.parseRtpMap(o),c=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),n.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(s.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(function(e){n.headerExtensions.push(t.parseExtmap(e))});var u=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(function(e){u.forEach(function(t){e.rtcpFeedback.find(function(e){return e.type===t.type&&e.parameter===t.parameter})||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){var i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(function(e){i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)});var r=0;return n.codecs.forEach(function(e){e.maxptime>r&&(r=e.maxptime)}),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(function(e){i+=t.writeExtmap(e)}),i},t.parseRtpEncodingParameters=function(e){var n,i=[],r=t.parseRtpParameters(e),a=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=t.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substring(17).split(" ").map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(n=u[0][1]),r.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&n&&(t.rtx={ssrc:n}),i.push(t),a&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(t))}}),0===i.length&&c&&i.push({ssrc:c});var d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,i.forEach(function(e){e.maxBitrate=d})),i},t.parseRtcpParameters=function(e){var n={},i=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);var r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;var a=t.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},t.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){var n,i=t.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(n=i[0].substring(7).split(" "))[0],track:n[1]};var r=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return r.length>0?{stream:(n=r[0].value.split(" "))[0],track:n[1]}:void 0},t.parseSctpDescription=function(e){var n,i=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");r.length>0&&(n=parseInt(r[0].substring(19),10)),isNaN(n)&&(n=65536);var a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:n};var o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){var s=o[0].substring(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){var r=void 0!==n?n:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){for(var i=t.splitLines(e),r=0;r<i.length;r++)switch(i[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[r].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var n=t.splitLines(e),i=0;i<n.length;i++)if(n[i].length<2||"="!==n[i].charAt(1))return!1;return!0},e.exports=t}(Ur);var jr=Ur.exports,Fr=vn(jr),Br=t({__proto__:null,default:Fr},[jr]);function Jr(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===T(e)&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){var n=new t(e),i=Fr.parseCandidate(e.candidate);for(var r in i)r in n||Object.defineProperty(n,r,{value:i[r]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,zi(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}}function qr(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||zi(e,"icecandidate",function(e){if(e.candidate){var t=Fr.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function Vr(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,i;(this._sctp=null,"chrome"===t.browser&&t.version>=76)&&("plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}));if(function(e){if(!e||!e.sdp)return!1;var t=Fr.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=Fr.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){var r,a=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),o=(e=a,i=65536,"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i),s=function(e,n){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var r=Fr.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],a);r=0===o&&0===s?Number.POSITIVE_INFINITY:0===o||0===s?Math.max(o,s):Math.min(o,s);var c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return r}}),this._sctp=c}return n.apply(this,arguments)}}}function Kr(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},zi(e,"datachannel",function(e){return n(e.channel,e.target),e})}function n(e,t){var n=e.send;e.send=function(){var i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}function Wr(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}}function Gr(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t._safariVersion>=13.1)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var i=t.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:i}):t.sdp=i}return n.apply(this,arguments)}}}function Hr(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}function zr(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!==T(t)||t.type&&t.sdp)return n.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?n.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then(function(t){return n.apply(e,[t])})})}}var Qr=Object.freeze({__proto__:null,removeExtmapAllowMixed:Gr,shimAddIceCandidateNullOrEmpty:Hr,shimConnectionState:Wr,shimMaxMessageSize:Vr,shimParameterlessSetLocalDescription:zr,shimRTCIceCandidate:Jr,shimRTCIceCandidateRelayProtocol:qr,shimSendThrowTypeError:Kr});!function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=Xi,i=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;var n=e.navigator;if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(Hi(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(Hi(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=parseInt(Hi(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=Hi(n.userAgent,/Version\/(\d+(\.?\d+))/,1)}return t}(e),r={browserDetails:i,commonShim:Qr,extractVersion:Hi,disableLog:Qi,disableWarnings:Yi,sdp:Br};switch(i.browser){case"chrome":if(!mr||!fr||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=mr,Hr(e,i),zr(e),rr(e,i),ar(e),fr(e,i),or(e),lr(e,i),sr(e),cr(e),ur(e),hr(e,i),Jr(e),qr(e),Wr(e),Vr(e,i),Kr(e),Gr(e,i);break;case"firefox":if(!Pr||!gr||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Pr,Hr(e,i),zr(e),vr(e,i),gr(e,i),pr(e),br(e),kr(e),yr(e),Tr(e),Sr(e),wr(e),Cr(e),Er(e),Jr(e),Wr(e),Vr(e,i),Kr(e);break;case"safari":if(!Mr||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Mr,Hr(e,i),zr(e),_r(e),Lr(e),Or(e),Rr(e),Ir(e),Ar(e),Nr(e),xr(e),Jr(e),qr(e),Vr(e,i),Kr(e),Gr(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var Yr,Xr,Zr="AES-GCM",$r="lk_e2ee",ea={sharedKey:!1,ratchetSalt:"LKFrameEncryptionKey",ratchetWindowSize:8,failureTolerance:10,keyringSize:16};function ta(){return ia()||na()}function na(){return void 0!==window.RTCRtpScriptTransform}function ia(){return void 0!==window.RTCRtpSender&&void 0!==window.RTCRtpSender.prototype.createEncodedStreams}function ra(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i;return h().w(function(t){for(;;)switch(t.n){case 0:return n=new TextEncoder,t.n=1,crypto.subtle.importKey("raw",n.encode(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);case 1:return i=t.v,t.a(2,i)}},t)}))}function aa(e){return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveBits","deriveKey"]);case 1:return n=t.v,t.a(2,n)}},t)}))}function oa(e,t){var n=(new TextEncoder).encode(t);switch(e){case"HKDF":return{name:"HKDF",salt:n,hash:"SHA-256",info:new ArrayBuffer(128)};case"PBKDF2":return{name:"PBKDF2",salt:n,hash:"SHA-256",iterations:1e5};default:throw new Error("algorithm ".concat(e," is currently unsupported"))}}e.KeyProviderEvent=void 0,(Yr=e.KeyProviderEvent||(e.KeyProviderEvent={})).SetKey="setKey",Yr.RatchetRequest="ratchetRequest",Yr.KeyRatcheted="keyRatcheted",e.KeyHandlerEvent=void 0,(e.KeyHandlerEvent||(e.KeyHandlerEvent={})).KeyRatcheted="keyRatcheted",e.EncryptionEvent=void 0,(Xr=e.EncryptionEvent||(e.EncryptionEvent={})).ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",Xr.EncryptionError="encryptionError",e.CryptorEvent=void 0,(e.CryptorEvent||(e.CryptorEvent={})).Error="cryptorError";var sa,ca,ua=function(t){function n(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),(t=i(this,n)).onKeyRatcheted=function(e,t){bn.debug("key ratcheted event received",{material:e,keyIndex:t})},t.keyInfoMap=new Map,t.options=Object.assign(Object.assign({},ea),a),t.on(e.KeyProviderEvent.KeyRatcheted,t.onKeyRatcheted),t}return l(n,t),o(n,[{key:"onSetEncryptionKey",value:function(t,n,i){var r={key:t,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(null!=n?n:"shared","-").concat(null!=i?i:0),r),this.emit(e.KeyProviderEvent.SetKey,r)}},{key:"getKeys",value:function(){return Array.from(this.keyInfoMap.values())}},{key:"getOptions",value:function(){return this.options}},{key:"ratchetKey",value:function(t,n){this.emit(e.KeyProviderEvent.RatchetRequest,t,n)}}])}(Ki.EventEmitter),da=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,t),i(this,t,[Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1})])}return l(t,e),o(t,[{key:"setKey",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i;return h().w(function(t){for(;;)switch(t.n){case 0:if("string"!=typeof e){t.n=2;break}return t.n=1,ra(e);case 1:i=t.v,t.n=4;break;case 2:return t.n=3,aa(e);case 3:i=t.v;case 4:n=i,this.onSetEncryptionKey(n);case 5:return t.a(2)}},t,this)}))}}])}(ua),la=function(e){function t(e,n){var a;return r(this,t),(a=i(this,t,[n||"an error has occured"])).code=e,a}return l(t,e),o(t)}(w(Error)),fa=function(e){function t(e,n,a,o){var s;return r(this,t),(s=i(this,t,[1,e])).status=a,s.reason=n,s.context=o,s}return l(t,e),o(t)}(la),ha=function(e){function t(e){return r(this,t),i(this,t,[21,null!=e?e:"device is unsupported"])}return l(t,e),o(t)}(la),ma=function(e){function t(e){return r(this,t),i(this,t,[20,null!=e?e:"track is invalid"])}return l(t,e),o(t)}(la),va=function(e){function t(e){return r(this,t),i(this,t,[10,null!=e?e:"unsupported server"])}return l(t,e),o(t)}(la),pa=function(e){function t(e){return r(this,t),i(this,t,[12,null!=e?e:"unexpected connection state"])}return l(t,e),o(t)}(la),ga=function(e){function t(e){return r(this,t),i(this,t,[13,null!=e?e:"unable to negotiate"])}return l(t,e),o(t)}(la),ka=function(e){function t(e){return r(this,t),i(this,t,[13,null!=e?e:"unable to publish data"])}return l(t,e),o(t)}(la),ya=function(e){function t(e,n){var a;return r(this,t),(a=i(this,t,[15,e])).reason=n,a}return l(t,e),o(t)}(la);e.MediaDeviceFailure=void 0,(sa=e.MediaDeviceFailure||(e.MediaDeviceFailure={})).PermissionDenied="PermissionDenied",sa.NotFound="NotFound",sa.DeviceInUse="DeviceInUse",sa.Other="Other",function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(e.MediaDeviceFailure||(e.MediaDeviceFailure={})),e.CryptorErrorReason=void 0,(ca=e.CryptorErrorReason||(e.CryptorErrorReason={}))[ca.InvalidKey=0]="InvalidKey",ca[ca.MissingKey=1]="MissingKey",ca[ca.InternalError=2]="InternalError";var ba,Ta,Sa,wa,Ca=function(t){function n(t){var a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.CryptorErrorReason.InternalError,s=arguments.length>2?arguments[2]:void 0;return r(this,n),(a=i(this,n,[40,t])).reason=o,a.participantIdentity=s,a}return l(n,t),o(n)}(la);function Ea(e,t,n){var i,r,a;void 0===t&&(t=50),void 0===n&&(n={});var o=null!=(i=n.isImmediate)&&i,s=null!=(r=n.callback)&&r,c=n.maxWait,u=Date.now(),d=[];function l(){if(void 0!==c){var e=Date.now()-u;if(e+t>=c)return c-e}return t}var f=function(){var t=[].slice.call(arguments),n=this;return new Promise(function(i,r){var c=o&&void 0===a;if(void 0!==a&&clearTimeout(a),a=setTimeout(function(){if(a=void 0,u=Date.now(),!o){var i=e.apply(n,t);s&&s(i),d.forEach(function(e){return(0,e.resolve)(i)}),d=[]}},l()),c){var f=e.apply(n,t);return s&&s(f),i(f)}d.push({resolve:i,reject:r})})};return f.cancel=function(e){void 0!==a&&clearTimeout(a),d.forEach(function(t){return(0,t.reject)(e)}),d=[]},f}e.RoomEvent=void 0,(ba=e.RoomEvent||(e.RoomEvent={})).Connected="connected",ba.Reconnecting="reconnecting",ba.SignalReconnecting="signalReconnecting",ba.Reconnected="reconnected",ba.Disconnected="disconnected",ba.ConnectionStateChanged="connectionStateChanged",ba.MediaDevicesChanged="mediaDevicesChanged",ba.ParticipantConnected="participantConnected",ba.ParticipantDisconnected="participantDisconnected",ba.TrackPublished="trackPublished",ba.TrackSubscribed="trackSubscribed",ba.TrackSubscriptionFailed="trackSubscriptionFailed",ba.TrackUnpublished="trackUnpublished",ba.TrackUnsubscribed="trackUnsubscribed",ba.TrackMuted="trackMuted",ba.TrackUnmuted="trackUnmuted",ba.LocalTrackPublished="localTrackPublished",ba.LocalTrackUnpublished="localTrackUnpublished",ba.LocalAudioSilenceDetected="localAudioSilenceDetected",ba.ActiveSpeakersChanged="activeSpeakersChanged",ba.ParticipantMetadataChanged="participantMetadataChanged",ba.ParticipantNameChanged="participantNameChanged",ba.ParticipantAttributesChanged="participantAttributesChanged",ba.RoomMetadataChanged="roomMetadataChanged",ba.DataReceived="dataReceived",ba.SipDTMFReceived="sipDTMFReceived",ba.TranscriptionReceived="transcriptionReceived",ba.ConnectionQualityChanged="connectionQualityChanged",ba.TrackStreamStateChanged="trackStreamStateChanged",ba.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",ba.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",ba.AudioPlaybackStatusChanged="audioPlaybackChanged",ba.VideoPlaybackStatusChanged="videoPlaybackChanged",ba.MediaDevicesError="mediaDevicesError",ba.ParticipantPermissionsChanged="participantPermissionsChanged",ba.SignalConnected="signalConnected",ba.RecordingStatusChanged="recordingStatusChanged",ba.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",ba.EncryptionError="encryptionError",ba.DCBufferStatusChanged="dcBufferStatusChanged",ba.ActiveDeviceChanged="activeDeviceChanged",ba.ChatMessage="chatMessage",ba.ReconnectPrimaryDelay="reconnectPrimaryDelay",ba.ReconnectSecondaryDelay="reconnectSecondaryDelay",ba.ReconnectICEDelay="reconnectICEDelay",ba.LocalTrackSubscribed="localTrackSubscribed",ba.MetricsReceived="metricsReceived",e.ParticipantEvent=void 0,(Ta=e.ParticipantEvent||(e.ParticipantEvent={})).TrackPublished="trackPublished",Ta.TrackSubscribed="trackSubscribed",Ta.TrackSubscriptionFailed="trackSubscriptionFailed",Ta.TrackUnpublished="trackUnpublished",Ta.TrackUnsubscribed="trackUnsubscribed",Ta.TrackMuted="trackMuted",Ta.TrackUnmuted="trackUnmuted",Ta.LocalTrackPublished="localTrackPublished",Ta.LocalTrackUnpublished="localTrackUnpublished",Ta.ParticipantMetadataChanged="participantMetadataChanged",Ta.ParticipantNameChanged="participantNameChanged",Ta.DataReceived="dataReceived",Ta.SipDTMFReceived="sipDTMFReceived",Ta.TranscriptionReceived="transcriptionReceived",Ta.IsSpeakingChanged="isSpeakingChanged",Ta.ConnectionQualityChanged="connectionQualityChanged",Ta.TrackStreamStateChanged="trackStreamStateChanged",Ta.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",Ta.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",Ta.MediaDevicesError="mediaDevicesError",Ta.AudioStreamAcquired="audioStreamAcquired",Ta.ParticipantPermissionsChanged="participantPermissionsChanged",Ta.PCTrackAdded="pcTrackAdded",Ta.AttributesChanged="attributesChanged",Ta.ChatMessage="chatMessage",Ta.LocalTrackSubscribed="localTrackSubscribed",e.EngineEvent=void 0,(Sa=e.EngineEvent||(e.EngineEvent={})).TransportsCreated="transportsCreated",Sa.Connected="connected",Sa.Disconnected="disconnected",Sa.Resuming="resuming",Sa.Resumed="resumed",Sa.Restarting="restarting",Sa.Restarted="restarted",Sa.SignalResumed="signalResumed",Sa.SignalRestarted="signalRestarted",Sa.Closing="closing",Sa.MediaTrackAdded="mediaTrackAdded",Sa.ActiveSpeakersUpdate="activeSpeakersUpdate",Sa.DataPacketReceived="dataPacketReceived",Sa.PrimaryDelay="primaryDelay",Sa.SecondaryDelay="secondaryDelay",Sa.TranscriptionReceived="transcriptionReceived",Sa.RTPVideoMapUpdate="rtpVideoMapUpdate",Sa.DCBufferStatusChanged="dcBufferStatusChanged",Sa.ParticipantUpdate="participantUpdate",Sa.RoomUpdate="roomUpdate",Sa.SpeakersChanged="speakersChanged",Sa.StreamStateChanged="streamStateChanged",Sa.ConnectionQualityUpdate="connectionQualityUpdate",Sa.SubscriptionError="subscriptionError",Sa.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",Sa.RemoteMute="remoteMute",Sa.SubscribedQualityUpdate="subscribedQualityUpdate",Sa.LocalTrackUnpublished="localTrackUnpublished",Sa.LocalTrackSubscribed="localTrackSubscribed",Sa.Offline="offline",Sa.SignalRequestResponse="signalRequestResponse",e.TrackEvent=void 0,(wa=e.TrackEvent||(e.TrackEvent={})).Message="message",wa.Muted="muted",wa.Unmuted="unmuted",wa.Restarted="restarted",wa.Ended="ended",wa.Subscribed="subscribed",wa.Unsubscribed="unsubscribed",wa.UpdateSettings="updateSettings",wa.UpdateSubscription="updateSubscription",wa.AudioPlaybackStarted="audioPlaybackStarted",wa.AudioPlaybackFailed="audioPlaybackFailed",wa.AudioSilenceDetected="audioSilenceDetected",wa.VisibilityChanged="visibilityChanged",wa.VideoDimensionsChanged="videoDimensionsChanged",wa.VideoPlaybackStarted="videoPlaybackStarted",wa.VideoPlaybackFailed="videoPlaybackFailed",wa.ElementAttached="elementAttached",wa.ElementDetached="elementDetached",wa.UpstreamPaused="upstreamPaused",wa.UpstreamResumed="upstreamResumed",wa.SubscriptionPermissionChanged="subscriptionPermissionChanged",wa.SubscriptionStatusChanged="subscriptionStatusChanged",wa.SubscriptionFailed="subscriptionFailed",wa.TrackProcessorUpdate="trackProcessorUpdate",wa.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",wa.TranscriptionReceived="transcriptionReceived",wa.TimeSyncUpdate="timeSyncUpdate";var Pa,Ra=/version\/(\d+(\.?_?\d+)+)/i;function Ia(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0!==e||"undefined"!=typeof navigator){var n=(null!=e?e:navigator.userAgent).toLowerCase();if(void 0===Pa||t){var i=Oa.find(function(e){return e.test.test(n)});Pa=null==i?void 0:i.describe(n)}return Pa}}var Oa=[{test:/firefox|iceweasel|fxios/i,describe:function(e){return{name:"Firefox",version:Na(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Da(e)}}},{test:/chrom|crios|crmo/i,describe:function(e){return{name:"Chrome",version:Na(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Da(e)}}},{test:/safari|applewebkit/i,describe:function(e){return{name:"Safari",version:Na(Ra,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:Da(e)}}}];function Na(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=t.match(e);return i&&i.length>=n&&i[n]||""}function Da(e){return e.includes("mac os")?Na(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}var _a="2.1.3",Aa=o(function e(){r(this,e)});Aa.setTimeout=function(){return setTimeout.apply(void 0,arguments)},Aa.setInterval=function(){return setInterval.apply(void 0,arguments)},Aa.clearTimeout=function(){return clearTimeout.apply(void 0,arguments)},Aa.clearInterval=function(){return clearInterval.apply(void 0,arguments)};var La,xa=function(){return o(function e(t,n,i,a,o){if(r(this,e),"object"===T(t))this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else{if(void 0===n||void 0===i)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=t,this.height=n,this.aspectRatio=t/n,this.encoding={maxBitrate:i,maxFramerate:a,priority:o}}},[{key:"resolution",get:function(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}])}(),Ma=["vp8","h264"],Ua=["vp8","h264","vp9","av1"];function ja(e){return!!Ma.find(function(t){return t===e})}e.AudioPresets=void 0,(La=e.AudioPresets||(e.AudioPresets={})).telephone={maxBitrate:12e3},La.speech={maxBitrate:24e3},La.music={maxBitrate:48e3},La.musicStereo={maxBitrate:64e3},La.musicHighQuality={maxBitrate:96e3},La.musicHighQualityStereo={maxBitrate:128e3};var Fa={h540:new xa(960,540,5e5,25),h720:new xa(1280,720,125e4,30)},Ba={h540:new xa(720,540,55e4,25),h720:new xa(960,720,12e5,30)},Ja={h360fps3:new xa(640,360,2e5,3,"medium"),h360fps15:new xa(640,360,4e5,15,"medium"),h720fps5:new xa(1280,720,8e5,5,"medium"),h720fps15:new xa(1280,720,15e5,15,"medium"),h720fps30:new xa(1280,720,2e6,30,"medium"),h1080fps15:new xa(1920,1080,25e5,15,"medium"),h1080fps30:new xa(1920,1080,5e6,30,"medium"),original:new xa(0,0,7e6,30,"medium")};var qa,Va,Ka,Wa,Ga=[];function Ha(e,t){var n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,(i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks()).includes(e)||(i.forEach(function(e){n.removeTrack(e)}),n.addTrack(e)),po()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(po()||vo())&&t instanceof HTMLVideoElement&&setTimeout(function(){t.srcObject=n,t.play().catch(function(){})},0))}function za(e,t){if(t.srcObject instanceof MediaStream){var n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}function Qa(e,t,n){var i,r,a,o,s,c=ro(null!=e?e:{}),u=c.optionsWithoutProcessor,d=c.audioProcessor,l=c.videoProcessor,f=null!==(i=function(e){if(void 0!==e)return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}(u))&&void 0!==i?i:{};return!0===f.audio&&(f.audio={}),!0===f.video&&(f.video={}),f.audio&&(Ya(f.audio,t),null!==(r=(o=f.audio).deviceId)&&void 0!==r||(o.deviceId="default"),d&&(f.audio.processor=d)),f.video&&(Ya(f.video,n),null!==(a=(s=f.video).deviceId)&&void 0!==a||(s.deviceId="default"),l&&(f.video.processor=l)),f}function Ya(e,t){return Object.keys(t).forEach(function(n){void 0===e[n]&&(e[n]=t[n])}),e}function Xa(e){var t,n,i,r,a={};if(e.video)if("object"===T(e.video)){var o={},s=o,c=e.video;Object.keys(c).forEach(function(e){if("resolution"===e)Ya(s,c.resolution);else s[e]=c[e]}),a.video=o,null!==(t=(i=a.video).deviceId)&&void 0!==t||(i.deviceId="default")}else a.video=!!e.video&&{deviceId:"default"};else a.video=!1;return e.audio?"object"===T(e.audio)?(a.audio=e.audio,null!==(n=(r=a.audio).deviceId)&&void 0!==n||(r.deviceId="default")):a.audio={deviceId:"default"}:a.audio=!1,a}function Za(e){return Dn(this,arguments,void 0,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return h().m(function n(){var i,r,a,o,s;return h().w(function(n){for(;;)switch(n.n){case 0:if(!(i=$a())){n.n=2;break}return(r=i.createAnalyser()).fftSize=2048,a=r.frequencyBinCount,o=new Uint8Array(a),i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),n.n=1,oo(t);case 1:return r.getByteTimeDomainData(o),s=o.some(function(e){return 128!==e&&0!==e}),i.close(),n.a(2,!s);case 2:return n.a(2,!1)}},n)})()})}function $a(){var e="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);if(e)return new e({latencyHint:"interactive"})}function eo(t){return t===e.Track.Source.Microphone?"audioinput":t===e.Track.Source.Camera?"videoinput":void 0}function to(e){var t,n,i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"==typeof i?{}:i,i=po()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function no(e){return e.split("/")[1].toLowerCase()}function io(t){return t instanceof e.Track?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?io(t.track):{})}}function ro(e){var t,n,i=Object.assign({},e);return"object"===T(i.audio)&&i.audio.processor&&(t=i.audio.processor,i.audio=Object.assign(Object.assign({},i.audio),{processor:void 0})),"object"===T(i.video)&&i.video.processor&&(n=i.video.processor,i.video=Object.assign(Object.assign({},i.video),{processor:void 0})),{audioProcessor:t,videoProcessor:n,optionsWithoutProcessor:i}}e.VideoQuality=void 0,function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(e.VideoQuality||(e.VideoQuality={})),e.Track=function(t){function n(t,a){var o,s,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),(o=i(this,n)).attachedElements=[],o.isMuted=!1,o.streamState=n.StreamState.Active,o.isInBackground=!1,o._currentBitrate=0,o.log=bn,o.appVisibilityChangedListener=function(){o.backgroundTimeout&&clearTimeout(o.backgroundTimeout),"hidden"===document.visibilityState?o.backgroundTimeout=setTimeout(function(){return o.handleAppVisibilityChanged()},5e3):o.handleAppVisibilityChanged()},o.log=Sn(null!==(s=c.loggerName)&&void 0!==s?s:e.LoggerNames.Track),o.loggerContextCb=c.loggerContextCb,o.setMaxListeners(100),o.kind=a,o._mediaStreamTrack=t,o._mediaStreamID=t.id,o.source=n.Source.Unknown,o}return l(n,t),o(n,[{key:"logContext",get:function(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),io(this))}},{key:"currentBitrate",get:function(){return this._currentBitrate}},{key:"mediaStreamTrack",get:function(){return this._mediaStreamTrack}},{key:"mediaStreamID",get:function(){return this._mediaStreamID}},{key:"attach",value:function(t){var i=this,r="audio";this.kind===n.Kind.Video&&(r="video"),0===this.attachedElements.length&&this.kind===n.Kind.Video&&this.addAppVisibilityListener(),t||("audio"===r&&(Ga.forEach(function(e){null!==e.parentElement||t||(t=e)}),t&&Ga.splice(Ga.indexOf(t),1)),t||(t=document.createElement(r))),this.attachedElements.includes(t)||this.attachedElements.push(t),Ha(this.mediaStreamTrack,t);var a=t.srcObject.getTracks(),o=a.some(function(e){return"audio"===e.kind});return t.play().then(function(){i.emit(o?e.TrackEvent.AudioPlaybackStarted:e.TrackEvent.VideoPlaybackStarted)}).catch(function(n){"NotAllowedError"===n.name?i.emit(o?e.TrackEvent.AudioPlaybackFailed:e.TrackEvent.VideoPlaybackFailed,n):"AbortError"===n.name?bn.debug("".concat(o?"audio":"video"," playback aborted, likely due to new play request")):bn.warn("could not playback ".concat(o?"audio":"video"),n),o&&t&&a.some(function(e){return"video"===e.kind})&&"NotAllowedError"===n.name&&(t.muted=!0,t.play().catch(function(){}))}),this.emit(e.TrackEvent.ElementAttached,t),t}},{key:"detach",value:function(t){var n=this;try{if(t){za(this.mediaStreamTrack,t);var i=this.attachedElements.indexOf(t);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(t),this.emit(e.TrackEvent.ElementDetached,t)),t}var r=[];return this.attachedElements.forEach(function(t){za(n.mediaStreamTrack,t),r.push(t),n.recycleElement(t),n.emit(e.TrackEvent.ElementDetached,t)}),this.attachedElements=[],r}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}},{key:"stop",value:function(){this.stopMonitor(),this._mediaStreamTrack.stop()}},{key:"enable",value:function(){this._mediaStreamTrack.enabled=!0}},{key:"disable",value:function(){this._mediaStreamTrack.enabled=!1}},{key:"stopMonitor",value:function(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}},{key:"updateLoggerOptions",value:function(e){e.loggerName&&(this.log=Sn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}},{key:"recycleElement",value:function(e){if(e instanceof HTMLAudioElement){var t=!0;e.pause(),Ga.forEach(function(e){e.parentElement||(t=!1)}),t&&Ga.push(e)}}},{key:"handleAppVisibilityChanged",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t=this;return h().w(function(e){for(;;)switch(e.n){case 0:this.isInBackground="hidden"===document.visibilityState,this.isInBackground||this.kind!==n.Kind.Video||setTimeout(function(){return t.attachedElements.forEach(function(e){return e.play().catch(function(){})})},0);case 1:return e.a(2)}},e,this)}))}},{key:"addAppVisibilityListener",value:function(){bo()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}},{key:"removeAppVisibilityListener",value:function(){bo()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}])}(Ki.EventEmitter),qa=e.Track||(e.Track={}),function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(Va=qa.Kind||(qa.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(Ka=qa.Source||(qa.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(Wa=qa.StreamState||(qa.StreamState={})),qa.kindToProto=function(e){switch(e){case Va.Audio:return ct.AUDIO;case Va.Video:return ct.VIDEO;default:return ct.DATA}},qa.kindFromProto=function(e){switch(e){case ct.AUDIO:return Va.Audio;case ct.VIDEO:return Va.Video;default:return Va.Unknown}},qa.sourceToProto=function(e){switch(e){case Ka.Camera:return ut.CAMERA;case Ka.Microphone:return ut.MICROPHONE;case Ka.ScreenShare:return ut.SCREEN_SHARE;case Ka.ScreenShareAudio:return ut.SCREEN_SHARE_AUDIO;default:return ut.UNKNOWN}},qa.sourceFromProto=function(e){switch(e){case ut.CAMERA:return Ka.Camera;case ut.MICROPHONE:return Ka.Microphone;case ut.SCREEN_SHARE:return Ka.ScreenShare;case ut.SCREEN_SHARE_AUDIO:return Ka.ScreenShareAudio;default:return Ka.Unknown}},qa.streamStateFromProto=function(e){switch(e){case Cn.ACTIVE:return Wa.Active;case Cn.PAUSED:return Wa.Paused;default:return Wa.Unknown}};var ao="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function oo(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t){return Aa.setTimeout(t,e)}))},t)}))}function so(){return"addTransceiver"in RTCPeerConnection.prototype}function co(){return"addTrack"in RTCPeerConnection.prototype}function uo(){if(!("getCapabilities"in RTCRtpSender))return!1;if(po())return!1;var e=RTCRtpSender.getCapabilities("video"),t=!1;if(e){var n,i=s(e.codecs);try{for(i.s();!(n=i.n()).done;){if("video/AV1"===n.value.mimeType){t=!0;break}}}catch(e){i.e(e)}finally{i.f()}}return t}function lo(){if(!("getCapabilities"in RTCRtpSender))return!1;if(vo())return!1;if(po()){var e=Ia();if((null==e?void 0:e.version)&&Po(e.version,"16")<0)return!1}var t=RTCRtpSender.getCapabilities("video"),n=!1;if(t){var i,r=s(t.codecs);try{for(r.s();!(i=r.n()).done;){if("video/VP9"===i.value.mimeType){n=!0;break}}}catch(e){r.e(e)}finally{r.f()}}return n}function fo(e){return"av1"===e||"vp9"===e}function ho(e){return!!document&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function mo(){return"undefined"!=typeof RTCPeerConnection&&(so()||co())}function vo(){var e;return"Firefox"===(null===(e=Ia())||void 0===e?void 0:e.name)}function po(){var e;return"Safari"===(null===(e=Ia())||void 0===e?void 0:e.name)}function go(){var e=Ia();return"Safari"===(null==e?void 0:e.name)&&e.version.startsWith("17.")}function ko(){var e,t;return!!bo()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function yo(){var e=Ia(),t="17.2";if(e)return"Safari"!==e.name&&"iOS"!==e.os||(!!("iOS"===e.os&&e.osVersion&&Po(t,e.osVersion)>=0)||"Safari"===e.name&&Po(t,e.version)>=0)}function bo(){return"undefined"!=typeof document}function To(){return"ReactNative"==navigator.product}function So(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function wo(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Co(){if(To()){var e=wo();return e?e.platform:void 0}}function Eo(){if(bo())return window.devicePixelRatio;if(To()){var e=wo();if(e)return e.devicePixelRatio}return 1}function Po(e,t){for(var n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length),a=0;a<r;++a){var o=parseInt(n[a],10),s=parseInt(i[a],10);if(o>s)return 1;if(o<s)return-1;if(a===r-1&&o===s)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function Ro(e){var t,n=s(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.target.handleResize(i)}}catch(e){n.e(e)}finally{n.f()}}function Io(e){var t,n=s(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.target.handleVisibilityChanged(i)}}catch(e){n.e(e)}finally{n.f()}}var Oo,No,Do=null,_o=function(){return Do||(Do=new ResizeObserver(Ro)),Do},Ao=null,Lo=function(){return Ao||(Ao=new IntersectionObserver(Io,{root:null,rootMargin:"0px"})),Ao};function xo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=document.createElement("canvas");r.width=e,r.height=t;var a=r.getContext("2d");null==a||a.fillRect(0,0,r.width,r.height),i&&a&&(a.beginPath(),a.arc(e/2,t/2,50,0,2*Math.PI,!0),a.closePath(),a.fillStyle="grey",a.fill());var o=g(r.captureStream().getTracks(),1)[0];if(!o)throw Error("Could not get empty media stream video track");return o.enabled=n,o}function Mo(){if(!No){var e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);var i=e.createMediaStreamDestination();t.connect(n),n.connect(i),t.start();var r=g(i.stream.getAudioTracks(),1);if(!(No=r[0]))throw Error("Could not get empty media stream audio track");No.enabled=!1}return No.clone()}var Uo=o(function e(t,n){var i=this;r(this,e),this.onFinally=n,this.promise=new Promise(function(e,n){return Dn(i,void 0,void 0,h().m(function i(){return h().w(function(i){for(;;)switch(i.n){case 0:if(this.resolve=e,this.reject=n,!t){i.n=1;break}return i.n=1,t(e,n);case 1:return i.a(2)}},i,this)}))}).finally(function(){var e;return null===(e=i.onFinally)||void 0===e?void 0:e.call(i)})});var jo=function(){return o(function e(){r(this,e),this._locking=Promise.resolve(),this._locks=0},[{key:"isLocked",value:function(){return this._locks>0}},{key:"lock",value:function(){var e,t=this;this._locks+=1;var n=new Promise(function(n){return e=function(){t._locks-=1,n()}}),i=this._locking.then(function(){return e});return this._locking=this._locking.then(function(){return n}),i}}])}();function Fo(e){if("string"==typeof e||"number"==typeof e)return e;if(Array.isArray(e))return e[0];if(e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function Bo(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function Jo(t){switch(t.reason){case 4:return t.context;case 3:return e.DisconnectReason.CLIENT_INITIATED;case 0:return e.DisconnectReason.USER_REJECTED;case 1:return e.DisconnectReason.JOIN_FAILURE;default:return e.DisconnectReason.UNKNOWN_REASON}}var qo="default",Vo=function(){function e(){r(this,e),this._previousDevices=[]}return o(e,[{key:"previousDevices",get:function(){return this._previousDevices}},{key:"getDevices",value:function(t){return Dn(this,arguments,void 0,function(t){var n=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return h().m(function r(){var a,o,s,c;return h().w(function(r){for(;;)switch(r.n){case 0:if(!((null===(a=e.userMediaPromiseMap)||void 0===a?void 0:a.size)>0)){r.n=6;break}if(bn.debug("awaiting getUserMedia promise"),r.p=1,!t){r.n=3;break}return r.n=2,e.userMediaPromiseMap.get(t);case 2:r.n=4;break;case 3:return r.n=4,Promise.all(e.userMediaPromiseMap.values());case 4:r.n=6;break;case 5:r.p=5,r.v,bn.warn("error waiting for media permissons");case 6:return r.n=7,navigator.mediaDevices.enumerateDevices();case 7:if(o=r.v,!i||po()&&n.hasDeviceInUse(t)){r.n=10;break}if(!(0===o.filter(function(e){return e.kind===t}).length||o.some(function(e){var n=""===e.label,i=!t||e.kind===t;return n&&i}))){r.n=10;break}return s={video:"audioinput"!==t&&"audiooutput"!==t,audio:"videoinput"!==t&&{deviceId:"default"}},r.n=8,navigator.mediaDevices.getUserMedia(s);case 8:return c=r.v,r.n=9,navigator.mediaDevices.enumerateDevices();case 9:o=r.v,c.getTracks().forEach(function(e){e.stop()});case 10:return n._previousDevices=o,t&&(o=o.filter(function(e){return e.kind===t})),r.a(2,o)}},r,null,[[1,5]])})()})}},{key:"normalizeDeviceId",value:function(e,t,n){return Dn(this,void 0,void 0,h().m(function i(){var r,a,o;return h().w(function(i){for(;;)switch(i.n){case 0:if(t===qo){i.n=1;break}return i.a(2,t);case 1:return i.n=2,this.getDevices(e);case 2:if(r=i.v,a=r.find(function(e){return e.deviceId===qo})){i.n=3;break}return bn.warn("could not reliably determine default device"),i.a(2,void 0);case 3:if(o=r.find(function(e){return e.deviceId!==qo&&e.groupId===(null!=n?n:a.groupId)})){i.n=4;break}return bn.warn("could not reliably determine default device"),i.a(2,void 0);case 4:return i.a(2,null==o?void 0:o.deviceId)}},i,this)}))}},{key:"hasDeviceInUse",value:function(t){return t?e.userMediaPromiseMap.has(t):e.userMediaPromiseMap.size>0}}],[{key:"getInstance",value:function(){return void 0===this.instance&&(this.instance=new e),this.instance}}])}();Vo.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],Vo.userMediaPromiseMap=new Map;var Ko,Wo=function(t){function n(t,a,o){var s,c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0;return r(this,n),(s=i(this,n,[t,a,u])).manuallyStopped=!1,s._isUpstreamPaused=!1,s.handleTrackMuteEvent=function(){return s.debouncedTrackMuteHandler().catch(function(){return s.log.debug("track mute bounce got cancelled by an unmute event",s.logContext)})},s.debouncedTrackMuteHandler=Ea(function(){return Dn(s,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.pauseUpstream();case 1:return e.a(2)}},e,this)}))},5e3),s.handleTrackUnmuteEvent=function(){return Dn(s,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)switch(e.n){case 0:return this.debouncedTrackMuteHandler.cancel("unmute"),e.n=1,this.resumeUpstream();case 1:return e.a(2)}},e,this)}))},s.handleEnded=function(){s.isInBackground&&(s.reacquireTrack=!0),s._mediaStreamTrack.removeEventListener("mute",s.handleTrackMuteEvent),s._mediaStreamTrack.removeEventListener("unmute",s.handleTrackUnmuteEvent),s.emit(e.TrackEvent.Ended,s)},s.reacquireTrack=!1,s.providedByUser=c,s.muteLock=new jo,s.pauseUpstreamLock=new jo,s.processorLock=new jo,s.restartLock=new jo,s.setMediaStreamTrack(t,!0),s._constraints=t.getConstraints(),o&&(s._constraints=o),s}return l(n,t),o(n,[{key:"sender",get:function(){return this._sender},set:function(e){this._sender=e}},{key:"constraints",get:function(){return this._constraints}},{key:"id",get:function(){return this._mediaStreamTrack.id}},{key:"dimensions",get:function(){if(this.kind===e.Track.Kind.Video){var t=this._mediaStreamTrack.getSettings(),n=t.width,i=t.height;return n&&i?{width:n,height:i}:void 0}}},{key:"isUpstreamPaused",get:function(){return this._isUpstreamPaused}},{key:"isUserProvided",get:function(){return this.providedByUser}},{key:"mediaStreamTrack",get:function(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}},{key:"getSourceTrackSettings",value:function(){return this._mediaStreamTrack.getSettings()}},{key:"setMediaStreamTrack",value:function(e,t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a=this;return h().w(function(n){for(;;)switch(n.n){case 0:if(e!==this._mediaStreamTrack||t){n.n=1;break}return n.a(2);case 1:if(this._mediaStreamTrack&&(this.attachedElements.forEach(function(e){za(a._mediaStreamTrack,e)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),!this.processor||!e){n.n=7;break}return n.n=2,this.processorLock.lock();case 2:if(r=n.v,n.p=3,this.log.debug("restarting processor",this.logContext),"unknown"!==this.kind){n.n=4;break}throw TypeError("cannot set processor on track of unknown kind");case 4:return this.processorElement&&(Ha(e,this.processorElement),this.processorElement.muted=!0),n.n=5,this.processor.restart({track:e,kind:this.kind,element:this.processorElement});case 5:i=this.processor.processedTrack;case 6:return n.p=6,r(),n.f(6);case 7:if(!this.sender){n.n=8;break}return n.n=8,this.sender.replaceTrack(null!=i?i:e);case 8:if(this.providedByUser||this._mediaStreamTrack===e||this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,!e){n.n=10;break}return this._mediaStreamTrack.enabled=!this.isMuted,n.n=9,this.resumeUpstream();case 9:this.attachedElements.forEach(function(t){Ha(null!=i?i:e,t)});case 10:return n.a(2)}},n,this,[[3,,6,7]])}))}},{key:"waitForDimensions",value:function(){return Dn(this,arguments,void 0,function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return h().m(function i(){var r,a,o;return h().w(function(i){for(;;)switch(i.n){case 0:if(t.kind!==e.Track.Kind.Audio){i.n=1;break}throw new Error("cannot get dimensions for audio tracks");case 1:if("iOS"!==(null===(r=Ia())||void 0===r?void 0:r.os)){i.n=2;break}return i.n=2,oo(10);case 2:a=Date.now();case 3:if(!(Date.now()-a<n)){i.n=6;break}if(!(o=t.dimensions)){i.n=4;break}return i.a(2,o);case 4:return i.n=5,oo(50);case 5:i.n=3;break;case 6:throw new ma("unable to get track dimensions after timeout");case 7:return i.a(2)}},i)})()})}},{key:"setDeviceId",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:if(this._constraints.deviceId!==e||this._mediaStreamTrack.getSettings().deviceId!==Fo(e)){t.n=1;break}return t.a(2,!0);case 1:if(this._constraints.deviceId=e,!this.isMuted){t.n=2;break}return t.a(2,!0);case 2:return t.n=3,this.restartTrack();case 3:return t.a(2,Fo(e)===this._mediaStreamTrack.getSettings().deviceId)}},t,this)}))}},{key:"getDeviceId",value:function(){return Dn(this,arguments,void 0,function(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return h().m(function i(){var r,a,o,s;return h().w(function(i){for(;;)switch(i.n){case 0:if(t.source!==e.Track.Source.ScreenShare){i.n=1;break}return i.a(2);case 1:return r=t._mediaStreamTrack.getSettings(),a=r.deviceId,o=r.groupId,s=t.kind===e.Track.Kind.Audio?"audioinput":"videoinput",i.a(2,n?Vo.getInstance().normalizeDeviceId(s,a,o):a)}},i)})()})}},{key:"mute",value:function(){return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)if(0===e.n)return this.setTrackMuted(!0),e.a(2,this)},e,this)}))}},{key:"unmute",value:function(){return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)if(0===e.n)return this.setTrackMuted(!1),e.a(2,this)},e,this)}))}},{key:"replaceTrack",value:function(e,t){return Dn(this,void 0,void 0,h().m(function n(){var i,r;return h().w(function(n){for(;;)switch(n.n){case 0:if(this.sender){n.n=1;break}throw new ma("unable to replace an unpublished track");case 1:return"boolean"==typeof t?i=t:void 0!==t&&(i=t.userProvidedTrack,r=t.stopProcessor),this.providedByUser=null==i||i,this.log.debug("replace MediaStreamTrack",this.logContext),n.n=2,this.setMediaStreamTrack(e);case 2:if(!r||!this.processor){n.n=3;break}return n.n=3,this.stopProcessor();case 3:return n.a(2,this)}},n,this)}))}},{key:"restart",value:function(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a,o,s=this;return h().w(function(n){for(;;)switch(n.n){case 0:return this.manuallyStopped=!1,n.n=1,this.restartLock.lock();case 1:return i=n.v,n.p=2,t||(t=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t})),r={audio:!1,video:!1},this.kind===e.Track.Kind.Video?r.video=t:r.audio=t,this.attachedElements.forEach(function(e){za(s.mediaStreamTrack,e)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop(),n.n=3,navigator.mediaDevices.getUserMedia(r);case 3:return a=n.v,(o=a.getTracks()[0]).addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),n.n=4,this.setMediaStreamTrack(o);case 4:return this._constraints=t,this.emit(e.TrackEvent.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),n.a(2,this);case 5:return n.p=5,i(),n.f(5);case 6:return n.a(2)}},n,this,[[2,,5,6]])}))}},{key:"setTrackMuted",value:function(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),this.isMuted===t&&this._mediaStreamTrack.enabled!==t||(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?e.TrackEvent.Muted:e.TrackEvent.Unmuted,this))}},{key:"needsReAcquisition",get:function(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}},{key:"handleAppVisibilityChanged",value:function(){var e=this,t=Object.create(null,{handleAppVisibilityChanged:{get:function(){return k(n,"handleAppVisibilityChanged",e,1)}}});return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.handleAppVisibilityChanged.call(this);case 1:if(ko()){e.n=2;break}return e.a(2);case 2:if(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted){e.n=4;break}return this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),e.n=3,this.restart();case 3:this.reacquireTrack=!1;case 4:return e.a(2)}},e,this)}))}},{key:"stop",value:function(){var e;this.manuallyStopped=!0,k(n,"stop",this,3)([]),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}},{key:"pauseUpstream",value:function(){return Dn(this,void 0,void 0,h().m(function t(){var n,i;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.pauseUpstreamLock.lock();case 1:if(n=t.v,t.p=2,!0!==this._isUpstreamPaused){t.n=3;break}return t.a(2);case 3:if(this.sender){t.n=4;break}return this.log.warn("unable to pause upstream for an unpublished track",this.logContext),t.a(2);case 4:if(this._isUpstreamPaused=!0,this.emit(e.TrackEvent.UpstreamPaused,this),!("Safari"===(null==(i=Ia())?void 0:i.name)&&Po(i.version,"12.0")<0)){t.n=5;break}throw new ha("pauseUpstream is not supported on Safari < 12.");case 5:return t.n=6,this.sender.replaceTrack(null);case 6:return t.p=6,n(),t.f(6);case 7:return t.a(2)}},t,this,[[2,,6,7]])}))}},{key:"resumeUpstream",value:function(){return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.pauseUpstreamLock.lock();case 1:if(n=t.v,t.p=2,!1!==this._isUpstreamPaused){t.n=3;break}return t.a(2);case 3:if(this.sender){t.n=4;break}return this.log.warn("unable to resume upstream for an unpublished track",this.logContext),t.a(2);case 4:return this._isUpstreamPaused=!1,this.emit(e.TrackEvent.UpstreamResumed,this),t.n=5,this.sender.replaceTrack(this.mediaStreamTrack);case 5:return t.p=5,n(),t.f(5);case 6:return t.a(2)}},t,this,[[2,,5,6]])}))}},{key:"getRTCStatsReport",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n;return h().w(function(e){for(;;)switch(e.n){case 0:if(null===(t=this.sender)||void 0===t?void 0:t.getStats){e.n=1;break}return e.a(2);case 1:return e.n=2,this.sender.getStats();case 2:return n=e.v,e.a(2,n)}},e,this)}))}},{key:"setProcessor",value:function(t){return Dn(this,arguments,void 0,function(t){var n=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return h().m(function r(){var a,o,c,u,d,l,f;return h().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,n.processorLock.lock();case 1:return c=r.v,r.p=2,n.log.debug("setting up processor",n.logContext),n.processorElement=null!==(a=n.processorElement)&&void 0!==a?a:document.createElement(n.kind),u={kind:n.kind,track:n._mediaStreamTrack,element:n.processorElement,audioContext:n.audioContext},r.n=3,t.init(u);case 3:if(!n.processor){r.n=4;break}return r.n=4,n.stopProcessor();case 4:if("unknown"!==n.kind){r.n=5;break}throw TypeError("cannot set processor on track of unknown kind");case 5:if(Ha(n._mediaStreamTrack,n.processorElement),n.processorElement.muted=!0,n.processorElement.play().catch(function(e){return n.log.error("failed to play processor element",Object.assign(Object.assign({},n.logContext),{error:e}))}),n.processor=t,!n.processor.processedTrack){r.n=6;break}d=s(n.attachedElements);try{for(d.s();!(l=d.n()).done;)(f=l.value)!==n.processorElement&&i&&(za(n._mediaStreamTrack,f),Ha(n.processor.processedTrack,f))}catch(e){d.e(e)}finally{d.f()}return r.n=6,null===(o=n.sender)||void 0===o?void 0:o.replaceTrack(n.processor.processedTrack);case 6:n.emit(e.TrackEvent.TrackProcessorUpdate,n.processor);case 7:return r.p=7,c(),r.f(7);case 8:return r.a(2)}},r,null,[[2,,7,8]])})()})}},{key:"getProcessor",value:function(){return this.processor}},{key:"stopProcessor",value:function(){return Dn(this,arguments,void 0,function(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return h().m(function i(){var r,a;return h().w(function(i){for(;;)switch(i.n){case 0:if(t.processor){i.n=1;break}return i.a(2);case 1:return t.log.debug("stopping processor",t.logContext),null===(r=t.processor.processedTrack)||void 0===r||r.stop(),i.n=2,t.processor.destroy();case 2:return t.processor=void 0,n||(null===(a=t.processorElement)||void 0===a||a.remove(),t.processorElement=void 0),i.n=3,t._mediaStreamTrack.applyConstraints(t._constraints);case 3:return i.n=4,t.setMediaStreamTrack(t._mediaStreamTrack,!0);case 4:t.emit(e.TrackEvent.TrackProcessorUpdate);case 5:return i.a(2)}},i)})()})}}])}(e.Track),Go=function(t){function n(t){var a;return r(this,n),(a=i(this,n)).onWorkerMessage=function(t){var n,i,r=t.data,o=r.kind,s=r.data;switch(o){case"error":bn.error(s.error.message),a.emit(e.EncryptionEvent.EncryptionError,s.error);break;case"initAck":s.enabled&&a.keyProvider.getKeys().forEach(function(e){a.postKey(e)});break;case"enable":if(s.enabled&&a.keyProvider.getKeys().forEach(function(e){a.postKey(e)}),a.encryptionEnabled!==s.enabled&&s.participantIdentity===(null===(n=a.room)||void 0===n?void 0:n.localParticipant.identity))a.emit(e.EncryptionEvent.ParticipantEncryptionStatusChanged,s.enabled,a.room.localParticipant),a.encryptionEnabled=s.enabled;else if(s.participantIdentity){var c=null===(i=a.room)||void 0===i?void 0:i.getParticipantByIdentity(s.participantIdentity);if(!c)throw TypeError("couldn't set encryption status, participant not found".concat(s.participantIdentity));a.emit(e.EncryptionEvent.ParticipantEncryptionStatusChanged,s.enabled,c)}break;case"ratchetKey":a.keyProvider.emit(e.KeyProviderEvent.KeyRatcheted,s.material,s.keyIndex)}},a.onWorkerError=function(t){bn.error("e2ee worker encountered an error:",{error:t.error}),a.emit(e.EncryptionEvent.EncryptionError,t.error)},a.keyProvider=t.keyProvider,a.worker=t.worker,a.encryptionEnabled=!1,a}return l(n,t),o(n,[{key:"setup",value:function(e){if(!ta())throw new ha("tried to setup end-to-end encryption on an unsupported browser");if(bn.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);var t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Rn.getLevel()}};this.worker&&(bn.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}},{key:"setParticipantCryptorEnabled",value:function(e,t){bn.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}},{key:"setSifTrailer",value:function(e){e&&0!==e.length?this.postSifTrailer(e):bn.warn("ignoring server sent trailer as it's empty")}},{key:"setupEngine",value:function(t){var n=this;t.on(e.EngineEvent.RTPVideoMapUpdate,function(e){n.postRTPMap(e)})}},{key:"setupEventListeners",value:function(t,n){var i=this;t.on(e.RoomEvent.TrackPublished,function(e,t){return i.setParticipantCryptorEnabled(e.trackInfo.encryption!==It.NONE,t.identity)}),t.on(e.RoomEvent.ConnectionStateChanged,function(n){n===e.ConnectionState.Connected&&t.remoteParticipants.forEach(function(e){e.trackPublications.forEach(function(t){i.setParticipantCryptorEnabled(t.trackInfo.encryption!==It.NONE,e.identity)})})}).on(e.RoomEvent.TrackUnsubscribed,function(e,t,n){var r,a={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(r=i.worker)||void 0===r||r.postMessage(a)}).on(e.RoomEvent.TrackSubscribed,function(e,t,n){i.setupE2EEReceiver(e,n.identity,t.trackInfo)}).on(e.RoomEvent.SignalConnected,function(){if(!i.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(function(e){i.postKey(e)}),i.setParticipantCryptorEnabled(i.room.localParticipant.isE2EEEnabled,i.room.localParticipant.identity)}),t.localParticipant.on(e.ParticipantEvent.LocalTrackPublished,function(e){return Dn(i,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:this.setupE2EESender(e.track,e.track.sender);case 1:return t.a(2)}},t,this)}))}),n.on(e.KeyProviderEvent.SetKey,function(e){return i.postKey(e)}).on(e.KeyProviderEvent.RatchetRequest,function(e,t){return i.postRatchetRequest(e,t)})}},{key:"postRatchetRequest",value:function(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");var n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}},{key:"postKey",value:function(e){var t,n=e.key,i=e.participantIdentity,r=e.keyIndex;if(!this.worker)throw Error("could not set key, worker is missing");var a={kind:"setKey",data:{participantIdentity:i,isPublisher:i===(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(a)}},{key:"postEnable",value:function(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");var n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}},{key:"postRTPMap",value:function(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");var n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}},{key:"postSifTrailer",value:function(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");var t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}},{key:"setupE2EEReceiver",value:function(e,t,n){if(e.receiver){if(!(null==n?void 0:n.mimeType)||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?no(n.mimeType):void 0)}}},{key:"setupE2EESender",value:function(e,t){e instanceof Wo&&t?this.handleSender(t,e.mediaStreamID,void 0):t||bn.warn("early return because sender is not ready")}},{key:"handleReceiver",value:function(e,t,n,i){return Dn(this,void 0,void 0,h().m(function r(){var a,o,s,c,u,d;return h().w(function(r){for(;;)switch(r.n){case 0:if(this.worker){r.n=1;break}return r.a(2);case 1:if(!na()){r.n=2;break}a={kind:"decode",participantIdentity:n,trackId:t,codec:i},e.transform=new RTCRtpScriptTransform(this.worker,a),r.n=4;break;case 2:if(!($r in e)||!i){r.n=3;break}return o={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}},this.worker.postMessage(o),r.a(2);case 3:s=e.writableStream,c=e.readableStream,s&&c||(u=e.createEncodedStreams(),e.writableStream=u.writable,s=u.writable,e.readableStream=u.readable,c=u.readable),d={kind:"decode",data:{readableStream:c,writableStream:s,trackId:t,codec:i,participantIdentity:n}},this.worker.postMessage(d,[c,s]);case 4:e[$r]=!0;case 5:return r.a(2)}},r,this)}))}},{key:"handleSender",value:function(e,t,n){var i;if(!($r in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity)||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(na()){bn.info("initialize script transform");var r={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{bn.info("initialize encoded streams");var a=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:a.readable,writableStream:a.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o,[a.readable,a.writable])}e[$r]=!0}}}])}(Ki.EventEmitter);!function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(Ko||(Ko={}));var Ho,zo=function(){return o(function e(){r(this,e),this.pendingTasks=new Map,this.taskMutex=new jo,this.nextTaskIndex=0},[{key:"run",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i;return h().w(function(t){for(;;)switch(t.n){case 0:return n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Ko.WAITING},this.pendingTasks.set(n.id,n),t.n=1,this.taskMutex.lock();case 1:return i=t.v,t.p=2,n.executedAt=Date.now(),n.status=Ko.RUNNING,t.n=3,e();case 3:return t.a(2,t.v);case 4:return t.p=4,n.status=Ko.COMPLETED,this.pendingTasks.delete(n.id),i(),t.f(4);case 5:return t.a(2)}},t,this,[[2,,4,5]])}))}},{key:"flush",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t=this;return h().w(function(e){for(;;)if(0===e.n)return e.a(2,this.run(function(){return Dn(t,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)}))}))},e,this)}))}},{key:"snapshot",value:function(){return Array.from(this.pendingTasks.values())}}])}(),Qo=["syncState","trickle","offer","answer","simulate","leave"];function Yo(e){var t=Qo.indexOf(e.case)>=0;return bn.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(Ho||(Ho={}));var Xo=function(){return o(function t(){var n,i=this,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,t),this.rtt=0,this.state=Ho.DISCONNECTED,this.log=bn,this._requestId=0,this.resetCallbacks=function(){i.onAnswer=void 0,i.onLeave=void 0,i.onLocalTrackPublished=void 0,i.onLocalTrackUnpublished=void 0,i.onNegotiateRequested=void 0,i.onOffer=void 0,i.onRemoteMuteChanged=void 0,i.onSubscribedQualityUpdate=void 0,i.onTokenRefresh=void 0,i.onTrickle=void 0,i.onClose=void 0},this.log=Sn(null!==(n=o.loggerName)&&void 0!==n?n:e.LoggerNames.Signal),this.loggerContextCb=o.loggerContextCb,this.useJSON=a,this.requestQueue=new zo,this.queuedRequests=[],this.closingLock=new jo,this.connectionLock=new jo,this.state=Ho.DISCONNECTED},[{key:"currentState",get:function(){return this.state}},{key:"isDisconnected",get:function(){return this.state===Ho.DISCONNECTING||this.state===Ho.DISCONNECTED}},{key:"isEstablishingConnection",get:function(){return this.state===Ho.CONNECTING||this.state===Ho.RECONNECTING}},{key:"getNextRequestId",value:function(){return this._requestId+=1,this._requestId}},{key:"logContext",get:function(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}},{key:"join",value:function(e,t,n,i){return Dn(this,void 0,void 0,h().m(function r(){var a;return h().w(function(r){for(;;)switch(r.n){case 0:return this.state=Ho.CONNECTING,this.options=n,r.n=1,this.connect(e,t,n,i);case 1:return a=r.v,r.a(2,a)}},r,this)}))}},{key:"reconnect",value:function(e,t,n,i){return Dn(this,void 0,void 0,h().m(function r(){var a;return h().w(function(r){for(;;)switch(r.n){case 0:if(this.options){r.n=1;break}return this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext),r.a(2);case 1:return this.state=Ho.RECONNECTING,this.clearPingInterval(),r.n=2,this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}));case 2:return a=r.v,r.a(2,a)}},r,this)}))}},{key:"connect",value:function(e,t,n,i){var r=this;this.connectOptions=n,e=(e=function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(e)).replace(/\/$/,""),e+="/rtc";var a,o,s=function(e,t,n){var i,r=new URLSearchParams;r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid));r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",To()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel);t.os&&r.set("os",t.os);t.osVersion&&r.set("os_version",t.osVersion);t.browser&&r.set("browser",t.browser);t.browserVersion&&r.set("browser_version",t.browserVersion);n.adaptiveStream&&r.set("adaptive_stream","1");n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString());(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&r.set("network",navigator.connection.type);return"?".concat(r.toString())}(t,(o=new Yt({sdk:Qt.JS,protocol:15,version:_a}),To()&&(o.os=null!==(a=Co())&&void 0!==a?a:""),o),n);return new Promise(function(t,a){return Dn(r,void 0,void 0,h().m(function r(){var o,c,u,d=this;return h().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,this.connectionLock.lock();case 1:if(o=r.v,r.p=2,c=function(){return Dn(d,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)switch(e.n){case 0:this.close(),clearTimeout(u),a(new fa("room connection has been cancelled (signal)",3));case 1:return e.a(2)}},e,this)}))},u=setTimeout(function(){d.close(),a(new fa("room connection has timed out (signal)",1))},n.websocketTimeout),(null==i?void 0:i.aborted)&&c(),null==i||i.addEventListener("abort",c),this.log.debug("connecting to ".concat(e+s),this.logContext),!this.ws){r.n=3;break}return r.n=3,this.close(!1);case 3:this.ws=new WebSocket(e+s),this.ws.binaryType="arraybuffer",this.ws.onopen=function(){clearTimeout(u)},this.ws.onerror=function(t){return Dn(d,void 0,void 0,h().m(function n(){var i,r;return h().w(function(n){for(;;)switch(n.n){case 0:if(this.state===Ho.CONNECTED){n.n=8;break}return this.state=Ho.DISCONNECTED,clearTimeout(u),n.p=1,n.n=2,fetch("http".concat(e.substring(2),"/validate").concat(s));case 2:if(!(i=n.v).status.toFixed(0).startsWith("4")){n.n=4;break}return n.n=3,i.text();case 3:r=n.v,a(new fa(r,0,i.status)),n.n=5;break;case 4:a(new fa("Internal error",2,i.status));case 5:n.n=7;break;case 6:n.p=6,n.v,a(new fa("server was not reachable",1));case 7:return n.a(2);case 8:this.handleWSError(t);case 9:return n.a(2)}},n,this,[[1,6]])}))},this.ws.onmessage=function(e){return Dn(d,void 0,void 0,h().m(function r(){var o,s,u,d,l,f;return h().w(function(r){for(;;)switch(r.n){case 0:if("string"!=typeof e.data){r.n=1;break}l=JSON.parse(e.data),d=xn.fromJson(l,{ignoreUnknownFields:!0}),r.n=3;break;case 1:if(!(e.data instanceof ArrayBuffer)){r.n=2;break}d=xn.fromBinary(new Uint8Array(e.data)),r.n=3;break;case 2:return this.log.error("could not decode websocket message: ".concat(T(e.data)),this.logContext),r.a(2);case 3:if(this.state===Ho.CONNECTED){r.n=4;break}if(f=!1,"join"===(null===(o=d.message)||void 0===o?void 0:o.case)?(this.state=Ho.CONNECTED,null==i||i.removeEventListener("abort",c),this.pingTimeoutDuration=d.message.value.pingTimeout,this.pingIntervalDuration=d.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),t(d.message.value)):this.state===Ho.RECONNECTING&&"leave"!==d.message.case?(this.state=Ho.CONNECTED,null==i||i.removeEventListener("abort",c),this.startPingInterval(),"reconnect"===(null===(s=d.message)||void 0===s?void 0:s.case)?t(d.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),t(void 0),f=!0)):this.isEstablishingConnection&&"leave"===d.message.case?a(new fa("Received leave request while trying to (re)connect",4,void 0,d.message.value.reason)):n.reconnect||a(new fa("did not receive join response, got ".concat(null===(u=d.message)||void 0===u?void 0:u.case," instead"),2)),f){r.n=4;break}return r.a(2);case 4:if(!this.signalLatency){r.n=5;break}return r.n=5,oo(this.signalLatency);case 5:this.handleSignalResponse(d);case 6:return r.a(2)}},r,this)}))},this.ws.onclose=function(e){d.isEstablishingConnection&&a(new fa("Websocket got closed during a (re)connection attempt",2)),d.log.warn("websocket closed",Object.assign(Object.assign({},d.logContext),{reason:e.reason,code:e.code,wasClean:e.wasClean,state:d.state})),d.handleOnClose(e.reason)};case 4:return r.p=4,o(),r.f(4);case 5:return r.a(2)}},r,this,[[2,,4,5]])}))})}},{key:"close",value:function(){return Dn(this,arguments,void 0,function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return h().m(function n(){var i,r;return h().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,e.closingLock.lock();case 1:if(i=n.v,n.p=2,e.clearPingInterval(),t&&(e.state=Ho.DISCONNECTING),!e.ws){n.n=4;break}if(e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null,r=new Promise(function(t){e.ws?e.ws.onclose=function(){t()}:t()}),!(e.ws.readyState<e.ws.CLOSING)){n.n=3;break}return e.ws.close(),n.n=3,Promise.race([r,oo(250)]);case 3:e.ws=void 0;case 4:return n.p=4,t&&(e.state=Ho.DISCONNECTED),i(),n.f(4);case 5:return n.a(2)}},n,null,[[2,,4,5]])})()})}},{key:"sendOffer",value:function(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:$o(e)})}},{key:"sendAnswer",value:function(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:$o(e)})}},{key:"sendIceCandidate",value:function(e,t){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new jn({candidateInit:JSON.stringify(e),target:t})})}},{key:"sendMuteTrack",value:function(e,t){return this.log.debug("sending Mute Track req to server",Object.assign(Object.assign({},this.logContext),{trackSid:e,muted:t})),this.sendRequest({case:"mute",value:new Fn({sid:e,muted:t})})}},{key:"sendAddTrack",value:function(e){return this.log.debug("sending Add Track req to server",Object.assign(Object.assign({},this.logContext),{req:e})),this.sendRequest({case:"addTrack",value:e})}},{key:"sendUpdateLocalMetadata",value:function(e,t){return Dn(this,arguments,void 0,function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return h().m(function r(){var a;return h().w(function(r){for(;;)switch(r.n){case 0:return a=n.getNextRequestId(),r.n=1,n.sendRequest({case:"updateMetadata",value:new $n({requestId:a,metadata:e,name:t,attributes:i})});case 1:return r.a(2,a)}},r)})()})}},{key:"sendUpdateTrackSettings",value:function(e){this.log.debug("sending Update Track setting req to server",Object.assign(Object.assign({},this.logContext),{settings:e})),this.sendRequest({case:"trackSetting",value:e})}},{key:"sendUpdateSubscription",value:function(e){return this.log.debug("sending Update Subscription req to server",Object.assign(Object.assign({},this.logContext),{sub:e})),this.sendRequest({case:"subscription",value:e})}},{key:"sendSyncState",value:function(e){return this.log.debug("sending sync state req to server",Object.assign(Object.assign({},this.logContext),{sync:e})),this.sendRequest({case:"syncState",value:e})}},{key:"sendUpdateVideoLayers",value:function(e,t){return this.log.debug("sending update video layer req to server",Object.assign(Object.assign({},this.logContext),{trackSid:e,layers:t})),this.sendRequest({case:"updateLayers",value:new Zn({trackSid:e,layers:t})})}},{key:"sendUpdateSubscriptionPermissions",value:function(e,t){return this.log.debug("sending update subscription permission req to server",Object.assign(Object.assign({},this.logContext),{allParticipants:e,trackPermissions:t})),this.sendRequest({case:"subscriptionPermission",value:new li({allParticipants:e,trackPermissions:t})})}},{key:"sendSimulateScenario",value:function(e){return this.log.debug("sending simulate scenario req to server",Object.assign(Object.assign({},this.logContext),{scenario:e})),this.sendRequest({case:"simulate",value:e})}},{key:"sendPing",value:function(){return this.log.debug("sending ping req to server",this.logContext),Promise.all([this.sendRequest({case:"ping",value:z.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new pi({timestamp:z.parse(Date.now()),rtt:z.parse(this.rtt)})})])}},{key:"sendUpdateLocalAudioTrack",value:function(e,t){return this.sendRequest({case:"updateAudioTrack",value:new zn({trackSid:e,features:t})})}},{key:"sendLeave",value:function(){return this.log.debug("sending leave req to server",this.logContext),this.sendRequest({case:"leave",value:new Xn({canReconnect:!1,reason:e.DisconnectReason.CLIENT_INITIATED,action:Yn.DISCONNECT})})}},{key:"sendRequest",value:function(e){return Dn(this,arguments,void 0,function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return h().m(function i(){var r;return h().w(function(i){for(;;)switch(i.n){case 0:if(t.log.debug("sending request  to server ",Object.assign(Object.assign({},t.logContext),{message:e})),!(!n&&!Yo(e))||t.state!==Ho.RECONNECTING){i.n=1;break}return t.queuedRequests.push(function(){return Dn(t,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.sendRequest(e,!0);case 1:return t.a(2)}},t,this)}))}),i.a(2);case 1:if(n){i.n=2;break}return i.n=2,t.requestQueue.flush();case 2:if(!t.signalLatency){i.n=3;break}return i.n=3,oo(t.signalLatency);case 3:if(t.ws&&t.ws.readyState===t.ws.OPEN){i.n=4;break}return t.log.error("cannot send signal request before connected, type: ".concat(null==e?void 0:e.case),t.logContext),i.a(2);case 4:r=new Ln({message:e});try{t.useJSON?t.ws.send(r.toJsonString()):t.ws.send(r.toBinary())}catch(e){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:e}))}case 5:return i.a(2)}},i)})()})}},{key:"handleSignalResponse",value:function(e){var t,n,i=e.message;if(null!=i){var r=!1;if("answer"===i.case){this.log.debug("the answer response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e}));var a=Zo(i.value);this.onAnswer&&this.onAnswer(a)}else if("offer"===i.case){this.log.debug("the offer response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e}));var o=Zo(i.value);this.onOffer&&this.onOffer(o)}else if("trickle"===i.case){this.log.debug("the trickle response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e}));var s=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(s,i.value.target)}else"update"===i.case?(this.log.debug("the update response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e})),this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[])):"trackPublished"===i.case?(this.log.debug("the trackPublished response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e})),this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value)):"speakersChanged"===i.case?(this.log.debug("the speakersChanged response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e})),this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[])):"leave"===i.case?(this.log.debug("the leave response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e})),this.onLeave&&this.onLeave(i.value)):"mute"===i.case?(this.log.debug("the mute response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e})),this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted)):"roomUpdate"===i.case?(this.log.debug("the roomUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e})),this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room)):"connectionQuality"===i.case?(this.log.debug("the connectionQuality response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e})),this.onConnectionQuality&&this.onConnectionQuality(i.value)):"streamStateUpdate"===i.case?(this.log.debug("the streamStateUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e})),this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value)):"subscribedQualityUpdate"===i.case?(this.log.debug("the subscribedQualityUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e})),this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value)):"subscriptionPermissionUpdate"===i.case?(this.log.debug("the subscriptionPermissionUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e})),this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value)):"refreshToken"===i.case?(this.log.debug("the refreshToken response from server is: ",Object.assign(Object.assign({},this.logContext),{response:e})),this.onTokenRefresh&&this.onTokenRefresh(i.value)):"trackUnpublished"===i.case?(this.log.debug("the trackUnpublished response from server is:",Object.assign(Object.assign({},this.logContext),{response:e})),this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value)):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):"requestResponse"===i.case?this.onRequestResponse&&this.onRequestResponse(i.value):"trackSubscribed"===i.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));r||this.resetPingTimeout()}else this.log.debug("received unsupported message",this.logContext)}},{key:"setReconnected",value:function(){for(;this.queuedRequests.length>0;){var e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}},{key:"handleOnClose",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:if(this.state!==Ho.DISCONNECTED){t.n=1;break}return t.a(2);case 1:return n=this.onClose,t.n=2,this.close();case 2:this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e);case 3:return t.a(2)}},t,this)}))}},{key:"handleWSError",value:function(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}},{key:"resetPingTimeout",value:function(){var e=this;this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=Aa.setTimeout(function(){e.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*e.pingTimeoutDuration).toUTCString()),e.logContext),e.handleOnClose("ping timeout")},1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}},{key:"clearPingTimeout",value:function(){this.pingTimeout&&Aa.clearTimeout(this.pingTimeout)}},{key:"startPingInterval",value:function(){var e=this;this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=Aa.setInterval(function(){e.sendPing()},1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}},{key:"clearPingInterval",value:function(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Aa.clearInterval(this.pingInterval)}}])}();function Zo(e){var t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function $o(e){return new Kn({sdp:e.sdp,type:e.type})}var es={},ts={exports:{}},ns=ts.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(ns).forEach(function(e){ns[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})});var is=ts.exports;!function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var a=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var a=0;a<i.length;a+=1)null!=e[a+1]&&(n[i[a]]=t(e[a+1]))}(i.match(e.reg),a,e.names,e.name),e.push&&n[e.push].push(a)},i=is,r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},a=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),o=a[a.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,o,r)}}),t.media=a,t};var a=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})})},e.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}})})}}(es);var rs=is,as=/%[sdv%]/g,os=function(e){var t=1,n=arguments,i=n.length;return e.replace(as,function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},ss=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var a=t.names[r];t.name?i.push(n[t.name][a]):i.push(n[t.names[r]])}else i.push(n[t.name]);return os.apply(null,i)},cs=["v","o","s","i","u","e","p","c","b","t","r","z","a"],us=["i","c","b","a"],ds=es,ls=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||cs,i=t.innerOrder||us,r=[];return n.forEach(function(t){rs[t].forEach(function(n){n.name in e&&null!=e[n.name]?r.push(ss(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){r.push(ss(t,n,e))})})}),e.media.forEach(function(e){r.push(ss("m",rs.m[0],e)),i.forEach(function(t){rs[t].forEach(function(n){n.name in e&&null!=e[n.name]?r.push(ss(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){r.push(ss(t,n,e))})})})}),r.join("\r\n")+"\r\n"},fs=ls,hs=ds.parse,ms="negotiationStarted",vs="negotiationComplete",ps="rtpVideoPayloadTypes",gs=function(t){function n(t){var a,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(this,n),(a=i(this,n)).log=bn,a.ddExtID=0,a.pendingCandidates=[],a.restartingIce=!1,a.renegotiate=!1,a.trackBitrates=[],a.remoteStereoMids=[],a.remoteNackMids=[],a.negotiate=Ea(function(e){return Dn(a,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return this.emit(ms),t.p=1,t.n=2,this.createAndSendOffer();case 2:t.n=5;break;case 3:if(t.p=3,n=t.v,!e){t.n=4;break}e(n),t.n=5;break;case 4:throw n;case 5:return t.a(2)}},t,this,[[1,3]])}))},20),a.close=function(){a._pc&&(a._pc.close(),a._pc.onconnectionstatechange=null,a._pc.oniceconnectionstatechange=null,a._pc.onicegatheringstatechange=null,a._pc.ondatachannel=null,a._pc.onnegotiationneeded=null,a._pc.onsignalingstatechange=null,a._pc.onicecandidate=null,a._pc.ondatachannel=null,a._pc.ontrack=null,a._pc.onconnectionstatechange=null,a._pc.oniceconnectionstatechange=null,a._pc=null)},a.log=Sn(null!==(o=s.loggerName)&&void 0!==o?o:e.LoggerNames.PCTransport),a.loggerOptions=s,a.config=t,a._pc=a.createPC(),a}return l(n,t),o(n,[{key:"pc",get:function(){return this._pc||(this._pc=this.createPC()),this._pc}},{key:"createPC",value:function(){var e=this,t=new RTCPeerConnection(this.config);return t.onicecandidate=function(t){var n;t.candidate&&(null===(n=e.onIceCandidate)||void 0===n||n.call(e,t.candidate))},t.onicecandidateerror=function(t){var n;null===(n=e.onIceCandidateError)||void 0===n||n.call(e,t)},t.oniceconnectionstatechange=function(){var n;null===(n=e.onIceConnectionStateChange)||void 0===n||n.call(e,t.iceConnectionState)},t.onsignalingstatechange=function(){var n;null===(n=e.onSignalingStatechange)||void 0===n||n.call(e,t.signalingState)},t.onconnectionstatechange=function(){var n;null===(n=e.onConnectionStateChange)||void 0===n||n.call(e,t.connectionState)},t.ondatachannel=function(t){var n;null===(n=e.onDataChannel)||void 0===n||n.call(e,t)},t.ontrack=function(t){var n;null===(n=e.onTrack)||void 0===n||n.call(e,t)},t}},{key:"logContext",get:function(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}},{key:"isICEConnected",get:function(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}},{key:"addIceCandidate",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:if(!this.pc.remoteDescription||this.restartingIce){t.n=1;break}return t.a(2,this.pc.addIceCandidate(e));case 1:this.pendingCandidates.push(e);case 2:return t.a(2)}},t,this)}))}},{key:"setRemoteDescription",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i,r,a,o,c,u=this;return h().w(function(t){for(;;)switch(t.n){case 0:return i=void 0,"offer"===e.type?(r=ys(e),a=r.stereoMids,o=r.nackMids,this.remoteStereoMids=a,this.remoteNackMids=o):"answer"===e.type&&((c=hs(null!==(n=e.sdp)&&void 0!==n?n:"")).media.forEach(function(e){"audio"===e.type&&u.trackBitrates.some(function(t){if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;var n=0;if(e.rtp.some(function(e){return e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)}),0===n)return!0;var i,r=!1,a=s(e.fmtp);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o.payload===n){o.config=o.config.split(";").filter(function(e){return!e.includes("maxaveragebitrate")}).join(";"),t.maxbr>0&&(o.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),r=!0;break}}}catch(e){a.e(e)}finally{a.f()}return r||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0})}),i=fs(c)),t.n=1,this.setMungedSDP(e,i,!0);case 1:if(this.pendingCandidates.forEach(function(e){u.pc.addIceCandidate(e)}),this.pendingCandidates=[],this.restartingIce=!1,!this.renegotiate){t.n=3;break}return this.renegotiate=!1,t.n=2,this.createAndSendOffer();case 2:t.n=4;break;case 3:"answer"===e.type&&(this.emit(vs),e.sdp&&hs(e.sdp).media.forEach(function(e){"video"===e.type&&u.emit(ps,e.rtp)}));case 4:return t.a(2)}},t,this)}))}},{key:"createAndSendOffer",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i,r,a,o=this;return h().w(function(t){for(;;)switch(t.n){case 0:if(void 0!==this.onOffer){t.n=1;break}return t.a(2);case 1:if((null==e?void 0:e.iceRestart)&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),!this._pc||"have-local-offer"!==this._pc.signalingState){t.n=5;break}if(i=this._pc.remoteDescription,!(null==e?void 0:e.iceRestart)||!i){t.n=3;break}return t.n=2,this._pc.setRemoteDescription(i);case 2:t.n=4;break;case 3:return this.renegotiate=!0,t.a(2);case 4:t.n=6;break;case 5:if(this._pc&&"closed"!==this._pc.signalingState){t.n=6;break}return this.log.warn("could not createOffer with closed peer connection",this.logContext),t.a(2);case 6:return this.log.debug("starting to negotiate",this.logContext),t.n=7,this.pc.createOffer(e);case 7:return r=t.v,this.log.debug("original offer",Object.assign({sdp:r.sdp},this.logContext)),(a=hs(null!==(n=r.sdp)&&void 0!==n?n:"")).media.forEach(function(e){bs(e),"audio"===e.type?ks(e,[],[]):"video"===e.type&&o.trackBitrates.some(function(t){if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;var n=0;if(e.rtp.some(function(e){return e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)}),0===n)return!0;if(fo(t.codec)&&o.ensureVideoDDExtensionForSVC(e,a),"av1"!==t.codec)return!0;var i,r=Math.round(.7*t.maxbr),c=s(e.fmtp);try{for(c.s();!(i=c.n()).done;){var u=i.value;if(u.payload===n){u.config.includes("x-google-start-bitrate")||(u.config+=";x-google-start-bitrate=".concat(r));break}}}catch(e){c.e(e)}finally{c.f()}return!0})}),t.n=8,this.setMungedSDP(r,fs(a));case 8:this.onOffer(r);case 9:return t.a(2)}},t,this)}))}},{key:"createAndSetAnswer",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n,i,r=this;return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.pc.createAnswer();case 1:return n=e.v,(i=hs(null!==(t=n.sdp)&&void 0!==t?t:"")).media.forEach(function(e){bs(e),"audio"===e.type&&ks(e,r.remoteStereoMids,r.remoteNackMids)}),e.n=2,this.setMungedSDP(n,fs(i));case 2:return e.a(2,n)}},e,this)}))}},{key:"createDataChannel",value:function(e,t){return this.pc.createDataChannel(e,t)}},{key:"addTransceiver",value:function(e,t){return this.pc.addTransceiver(e,t)}},{key:"addTrack",value:function(e){if(!this._pc)throw new pa("PC closed, cannot add track");return this._pc.addTrack(e)}},{key:"setTrackCodecBitrate",value:function(e){this.trackBitrates.push(e)}},{key:"setConfiguration",value:function(e){var t;if(!this._pc)throw new pa("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}},{key:"canRemoveTrack",value:function(){var e;return!!(null===(e=this._pc)||void 0===e?void 0:e.removeTrack)}},{key:"removeTrack",value:function(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}},{key:"getConnectionState",value:function(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}},{key:"getICEConnectionState",value:function(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}},{key:"getSignallingState",value:function(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}},{key:"getTransceivers",value:function(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}},{key:"getSenders",value:function(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}},{key:"getLocalDescription",value:function(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}},{key:"getRemoteDescription",value:function(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}},{key:"getStats",value:function(){return this.pc.getStats()}},{key:"getConnectedAddress",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n,i,r,a;return h().w(function(e){for(;;)switch(e.n){case 0:if(this._pc){e.n=1;break}return e.a(2);case 1:return n="",i=new Map,r=new Map,e.n=2,this._pc.getStats();case 2:if(e.v.forEach(function(e){switch(e.type){case"transport":n=e.selectedCandidatePairId;break;case"candidate-pair":""===n&&e.selected&&(n=e.id),i.set(e.id,e);break;case"remote-candidate":r.set(e.id,"".concat(e.address,":").concat(e.port))}}),""!==n){e.n=3;break}return e.a(2,void 0);case 3:if(void 0!==(a=null===(t=i.get(n))||void 0===t?void 0:t.remoteCandidateId)){e.n=4;break}return e.a(2,void 0);case 4:return e.a(2,r.get(a))}},e,this)}))}},{key:"setMungedSDP",value:function(e,t,n){return Dn(this,void 0,void 0,h().m(function i(){var r,a,o,s,c;return h().w(function(i){for(;;)switch(i.n){case 0:if(!t){i.n=6;break}if(r=e.sdp,e.sdp=t,i.p=1,this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),!n){i.n=3;break}return i.n=2,this.pc.setRemoteDescription(e);case 2:i.n=4;break;case 3:return i.n=4,this.pc.setLocalDescription(e);case 4:return i.a(2);case 5:i.p=5,s=i.v,this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:t})),e.sdp=r;case 6:if(i.p=6,!n){i.n=8;break}return i.n=7,this.pc.setRemoteDescription(e);case 7:i.n=9;break;case 8:return i.n=9,this.pc.setLocalDescription(e);case 9:i.n=11;break;case 10:throw i.p=10,c=i.v,a="unknown error",c instanceof Error?a=c.message:"string"==typeof c&&(a=c),o={error:a,sdp:e.sdp},!n&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new ga(a);case 11:return i.a(2)}},i,this,[[6,10],[1,5]])}))}},{key:"ensureVideoDDExtensionForSVC",value:function(e,t){var n,i;if(!(null===(n=e.ext)||void 0===n?void 0:n.some(function(e){return e.uri===ao}))){if(0===this.ddExtID){var r=0;t.media.forEach(function(e){var t;"video"===e.type&&(null===(t=e.ext)||void 0===t||t.forEach(function(e){e.value>r&&(r=e.value)}))}),this.ddExtID=r+1}null===(i=e.ext)||void 0===i||i.push({value:this.ddExtID,uri:ao})}}}])}(Ki.EventEmitter);function ks(e,t,n){var i=0;e.rtp.some(function(e){return"opus"===e.codec&&(i=e.payload,!0)}),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some(function(e){return e.payload===i&&"nack"===e.type})&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some(function(e){return e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0)}))}function ys(e){var t,n=[],i=[],r=hs(null!==(t=e.sdp)&&void 0!==t?t:""),a=0;return r.media.forEach(function(e){var t;"audio"===e.type&&(e.rtp.some(function(e){return"opus"===e.codec&&(a=e.payload,!0)}),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some(function(e){return e.payload===a&&"nack"===e.type}))&&i.push(e.mid),e.fmtp.some(function(t){return t.payload===a&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0)}))}),{stereoMids:n,nackMids:i}}function bs(e){if(e.connection){var t=e.connection.ip.indexOf(":")>=0;(4===e.connection.version&&t||6===e.connection.version&&!t)&&(e.connection.ip="0.0.0.0",e.connection.version=4)}}var Ts,Ss="vp8",ws={audioPreset:e.AudioPresets.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Ja.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Ss,backupCodec:!0},Cs={deviceId:"default",autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Es={deviceId:"default",resolution:Fa.h720.resolution},Ps={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Nn,disconnectOnPageLeave:!0,webAudioMix:!1},Rs={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(Ts||(Ts={}));var Is=function(){return o(function t(n,i,a){var o,s=this;r(this,t),this.peerConnectionTimeout=Rs.peerConnectionTimeout,this.log=bn,this.updateState=function(){var e,t=s.state,n=s.requiredTransports.map(function(e){return e.getConnectionState()});n.every(function(e){return"connected"===e})?s.state=Ts.CONNECTED:n.some(function(e){return"failed"===e})?s.state=Ts.FAILED:n.some(function(e){return"connecting"===e})?s.state=Ts.CONNECTING:n.every(function(e){return"closed"===e})?s.state=Ts.CLOSED:n.some(function(e){return"closed"===e})?s.state=Ts.CLOSING:n.every(function(e){return"new"===e})&&(s.state=Ts.NEW),t!==s.state&&(s.log.debug("pc state change: from ".concat(Ts[t]," to ").concat(Ts[s.state]),s.logContext),null===(e=s.onStateChange)||void 0===e||e.call(s,s.state,s.publisher.getConnectionState(),s.subscriber.getConnectionState()))},this.log=Sn(null!==(o=a.loggerName)&&void 0!==o?o:e.LoggerNames.PCManager),this.loggerOptions=a,this.isPublisherConnectionRequired=!i,this.isSubscriberConnectionRequired=i,this.publisher=new gs(n,a),this.subscriber=new gs(n,a),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=function(e){var t;null===(t=s.onIceCandidate)||void 0===t||t.call(s,e,wn.PUBLISHER)},this.subscriber.onIceCandidate=function(e){var t;null===(t=s.onIceCandidate)||void 0===t||t.call(s,e,wn.SUBSCRIBER)},this.subscriber.onDataChannel=function(e){var t;null===(t=s.onDataChannel)||void 0===t||t.call(s,e)},this.subscriber.onTrack=function(e){var t;null===(t=s.onTrack)||void 0===t||t.call(s,e)},this.publisher.onOffer=function(e){var t;null===(t=s.onPublisherOffer)||void 0===t||t.call(s,e)},this.state=Ts.NEW,this.connectionLock=new jo,this.remoteOfferLock=new jo},[{key:"needsPublisher",get:function(){return this.isPublisherConnectionRequired}},{key:"needsSubscriber",get:function(){return this.isSubscriberConnectionRequired}},{key:"currentState",get:function(){return this.state}},{key:"logContext",get:function(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}},{key:"requirePublisher",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}},{key:"requireSubscriber",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}},{key:"createAndSendPublisherOffer",value:function(e){return this.publisher.createAndSendOffer(e)}},{key:"setPublisherAnswer",value:function(e){return this.publisher.setRemoteDescription(e)}},{key:"removeTrack",value:function(e){return this.publisher.removeTrack(e)}},{key:"close",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n,i,r;return h().w(function(e){for(;;)switch(e.n){case 0:if(this.publisher&&"closed"!==this.publisher.getSignallingState()){t=this.publisher,n=s(t.getSenders());try{for(n.s();!(i=n.n()).done;){r=i.value;try{t.canRemoveTrack()&&t.removeTrack(r)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}}catch(e){n.e(e)}finally{n.f()}}return e.n=1,Promise.all([this.publisher.close(),this.subscriber.close()]);case 1:this.updateState();case 2:return e.a(2)}},e,this)}))}},{key:"triggerIceRestart",value:function(){return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)switch(e.n){case 0:if(this.subscriber.restartingIce=!0,!this.needsPublisher){e.n=1;break}return e.n=1,this.createAndSendPublisherOffer({iceRestart:!0});case 1:return e.a(2)}},e,this)}))}},{key:"addIceCandidate",value:function(e,t){return Dn(this,void 0,void 0,h().m(function n(){return h().w(function(n){for(;;)switch(n.n){case 0:if(t!==wn.PUBLISHER){n.n=2;break}return n.n=1,this.publisher.addIceCandidate(e);case 1:n.n=3;break;case 2:return n.n=3,this.subscriber.addIceCandidate(e);case 3:return n.a(2)}},n,this)}))}},{key:"createSubscriberAnswerFromOffer",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i;return h().w(function(t){for(;;)switch(t.n){case 0:return this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()})),t.n=1,this.remoteOfferLock.lock();case 1:return n=t.v,t.p=2,t.n=3,this.subscriber.setRemoteDescription(e);case 3:return t.n=4,this.subscriber.createAndSetAnswer();case 4:return i=t.v,t.a(2,i);case 5:return t.p=5,n(),t.f(5);case 6:return t.a(2)}},t,this,[[2,,5,6]])}))}},{key:"updateConfiguration",value:function(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}},{key:"ensurePCTransportConnection",value:function(e,t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a=this;return h().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,this.connectionLock.lock();case 1:return r=n.v,n.p=2,this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),n.n=3,Promise.all(null===(i=this.requiredTransports)||void 0===i?void 0:i.map(function(n){return a.ensureTransportConnected(n,e,t)}));case 3:return n.p=3,r(),n.f(3);case 4:return n.a(2)}},n,this,[[2,,3,4]])}))}},{key:"negotiate",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n=this;return h().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t,i){return Dn(n,void 0,void 0,h().m(function n(){var r,a,o=this;return h().w(function(n){for(;;)switch(n.n){case 0:return r=setTimeout(function(){i("negotiation timed out")},this.peerConnectionTimeout),a=function(){clearTimeout(r),i("negotiation aborted")},e.signal.addEventListener("abort",a),this.publisher.once(ms,function(){e.signal.aborted||o.publisher.once(vs,function(){clearTimeout(r),t()})}),n.n=1,this.publisher.negotiate(function(e){clearTimeout(r),i(e)});case 1:return n.a(2)}},n,this)}))}))},t)}))}},{key:"addPublisherTransceiver",value:function(e,t){return this.publisher.addTransceiver(e,t)}},{key:"addPublisherTrack",value:function(e){return this.publisher.addTrack(e)}},{key:"createPublisherDataChannel",value:function(e,t){return this.publisher.createDataChannel(e,t)}},{key:"getConnectedAddress",value:function(e){return e===wn.PUBLISHER||e===wn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}},{key:"requiredTransports",get:function(){var e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}},{key:"ensureTransportConnected",value:function(e,t){return Dn(this,arguments,void 0,function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return h().m(function r(){return h().w(function(r){for(;;)switch(r.n){case 0:if("connected"!==e.getConnectionState()){r.n=1;break}return r.a(2);case 1:return r.a(2,new Promise(function(e,r){return Dn(n,void 0,void 0,h().m(function n(){var a,o,s=this;return h().w(function(n){for(;;)switch(n.n){case 0:a=function(){s.log.warn("abort transport connection",s.logContext),Aa.clearTimeout(o),r(new fa("room connection has been cancelled",3))},(null==t?void 0:t.signal.aborted)&&a(),null==t||t.signal.addEventListener("abort",a),o=Aa.setTimeout(function(){null==t||t.signal.removeEventListener("abort",a),r(new fa("could not establish pc connection",2))},i);case 1:if(this.state===Ts.CONNECTED){n.n=4;break}return n.n=2,oo(50);case 2:if(!(null==t?void 0:t.signal.aborted)){n.n=3;break}return r(new fa("room connection has been cancelled",3)),n.a(2);case 3:n.n=1;break;case 4:Aa.clearTimeout(o),null==t||t.signal.removeEventListener("abort",a),e();case 5:return n.a(2)}},n,this)}))}))}},r)})()})}}])}(),Os=2e3;function Ns(e,t){return t?("bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)):0;var n,i}var Ds=function(t){function n(t,a){var o,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;return r(this,n),(o=i(this,n,[t,e.Track.Kind.Audio,a,s,u])).stopOnMute=!1,o.isKrispNoiseFilterEnabled=!1,o.monitorSender=function(){return Dn(o,void 0,void 0,h().m(function e(){var t,n;return h().w(function(e){for(;;)switch(e.n){case 0:if(this.sender){e.n=1;break}return this._currentBitrate=0,e.a(2);case 1:return e.p=1,e.n=2,this.getSenderStats();case 2:t=e.v,e.n=4;break;case 3:return e.p=3,n=e.v,this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:n})),e.a(2);case 4:t&&this.prevStats&&(this._currentBitrate=Ns(t,this.prevStats)),this.prevStats=t;case 5:return e.a(2)}},e,this,[[1,3]])}))},o.handleKrispNoiseFilterEnable=function(){o.isKrispNoiseFilterEnabled=!0,o.log.debug("Krisp noise filter enabled",o.logContext),o.emit(e.TrackEvent.AudioTrackFeatureUpdate,o,pt.TF_ENHANCED_NOISE_CANCELLATION,!0)},o.handleKrispNoiseFilterDisable=function(){o.isKrispNoiseFilterEnabled=!1,o.log.debug("Krisp noise filter disabled",o.logContext),o.emit(e.TrackEvent.AudioTrackFeatureUpdate,o,pt.TF_ENHANCED_NOISE_CANCELLATION,!1)},o.audioContext=c,o.checkForSilence(),o}return l(n,t),o(n,[{key:"enhancedNoiseCancellation",get:function(){return this.isKrispNoiseFilterEnabled}},{key:"mute",value:function(){var t=this,i=Object.create(null,{mute:{get:function(){return k(n,"mute",t,1)}}});return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.muteLock.lock();case 1:if(n=t.v,t.p=2,!this.isMuted){t.n=3;break}return this.log.debug("Track already muted",this.logContext),t.a(2,this);case 3:return this.source===e.Track.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),t.n=4,i.mute.call(this);case 4:return t.a(2,this);case 5:return t.p=5,n(),t.f(5);case 6:return t.a(2)}},t,this,[[2,,5,6]])}))}},{key:"unmute",value:function(){var t=this,i=Object.create(null,{unmute:{get:function(){return k(n,"unmute",t,1)}}});return Dn(this,void 0,void 0,h().m(function t(){var n,r;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.muteLock.lock();case 1:if(n=t.v,t.p=2,this.isMuted){t.n=3;break}return this.log.debug("Track already unmuted",this.logContext),t.a(2,this);case 3:if(r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Fo(this._constraints.deviceId),this.source!==e.Track.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState&&!r||this.isUserProvided){t.n=4;break}return this.log.debug("reacquiring mic track",this.logContext),t.n=4,this.restartTrack();case 4:return t.n=5,i.unmute.call(this);case 5:return t.a(2,this);case 6:return t.p=6,n(),t.f(6);case 7:return t.a(2)}},t,this,[[2,,6,7]])}))}},{key:"restartTrack",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i;return h().w(function(t){for(;;)switch(t.n){case 0:return e&&"boolean"!=typeof(i=Xa({audio:e})).audio&&(n=i.audio),t.n=1,this.restart(n);case 1:return t.a(2)}},t,this)}))}},{key:"restart",value:function(e){var t=this,i=Object.create(null,{restart:{get:function(){return k(n,"restart",t,1)}}});return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,i.restart.call(this,e);case 1:return n=t.v,this.checkForSilence(),t.a(2,n)}},t,this)}))}},{key:"startMonitor",value:function(){var e=this;bo()&&(this.monitorInterval||(this.monitorInterval=setInterval(function(){e.monitorSender()},Os)))}},{key:"setProcessor",value:function(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a;return h().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,this.processorLock.lock();case 1:if(r=n.v,n.p=2,this.audioContext){n.n=3;break}throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");case 3:if(!this.processor){n.n=4;break}return n.n=4,this.stopProcessor();case 4:return a={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext},this.log.debug("setting up audio processor ".concat(t.name),this.logContext),n.n=5,t.init(a);case 5:if(this.processor=t,!this.processor.processedTrack){n.n=7;break}return n.n=6,null===(i=this.sender)||void 0===i?void 0:i.replaceTrack(this.processor.processedTrack);case 6:this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable);case 7:this.emit(e.TrackEvent.TrackProcessorUpdate,this.processor);case 8:return n.p=8,r(),n.f(8);case 9:return n.a(2)}},n,this,[[2,,8,9]])}))}},{key:"setAudioContext",value:function(e){this.audioContext=e}},{key:"getSenderStats",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n;return h().w(function(e){for(;;)switch(e.n){case 0:if(null===(t=this.sender)||void 0===t?void 0:t.getStats){e.n=1;break}return e.a(2,void 0);case 1:return e.n=2,this.sender.getStats();case 2:return e.v.forEach(function(e){"outbound-rtp"===e.type&&(n={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})}),e.a(2,n)}},e,this)}))}},{key:"checkForSilence",value:function(){return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Za(this);case 1:return(n=t.v)&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(e.TrackEvent.AudioSilenceDetected)),t.a(2,n)}},t,this)}))}}])}(Wo);function _s(e,t,n){switch(e.kind){case"audio":return new Ds(e,t,!1,void 0,n);case"video":return new Hs(e,t,!1,n);default:throw new ma("unsupported track type: ".concat(e.kind))}}var As=Object.values(Fa),Ls=Object.values(Ba),xs=Object.values(Ja),Ms=[Fa.h540,Fa.h720],Us=[Ba.h540,Ba.h720],js=["q","h","f"];function Fs(e,t,n,i){var r,a,o=null==i?void 0:i.videoEncoding;e&&(o=null==i?void 0:i.screenShareEncoding);var s=null==i?void 0:i.simulcast,c=null==i?void 0:i.scalabilityMode,u=null==i?void 0:i.videoCodec;if(!o&&!s&&!c||!t||!n)return[{}];o||(o=Js(e,t,n,u),bn.debug("using video encoding",o));var d=o.maxFramerate,l=new xa(t,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&fo(u)){var f=new Ws(c),h=[];if(f.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));var m=Ia();if(po()||To()||"Chrome"===(null==m?void 0:m.name)&&Po(null==m?void 0:m.version,"113")<0){for(var v="h"==f.suffix?2:3,p=0;p<f.spatial;p+=1)h.push({rid:js[2-p],maxBitrate:o.maxBitrate/Math.pow(v,p),maxFramerate:l.encoding.maxFramerate});h[0].scalabilityMode=c}else h.push({maxBitrate:o.maxBitrate,maxFramerate:l.encoding.maxFramerate,scalabilityMode:c});return l.encoding.priority&&(h[0].priority=l.encoding.priority,h[0].networkPriority=l.encoding.priority),bn.debug("using svc encoding",{encodings:h}),h}if(!s)return[o];var k,y=[];if((y=e?null!==(r=Ks(null==i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:qs(e,l):null!==(a=Ks(null==i?void 0:i.videoSimulcastLayers))&&void 0!==a?a:qs(e,l)).length>0){var b=y[0];if(y.length>1)k=g(y,2)[1];var T=Math.max(t,n);if(T>=960&&k)return Vs(t,n,[b,k,l],d);if(T>=480)return Vs(t,n,[b,l],d)}return Vs(t,n,[l])}function Bs(t,n,i){var r,a,o,s;if(i.backupCodec&&!0!==i.backupCodec&&i.backupCodec.codec!==i.videoCodec){n!==i.backupCodec.codec&&bn.warn("requested a different codec than specified as backup",{serverRequested:n,backup:i.backupCodec.codec}),i.videoCodec=n,i.videoEncoding=i.backupCodec.encoding;var c=t.mediaStreamTrack.getSettings(),u=null!==(r=c.width)&&void 0!==r?r:null===(a=t.dimensions)||void 0===a?void 0:a.width,d=null!==(o=c.height)&&void 0!==o?o:null===(s=t.dimensions)||void 0===s?void 0:s.height;return Fs(t.source===e.Track.Source.ScreenShare,u,d,i)}}function Js(e,t,n,i){for(var r=function(e,t,n){if(e)return xs;var i=t>n?t/n:n/t;if(Math.abs(i-16/9)<Math.abs(i-4/3))return As;return Ls}(e,t,n),a=r[0].encoding,o=Math.max(t,n),s=0;s<r.length;s+=1){var c=r[s];if(a=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":(a=Object.assign({},a)).maxBitrate=.7*a.maxBitrate;break;case"vp9":(a=Object.assign({},a)).maxBitrate=.85*a.maxBitrate}return a}function qs(e,t){if(e)return[{scaleResolutionDownBy:2,fps:(n=t).encoding.maxFramerate}].map(function(e){var t,i;return new xa(Math.floor(n.width/e.scaleResolutionDownBy),Math.floor(n.height/e.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(e.scaleResolutionDownBy,2)*((null!==(t=n.encoding.maxFramerate)&&void 0!==t?t:30)/(null!==(i=e.fps)&&void 0!==i?i:30))))),e.fps,n.encoding.priority)});var n,i=t.width,r=t.height,a=i>r?i/r:r/i;return Math.abs(a-16/9)<Math.abs(a-4/3)?Ms:Us}function Vs(e,t,n,i){var r=[];if(n.forEach(function(n,a){if(!(a>=js.length)){var o=Math.min(e,t),s={rid:js[a],scaleResolutionDownBy:Math.max(1,o/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate},c=i&&n.encoding.maxFramerate?Math.min(i,n.encoding.maxFramerate):n.encoding.maxFramerate;c&&(s.maxFramerate=c);var u=vo()||0===a;n.encoding.priority&&u&&(s.priority=n.encoding.priority,s.networkPriority=n.encoding.priority),r.push(s)}}),To()&&"ios"===Co()){var a=void 0;r.forEach(function(e){a?e.maxFramerate&&e.maxFramerate>a&&(a=e.maxFramerate):a=e.maxFramerate});var o=!0;r.forEach(function(e){var t;e.maxFramerate!=a&&(o&&(o=!1,bn.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),bn.info('Setting framerate of encoding "'.concat(null!==(t=e.rid)&&void 0!==t?t:"",'" to ').concat(a)),e.maxFramerate=a)})}return r}function Ks(e){if(e)return e.sort(function(e,t){var n=e.encoding,i=t.encoding;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0})}var Ws=function(){return o(function e(t){r(this,e);var n=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}},[{key:"toString",value:function(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}])}();function Gs(t){return t.source===e.Track.Source.ScreenShare||t.constraints.height&&Fo(t.constraints.height)>=1080?"maintain-resolution":"balanced"}var Hs=function(t){function n(t,a){var o,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=arguments.length>3?arguments[3]:void 0;return r(this,n),(o=i(this,n,[t,e.Track.Kind.Video,a,s,c])).simulcastCodecs=new Map,o.degradationPreference="balanced",o.monitorSender=function(){return Dn(o,void 0,void 0,h().m(function e(){var t,n,i,r,a=this;return h().w(function(e){for(;;)switch(e.n){case 0:if(this.sender){e.n=1;break}return this._currentBitrate=0,e.a(2);case 1:return e.p=1,e.n=2,this.getSenderStats();case 2:t=e.v,e.n=4;break;case 3:return e.p=3,r=e.v,this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:r})),e.a(2);case 4:n=new Map(t.map(function(e){return[e.rid,e]})),this.prevStats&&(i=0,n.forEach(function(e,t){var n,r=null===(n=a.prevStats)||void 0===n?void 0:n.get(t);i+=Ns(e,r)}),this._currentBitrate=i),this.prevStats=n;case 5:return e.a(2)}},e,this,[[1,3]])}))},o.senderLock=new jo,o}return l(n,t),o(n,[{key:"sender",get:function(){return this._sender},set:function(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}},{key:"isSimulcast",get:function(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}},{key:"startMonitor",value:function(e){var t,n=this;if(this.signalClient=e,bo()){var i=null===(t=this.sender)||void 0===t?void 0:t.getParameters();i&&(this.encodings=i.encodings),this.monitorInterval||(this.monitorInterval=setInterval(function(){n.monitorSender()},Os))}}},{key:"stop",value:function(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(function(e){e.mediaStreamTrack.stop()}),k(n,"stop",this,3)([])}},{key:"pauseUpstream",value:function(){var e=this,t=Object.create(null,{pauseUpstream:{get:function(){return k(n,"pauseUpstream",e,1)}}});return Dn(this,void 0,void 0,h().m(function e(){var n,i,r,a,o,s,c,u,d,l;return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.pauseUpstream.call(this);case 1:e.p=1,s=!0,c=An(this.simulcastCodecs.values());case 2:return e.n=3,c.next();case 3:if(u=e.v,n=u.done){e.n=5;break}return a=u.value,s=!1,d=a,e.n=4,null===(o=d.sender)||void 0===o?void 0:o.replaceTrack(null);case 4:s=!0,e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,l=e.v,i={error:l};case 7:if(e.p=7,e.p=8,s||n||!(r=c.return)){e.n=9;break}return e.n=9,r.call(c);case 9:if(e.p=9,!i){e.n=10;break}throw i.error;case 10:return e.f(9);case 11:return e.f(7);case 12:return e.a(2)}},e,this,[[8,,9,11],[1,6,7,12]])}))}},{key:"resumeUpstream",value:function(){var e=this,t=Object.create(null,{resumeUpstream:{get:function(){return k(n,"resumeUpstream",e,1)}}});return Dn(this,void 0,void 0,h().m(function e(){var n,i,r,a,o,s,c,u,d,l;return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.resumeUpstream.call(this);case 1:e.p=1,s=!0,c=An(this.simulcastCodecs.values());case 2:return e.n=3,c.next();case 3:if(u=e.v,n=u.done){e.n=5;break}return a=u.value,s=!1,d=a,e.n=4,null===(o=d.sender)||void 0===o?void 0:o.replaceTrack(d.mediaStreamTrack);case 4:s=!0,e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,l=e.v,i={error:l};case 7:if(e.p=7,e.p=8,s||n||!(r=c.return)){e.n=9;break}return e.n=9,r.call(c);case 9:if(e.p=9,!i){e.n=10;break}throw i.error;case 10:return e.f(9);case 11:return e.f(7);case 12:return e.a(2)}},e,this,[[8,,9,11],[1,6,7,12]])}))}},{key:"mute",value:function(){var t=this,i=Object.create(null,{mute:{get:function(){return k(n,"mute",t,1)}}});return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.muteLock.lock();case 1:if(n=t.v,t.p=2,!this.isMuted){t.n=3;break}return this.log.debug("Track already muted",this.logContext),t.a(2,this);case 3:return this.source!==e.Track.Source.Camera||this.isUserProvided||(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),t.n=4,i.mute.call(this);case 4:return t.a(2,this);case 5:return t.p=5,n(),t.f(5);case 6:return t.a(2)}},t,this,[[2,,5,6]])}))}},{key:"unmute",value:function(){var t=this,i=Object.create(null,{unmute:{get:function(){return k(n,"unmute",t,1)}}});return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.muteLock.lock();case 1:if(n=t.v,t.p=2,this.isMuted){t.n=3;break}return this.log.debug("Track already unmuted",this.logContext),t.a(2,this);case 3:if(this.source!==e.Track.Source.Camera||this.isUserProvided){t.n=4;break}return this.log.debug("reacquiring camera track",this.logContext),t.n=4,this.restartTrack();case 4:return t.n=5,i.unmute.call(this);case 5:return t.a(2,this);case 6:return t.p=6,n(),t.f(6);case 7:return t.a(2)}},t,this,[[2,,6,7]])}))}},{key:"setTrackMuted",value:function(e){k(n,"setTrackMuted",this,3)([e]);var t,i=s(this.simulcastCodecs.values());try{for(i.s();!(t=i.n()).done;){t.value.mediaStreamTrack.enabled=!e}}catch(e){i.e(e)}finally{i.f()}}},{key:"getSenderStats",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n,i;return h().w(function(e){for(;;)switch(e.n){case 0:if(null===(t=this.sender)||void 0===t?void 0:t.getStats){e.n=1;break}return e.a(2,[]);case 1:return n=[],e.n=2,this.sender.getStats();case 2:return(i=e.v).forEach(function(e){var t;if("outbound-rtp"===e.type){var r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(t=e.rid)&&void 0!==t?t:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},a=i.get(e.remoteId);a&&(r.jitter=a.jitter,r.packetsLost=a.packetsLost,r.roundTripTime=a.roundTripTime),n.push(r)}}),n.sort(function(e,t){var n,i;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(i=e.frameWidth)&&void 0!==i?i:0)}),e.a(2,n)}},e,this)}))}},{key:"setPublishingQuality",value:function(t){for(var n=[],i=e.VideoQuality.LOW;i<=e.VideoQuality.HIGH;i+=1)n.push(new si({quality:i,enabled:i<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(n)}},{key:"restartTrack",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i,r,a,o,s,c,u,d,l,f;return h().w(function(t){for(;;)switch(t.n){case 0:return e&&"boolean"!=typeof(s=Xa({video:e})).video&&(o=s.video),t.n=1,this.restart(o);case 1:t.p=1,c=!0,u=An(this.simulcastCodecs.values());case 2:return t.n=3,u.next();case 3:if(d=t.v,n=d.done){t.n=5;break}if(a=d.value,c=!1,!(l=a).sender){t.n=4;break}return l.mediaStreamTrack=this.mediaStreamTrack.clone(),t.n=4,l.sender.replaceTrack(l.mediaStreamTrack);case 4:c=!0,t.n=2;break;case 5:t.n=7;break;case 6:t.p=6,f=t.v,i={error:f};case 7:if(t.p=7,t.p=8,c||n||!(r=u.return)){t.n=9;break}return t.n=9,r.call(u);case 9:if(t.p=9,!i){t.n=10;break}throw i.error;case 10:return t.f(9);case 11:return t.f(7);case 12:return t.a(2)}},t,this,[[8,,9,11],[1,6,7,12]])}))}},{key:"setProcessor",value:function(e){var t=this,i=Object.create(null,{setProcessor:{get:function(){return k(n,"setProcessor",t,1)}}});return Dn(this,arguments,void 0,function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return h().m(function r(){var a,o,s,c,u,d,l,f,m,v,p;return h().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,i.setProcessor.call(t,e,n);case 1:if(!(null===(u=t.processor)||void 0===u?void 0:u.processedTrack)){r.n=13;break}r.p=2,l=!0,f=An(t.simulcastCodecs.values());case 3:return r.n=4,f.next();case 4:if(m=r.v,a=m.done){r.n=6;break}return c=m.value,l=!1,v=c,r.n=5,null===(d=v.sender)||void 0===d?void 0:d.replaceTrack(t.processor.processedTrack);case 5:l=!0,r.n=3;break;case 6:r.n=8;break;case 7:r.p=7,p=r.v,o={error:p};case 8:if(r.p=8,r.p=9,l||a||!(s=f.return)){r.n=10;break}return r.n=10,s.call(f);case 10:if(r.p=10,!o){r.n=11;break}throw o.error;case 11:return r.f(10);case 12:return r.f(8);case 13:return r.a(2)}},r,null,[[9,,10,12],[2,7,8,13]])})()})}},{key:"setDegradationPreference",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext),(n=this.sender.getParameters()).degradationPreference=e,this.sender.setParameters(n)}catch(e){this.log.warn("failed to set degradationPreference",Object.assign({error:e},this.logContext))}case 1:return t.a(2)}},t,this)}))}},{key:"addSimulcastTrack",value:function(e,t){if(!this.simulcastCodecs.has(e)){var n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext)}},{key:"setSimulcastTrackSender",value:function(e,t){var n=this,i=this.simulcastCodecs.get(e);i&&(i.sender=t,setTimeout(function(){n.subscribedCodecs&&n.setPublishingCodecs(n.subscribedCodecs)},5e3))}},{key:"setPublishingCodecs",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i,r,a,o,c,u,d,l,f,m,v,p,g;return h().w(function(t){for(;;)switch(t.n){case 0:if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),this.codec||!(e.length>0)){t.n=2;break}return t.n=1,this.setPublishingLayers(e[0].qualities);case 1:return t.a(2,[]);case 2:this.subscribedCodecs=e,d=[],t.p=3,n=!0,i=An(e);case 4:return t.n=5,i.next();case 5:if(r=t.v,a=r.done){t.n=17;break}if(u=r.value,n=!1,l=u,this.codec&&this.codec!==l.codec){t.n=7;break}return t.n=6,this.setPublishingLayers(l.qualities);case 6:t.n=16;break;case 7:if(f=this.simulcastCodecs.get(l.codec),this.log.debug("try setPublishingCodec for ".concat(l.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:f})),f&&f.sender){t.n=15;break}m=s(l.qualities),t.p=8,m.s();case 9:if((v=m.n()).done){t.n=11;break}if(!v.value.enabled){t.n=10;break}return d.push(l.codec),t.a(3,11);case 10:t.n=9;break;case 11:t.n=13;break;case 12:t.p=12,p=t.v,m.e(p);case 13:return t.p=13,m.f(),t.f(13);case 14:t.n=16;break;case 15:if(!f.encodings){t.n=16;break}return this.log.debug("try setPublishingLayersForSender ".concat(l.codec),this.logContext),t.n=16,zs(f.sender,f.encodings,l.qualities,this.senderLock,this.log,this.logContext);case 16:n=!0,t.n=4;break;case 17:t.n=19;break;case 18:t.p=18,g=t.v,o={error:g};case 19:if(t.p=19,t.p=20,n||a||!(c=i.return)){t.n=21;break}return t.n=21,c.call(i);case 21:if(t.p=21,!o){t.n=22;break}throw o.error;case 22:return t.f(21);case 23:return t.f(19);case 24:return t.a(2,d)}},t,this,[[20,,21,23],[8,12,13,14],[3,18,19,24]])}))}},{key:"setPublishingLayers",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:if(this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),this.sender&&this.encodings){t.n=1;break}return t.a(2);case 1:return t.n=2,zs(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext);case 2:return t.a(2)}},t,this)}))}},{key:"handleAppVisibilityChanged",value:function(){var t=this,i=Object.create(null,{handleAppVisibilityChanged:{get:function(){return k(n,"handleAppVisibilityChanged",t,1)}}});return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,i.handleAppVisibilityChanged.call(this);case 1:if(ko()){t.n=2;break}return t.a(2);case 2:this.isInBackground&&this.source===e.Track.Source.Camera&&(this._mediaStreamTrack.enabled=!1);case 3:return t.a(2)}},t,this)}))}}])}(Wo);function zs(e,t,n,i,r,a){return Dn(this,void 0,void 0,h().m(function o(){var s,c,u,d;return h().w(function(o){for(;;)switch(o.n){case 0:return o.n=1,i.lock();case 1:if(s=o.v,r.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:e,qualities:n,senderEncodings:t})),o.p=2,c=e.getParameters(),u=c.encodings){o.n=3;break}return o.a(2);case 3:if(u.length===t.length){o.n=4;break}return r.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:u,senderEncodings:t})),o.a(2);case 4:if(d=!1,u.forEach(function(e,i){var o,s=null!==(o=e.rid)&&void 0!==o?o:"";""===s&&(s="q");var c=Qs(s),u=n.find(function(e){return e.quality===c});u&&e.active!==u.enabled&&(d=!0,e.active=u.enabled,r.debug("setting layer ".concat(u.quality," to ").concat(e.active?"enabled":"disabled"),a),vo()&&(u.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))}),!d){o.n=5;break}return c.encodings=u,r.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:c.encodings})),o.n=5,e.setParameters(c);case 5:return o.p=5,s(),o.f(5);case 6:return o.a(2)}},o,null,[[2,,5,6]])}))}function Qs(t){switch(t){case"f":default:return e.VideoQuality.HIGH;case"h":return e.VideoQuality.MEDIUM;case"q":return e.VideoQuality.LOW}}function Ys(t,n,i,r){if(!i)return[new _t({quality:e.VideoQuality.HIGH,width:t,height:n,bitrate:0,ssrc:0})];if(r){for(var a=i[0].scalabilityMode,o=new Ws(a),s=[],c="h"==o.suffix?1.5:2,u="h"==o.suffix?2:3,d=0;d<o.spatial;d+=1)s.push(new _t({quality:Math.min(e.VideoQuality.HIGH,o.spatial-1)-d,width:Math.ceil(t/Math.pow(c,d)),height:Math.ceil(n/Math.pow(c,d)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(u,d)):0,ssrc:0}));return s}return i.map(function(e){var i,r,a,o=null!==(i=e.scaleResolutionDownBy)&&void 0!==i?i:1,s=Qs(null!==(r=e.rid)&&void 0!==r?r:"");return new _t({quality:s,width:Math.ceil(t/o),height:Math.ceil(n/o),bitrate:null!==(a=e.maxBitrate)&&void 0!==a?a:0,ssrc:0})})}var Xs,Zs="_lossy",$s="_reliable",ec="leave-reconnect";!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(Xs||(Xs={}));var tc=function(t){function n(t){var a,o;return r(this,n),(a=i(this,n)).options=t,a.rtcConfig={},a.peerConnectionTimeout=Rs.peerConnectionTimeout,a.fullReconnectOnNext=!1,a.subscriberPrimary=!1,a.hasPublished=!1,a.pcState=Xs.New,a._isClosed=!0,a.pendingTrackResolvers={},a.reconnectAttempts=0,a.reconnectStart=0,a.attemptingReconnect=!1,a.joinAttempts=0,a.maxJoinAttempts=1,a.firstReconnectAttempt=!0,a.shouldFailNext=!1,a.log=bn,a.disconnectStartTimePrimary=0,a.disconnectStartTimeSecondary=0,a.handleDataChannel=function(e){return Dn(a,[e],void 0,function(e){var t=this,n=e.channel;return h().m(function e(){return h().w(function(e){for(;;)switch(e.n){case 0:if(n){e.n=1;break}return e.a(2);case 1:if(n.label!==$s){e.n=2;break}t.reliableDCSub=n,e.n=4;break;case 2:if(n.label!==Zs){e.n=3;break}t.lossyDCSub=n,e.n=4;break;case 3:return e.a(2);case 4:t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage;case 5:return e.a(2)}},e)})()})},a.handleDataMessage=function(t){return Dn(a,void 0,void 0,h().m(function n(){var i,r,a,o,s;return h().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,this.dataProcessLock.lock();case 1:if(a=n.v,n.p=2,!(t.data instanceof ArrayBuffer)){n.n=3;break}o=t.data,n.n=6;break;case 3:if(!(t.data instanceof Blob)){n.n=5;break}return n.n=4,t.data.arrayBuffer();case 4:o=n.v,n.n=6;break;case 5:return this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:t.data})),n.a(2);case 6:s=Lt.fromBinary(new Uint8Array(o)),"speaker"===(null===(i=s.value)||void 0===i?void 0:i.case)?this.emit(e.EngineEvent.ActiveSpeakersUpdate,s.value.value.speakers):("user"===(null===(r=s.value)||void 0===r?void 0:r.case)&&rc(s,s.value.value),this.emit(e.EngineEvent.DataPacketReceived,s));case 7:return n.p=7,a(),n.f(7);case 8:return n.a(2)}},n,this,[[2,,7,8]])}))},a.handleDataError=function(e){var t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){var n=e.error.error;a.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},a.logContext),{error:n}))}else a.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},a.logContext),{event:e}))},a.handleBufferedAmountLow=function(t){var n=0===t.currentTarget.maxRetransmits?e.DataPacket_Kind.LOSSY:e.DataPacket_Kind.RELIABLE;a.updateAndEmitDCBufferStatus(n)},a.handleDisconnect=function(t,n){if(!a._isClosed){a.log.warn("".concat(t," disconnected"),a.logContext),0===a.reconnectAttempts&&(a.reconnectStart=Date.now());var i=Date.now()-a.reconnectStart,r=a.getNextRetryDelay({elapsedMs:i,retryCount:a.reconnectAttempts});null!==r?(t===ec&&(r=0),a.log.debug("reconnecting in ".concat(r,"ms"),a.logContext),a.clearReconnectTimeout(),a.token&&a.regionUrlProvider&&a.regionUrlProvider.updateToken(a.token),a.reconnectTimeout=Aa.setTimeout(function(){return a.attemptReconnect(n).finally(function(){return a.reconnectTimeout=void 0})},r)):function(t){a.log.warn("could not recover connection after ".concat(a.reconnectAttempts," attempts, ").concat(t,"ms. giving up"),a.logContext),a.emit(e.EngineEvent.Disconnected),a.close()}(i)}},a.waitForRestarted=function(){return new Promise(function(t,n){a.pcState===Xs.Connected&&t();var i=function(){a.off(e.EngineEvent.Disconnected,r),t()},r=function(){a.off(e.EngineEvent.Restarted,i),n()};a.once(e.EngineEvent.Restarted,i),a.once(e.EngineEvent.Disconnected,r)})},a.updateAndEmitDCBufferStatus=function(t){var n=a.isBufferStatusLow(t);void 0!==n&&n!==a.dcBufferStatus.get(t)&&(a.dcBufferStatus.set(t,n),a.emit(e.EngineEvent.DCBufferStatusChanged,n,t))},a.isBufferStatusLow=function(e){var t=a.dataChannelForKind(e);if(t)return t.bufferedAmount<=t.bufferedAmountLowThreshold},a.handleBrowserOnLine=function(){a.client.currentState===Ho.RECONNECTING&&(a.clearReconnectTimeout(),a.attemptReconnect(mt.RR_SIGNAL_DISCONNECTED))},a.log=Sn(null!==(o=t.loggerName)&&void 0!==o?o:e.LoggerNames.Engine),a.loggerOptions={loggerName:t.loggerName,loggerContextCb:function(){return a.logContext}},a.client=new Xo(void 0,a.loggerOptions),a.client.signalLatency=a.options.expSignalLatency,a.reconnectPolicy=a.options.reconnectPolicy,a.registerOnLineListener(),a.closingLock=new jo,a.dataProcessLock=new jo,a.dcBufferStatus=new Map([[e.DataPacket_Kind.LOSSY,!0],[e.DataPacket_Kind.RELIABLE,!0]]),a.client.onParticipantUpdate=function(t){return a.emit(e.EngineEvent.ParticipantUpdate,t)},a.client.onConnectionQuality=function(t){return a.emit(e.EngineEvent.ConnectionQualityUpdate,t)},a.client.onRoomUpdate=function(t){return a.emit(e.EngineEvent.RoomUpdate,t)},a.client.onSubscriptionError=function(t){return a.emit(e.EngineEvent.SubscriptionError,t)},a.client.onSubscriptionPermissionUpdate=function(t){return a.emit(e.EngineEvent.SubscriptionPermissionUpdate,t)},a.client.onSpeakersChanged=function(t){return a.emit(e.EngineEvent.SpeakersChanged,t)},a.client.onStreamStateUpdate=function(t){return a.emit(e.EngineEvent.StreamStateChanged,t)},a.client.onRequestResponse=function(t){return a.emit(e.EngineEvent.SignalRequestResponse,t)},a}return l(n,t),o(n,[{key:"isClosed",get:function(){return this._isClosed}},{key:"pendingReconnect",get:function(){return!!this.reconnectTimeout}},{key:"logContext",get:function(){var e,t,n,i,r,a,o,s;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,participant:null===(a=null===(r=this.latestJoinResponse)||void 0===r?void 0:r.participant)||void 0===a?void 0:a.identity,pID:null===(s=null===(o=this.latestJoinResponse)||void 0===o?void 0:o.participant)||void 0===s?void 0:s.sid}}},{key:"join",value:function(e,t,n,i){return Dn(this,void 0,void 0,h().m(function r(){var a,o;return h().w(function(r){for(;;)switch(r.n){case 0:return this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries,r.p=1,this.joinAttempts+=1,this.setupSignalClientCallbacks(),r.n=2,this.client.join(e,t,n,i);case 2:if(a=r.v,this._isClosed=!1,this.latestJoinResponse=a,this.subscriberPrimary=a.subscriberPrimary,this.pcManager){r.n=3;break}return r.n=3,this.configure(a);case 3:return this.subscriberPrimary&&!a.fastPublish||this.negotiate(),this.clientConfiguration=a.clientConfiguration,r.a(2,a);case 4:if(r.p=4,!((o=r.v)instanceof fa)){r.n=5;break}if(1!==o.reason){r.n=5;break}if(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),!(this.joinAttempts<this.maxJoinAttempts)){r.n=5;break}return r.a(2,this.join(e,t,n,i));case 5:throw o;case 6:return r.a(2)}},r,this,[[1,4]])}))}},{key:"close",value:function(){return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.closingLock.lock();case 1:if(n=t.v,!this.isClosed){t.n=2;break}return n(),t.a(2);case 2:return t.p=2,this._isClosed=!0,this.joinAttempts=0,this.emit(e.EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),t.n=3,this.cleanupPeerConnections();case 3:return t.n=4,this.cleanupClient();case 4:return t.p=4,n(),t.f(4);case 5:return t.a(2)}},t,this,[[2,,4,5]])}))}},{key:"cleanupPeerConnections",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n;return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,null===(t=this.pcManager)||void 0===t?void 0:t.close();case 1:this.pcManager=void 0,(n=function(e){e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)})(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0;case 2:return e.a(2)}},e,this)}))}},{key:"cleanupClient",value:function(){return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.client.close();case 1:this.client.resetCallbacks();case 2:return e.a(2)}},e,this)}))}},{key:"addTrack",value:function(e){var t=this;if(this.pendingTrackResolvers[e.cid])throw new ma("a track with the same ID has already been published");return new Promise(function(n,i){var r=setTimeout(function(){delete t.pendingTrackResolvers[e.cid],i(new fa("publication of local track timed out, no response from server",2))},1e4);t.pendingTrackResolvers[e.cid]={resolve:function(e){clearTimeout(r),n(e)},reject:function(){clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},t.client.sendAddTrack(e)})}},{key:"removeTrack",value:function(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){var t=this.pendingTrackResolvers[e.track.id].reject;t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(e){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:e}))}return!1}},{key:"updateMuteStatus",value:function(e,t){this.client.sendMuteTrack(e,t)}},{key:"dataSubscriberReadyState",get:function(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}},{key:"getConnectedServerAddress",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t;return h().w(function(e){for(;;)if(0===e.n)return e.a(2,null===(t=this.pcManager)||void 0===t?void 0:t.getConnectedAddress())},e,this)}))}},{key:"setRegionUrlProvider",value:function(e){this.regionUrlProvider=e}},{key:"configure",value:function(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a,o=this;return h().w(function(n){for(;;)switch(n.n){case 0:if(!this.pcManager||this.pcManager.currentState===Ts.NEW){n.n=1;break}return n.a(2);case 1:this.participantSid=null===(i=t.participant)||void 0===i?void 0:i.sid,a=this.makeRTCConfiguration(t),this.pcManager=new Is(a,t.subscriberPrimary,this.loggerOptions),this.emit(e.EngineEvent.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=function(e,t){o.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=function(e){o.client.sendOffer(e)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=function(n,i,r){return Dn(o,void 0,void 0,h().m(function a(){var o,s,c;return h().w(function(a){for(;;)switch(a.n){case 0:this.log.debug("primary PC state changed ".concat(n),this.logContext),["closed","disconnected","failed"].includes(i)&&(this.publisherConnectionPromise=void 0),n===Ts.CONNECTED?(o=this.pcState===Xs.New,this.pcState=Xs.Connected,o&&this.emit(e.EngineEvent.Connected,t)):n===Ts.FAILED&&this.pcState===Xs.Connected&&(this.pcState=Xs.Disconnected,this.handleDisconnect("peerconnection failed","failed"===r?mt.RR_SUBSCRIBER_FAILED:mt.RR_PUBLISHER_FAILED)),s=this.client.isDisconnected||this.client.currentState===Ho.RECONNECTING,c=[Ts.FAILED,Ts.CLOSING,Ts.CLOSED].includes(n),s&&c&&!this._isClosed&&this.emit(e.EngineEvent.Offline);case 1:return a.a(2)}},a,this)}))},this.pcManager.onTrack=function(t){o.emit(e.EngineEvent.MediaTrackAdded,t.track,t.streams[0],t.receiver)},ic(null===(r=t.serverInfo)||void 0===r?void 0:r.protocol)||this.createDataChannels();case 2:return n.a(2)}},n,this)}))}},{key:"setupSignalClientCallbacks",value:function(){var t=this;this.client.onAnswer=function(e){return Dn(t,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:if(this.pcManager){t.n=1;break}return t.a(2);case 1:return this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),t.n=2,this.pcManager.setPublisherAnswer(e);case 2:return t.a(2)}},t,this)}))},this.client.onTrickle=function(e,n){t.pcManager&&(t.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},t.logContext),{candidate:e,target:n})),t.pcManager.addIceCandidate(e,n))},this.client.onOffer=function(e){return Dn(t,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:if(this.pcManager){t.n=1;break}return t.a(2);case 1:return t.n=2,this.pcManager.createSubscriberAnswerFromOffer(e);case 2:n=t.v,this.client.sendAnswer(n);case 3:return t.a(2)}},t,this)}))},this.client.onLocalTrackPublished=function(e){var n;if(t.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},t.logContext),{cid:e.cid,track:null===(n=e.track)||void 0===n?void 0:n.sid})),t.pendingTrackResolvers[e.cid]){var i=t.pendingTrackResolvers[e.cid].resolve;delete t.pendingTrackResolvers[e.cid],i(e.track)}else t.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},t.logContext),{cid:e.cid}))},this.client.onLocalTrackUnpublished=function(n){t.emit(e.EngineEvent.LocalTrackUnpublished,n)},this.client.onLocalTrackSubscribed=function(n){t.emit(e.EngineEvent.LocalTrackSubscribed,n)},this.client.onTokenRefresh=function(e){t.token=e,sessionStorage.setItem("token",t.token)},this.client.onRemoteMuteChanged=function(n,i){t.emit(e.EngineEvent.RemoteMute,n,i)},this.client.onSubscribedQualityUpdate=function(n){t.emit(e.EngineEvent.SubscribedQualityUpdate,n)},this.client.onClose=function(){t.handleDisconnect("signal",mt.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=function(n){switch(t.log.debug("client leave request",Object.assign(Object.assign({},t.logContext),{reason:null==n?void 0:n.reason})),sessionStorage.removeItem("token"),sessionStorage.removeItem("isAudioMuted"),sessionStorage.removeItem("isVideoMuted"),n.regions&&t.regionUrlProvider&&(t.log.debug("updating regions",t.logContext),t.regionUrlProvider.setServerReportedRegions(n.regions)),n.action){case Yn.DISCONNECT:t.emit(e.EngineEvent.Disconnected,null==n?void 0:n.reason),t.close();break;case Yn.RECONNECT:t.fullReconnectOnNext=!0,t.handleDisconnect(ec);break;case Yn.RESUME:t.handleDisconnect(ec)}}}},{key:"makeRTCConfiguration",value:function(e){var t,n=Object.assign({},this.rtcConfig);if((null===(t=this.signalOpts)||void 0===t?void 0:t.e2eeEnabled)&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){var i=[];e.iceServers.forEach(function(e){var t={urls:e.urls};e.username&&(t.username=e.username),e.credential&&(t.credential=e.credential),i.push(t)}),n.iceServers=i}return e.clientConfiguration&&e.clientConfiguration.forceRelay===ft.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}},{key:"createDataChannels",value:function(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Zs,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel($s,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}},{key:"createSender",value:function(e,t,n){return Dn(this,void 0,void 0,h().m(function i(){var r,a;return h().w(function(i){for(;;)switch(i.n){case 0:if(!so()){i.n=2;break}return i.n=1,this.createTransceiverRTCRtpSender(e,t,n);case 1:return r=i.v,i.a(2,r);case 2:if(!co()){i.n=4;break}return this.log.warn("using add-track fallback",this.logContext),i.n=3,this.createRTCRtpSender(e.mediaStreamTrack);case 3:return a=i.v,i.a(2,a);case 4:throw new pa("Required webRTC APIs not supported on this device");case 5:return i.a(2)}},i,this)}))}},{key:"createSimulcastSender",value:function(e,t,n,i){return Dn(this,void 0,void 0,h().m(function r(){return h().w(function(r){for(;;)switch(r.n){case 0:if(!so()){r.n=1;break}return r.a(2,this.createSimulcastTransceiverSender(e,t,n,i));case 1:if(!co()){r.n=2;break}return this.log.debug("using add-track fallback",this.logContext),r.a(2,this.createRTCRtpSender(e.mediaStreamTrack));case 2:throw new pa("Cannot stream on this device");case 3:return r.a(2)}},r,this)}))}},{key:"createTransceiverRTCRtpSender",value:function(e,t,n){return Dn(this,void 0,void 0,h().m(function i(){var r,a,o;return h().w(function(i){for(;;)switch(i.n){case 0:if(this.pcManager){i.n=1;break}throw new pa("publisher is closed");case 1:return r=[],e.mediaStream&&r.push(e.mediaStream),e instanceof Hs&&(e.codec=t.videoCodec),a={direction:"sendonly",streams:r},n&&(a.sendEncodings=n),i.n=2,this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,a);case 2:return o=i.v,i.a(2,o.sender)}},i,this)}))}},{key:"createSimulcastTransceiverSender",value:function(e,t,n,i){return Dn(this,void 0,void 0,h().m(function r(){var a,o;return h().w(function(r){for(;;)switch(r.n){case 0:if(this.pcManager){r.n=1;break}throw new pa("publisher is closed");case 1:return a={direction:"sendonly"},i&&(a.sendEncodings=i),r.n=2,this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,a);case 2:if(o=r.v,n.videoCodec){r.n=3;break}return r.a(2);case 3:return e.setSimulcastTrackSender(n.videoCodec,o.sender),r.a(2,o.sender)}},r,this)}))}},{key:"createRTCRtpSender",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:if(this.pcManager){t.n=1;break}throw new pa("publisher is closed");case 1:return t.a(2,this.pcManager.addPublisherTrack(e))}},t,this)}))}},{key:"attemptReconnect",value:function(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a,o,s;return h().w(function(n){for(;;)switch(n.n){case 0:if(!this._isClosed){n.n=1;break}return n.a(2);case 1:if(!this.attemptingReconnect){n.n=2;break}return bn.warn("already attempting reconnect, returning early",this.logContext),n.a(2);case 2:if((null===(i=this.clientConfiguration)||void 0===i?void 0:i.resumeConnection)!==ft.DISABLED&&(null!==(a=null===(r=this.pcManager)||void 0===r?void 0:r.currentState)&&void 0!==a?a:Ts.NEW)!==Ts.NEW||(this.fullReconnectOnNext=!0),n.p=3,this.attemptingReconnect=!0,!this.fullReconnectOnNext){n.n=5;break}return n.n=4,this.restartConnection();case 4:n.n=6;break;case 5:return n.n=6,this.resumeConnection(t);case 6:this.clearPendingReconnect(),this.fullReconnectOnNext=!1,n.n=9;break;case 7:if(n.p=7,s=n.v,this.reconnectAttempts+=1,o=!0,s instanceof pa?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof nc||(this.fullReconnectOnNext=!0),!o){n.n=8;break}this.handleDisconnect("reconnect",mt.RR_UNKNOWN),n.n=9;break;case 8:return this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(e.EngineEvent.Disconnected),n.n=9,this.close();case 9:return n.p=9,this.attemptingReconnect=!1,n.f(9);case 10:return n.a(2)}},n,this,[[3,7,9,10]])}))}},{key:"getNextRetryDelay",value:function(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(e){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:e}))}return null}},{key:"restartConnection",value:function(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a,o,s,c,u,d;return h().w(function(n){for(;;)switch(n.n){case 0:if(n.p=0,this.url&&this.token){n.n=1;break}throw new pa("could not reconnect, url or token not saved");case 1:if(this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(e.EngineEvent.Restarting),this.client.isDisconnected){n.n=2;break}return n.n=2,this.client.sendLeave();case 2:return n.n=3,this.cleanupPeerConnections();case 3:return n.n=4,this.cleanupClient();case 4:if(n.p=4,this.signalOpts){n.n=5;break}throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new nc;case 5:return n.n=6,this.join(null!=t?t:this.url,this.token,this.signalOpts);case 6:o=n.v,n.n=9;break;case 7:if(n.p=7,!((u=n.v)instanceof fa&&0===u.reason)){n.n=8;break}throw new pa("could not reconnect, token might be expired");case 8:throw new nc;case 9:if(!this.shouldFailNext){n.n=10;break}throw this.shouldFailNext=!1,new Error("simulated failure");case 10:return this.client.setReconnected(),this.emit(e.EngineEvent.SignalRestarted,o),n.n=11,this.waitForPCReconnected();case 11:if(this.client.currentState===Ho.CONNECTED){n.n=12;break}throw new nc("Signal connection got severed during reconnect");case 12:this.client.setReconnected(),this.emit(e.EngineEvent.SignalRestarted,o),null===(i=this.regionUrlProvider)||void 0===i||i.resetAttempts(),this.emit(e.EngineEvent.Restarted),s=Date.now(),0==this.disconnectStartTimePrimary&&(this.disconnectStartTimePrimary=s),0==this.disconnectStartTimeSecondary&&(this.disconnectStartTimeSecondary=s),this.emit(e.EngineEvent.PrimaryDelay,s-this.disconnectStartTimePrimary),this.emit(e.EngineEvent.SecondaryDelay,s-this.disconnectStartTimeSecondary),this.disconnectStartTimePrimary=this.disconnectStartTimeSecondary=0,n.n=17;break;case 13:return n.p=13,d=n.v,n.n=14,null===(r=this.regionUrlProvider)||void 0===r?void 0:r.getNextBestRegionUrl();case 14:if(!(c=n.v)){n.n=16;break}return n.n=15,this.restartConnection(c);case 15:case 17:return n.a(2);case 16:throw null===(a=this.regionUrlProvider)||void 0===a||a.resetAttempts(),d}},n,this,[[4,7],[0,13]])}))}},{key:"resumeConnection",value:function(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a,o,s;return h().w(function(n){for(;;)switch(n.n){case 0:if(this.url&&this.token){n.n=1;break}throw new pa("could not reconnect, url or token not saved");case 1:if(this.pcManager){n.n=2;break}throw new pa("publisher and subscriber connections unset");case 2:return this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(e.EngineEvent.Resuming),n.p=3,this.setupSignalClientCallbacks(),n.n=4,this.client.reconnect(this.url,this.token,this.participantSid,t);case 4:r=n.v,n.n=8;break;case 5:if(n.p=5,s=n.v,a="",s instanceof Error&&(a=s.message,this.log.error(s.message,Object.assign(Object.assign({},this.logContext),{error:s}))),!(s instanceof fa&&0===s.reason)){n.n=6;break}throw new pa("could not reconnect, token might be expired");case 6:if(!(s instanceof fa&&4===s.reason)){n.n=7;break}throw s;case 7:throw new nc(a);case 8:if(this.emit(e.EngineEvent.SignalResumed),r?(o=this.makeRTCConfiguration(r),this.pcManager.updateConfiguration(o)):this.log.warn("Did not receive reconnect response",this.logContext),!this.shouldFailNext){n.n=9;break}throw this.shouldFailNext=!1,new Error("simulated failure");case 9:return n.n=10,this.pcManager.triggerIceRestart();case 10:return n.n=11,this.waitForPCReconnected();case 11:if(this.client.currentState===Ho.CONNECTED){n.n=12;break}throw new nc("Signal connection got severed during reconnect");case 12:this.hasPublished&&(0!=this.disconnectStartTimePrimary&&0!=this.disconnectStartTimeSecondary||!this.firstReconnectAttempt||(this.disconnectStartTimePrimary=this.disconnectStartTimeSecondary=Date.now(),this.firstReconnectAttempt=!1)),this.client.setReconnected(),"open"===(null===(i=this.reliableDC)||void 0===i?void 0:i.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),this.emit(e.EngineEvent.Resumed);case 13:return n.a(2)}},n,this,[[3,5]])}))}},{key:"waitForPCInitialConnection",value:function(e,t){return Dn(this,void 0,void 0,h().m(function n(){return h().w(function(n){for(;;)switch(n.n){case 0:if(this.pcManager){n.n=1;break}throw new pa("PC manager is closed");case 1:return n.n=2,this.pcManager.ensurePCTransportConnection(t,e);case 2:return n.a(2)}},n,this)}))}},{key:"waitForPCReconnected",value:function(){return Dn(this,void 0,void 0,h().m(function t(){var n,i,r,a,o;return h().w(function(t){for(;;)switch(t.n){case 0:return this.pcState=Xs.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext),t.p=1,t.n=2,oo(2e3);case 2:if(this.pcManager){t.n=3;break}throw new pa("PC manager is closed");case 3:return t.n=4,this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout);case 4:i=Date.now(),r=i,this.pcState=Xs.Reconnecting;case 5:if(!(r-i<this.peerConnectionTimeout)){t.n=8;break}if(void 0!==this.primaryPC){t.n=6;break}return t.a(3,8);case 6:r-i>2e3&&"connected"===(null===(n=this.primaryPC)||void 0===n?void 0:n.connectionState)&&(a=Date.now(),0==this.disconnectStartTimePrimary&&(this.disconnectStartTimePrimary=a),0==this.disconnectStartTimeSecondary&&(this.disconnectStartTimeSecondary=a),this.emit(e.EngineEvent.PrimaryDelay,a-this.disconnectStartTimePrimary),this.emit(e.EngineEvent.SecondaryDelay,a-this.disconnectStartTimeSecondary),this.disconnectStartTimePrimary=0,this.disconnectStartTimeSecondary=0,this.firstReconnectAttempt=!0);case 7:t.n=5;break;case 8:t.n=10;break;case 9:throw t.p=9,o=t.v,this.pcState=Xs.Disconnected,new fa("could not establish PC connection, ".concat(o.message),2);case 10:return t.a(2)}},t,this,[[1,9]])}))}},{key:"sendDataPacket",value:function(e,t){return Dn(this,void 0,void 0,h().m(function n(){var i,r;return h().w(function(n){for(;;)switch(n.n){case 0:return i=e.toBinary(),n.n=1,this.ensurePublisherConnected(t);case 1:(r=this.dataChannelForKind(t))&&r.send(i),this.updateAndEmitDCBufferStatus(t);case 2:return n.a(2)}},n,this)}))}},{key:"ensureDataTransportConnected",value:function(e){return Dn(this,arguments,void 0,function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return h().m(function i(){var r,a,o,s,c,u;return h().w(function(i){for(;;)switch(i.n){case 0:if(t.pcManager){i.n=1;break}throw new pa("PC manager is closed");case 1:if(a=n?t.pcManager.subscriber:t.pcManager.publisher,o=n?"Subscriber":"Publisher",a){i.n=2;break}throw new fa("".concat(o," connection not set"),2);case 2:if(s=!1,n||t.dataChannelForKind(e,n)||(t.createDataChannels(),s=!0),s||n||t.pcManager.publisher.isICEConnected||"checking"===t.pcManager.publisher.getICEConnectionState()||(s=!0),s&&t.negotiate(),"open"!==(null==(c=t.dataChannelForKind(e,n))?void 0:c.readyState)){i.n=3;break}return i.a(2);case 3:u=(new Date).getTime()+t.peerConnectionTimeout;case 4:if(!((new Date).getTime()<u)){i.n=7;break}if(!a.isICEConnected||"open"!==(null===(r=t.dataChannelForKind(e,n))||void 0===r?void 0:r.readyState)){i.n=5;break}return i.a(2);case 5:return i.n=6,oo(50);case 6:i.n=4;break;case 7:throw new fa("could not establish ".concat(o," connection, state: ").concat(a.getICEConnectionState()),2);case 8:return i.a(2)}},i)})()})}},{key:"ensurePublisherConnected",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:return this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),t.n=1,this.publisherConnectionPromise;case 1:return t.a(2)}},t,this)}))}},{key:"verifyTransport",value:function(){return!!this.pcManager&&(this.pcManager.currentState===Ts.CONNECTED&&!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED))}},{key:"negotiate",value:function(){return Dn(this,void 0,void 0,h().m(function t(){var n=this;return h().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t,i){return Dn(n,void 0,void 0,h().m(function n(){var r,a,o,s=this;return h().w(function(n){for(;;)switch(n.n){case 0:if(this.pcManager){n.n=1;break}return i(new ga("PC manager is closed")),n.a(2);case 1:return this.pcManager.requirePublisher(),0!=this.pcManager.publisher.getTransceivers().length||this.lossyDC||this.reliableDC||this.createDataChannels(),r=new AbortController,a=function(){r.abort(),s.log.debug("engine disconnected while negotiation was ongoing",s.logContext),t()},this.isClosed&&i("cannot negotiate on closed engine"),this.on(e.EngineEvent.Closing,a),this.pcManager.publisher.once(ps,function(t){var n=new Map;t.forEach(function(e){var t,i=e.codec.toLowerCase();t=i,Ua.includes(t)&&n.set(e.payload,i)}),s.emit(e.EngineEvent.RTPVideoMapUpdate,n)}),n.p=2,n.n=3,this.pcManager.negotiate(r);case 3:t(),n.n=5;break;case 4:n.p=4,(o=n.v)instanceof ga&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",mt.RR_UNKNOWN),i(o);case 5:return n.p=5,this.off(e.EngineEvent.Closing,a),n.f(5);case 6:return n.a(2)}},n,this,[[2,4,5,6]])}))}))},t)}))}},{key:"dataChannelForKind",value:function(t,n){if(n){if(t===e.DataPacket_Kind.LOSSY)return this.lossyDCSub;if(t===e.DataPacket_Kind.RELIABLE)return this.reliableDCSub}else{if(t===e.DataPacket_Kind.LOSSY)return this.lossyDC;if(t===e.DataPacket_Kind.RELIABLE)return this.reliableDC}}},{key:"sendSyncState",value:function(e,t){var n,i;if(this.pcManager){var r,a,o=this.pcManager.subscriber.getLocalDescription(),s=this.pcManager.subscriber.getRemoteDescription(),c=null===(i=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===i||i,u=new Array,d=new Array;e.forEach(function(e){e.isDesired!==c&&u.push(e.trackSid),e.isEnabled||d.push(e.trackSid)}),this.client.sendSyncState(new hi({answer:o?$o({sdp:o.sdp,type:o.type}):void 0,offer:s?$o({sdp:s.sdp,type:s.type}):void 0,subscription:new Gn({trackSids:u,subscribe:!c,participantTracks:[]}),publishTracks:(r=t,a=[],r.forEach(function(e){void 0!==e.track&&a.push(new qn({cid:e.track.mediaStreamID,track:e.trackInfo}))}),a),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:d}))}else this.log.warn("sync state cannot be sent without peer connection setup",this.logContext)}},{key:"failNext",value:function(){this.shouldFailNext=!0}},{key:"dataChannelsInfo",value:function(){var t=[],n=function(e,n){void 0!==(null==e?void 0:e.id)&&null!==e.id&&t.push(new mi({label:e.label,id:e.id,target:n}))};return n(this.dataChannelForKind(e.DataPacket_Kind.LOSSY),wn.PUBLISHER),n(this.dataChannelForKind(e.DataPacket_Kind.RELIABLE),wn.PUBLISHER),n(this.dataChannelForKind(e.DataPacket_Kind.LOSSY,!0),wn.SUBSCRIBER),n(this.dataChannelForKind(e.DataPacket_Kind.RELIABLE,!0),wn.SUBSCRIBER),t}},{key:"clearReconnectTimeout",value:function(){this.reconnectTimeout&&Aa.clearTimeout(this.reconnectTimeout)}},{key:"clearPendingReconnect",value:function(){this.clearReconnectTimeout(),this.reconnectAttempts=0}},{key:"registerOnLineListener",value:function(){bo()&&window.addEventListener("online",this.handleBrowserOnLine)}},{key:"deregisterOnLineListener",value:function(){bo()&&window.removeEventListener("online",this.handleBrowserOnLine)}}])}(Ki.EventEmitter),nc=function(e){function t(){return r(this,t),i(this,t,arguments)}return l(t,e),o(t)}(w(Error));function ic(e){return void 0!==e&&e>13}function rc(e,t){var n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;var i=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}var ac=function(){return o(function e(t,n){r(this,e),this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=n},[{key:"updateToken",value:function(e){this.token=e}},{key:"isCloud",value:function(){return So(this.serverUrl)}},{key:"getServerUrl",value:function(){return this.serverUrl}},{key:"getNextBestRegionUrl",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i,r=this;return h().w(function(t){for(;;)switch(t.n){case 0:if(this.isCloud()){t.n=1;break}throw Error("region availability is only supported for LiveKit Cloud domains");case 1:if(this.regionSettings&&!(Date.now()-this.lastUpdateAt>this.settingsCacheTime)){t.n=3;break}return t.n=2,this.fetchRegionSettings(e);case 2:this.regionSettings=t.v;case 3:if(!((n=this.regionSettings.regions.filter(function(e){return!r.attemptedRegions.find(function(t){return t.url===e.url})})).length>0)){t.n=4;break}return i=n[0],this.attemptedRegions.push(i),bn.debug("next region: ".concat(i.region)),t.a(2,i.url);case 4:return t.a(2,null);case 5:return t.a(2)}},t,this)}))}},{key:"resetAttempts",value:function(){this.attemptedRegions=[]}},{key:"fetchRegionSettings",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("".concat(oc(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});case 1:if(!(n=t.v).ok){t.n=3;break}return t.n=2,n.json();case 2:return i=t.v,this.lastUpdateAt=Date.now(),t.a(2,i);case 3:throw new fa("Could not fetch region settings: ".concat(n.statusText),401===n.status?0:2,n.status);case 4:return t.a(2)}},t,this)}))}},{key:"setServerReportedRegions",value:function(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}])}();function oc(e){return"".concat(e.protocol.replace("ws","http"),"//").concat(e.host,"/settings")}var sc=function(e){function t(e,n,a){var o;return r(this,t),(o=i(this,t,[n])).code=e,o.message=uc(n,t.MAX_MESSAGE_BYTES),o.data=a?uc(a,t.MAX_DATA_BYTES):void 0,o}return l(t,e),o(t,[{key:"toProto",value:function(){return new Wt({code:this.code,message:this.message,data:this.data})}}],[{key:"fromProto",value:function(e){return new t(e.code,e.message,e.data)}},{key:"builtIn",value:function(e,n){return new t(t.ErrorCode[e],t.ErrorMessage[e],n)}}])}(w(Error));sc.MAX_MESSAGE_BYTES=256,sc.MAX_DATA_BYTES=15360,sc.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403},sc.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server"};function cc(e){return(new TextEncoder).encode(e).length}function uc(e,t){if(cc(e)<=t)return e;for(var n=0,i=e.length,r=new TextEncoder;n<i;){var a=Math.floor((n+i+1)/2);r.encode(e.slice(0,a)).length<=t?n=a:i=a-1}return e.slice(0,n)}var dc,lc,fc,hc=function(t){function n(e,t,a,o,s){var c;return r(this,n),(c=i(this,n,[e,a,s])).sid=t,c.receiver=o,c}return l(n,t),o(n,[{key:"setMuted",value:function(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?e.TrackEvent.Muted:e.TrackEvent.Unmuted,this))}},{key:"setMediaStream",value:function(t){var n=this;this.mediaStream=t;var i=function(r){r.track===n._mediaStreamTrack&&(t.removeEventListener("removetrack",i),n.receiver&&"playoutDelayHint"in n.receiver&&(n.receiver.playoutDelayHint=void 0),n.receiver=void 0,n._currentBitrate=0,n.emit(e.TrackEvent.Ended,n))};t.addEventListener("removetrack",i)}},{key:"start",value:function(){this.startMonitor(),k(n,"enable",this,3)([])}},{key:"stop",value:function(){this.stopMonitor(),k(n,"disable",this,3)([])}},{key:"getRTCStatsReport",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n;return h().w(function(e){for(;;)switch(e.n){case 0:if(null===(t=this.receiver)||void 0===t?void 0:t.getStats){e.n=1;break}return e.a(2);case 1:return e.n=2,this.receiver.getStats();case 2:return n=e.v,e.a(2,n)}},e,this)}))}},{key:"setPlayoutDelay",value:function(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}},{key:"getPlayoutDelay",value:function(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}},{key:"startMonitor",value:function(){var e=this;this.monitorInterval||(this.monitorInterval=setInterval(function(){return e.monitorReceiver()},Os)),"undefined"!=typeof RTCRtpReceiver&&"getSynchronizationSources"in RTCRtpReceiver&&this.registerTimeSyncUpdate()}},{key:"registerTimeSyncUpdate",value:function(){var t=this,n=function(){var i;t.timeSyncHandle=requestAnimationFrame(function(){return n()});var r=null===(i=t.receiver)||void 0===i?void 0:i.getSynchronizationSources()[0];if(r){var a=r.timestamp,o=r.rtpTimestamp;o&&t.rtpTimestamp!==o&&(t.emit(e.TrackEvent.TimeSyncUpdate,{timestamp:a,rtpTimestamp:o}),t.rtpTimestamp=o)}};n()}}])}(e.Track),mc=function(t){function n(t,a,o,s,c,u){var d;return r(this,n),(d=i(this,n,[t,a,e.Track.Kind.Audio,o,u])).monitorReceiver=function(){return Dn(d,void 0,void 0,h().m(function e(){var t;return h().w(function(e){for(;;)switch(e.n){case 0:if(this.receiver){e.n=1;break}return this._currentBitrate=0,e.a(2);case 1:return e.n=2,this.getReceiverStats();case 2:(t=e.v)&&this.prevStats&&this.receiver&&(this._currentBitrate=Ns(t,this.prevStats)),this.prevStats=t;case 3:return e.a(2)}},e,this)}))},d.audioContext=s,d.webAudioPluginNodes=[],c&&(d.sinkId=c.deviceId),d}return l(n,t),o(n,[{key:"setVolume",value:function(e){var t,n,i=s(this.attachedElements);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):r.volume=e}}catch(e){i.e(e)}finally{i.f()}To()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}},{key:"getVolume",value:function(){if(this.elementVolume)return this.elementVolume;if(To())return 1;var e=0;return this.attachedElements.forEach(function(t){t.volume>e&&(e=t.volume)}),e}},{key:"setSinkId",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:return this.sinkId=e,t.n=1,Promise.all(this.attachedElements.map(function(t){if(ho(t))return t.setSinkId(e)}));case 1:return t.a(2)}},t,this)}))}},{key:"attach",value:function(e){var t=0===this.attachedElements.length;return e?k(n,"attach",this,3)([e]):e=k(n,"attach",this,3)([]),this.sinkId&&ho(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}},{key:"detach",value:function(e){var t;return e?(t=k(n,"detach",this,3)([e]),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=k(n,"detach",this,3)([]),this.disconnectWebAudio()),t}},{key:"setAudioContext",value:function(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}},{key:"setWebAudioPlugins",value:function(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}},{key:"connectWebAudio",value:function(t,n){var i=this;this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(n.srcObject);var r=this.sourceNode;this.webAudioPluginNodes.forEach(function(e){r.connect(e),r=e}),this.gainNode=t.createGain(),r.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==t.state&&t.resume().then(function(){"running"!==t.state&&i.emit(e.TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(function(t){i.emit(e.TrackEvent.AudioPlaybackFailed,t)})}},{key:"disconnectWebAudio",value:function(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}},{key:"getReceiverStats",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t;return h().w(function(e){for(;;)switch(e.n){case 0:if(this.receiver&&this.receiver.getStats){e.n=1;break}return e.a(2);case 1:return e.n=2,this.receiver.getStats();case 2:return e.v.forEach(function(e){"inbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,timestamp:e.timestamp,jitter:e.jitter,bytesReceived:e.bytesReceived,concealedSamples:e.concealedSamples,concealmentEvents:e.concealmentEvents,silentConcealedSamples:e.silentConcealedSamples,silentConcealmentEvents:e.silentConcealmentEvents,totalAudioEnergy:e.totalAudioEnergy,totalSamplesDuration:e.totalSamplesDuration})}),e.a(2,t)}},e,this)}))}}])}(hc),vc=function(t){function n(t,a,o,s,c){var u;return r(this,n),(u=i(this,n,[t,a,e.Track.Kind.Video,o,c])).elementInfos=[],u.monitorReceiver=function(){return Dn(u,void 0,void 0,h().m(function e(){var t;return h().w(function(e){for(;;)switch(e.n){case 0:if(this.receiver){e.n=1;break}return this._currentBitrate=0,e.a(2);case 1:return e.n=2,this.getReceiverStats();case 2:(t=e.v)&&this.prevStats&&this.receiver&&(this._currentBitrate=Ns(t,this.prevStats)),this.prevStats=t;case 3:return e.a(2)}},e,this)}))},u.debouncedHandleResize=Ea(function(){u.updateDimensions()},100),u.adaptiveStreamSettings=s,u}return l(n,t),o(n,[{key:"isAdaptiveStream",get:function(){return void 0!==this.adaptiveStreamSettings}},{key:"mediaStreamTrack",get:function(){return this._mediaStreamTrack}},{key:"setMuted",value:function(e){var t=this;k(n,"setMuted",this,3)([e]),this.attachedElements.forEach(function(n){e?za(t._mediaStreamTrack,n):Ha(t._mediaStreamTrack,n)})}},{key:"attach",value:function(e){if(e?k(n,"attach",this,3)([e]):e=k(n,"attach",this,3)([]),this.adaptiveStreamSettings&&void 0===this.elementInfos.find(function(t){return t.element===e})){var t=new pc(e);this.observeElementInfo(t)}return e}},{key:"observeElementInfo",value:function(e){var t=this;this.adaptiveStreamSettings&&void 0===this.elementInfos.find(function(t){return t===e})?(e.handleResize=function(){t.debouncedHandleResize()},e.handleVisibilityChanged=function(){t.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}},{key:"stopObservingElementInfo",value:function(e){if(this.isAdaptiveStream){var t,n=this.elementInfos.filter(function(t){return t===e}),i=s(n);try{for(i.s();!(t=i.n()).done;){t.value.stopObserving()}}catch(e){i.e(e)}finally{i.f()}this.elementInfos=this.elementInfos.filter(function(t){return t!==e}),this.updateVisibility(),this.debouncedHandleResize()}else this.log.warn("stopObservingElementInfo ignored",this.logContext)}},{key:"detach",value:function(e){var t;if(e)return this.stopObservingElement(e),k(n,"detach",this,3)([e]);var i,r=s(t=k(n,"detach",this,3)([]));try{for(r.s();!(i=r.n()).done;){var a=i.value;this.stopObservingElement(a)}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"getDecoderImplementation",value:function(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}},{key:"getReceiverStats",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n,i,r;return h().w(function(e){for(;;)switch(e.n){case 0:if(this.receiver&&this.receiver.getStats){e.n=1;break}return e.a(2);case 1:return e.n=2,this.receiver.getStats();case 2:return t=e.v,i="",r=new Map,t.forEach(function(e){"inbound-rtp"===e.type?(i=e.codecId,n={type:"video",streamId:e.id,framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&r.set(e.id,e)}),n&&""!==i&&r.get(i)&&(n.mimeType=r.get(i).mimeType),e.a(2,n)}},e,this)}))}},{key:"stopObservingElement",value:function(e){var t,n=this.elementInfos.filter(function(t){return t.element===e}),i=s(n);try{for(i.s();!(t=i.n()).done;){var r=t.value;this.stopObservingElementInfo(r)}}catch(e){i.e(e)}finally{i.f()}}},{key:"handleAppVisibilityChanged",value:function(){var e=this,t=Object.create(null,{handleAppVisibilityChanged:{get:function(){return k(n,"handleAppVisibilityChanged",e,1)}}});return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.handleAppVisibilityChanged.call(this);case 1:if(this.isAdaptiveStream){e.n=2;break}return e.a(2);case 2:this.updateVisibility();case 3:return e.a(2)}},e,this)}))}},{key:"updateVisibility",value:function(){var t,n,i=this,r=this.elementInfos.reduce(function(e,t){return Math.max(e,t.visibilityChangedAt||0)},0),a=!(null!==(n=null===(t=this.adaptiveStreamSettings)||void 0===t?void 0:t.pauseVideoInBackground)&&void 0!==n&&!n)&&this.isInBackground,o=this.elementInfos.some(function(e){return e.pictureInPicture}),s=this.elementInfos.some(function(e){return e.visible})&&!a||o;this.lastVisible!==s&&(!s&&Date.now()-r<100?Aa.setTimeout(function(){i.updateVisibility()},100):(this.lastVisible=s,this.emit(e.TrackEvent.VisibilityChanged,s,this)))}},{key:"updateDimensions",value:function(){var t,n,i,r=0,a=0,o=this.getPixelDensity(),c=s(this.elementInfos);try{for(c.s();!(i=c.n()).done;){var u=i.value,d=u.width()*o,l=u.height()*o;d+l>r+a&&(r=d,a=l)}}catch(e){c.e(e)}finally{c.f()}(null===(t=this.lastDimensions)||void 0===t?void 0:t.width)===r&&(null===(n=this.lastDimensions)||void 0===n?void 0:n.height)===a||(this.lastDimensions={width:r,height:a},this.emit(e.TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}},{key:"getPixelDensity",value:function(){var e,t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;return"screen"===t?Eo():t||(Eo()>2?2:1)}}])}(hc),pc=function(){return o(function e(t,n){var i=this;r(this,e),this.onVisibilityChanged=function(e){var t,n=e.target,r=e.isIntersecting;n===i.element&&(i.isIntersecting=r,i.isPiP=gc(i.element),i.visibilityChangedAt=Date.now(),null===(t=i.handleVisibilityChanged)||void 0===t||t.call(i))},this.onEnterPiP=function(){var e,t,n;null===(t=null===(e=window.documentPictureInPicture)||void 0===e?void 0:e.window)||void 0===t||t.addEventListener("pagehide",i.onLeavePiP),i.isPiP=gc(i.element),null===(n=i.handleVisibilityChanged)||void 0===n||n.call(i)},this.onLeavePiP=function(){var e;i.isPiP=gc(i.element),null===(e=i.handleVisibilityChanged)||void 0===e||e.call(i)},this.element=t,this.isIntersecting=null!=n?n:kc(t),this.isPiP=bo()&&gc(t),this.visibilityChangedAt=0},[{key:"visible",get:function(){return this.isPiP||this.isIntersecting}},{key:"pictureInPicture",get:function(){return this.isPiP}},{key:"width",value:function(){return this.element.clientWidth}},{key:"height",value:function(){return this.element.clientHeight}},{key:"observe",value:function(){var e,t,n,i=this;this.isIntersecting=kc(this.element),this.isPiP=gc(this.element),this.element.handleResize=function(){var e;null===(e=i.handleResize)||void 0===e||e.call(i)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Lo().observe(this.element),_o().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),null===(e=window.documentPictureInPicture)||void 0===e||e.addEventListener("enter",this.onEnterPiP),null===(n=null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)||void 0===n||n.addEventListener("pagehide",this.onLeavePiP)}},{key:"stopObserving",value:function(){var e,t,n,i,r;null===(e=Lo())||void 0===e||e.unobserve(this.element),null===(t=_o())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),null===(n=window.documentPictureInPicture)||void 0===n||n.removeEventListener("enter",this.onEnterPiP),null===(r=null===(i=window.documentPictureInPicture)||void 0===i?void 0:i.window)||void 0===r||r.removeEventListener("pagehide",this.onLeavePiP)}}])}();function gc(e){var t,n;return document.pictureInPictureElement===e||!!(null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)&&kc(e,null===(n=window.documentPictureInPicture)||void 0===n?void 0:n.window)}function kc(e,t){for(var n=t||window,i=e.offsetTop,r=e.offsetLeft,a=e.offsetWidth,o=e.offsetHeight,s=e.hidden,c=getComputedStyle(e).display;e.offsetParent;)i+=(e=e.offsetParent).offsetTop,r+=e.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+a>n.pageXOffset&&!s&&"none"!==c}e.TrackPublication=function(t){function n(t,a,o,s){var c,u;return r(this,n),(c=i(this,n)).metadataMuted=!1,c.encryption=It.NONE,c.log=bn,c.handleMuted=function(){c.emit(e.TrackEvent.Muted)},c.handleUnmuted=function(){c.emit(e.TrackEvent.Unmuted)},c.log=Sn(null!==(u=null==s?void 0:s.loggerName)&&void 0!==u?u:e.LoggerNames.Publication),c.loggerContextCb=c.loggerContextCb,c.setMaxListeners(100),c.kind=t,c.trackSid=a,c.trackName=o,c.source=e.Track.Source.Unknown,c}return l(n,t),o(n,[{key:"setTrack",value:function(t){this.track&&(this.track.off(e.TrackEvent.Muted,this.handleMuted),this.track.off(e.TrackEvent.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(e.TrackEvent.Muted,this.handleMuted),t.on(e.TrackEvent.Unmuted,this.handleUnmuted))}},{key:"logContext",get:function(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),io(this))}},{key:"isMuted",get:function(){return this.metadataMuted}},{key:"isEnabled",get:function(){return!0}},{key:"isSubscribed",get:function(){return void 0!==this.track}},{key:"isEncrypted",get:function(){return this.encryption!==It.NONE}},{key:"audioTrack",get:function(){if(this.track instanceof Ds||this.track instanceof mc)return this.track}},{key:"videoTrack",get:function(){if(this.track instanceof Hs||this.track instanceof vc)return this.track}},{key:"updateInfo",value:function(t){this.trackSid=t.sid,this.trackName=t.name,this.source=e.Track.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===e.Track.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.encryption=t.encryption,this.trackInfo=t,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:t}))}}])}(Ki.EventEmitter),dc=e.TrackPublication||(e.TrackPublication={}),(lc=dc.SubscriptionStatus||(dc.SubscriptionStatus={})).Desired="desired",lc.Subscribed="subscribed",lc.Unsubscribed="unsubscribed",(fc=dc.PermissionStatus||(dc.PermissionStatus={})).Allowed="allowed",fc.NotAllowed="not_allowed";var yc=function(t){function n(t,a,o,s){var c;return r(this,n),(c=i(this,n,[t,a.sid,a.name,s])).track=void 0,c.handleTrackEnded=function(){c.emit(e.TrackEvent.Ended)},c.updateInfo(a),c.setTrack(o),c}return l(n,t),o(n,[{key:"isUpstreamPaused",get:function(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}},{key:"setTrack",value:function(t){this.track&&this.track.off(e.TrackEvent.Ended,this.handleTrackEnded),k(n,"setTrack",this,3)([t]),t&&t.on(e.TrackEvent.Ended,this.handleTrackEnded)}},{key:"isMuted",get:function(){return this.track?this.track.isMuted:k(n,"isMuted",this,1)}},{key:"audioTrack",get:function(){return k(n,"audioTrack",this,1)}},{key:"videoTrack",get:function(){return k(n,"videoTrack",this,1)}},{key:"mute",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t;return h().w(function(e){for(;;)if(0===e.n)return e.a(2,null===(t=this.track)||void 0===t?void 0:t.mute())},e,this)}))}},{key:"unmute",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t;return h().w(function(e){for(;;)if(0===e.n)return e.a(2,null===(t=this.track)||void 0===t?void 0:t.unmute())},e,this)}))}},{key:"pauseUpstream",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t;return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,null===(t=this.track)||void 0===t?void 0:t.pauseUpstream();case 1:return e.a(2)}},e,this)}))}},{key:"resumeUpstream",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t;return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,null===(t=this.track)||void 0===t?void 0:t.resumeUpstream();case 1:return e.a(2)}},e,this)}))}},{key:"getTrackFeatures",value:function(){var e;if(this.track instanceof Ds){var t=this.track.getSourceTrackSettings(),n=new Set;return t.autoGainControl&&n.add(pt.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(pt.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(pt.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(pt.TF_STEREO),(null===(e=this.options)||void 0===e?void 0:e.dtx)||n.add(pt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(pt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}])}(e.TrackPublication);e.ConnectionQuality=void 0,function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(e.ConnectionQuality||(e.ConnectionQuality={}));var bc=function(t){function n(t,a,o,s,c,u){var d,l,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e.ParticipantKind.STANDARD;return r(this,n),(d=i(this,n)).audioLevel=0,d.isSpeaking=!1,d._connectionQuality=e.ConnectionQuality.Unknown,d.log=bn,d.log=Sn(null!==(l=null==u?void 0:u.loggerName)&&void 0!==l?l:e.LoggerNames.Participant),d.loggerOptions=u,d.setMaxListeners(100),d.sid=t,d.identity=a,d.name=o,d.metadata=s,d.audioTrackPublications=new Map,d.videoTrackPublications=new Map,d.trackPublications=new Map,d._kind=f,d._attributes=null!=c?c:{},d}return l(n,t),o(n,[{key:"logContext",get:function(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}},{key:"isEncrypted",get:function(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(function(e){return e.isEncrypted})}},{key:"isAgent",get:function(){var t;return(null===(t=this.permissions)||void 0===t?void 0:t.agent)||this.kind===e.ParticipantKind.AGENT}},{key:"kind",get:function(){return this._kind}},{key:"attributes",get:function(){return Object.freeze(Object.assign({},this._attributes))}},{key:"getTrackPublications",value:function(){return Array.from(this.trackPublications.values())}},{key:"getTrackPublication",value:function(e){var t,n=s(this.trackPublications);try{for(n.s();!(t=n.n()).done;){var i=g(t.value,2)[1];if(i.source===e)return i}}catch(e){n.e(e)}finally{n.f()}}},{key:"getTrackPublicationByName",value:function(e){var t,n=s(this.trackPublications);try{for(n.s();!(t=n.n()).done;){var i=g(t.value,2)[1];if(i.trackName===e)return i}}catch(e){n.e(e)}finally{n.f()}}},{key:"connectionQuality",get:function(){return this._connectionQuality}},{key:"isCameraEnabled",get:function(){var t,n=this.getTrackPublication(e.Track.Source.Camera);return!(null===(t=null==n?void 0:n.isMuted)||void 0===t||t)}},{key:"isMicrophoneEnabled",get:function(){var t,n=this.getTrackPublication(e.Track.Source.Microphone);return!(null===(t=null==n?void 0:n.isMuted)||void 0===t||t)}},{key:"isScreenShareEnabled",get:function(){return!!this.getTrackPublication(e.Track.Source.ScreenShare)}},{key:"isLocal",get:function(){return!1}},{key:"joinedAt",get:function(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}},{key:"updateInfo",value:function(e){return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}},{key:"_setMetadata",value:function(t){var n=this.metadata!==t,i=this.metadata;this.metadata=t,n&&this.emit(e.ParticipantEvent.ParticipantMetadataChanged,i)}},{key:"_setName",value:function(t){var n=this.name!==t;this.name=t,n&&this.emit(e.ParticipantEvent.ParticipantNameChanged,t)}},{key:"_setAttributes",value:function(t){var n=function(e,t){var n,i,r={},a=s([].concat(y(Object.keys(t)),y(Object.keys(e))));try{for(a.s();!(i=a.n()).done;){var o=i.value;e[o]!==t[o]&&(r[o]=null!==(n=t[o])&&void 0!==n?n:"")}}catch(e){a.e(e)}finally{a.f()}return r}(this.attributes,t);this._attributes=t,Object.keys(n).length>0&&this.emit(e.ParticipantEvent.AttributesChanged,n)}},{key:"setPermissions",value:function(t){var n,i,r,a,o,s,c=this,u=this.permissions,d=t.canPublish!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublish)||t.canSubscribe!==(null===(i=this.permissions)||void 0===i?void 0:i.canSubscribe)||t.canPublishData!==(null===(r=this.permissions)||void 0===r?void 0:r.canPublishData)||t.hidden!==(null===(a=this.permissions)||void 0===a?void 0:a.hidden)||t.recorder!==(null===(o=this.permissions)||void 0===o?void 0:o.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some(function(e,t){var n;return e!==(null===(n=c.permissions)||void 0===n?void 0:n.canPublishSources[t])})||t.canSubscribeMetrics!==(null===(s=this.permissions)||void 0===s?void 0:s.canSubscribeMetrics);return this.permissions=t,d&&this.emit(e.ParticipantEvent.ParticipantPermissionsChanged,u,t),d}},{key:"setIsSpeaking",value:function(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(e.ParticipantEvent.IsSpeakingChanged,t))}},{key:"setConnectionQuality",value:function(t){var n=this;this._lastProtoQuality=t,this._qualityChangeTimeout&&clearTimeout(this._qualityChangeTimeout),this._qualityChangeTimeout=setTimeout(function(){var t=function(t){switch(t){case lt.EXCELLENT:return e.ConnectionQuality.Excellent;case lt.GOOD:return e.ConnectionQuality.Good;case lt.POOR:return e.ConnectionQuality.Poor;case lt.LOST:return e.ConnectionQuality.Lost;default:return e.ConnectionQuality.Unknown}}(n._lastProtoQuality),i=n._connectionQuality;i!==t&&(n._connectionQuality=t,console.log("Connection quality changed from ".concat(i," to ").concat(t)),n.emit(e.ParticipantEvent.ConnectionQualityChanged,t)),n._qualityChangeTimeout=void 0},15e3)}},{key:"setAudioContext",value:function(e){this.audioContext=e,this.audioTrackPublications.forEach(function(t){return(t.track instanceof mc||t.track instanceof Ds)&&t.track.setAudioContext(e)})}},{key:"addTrackPublication",value:function(t){var n=this;t.on(e.TrackEvent.Muted,function(){n.emit(e.ParticipantEvent.TrackMuted,t)}),t.on(e.TrackEvent.Unmuted,function(){n.emit(e.ParticipantEvent.TrackUnmuted,t)});var i=t;switch(i.track&&(i.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case e.Track.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case e.Track.Kind.Video:this.videoTrackPublications.set(t.trackSid,t)}}}])}(Ki.EventEmitter);var Tc,Sc=function(t){function n(t,a,o,s){var c;return r(this,n),(c=i(this,n,[t,a,void 0,void 0,void 0,{loggerName:s.loggerName,loggerContextCb:function(){return c.engine.logContext}}])).pendingPublishing=new Set,c.pendingPublishPromises=new Map,c.participantTrackPermissions=[],c.allParticipantsAllowedToSubscribe=!0,c.encryptionType=It.NONE,c.audioMuted=!1,c.videoMuted=!1,c.enabledPublishVideoCodecs=[],c.rpcHandlers=new Map,c.pendingAcks=new Map,c.pendingResponses=new Map,c.handleReconnecting=function(){c.reconnectFuture||(c.reconnectFuture=new Uo)},c.handleReconnected=function(){var e,t;null===(t=null===(e=c.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),c.reconnectFuture=void 0,c.updateTrackSubscriptionPermissions()},c.handleDisconnected=function(){var e,t;c.reconnectFuture&&(c.reconnectFuture.promise.catch(function(e){return c.log.warn(e.message,c.logContext)}),null===(t=null===(e=c.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),c.reconnectFuture=void 0)},c.handleSignalRequestResponse=function(e){var t=e.requestId,n=e.reason,i=e.message,r=c.pendingSignalRequests.get(t);r&&(n!==Ti.OK&&r.reject(new ya(i,n)),c.pendingSignalRequests.delete(t))},c.handleDataPacket=function(e){switch(e.value.case){case"rpcRequest":var t=e.value.value;c.handleIncomingRpcRequest(e.participantIdentity,t.id,t.method,t.payload,t.responseTimeoutMs);break;case"rpcResponse":var n=e.value.value,i=null,r=null;"payload"===n.value.case?i=n.value.value:"error"===n.value.case&&(r=sc.fromProto(n.value.value)),c.handleIncomingRpcResponse(n.requestId,i,r);break;case"rpcAck":var a=e.value.value;c.handleIncomingRpcAck(a.requestId)}},c.updateTrackSubscriptionPermissions=function(){c.log.debug("updating track subscription permissions",Object.assign(Object.assign({},c.logContext),{allParticipantsAllowed:c.allParticipantsAllowedToSubscribe,participantTrackPermissions:c.participantTrackPermissions})),c.engine.client.sendUpdateSubscriptionPermissions(c.allParticipantsAllowedToSubscribe,c.participantTrackPermissions.map(function(e){return function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new di({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e)}))},c.onTrackUnmuted=function(e){c.onTrackMuted(e,e.isUpstreamPaused)},c.onTrackMuted=function(t,n){void 0===n&&(n=!0),t.sid?(t.kind==e.Track.Kind.Audio?n?sessionStorage.setItem("isAudioMuted","true"):sessionStorage.setItem("isAudioMuted","false"):n?sessionStorage.setItem("isVideoMuted","true"):sessionStorage.setItem("isVideoMuted","false"),c.engine.updateMuteStatus(t.sid,n)):c.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},c.logContext),io(t)))},c.onTrackUpstreamPaused=function(e){c.log.debug("upstream paused",Object.assign(Object.assign({},c.logContext),io(e))),c.onTrackMuted(e,!0)},c.onTrackUpstreamResumed=function(e){c.log.debug("upstream resumed",Object.assign(Object.assign({},c.logContext),io(e))),c.onTrackMuted(e,e.isMuted)},c.onTrackFeatureUpdate=function(e){var t=c.audioTrackPublications.get(e.sid);t?c.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):c.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),c.logContext)},c.handleSubscribedQualityUpdate=function(e){return Dn(c,void 0,void 0,h().m(function t(){var n,i,r,a,o,s,c,u,d,l,f,m,v;return h().w(function(t){for(;;)switch(t.n){case 0:if(null===(o=this.roomOptions)||void 0===o?void 0:o.dynacast){t.n=1;break}return t.a(2);case 1:if(c=this.videoTrackPublications.get(e.trackSid)){t.n=2;break}return this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid})),t.a(2);case 2:if(!(e.subscribedCodecs.length>0)){t.n=17;break}if(c.videoTrack){t.n=3;break}return t.a(2);case 3:return t.n=4,c.videoTrack.setPublishingCodecs(e.subscribedCodecs);case 4:u=t.v,t.p=5,d=!0,l=An(u);case 6:return t.n=7,l.next();case 7:if(f=t.v,n=f.done){t.n=9;break}if(a=f.value,d=!1,!ja(m=a)){t.n=8;break}return this.log.debug("publish ".concat(m," for ").concat(c.videoTrack.sid),Object.assign(Object.assign({},this.logContext),io(c))),t.n=8,this.publishAdditionalCodecForTrack(c.videoTrack,m,c.options);case 8:d=!0,t.n=6;break;case 9:t.n=11;break;case 10:t.p=10,v=t.v,i={error:v};case 11:if(t.p=11,t.p=12,d||n||!(r=l.return)){t.n=13;break}return t.n=13,r.call(l);case 13:if(t.p=13,!i){t.n=14;break}throw i.error;case 14:return t.f(13);case 15:return t.f(11);case 16:t.n=18;break;case 17:if(!(e.subscribedQualities.length>0)){t.n=18;break}return t.n=18,null===(s=c.videoTrack)||void 0===s?void 0:s.setPublishingLayers(e.subscribedQualities);case 18:return t.a(2)}},t,this,[[12,,13,15],[5,10,11,16]])}))},c.handleLocalTrackUnpublished=function(e){var t=c.trackPublications.get(e.trackSid);t?c.unpublishTrack(t.track):c.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},c.logContext),{trackSid:e.trackSid}))},c.handleTrackEnded=function(t){return Dn(c,void 0,void 0,h().m(function n(){var i;return h().w(function(n){for(;;)switch(n.n){case 0:if(t.source!==e.Track.Source.ScreenShare&&t.source!==e.Track.Source.ScreenShareAudio){n.n=1;break}this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),io(t))),this.unpublishTrack(t),n.n=12;break;case 1:if(!t.isUserProvided){n.n=3;break}return n.n=2,t.mute();case 2:n.n=12;break;case 3:if(!(t instanceof Ds||t instanceof Hs)){n.n=12;break}if(n.p=4,!bo()){n.n=9;break}return n.p=5,n.n=6,null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:t.source===e.Track.Source.Camera?"camera":"microphone"});case 6:if(!(i=n.v)||"denied"!==i.state){n.n=7;break}throw this.log.warn("user has revoked access to ".concat(t.source),Object.assign(Object.assign({},this.logContext),io(t))),i.onchange=function(){"denied"!==i.state&&(t.isMuted||t.restartTrack(),i.onchange=null)},new Error("GetUserMedia Permission denied");case 7:n.n=9;break;case 8:n.p=8,n.v;case 9:if(t.isMuted){n.n=10;break}return this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),io(t))),n.n=10,t.restartTrack();case 10:n.n=12;break;case 11:return n.p=11,n.v,this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),io(t))),n.n=12,t.mute();case 12:return n.a(2)}},n,this,[[5,8],[4,11]])}))},c.audioTrackPublications=new Map,c.videoTrackPublications=new Map,c.trackPublications=new Map,c.engine=o,c.roomOptions=s,c.setupEngine(o),c.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),c.pendingSignalRequests=new Map,c}return l(n,t),o(n,[{key:"lastCameraError",get:function(){return this.cameraError}},{key:"lastMicrophoneError",get:function(){return this.microphoneError}},{key:"isE2EEEnabled",get:function(){return this.encryptionType!==It.NONE}},{key:"getTrackPublication",value:function(e){var t=k(n,"getTrackPublication",this,3)([e]);if(t)return t}},{key:"getTrackPublicationByName",value:function(e){var t=k(n,"getTrackPublicationByName",this,3)([e]);if(t)return t}},{key:"setupEngine",value:function(t){var n=this;this.engine=t,this.engine.on(e.EngineEvent.RemoteMute,function(e,t){var i=n.trackPublications.get(e);i&&i.track&&(t?("audio"==i.kind?(n.audioMuted=!0,sessionStorage.setItem("isAudioMuted","true")):(n.videoMuted=!0,sessionStorage.setItem("isVideoMuted","true")),i.mute()):("audio"==i.kind?sessionStorage.setItem("isAudioMuted","false"):sessionStorage.setItem("isVideoMuted","false"),i.unmute()))}),this.engine.on(e.EngineEvent.Connected,this.handleReconnected).on(e.EngineEvent.SignalRestarted,this.handleReconnected).on(e.EngineEvent.SignalResumed,this.handleReconnected).on(e.EngineEvent.Restarting,this.handleReconnecting).on(e.EngineEvent.Resuming,this.handleReconnecting).on(e.EngineEvent.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(e.EngineEvent.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(e.EngineEvent.Disconnected,this.handleDisconnected).on(e.EngineEvent.SignalRequestResponse,this.handleSignalRequestResponse).on(e.EngineEvent.DataPacketReceived,this.handleDataPacket)}},{key:"setMetadata",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.requestMetadataUpdate({metadata:e});case 1:return t.a(2)}},t,this)}))}},{key:"setName",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.requestMetadataUpdate({name:e});case 1:return t.a(2)}},t,this)}))}},{key:"setAttributes",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.requestMetadataUpdate({attributes:e});case 1:return t.a(2)}},t,this)}))}},{key:"requestMetadataUpdate",value:function(e){return Dn(this,arguments,void 0,function(e){var t=this,n=e.metadata,i=e.name,r=e.attributes;return h().m(function e(){return h().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,a){return Dn(t,void 0,void 0,h().m(function t(){var o,s,c,u,d,l,f=this;return h().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,c=!1,t.n=1,this.engine.client.sendUpdateLocalMetadata(null!==(o=null!=n?n:this.metadata)&&void 0!==o?o:"",null!==(s=null!=i?i:this.name)&&void 0!==s?s:"",r);case 1:u=t.v,d=performance.now(),this.pendingSignalRequests.set(u,{resolve:e,reject:function(e){a(e),c=!0},values:{name:i,metadata:n,attributes:r}});case 2:if(!(performance.now()-d<5e3)||c){t.n=5;break}if(i&&this.name!==i||n&&this.metadata!==n||r&&!Object.entries(r).every(function(e){var t=g(e,2),n=t[0],i=t[1];return f.attributes[n]===i||""===i&&!f.attributes[n]})){t.n=3;break}return this.pendingSignalRequests.delete(u),e(),t.a(2);case 3:return t.n=4,oo(50);case 4:t.n=2;break;case 5:a(new ya("Request to update local metadata timed out","TimeoutError")),t.n=7;break;case 6:t.p=6,(l=t.v)instanceof Error&&a(l);case 7:return t.a(2)}},t,this,[[0,6]])}))}))},e)})()})}},{key:"setCameraEnabled",value:function(t,n,i){return this.setTrackEnabled(e.Track.Source.Camera,t,n,i)}},{key:"setMicrophoneEnabled",value:function(t,n,i){return this.setTrackEnabled(e.Track.Source.Microphone,t,n,i)}},{key:"setScreenShareEnabled",value:function(t,n,i){return this.setTrackEnabled(e.Track.Source.ScreenShare,t,n,i)}},{key:"setPermissions",value:function(t){var i=this.permissions,r=k(n,"setPermissions",this,3)([t]);return r&&i&&this.emit(e.ParticipantEvent.ParticipantPermissionsChanged,i),r}},{key:"setE2EEEnabled",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:return this.encryptionType=e?It.GCM:It.NONE,t.n=1,this.republishAllTracks(void 0,!1);case 1:return t.a(2)}},t,this)}))}},{key:"setTrackEnabled",value:function(t,n,i,r){return Dn(this,void 0,void 0,h().m(function a(){var o,c,u,d,l,f,m,v,p,k,y,b,T,S,w;return h().w(function(a){for(;;)switch(a.n){case 0:if(this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:n})),!this.republishPromise){a.n=1;break}return a.n=1,this.republishPromise;case 1:if(u=this.getTrackPublication(t),!n){a.n=21;break}if(!u||!u.track){a.n=2;break}this.onTrackMuted(u.track,!1),a.n=20;break;case 2:if(!this.pendingPublishing.has(t)){a.n=5;break}return a.n=3,this.waitForPendingPublicationOfSource(t);case 3:return(l=a.v)||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t})),a.n=4,null==l?void 0:l.unmute();case 4:return a.a(2,l);case 5:this.pendingPublishing.add(t),a.p=6,T=t,a.n=T===e.Track.Source.Camera?7:T===e.Track.Source.Microphone?9:T===e.Track.Source.ScreenShare?11:13;break;case 7:return a.n=8,this.createTracks({video:null===(o=i)||void 0===o||o});case 8:return d=a.v,a.a(3,14);case 9:return a.n=10,this.createTracks({audio:null===(c=i)||void 0===c||c});case 10:return d=a.v,a.a(3,14);case 11:return a.n=12,this.createScreenTracks(Object.assign({},i));case 12:return d=a.v,a.a(3,14);case 13:throw new ma(t);case 14:a.n=16;break;case 15:throw a.p=15,S=a.v,null==d||d.forEach(function(e){e.stop()}),S instanceof Error&&this.emit(e.ParticipantEvent.MediaDevicesError,S),this.pendingPublishing.delete(t),S;case 16:a.p=16,f=[],m=s(d);try{for(m.s();!(v=m.n()).done;)p=v.value,this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),io(p))),f.push(this.publishTrack(p,r))}catch(e){m.e(e)}finally{m.f()}return a.n=17,Promise.all(f);case 17:k=a.v,y=g(k,1),u=y[0],a.n=19;break;case 18:throw a.p=18,w=a.v,null==d||d.forEach(function(e){e.stop()}),w;case 19:return a.p=19,this.pendingPublishing.delete(t),a.f(19);case 20:a.n=26;break;case 21:if((null==u?void 0:u.track)||!this.pendingPublishing.has(t)){a.n=23;break}return a.n=22,this.waitForPendingPublicationOfSource(t);case 22:(u=a.v)||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t}));case 23:if(!u||!u.track){a.n=26;break}if(t!==e.Track.Source.ScreenShare){a.n=25;break}return a.n=24,this.unpublishTrack(u.track);case 24:u=a.v,(b=this.getTrackPublication(e.Track.Source.ScreenShareAudio))&&b.track&&this.unpublishTrack(b.track),a.n=26;break;case 25:"microphone"==u.source&&(this.audioMuted=!0),"camera"==u.source&&(this.videoMuted=!0),this.onTrackMuted(u.track,!0);case 26:return a.a(2,u)}},a,this,[[16,18,19,20],[6,15]])}))}},{key:"enableCameraAndMicrophone",value:function(){return Dn(this,void 0,void 0,h().m(function t(){var n,i=this;return h().w(function(t){for(;;)switch(t.n){case 0:if(!this.pendingPublishing.has(e.Track.Source.Camera)&&!this.pendingPublishing.has(e.Track.Source.Microphone)){t.n=1;break}return t.a(2);case 1:return this.pendingPublishing.add(e.Track.Source.Camera),this.pendingPublishing.add(e.Track.Source.Microphone),t.p=2,t.n=3,this.createTracks({audio:!0,video:!0});case 3:return n=t.v,t.n=4,Promise.all(n.map(function(e){return i.publishTrack(e)}));case 4:return t.p=4,this.pendingPublishing.delete(e.Track.Source.Camera),this.pendingPublishing.delete(e.Track.Source.Microphone),t.f(4);case 5:return t.a(2)}},t,this,[[2,,4,5]])}))}},{key:"createTracks",value:function(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a,o,s,c,u,d,l,f,m=this;return h().w(function(n){for(;;)switch(n.n){case 0:return null!=t||(t={}),a=ro(t),o=a.audioProcessor,s=a.videoProcessor,c=a.optionsWithoutProcessor,u=Qa(c,null===(i=this.roomOptions)||void 0===i?void 0:i.audioCaptureDefaults,null===(r=this.roomOptions)||void 0===r?void 0:r.videoCaptureDefaults),d=Xa(u),n.p=1,n.n=2,navigator.mediaDevices.getUserMedia(d);case 2:l=n.v,n.n=4;break;case 3:throw n.p=3,(f=n.v)instanceof Error&&(d.audio&&(this.microphoneError=f),d.video&&(this.cameraError=f)),f;case 4:return d.audio&&(this.microphoneError=void 0,this.emit(e.ParticipantEvent.AudioStreamAcquired)),d.video&&(this.cameraError=void 0),n.a(2,Promise.all(l.getTracks().map(function(t){return Dn(m,void 0,void 0,h().m(function n(){var i,r,a,c,f=this;return h().w(function(n){for(;;)switch(n.n){case 0:if((i="audio"===t.kind)?u.audio:u.video,"boolean"!=typeof(a=i?d.audio:d.video)&&(r=a),(c=_s(t,r,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return f.logContext}})).kind===e.Track.Kind.Video?c.source=e.Track.Source.Camera:c.kind===e.Track.Kind.Audio&&(c.source=e.Track.Source.Microphone,c.setAudioContext(this.audioContext)),c.mediaStream=l,!(c instanceof Ds&&o)){n.n=2;break}return n.n=1,c.setProcessor(o);case 1:n.n=3;break;case 2:if(!(c instanceof Hs&&s)){n.n=3;break}return n.n=3,c.setProcessor(s);case 3:return n.a(2,c)}},n,this)}))})))}},n,this,[[1,3]])}))}},{key:"createScreenTracks",value:function(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a,o,s,c,u=this;return h().w(function(n){for(;;)switch(n.n){case 0:if(void 0===t&&(t={}),void 0!==navigator.mediaDevices.getDisplayMedia){n.n=1;break}throw new ha("getDisplayMedia not supported");case 1:return void 0!==t.resolution||go()||(t.resolution=Ja.h1080fps30.resolution),i=to(t),n.n=2,navigator.mediaDevices.getDisplayMedia(i);case 2:if(r=n.v,0!==(a=r.getVideoTracks()).length){n.n=3;break}throw new ma("no video track found");case 3:return(o=new Hs(a[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return u.logContext}})).source=e.Track.Source.ScreenShare,t.contentHint&&(o.mediaStreamTrack.contentHint=t.contentHint),s=[o],r.getAudioTracks().length>0&&(this.emit(e.ParticipantEvent.AudioStreamAcquired),(c=new Ds(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return u.logContext}})).source=e.Track.Source.ScreenShareAudio,s.push(c)),n.a(2,s)}},n,this)}))}},{key:"publishTrack",value:function(e,t){return Dn(this,void 0,void 0,h().m(function n(){return h().w(function(n){for(;;)if(0===n.n)return n.a(2,this.publishOrRepublishTrack(e,t))},n,this)}))}},{key:"publishOrRepublishTrack",value:function(t,n){return Dn(this,arguments,void 0,function(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return h().m(function a(){var o,s,c,u,d,l,f,m,v,p,g,k,y,b;return h().w(function(a){for(;;)switch(a.n){case 0:return t instanceof Ds&&t.setAudioContext(i.audioContext),a.n=1,null===(o=i.reconnectFuture)||void 0===o?void 0:o.promise;case 1:if(!i.republishPromise||r){a.n=2;break}return a.n=2,i.republishPromise;case 2:if(!(t instanceof Wo&&i.pendingPublishPromises.has(t))){a.n=3;break}return a.n=3,i.pendingPublishPromises.get(t);case 3:if(!(t instanceof MediaStreamTrack)){a.n=4;break}d=t.getConstraints(),a.n=9;break;case 4:d=t.constraints,l=void 0,y=t.source,a.n=y===e.Track.Source.Microphone?5:y===e.Track.Source.Camera?6:7;break;case 5:return l="audioinput",a.a(3,8);case 6:l="videoinput";case 7:return a.a(3,8);case 8:l&&i.activeDeviceMap.has(l)&&(d=Object.assign(Object.assign({},d),{deviceId:i.activeDeviceMap.get(l)}));case 9:if(!(t instanceof MediaStreamTrack)){a.n=14;break}b=t.kind,a.n="audio"===b?10:"video"===b?11:12;break;case 10:return t=new Ds(t,d,!0,i.audioContext,{loggerName:i.roomOptions.loggerName,loggerContextCb:function(){return i.logContext}}),a.a(3,13);case 11:return t=new Hs(t,d,!0,{loggerName:i.roomOptions.loggerName,loggerContextCb:function(){return i.logContext}}),a.a(3,13);case 12:throw new ma("unsupported MediaStreamTrack kind ".concat(t.kind));case 13:a.n=15;break;case 14:t.updateLoggerOptions({loggerName:i.roomOptions.loggerName,loggerContextCb:function(){return i.logContext}});case 15:if(i.trackPublications.forEach(function(e){e.track&&e.track===t&&(f=e)}),!f){a.n=16;break}return i.log.warn("track has already been published, skipping",Object.assign(Object.assign({},i.logContext),io(f))),a.a(2,f);case 16:return m="channelCount"in t.mediaStreamTrack.getSettings()&&2===t.mediaStreamTrack.getSettings().channelCount||2===t.mediaStreamTrack.getConstraints().channelCount,(v=null!==(s=null==n?void 0:n.forceStereo)&&void 0!==s?s:m)&&(n||(n={}),void 0===n.dtx&&i.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},i.logContext),io(t))),void 0===n.red&&i.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(c=n.dtx)&&void 0!==c||(n.dtx=!1),null!==(u=n.red)&&void 0!==u||(n.red=!1)),p=Object.assign(Object.assign({},i.roomOptions.publishDefaults),n),!yo()&&i.roomOptions.e2ee&&(i.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},i.logContext)),p.simulcast=!1),p.source&&(t.source=p.source),g=i.publish(t,p,v),i.pendingPublishPromises.set(t,g),a.p=17,a.n=18,g;case 18:return k=a.v,a.a(2,k);case 19:throw a.p=19,a.v;case 20:return a.p=20,i.pendingPublishPromises.delete(t),a.f(20);case 21:return a.a(2)}},a,null,[[17,19,20,21]])})()})}},{key:"publish",value:function(t,n,i){return Dn(this,void 0,void 0,h().m(function r(){var a,o,c,u,d,l,f,m,v,p,g,k,y,b,T,S,w,C,E,P,R,I,O=this;return h().w(function(r){for(;;)switch(r.n){case 0:if(Array.from(this.trackPublications.values()).find(function(e){return t instanceof Wo&&e.source===t.source})&&t.source!==e.Track.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),io(t))),n.stopMicTrackOnMute&&t instanceof Ds&&(t.stopOnMute=!0),t.source===e.Track.Source.ScreenShare&&vo()&&(n.simulcast=!1),"av1"!==n.videoCodec||uo()||(n.videoCodec=void 0),"vp9"!==n.videoCodec||lo()||(n.videoCodec=void 0),void 0===n.videoCodec&&(n.videoCodec=Ss),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(function(e){return n.videoCodec===no(e.mime)})||(n.videoCodec=no(this.enabledPublishVideoCodecs[0].mime))),g=n.videoCodec,t.on(e.TrackEvent.Muted,this.onTrackMuted),t.on(e.TrackEvent.Unmuted,this.onTrackUnmuted),t.on(e.TrackEvent.Ended,this.handleTrackEnded),t.on(e.TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.on(e.TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.on(e.TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),k=new Un({cid:t.mediaStreamTrack.id,name:n.name,type:e.Track.kindToProto(t.kind),muted:t.isMuted,source:e.Track.sourceToProto(t.source),disableDtx:!(null===(a=n.dtx)||void 0===a||a),encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(null===(o=n.red)||void 0===o||o),stream:null==n?void 0:n.stream}),t.kind!==e.Track.Kind.Video){r.n=5;break}return T={width:0,height:0},r.p=1,r.n=2,t.waitForDimensions();case 2:T=r.v,r.n=4;break;case 3:r.p=3,r.v,S=null!==(u=null===(c=this.roomOptions.videoCaptureDefaults)||void 0===c?void 0:c.resolution)&&void 0!==u?u:Fa.h720.resolution,T={width:S.width,height:S.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),io(t)),{dims:T}));case 4:k.width=T.width,k.height=T.height,t instanceof Hs&&(fo(g)&&(t.source===e.Track.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),io(t))))),n.scalabilityMode=null!==(d=n.scalabilityMode)&&void 0!==d?d:"L3T3_KEY"),k.simulcastCodecs=[new Mn({codec:g,cid:t.mediaStreamTrack.id})],!0===n.backupCodec&&(n.backupCodec={codec:Ss}),n.backupCodec&&g!==n.backupCodec.codec&&k.encryption===It.NONE?(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),k.simulcastCodecs.push(new Mn({codec:n.backupCodec.codec,cid:""}))):n.videoCodec&&(k.simulcastCodecs=[new Mn({codec:n.videoCodec,cid:t.mediaStreamTrack.id})])),y=Fs(t.source===e.Track.Source.ScreenShare,k.width,k.height,n),k.layers=Ys(k.width,k.height,y,fo(n.videoCodec)),1==y.length&&(b=Js(t.source===e.Track.Source.ScreenShare,k.width,k.height,n.videoCodec),y=[{maxBitrate:b.maxBitrate,maxFramerate:b.maxFramerate,active:!0}]),r.n=6;break;case 5:t.kind===e.Track.Kind.Audio&&n.audioBitrate&&(y=[{maxBitrate:null===(l=n.audioPreset)||void 0===l?void 0:l.maxBitrate,priority:null!==(m=null===(f=n.audioPreset)||void 0===f?void 0:f.priority)&&void 0!==m?m:"high",networkPriority:null!==(p=null===(v=n.audioPreset)||void 0===v?void 0:v.priority)&&void 0!==p?p:"high"}]);case 6:if(this.engine&&!this.engine.isClosed){r.n=7;break}throw new pa("cannot publish track when not connected");case 7:if(w=function(){return Dn(O,void 0,void 0,h().m(function i(){var r,a,o,c,u,d,l,f;return h().w(function(i){for(;;)switch(i.n){case 0:if(this.engine.pcManager){i.n=1;break}throw new pa("pcManager is not ready");case 1:return i.n=2,this.engine.createSender(t,n,y);case 2:if(t.sender=i.v,t instanceof Hs&&(null!==(r=n.degradationPreference)&&void 0!==r||(n.degradationPreference=Gs(t)),t.setDegradationPreference(n.degradationPreference)),!y){i.n=11;break}if(!vo()||t.kind!==e.Track.Kind.Audio){i.n=10;break}c=void 0,u=s(this.engine.pcManager.publisher.getTransceivers()),i.p=3,u.s();case 4:if((d=u.n()).done){i.n=6;break}if((l=d.value).sender!==t.sender){i.n=5;break}return c=l,i.a(3,6);case 5:i.n=4;break;case 6:i.n=8;break;case 7:i.p=7,f=i.v,u.e(f);case 8:return i.p=8,u.f(),i.f(8);case 9:c&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:c,codec:"opus",maxbr:(null===(a=y[0])||void 0===a?void 0:a.maxBitrate)?y[0].maxBitrate/1e3:0}),i.n=11;break;case 10:t.codec&&fo(t.codec)&&(null===(o=y[0])||void 0===o?void 0:o.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:k.cid,codec:t.codec,maxbr:y[0].maxBitrate/1e3});case 11:return i.n=12,this.engine.negotiate();case 12:return i.a(2)}},i,this,[[3,7,8,9]])}))},!(this.enabledPublishVideoCodecs.length>0)){r.n=9;break}return r.n=8,Promise.all([this.engine.addTrack(k),w()]);case 8:E=r.v,C=E[0],r.n=11;break;case 9:return r.n=10,this.engine.addTrack(k);case 10:return(C=r.v).codecs.forEach(function(e){void 0===P&&(P=e.mimeType)}),P&&t.kind===e.Track.Kind.Video&&(R=no(P))!==g&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),io(t)),{codec:R})),n.videoCodec=R,y=Fs(t.source===e.Track.Source.ScreenShare,k.width,k.height,n)),r.n=11,w();case 11:return(I=new yc(t.kind,C,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return O.logContext}})).options=n,t.sid=C.sid,this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:y,trackInfo:C})),t instanceof Hs?t.startMonitor(this.engine.client):t instanceof Ds&&t.startMonitor(),this.addTrackPublication(I),this.emit(e.ParticipantEvent.LocalTrackPublished,I),r.a(2,I)}},r,this,[[1,3]])}))}},{key:"isLocal",get:function(){return!0}},{key:"publishAdditionalCodecForTrack",value:function(t,n,i){return Dn(this,void 0,void 0,h().m(function r(){var a,o,s,c,u,d,l,f,m,v=this;return h().w(function(r){for(;;)switch(r.n){case 0:if(this.encryptionType===It.NONE){r.n=1;break}return r.a(2);case 1:if(this.trackPublications.forEach(function(e){e.track&&e.track===t&&(o=e)}),o){r.n=2;break}throw new ma("track is not published");case 2:if(t instanceof Hs){r.n=3;break}throw new ma("track is not a video track");case 3:if(s=Object.assign(Object.assign({},null===(a=this.roomOptions)||void 0===a?void 0:a.publishDefaults),i),c=Bs(t,n,s)){r.n=4;break}return this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),io(t))),r.a(2);case 4:if(u=t.addSimulcastTrack(n,c)){r.n=5;break}return r.a(2);case 5:if((d=new Un({cid:u.mediaStreamTrack.id,type:e.Track.kindToProto(t.kind),muted:t.isMuted,source:e.Track.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:s.videoCodec,cid:u.mediaStreamTrack.id}]})).layers=Ys(d.width,d.height,c),this.engine&&!this.engine.isClosed){r.n=6;break}throw new pa("cannot publish track when not connected");case 6:return l=function(){return Dn(v,void 0,void 0,h().m(function e(){var n;return h().w(function(e){for(;;)switch(e.n){case 0:return n={direction:"sendonly"},c&&(n.sendEncodings=c),e.n=1,this.engine.createSimulcastSender(t,u,s,c);case 1:return e.n=2,this.engine.negotiate();case 2:return e.a(2)}},e,this)}))},r.n=7,Promise.all([this.engine.addTrack(d),l()]);case 7:f=r.v,m=f[0],this.log.debug("published ".concat(n," for track ").concat(t.sid),Object.assign(Object.assign({},this.logContext),{encodings:c,trackInfo:m}));case 8:return r.a(2)}},r,this)}))}},{key:"unpublishTrack",value:function(t,n){return Dn(this,void 0,void 0,h().m(function i(){var r,a,o,c,u,d,l,f,m,v,p,k,y,b,T;return h().w(function(i){for(;;)switch(i.n){case 0:if(!(t instanceof Wo)){i.n=1;break}if(!(o=this.pendingPublishPromises.get(t))){i.n=1;break}return this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),io(t))),i.n=1,o;case 1:if(c=this.getPublicationForTrack(t),u=c?io(c):void 0,this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),u)),c&&c.track){i.n=2;break}return this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),u)),i.a(2,void 0);case 2:if((t=c.track).off(e.TrackEvent.Muted,this.onTrackMuted),t.off(e.TrackEvent.Unmuted,this.onTrackUnmuted),t.off(e.TrackEvent.Ended,this.handleTrackEnded),t.off(e.TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.off(e.TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),t.off(e.TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),d=t.sender,t.sender=void 0,!(t.isUpstreamPaused&&t.mediaStreamTrack&&d)){i.n=3;break}return i.n=3,d.replaceTrack(t.mediaStreamTrack);case 3:if(void 0===n&&(n=null===(a=null===(r=this.roomOptions)||void 0===r?void 0:r.stopLocalTrackOnUnpublish)||void 0===a||a),n?t.stop():t.stopMonitor(),l=!1,this.engine.pcManager&&this.engine.pcManager.currentState<Ts.FAILED&&d)try{f=s(this.engine.pcManager.publisher.getTransceivers());try{for(f.s();!(m=f.n()).done;)(v=m.value).sender===d&&(v.direction="inactive",l=!0)}catch(e){f.e(e)}finally{f.f()}if(this.engine.removeTrack(d)&&(l=!0),t instanceof Hs){p=s(t.simulcastCodecs);try{for(p.s();!(k=p.n()).done;)y=g(k.value,2),(b=y[1]).sender&&(this.engine.removeTrack(b.sender)&&(l=!0),b.sender=void 0)}catch(e){p.e(e)}finally{p.f()}t.simulcastCodecs.clear()}}catch(e){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),u),{error:e}))}this.trackPublications.delete(c.trackSid),T=c.kind,i.n=T===e.Track.Kind.Audio?4:T===e.Track.Kind.Video?5:6;break;case 4:return this.audioTrackPublications.delete(c.trackSid),i.a(3,7);case 5:return this.videoTrackPublications.delete(c.trackSid),i.a(3,7);case 6:return i.a(3,7);case 7:if(this.emit(e.ParticipantEvent.LocalTrackUnpublished,c),c.setTrack(void 0),!l){i.n=8;break}return i.n=8,this.engine.negotiate();case 8:return i.a(2,c)}},i,this)}))}},{key:"sendChatMessage",value:function(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r;return h().w(function(n){for(;;)switch(n.n){case 0:return i={id:crypto.randomUUID(),message:t,timestamp:Date.now()},r=new Lt({value:{case:"chatMessage",value:new Jt(Object.assign(Object.assign({},i),{timestamp:z.parse(i.timestamp)}))}}),n.n=1,this.engine.sendDataPacket(r,e.DataPacket_Kind.RELIABLE);case 1:return this.emit(e.ParticipantEvent.ChatMessage,i),n.a(2,i)}},n,this)}))}},{key:"editChatMessage",value:function(t,n){return Dn(this,void 0,void 0,h().m(function i(){var r,a;return h().w(function(i){for(;;)switch(i.n){case 0:return r=Object.assign(Object.assign({},n),{message:t,editTimestamp:Date.now()}),a=new Lt({value:{case:"chatMessage",value:new Jt(Object.assign(Object.assign({},r),{timestamp:z.parse(r.timestamp),editTimestamp:z.parse(r.editTimestamp)}))}}),i.n=1,this.engine.sendDataPacket(a,e.DataPacket_Kind.RELIABLE);case 1:return this.emit(e.ParticipantEvent.ChatMessage,r),i.a(2,r)}},i,this)}))}},{key:"unpublishTracks",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i=this;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Promise.all(e.map(function(e){return i.unpublishTrack(e)}));case 1:return n=t.v,t.a(2,n.filter(function(e){return e instanceof yc}))}},t)}))}},{key:"republishAllTracks",value:function(t){return Dn(this,arguments,void 0,function(t){var n=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return h().m(function r(){return h().w(function(r){for(;;)switch(r.n){case 0:if(!n.republishPromise){r.n=1;break}return r.n=1,n.republishPromise;case 1:return n.republishPromise=new Promise(function(r,a){return Dn(n,void 0,void 0,h().m(function n(){var o,s,c=this;return h().w(function(n){for(;;)switch(n.n){case 0:return n.p=0,o=[],this.trackPublications.forEach(function(e){e.track&&(t&&(e.options=Object.assign(Object.assign({},e.options),t)),o.push(e))}),n.n=1,Promise.all(o.map(function(t){return Dn(c,void 0,void 0,h().m(function n(){var r;return h().w(function(n){for(;;)switch(n.n){case 0:return r=t.track,n.n=1,this.unpublishTrack(r,!1);case 1:if(!i||r.isMuted||r.source===e.Track.Source.ScreenShare||r.source===e.Track.Source.ScreenShareAudio||!(r instanceof Ds||r instanceof Hs)||r.isUserProvided){n.n=2;break}return this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:t.trackSid})),n.n=2,r.restartTrack();case 2:return n.n=3,this.publishOrRepublishTrack(r,t.options,!0);case 3:return n.a(2)}},n,this)}))}));case 1:r(),n.n=3;break;case 2:n.p=2,s=n.v,a(s);case 3:return n.p=3,this.republishPromise=void 0,n.f(3);case 4:return n.a(2)}},n,this,[[0,2,3,4]])}))}),r.n=2,n.republishPromise;case 2:return r.a(2)}},r)})()})}},{key:"publishData",value:function(t){return Dn(this,arguments,void 0,function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h().m(function r(){var a,o,s,c;return h().w(function(r){for(;;)switch(r.n){case 0:return a=i.reliable?e.DataPacket_Kind.RELIABLE:e.DataPacket_Kind.LOSSY,o=i.destinationIdentities,s=i.topic,c=new Lt({kind:a,value:{case:"user",value:new Ut({participantIdentity:n.identity,payload:t,destinationIdentities:o,destinationSids:o,topic:s})}}),r.n=1,n.engine.sendDataPacket(c,a);case 1:return r.a(2)}},r)})()})}},{key:"publishDtmf",value:function(t,n){return Dn(this,void 0,void 0,h().m(function i(){var r;return h().w(function(i){for(;;)switch(i.n){case 0:return r=new Lt({kind:e.DataPacket_Kind.RELIABLE,value:{case:"sipDtmf",value:new jt({code:t,digit:n})}}),i.n=1,this.engine.sendDataPacket(r,e.DataPacket_Kind.RELIABLE);case 1:return i.a(2)}},i,this)}))}},{key:"performRpc",value:function(e,t,n){return Dn(this,arguments,void 0,function(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;return h().m(function a(){return h().w(function(a){for(;;)if(0===a.n)return a.a(2,new Promise(function(a,o){return Dn(i,void 0,void 0,h().m(function i(){var s,c,u,d,l,f,m,v=this;return h().w(function(i){for(;;)switch(i.n){case 0:if(!(cc(n)>15360)){i.n=1;break}return o(sc.builtIn("REQUEST_PAYLOAD_TOO_LARGE")),i.a(2);case 1:if(!((null===(c=null===(s=this.engine.latestJoinResponse)||void 0===s?void 0:s.serverInfo)||void 0===c?void 0:c.version)&&Po(null===(d=null===(u=this.engine.latestJoinResponse)||void 0===u?void 0:u.serverInfo)||void 0===d?void 0:d.version,"1.8.0")<0)){i.n=2;break}return o(sc.builtIn("UNSUPPORTED_SERVER")),i.a(2);case 2:return l=crypto.randomUUID(),i.n=3,this.publishRpcRequest(e,l,t,n,r-2e3);case 3:f=setTimeout(function(){v.pendingAcks.delete(l),o(sc.builtIn("CONNECTION_TIMEOUT")),v.pendingResponses.delete(l),clearTimeout(m)},2e3),this.pendingAcks.set(l,{resolve:function(){clearTimeout(f)},participantIdentity:e}),m=setTimeout(function(){v.pendingResponses.delete(l),o(sc.builtIn("RESPONSE_TIMEOUT"))},r),this.pendingResponses.set(l,{resolve:function(e,t){clearTimeout(m),v.pendingAcks.has(l)&&(console.warn("RPC response received before ack",l),v.pendingAcks.delete(l),clearTimeout(f)),t?o(t):a(null!=e?e:"")},participantIdentity:e});case 4:return i.a(2)}},i,this)}))}))},a)})()})}},{key:"registerRpcMethod",value:function(e,t){this.rpcHandlers.set(e,t)}},{key:"unregisterRpcMethod",value:function(e){this.rpcHandlers.delete(e)}},{key:"setTrackSubscriptionPermissions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}},{key:"handleIncomingRpcAck",value:function(e){var t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}},{key:"handleIncomingRpcResponse",value:function(e,t,n){var i=this.pendingResponses.get(e);i?(i.resolve(t,n),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}},{key:"handleIncomingRpcRequest",value:function(e,t,n,i,r){return Dn(this,void 0,void 0,h().m(function a(){var o,s,c,u,d;return h().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,this.publishRpcAck(e,t);case 1:if(o=this.rpcHandlers.get(n)){a.n=3;break}return a.n=2,this.publishRpcResponse(e,t,null,sc.builtIn("UNSUPPORTED_METHOD"));case 2:return a.a(2);case 3:return s=null,c=null,a.p=4,a.n=5,o(t,e,i,r);case 5:cc(u=a.v)>15360?(s=sc.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(n))):c=u,a.n=7;break;case 6:a.p=6,(d=a.v)instanceof sc?s=d:(console.warn("Uncaught error returned by RPC handler for ".concat(n,". Returning APPLICATION_ERROR instead."),d),s=sc.builtIn("APPLICATION_ERROR"));case 7:return a.n=8,this.publishRpcResponse(e,t,c,s);case 8:return a.a(2)}},a,this,[[4,6]])}))}},{key:"publishRpcRequest",value:function(t,n,i,r,a){return Dn(this,void 0,void 0,h().m(function o(){var s;return h().w(function(o){for(;;)switch(o.n){case 0:return s=new Lt({destinationIdentities:[t],kind:e.DataPacket_Kind.RELIABLE,value:{case:"rpcRequest",value:new qt({id:n,method:i,payload:r,responseTimeoutMs:a})}}),o.n=1,this.engine.sendDataPacket(s,e.DataPacket_Kind.RELIABLE);case 1:return o.a(2)}},o,this)}))}},{key:"publishRpcResponse",value:function(t,n,i,r){return Dn(this,void 0,void 0,h().m(function a(){var o;return h().w(function(a){for(;;)switch(a.n){case 0:return o=new Lt({destinationIdentities:[t],kind:e.DataPacket_Kind.RELIABLE,value:{case:"rpcResponse",value:new Kt({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:null!=i?i:""}})}}),a.n=1,this.engine.sendDataPacket(o,e.DataPacket_Kind.RELIABLE);case 1:return a.a(2)}},a,this)}))}},{key:"publishRpcAck",value:function(t,n){return Dn(this,void 0,void 0,h().m(function i(){var r;return h().w(function(i){for(;;)switch(i.n){case 0:return r=new Lt({destinationIdentities:[t],kind:e.DataPacket_Kind.RELIABLE,value:{case:"rpcAck",value:new Vt({requestId:n})}}),i.n=1,this.engine.sendDataPacket(r,e.DataPacket_Kind.RELIABLE);case 1:return i.a(2)}},i,this)}))}},{key:"handleParticipantDisconnected",value:function(e){var t,n=s(this.pendingAcks);try{for(n.s();!(t=n.n()).done;){var i=g(t.value,2),r=i[0];i[1].participantIdentity===e&&this.pendingAcks.delete(r)}}catch(e){n.e(e)}finally{n.f()}var a,o=s(this.pendingResponses);try{for(o.s();!(a=o.n()).done;){var c=g(a.value,2),u=c[0],d=c[1],l=d.participantIdentity,f=d.resolve;l===e&&(f(null,sc.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(u))}}catch(e){o.e(e)}finally{o.f()}}},{key:"setEnabledPublishCodecs",value:function(e){this.enabledPublishVideoCodecs=e.filter(function(e){return"video"===e.mime.split("/")[0].toLowerCase()})}},{key:"updateInfo",value:function(t){var i=this;return t.sid===this.sid&&(!!k(n,"updateInfo",this,3)([t])&&(t.tracks.forEach(function(t){var n,r=i.trackPublications.get(t.sid);if(r){console.log("Track type is: "+r.kind+" & Sid is: "+t.sid+" & Mute value is: "+t.muted);if(/^TR_VS.*/.test(t.sid)||/^TR_As.*/.test(t.sid))return;var a=r.track;r.kind==e.Track.Kind.Audio?(sessionStorage.getItem("isAudioMuted")&&"true"===sessionStorage.getItem("isAudioMuted")&&(i.log.debug("updating server audio mute state after reloading",Object.assign(Object.assign({},i.logContext),{sid:t.sid,muted:!0})),i.engine.client.sendMuteTrack(t.sid,!0),i.audioMuted=!0),t.muted?a instanceof Ds&&a.mute().then(function(){i.emit(e.ParticipantEvent.TrackMuted,r)}):(i.audioMuted&&a instanceof Ds&&a.unmute().then(function(){i.emit(e.ParticipantEvent.TrackUnmuted,r)}),i.audioMuted=!1)):(null===(n=r.track)||void 0===n?void 0:n.isUpstreamPaused)||(sessionStorage.getItem("isVideoMuted")&&"true"===sessionStorage.getItem("isVideoMuted")&&(i.log.debug("updating server video mute state after reloading",Object.assign(Object.assign({},i.logContext),{sid:t.sid,muted:!0})),i.engine.client.sendMuteTrack(t.sid,!0),i.videoMuted=!0),t.muted?a instanceof Hs&&a.mute().then(function(){i.emit(e.ParticipantEvent.TrackMuted,r)}):(i.videoMuted&&a instanceof Hs&&a.unmute().then(function(){i.emit(e.ParticipantEvent.TrackUnmuted,r)}),i.videoMuted=!1))}}),!0))}},{key:"getPublicationForTrack",value:function(e){var t;return this.trackPublications.forEach(function(n){var i=n.track;i&&(e instanceof MediaStreamTrack?(i instanceof Ds||i instanceof Hs)&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))}),t}},{key:"waitForPendingPublicationOfSource",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i,r;return h().w(function(t){for(;;)switch(t.n){case 0:n=1e4,i=Date.now();case 1:if(!(Date.now()<i+n)){t.n=4;break}if(!(r=Array.from(this.pendingPublishPromises.entries()).find(function(t){return g(t,1)[0].source===e}))){t.n=2;break}return t.a(2,r[1]);case 2:return t.n=3,oo(20);case 3:t.n=1;break;case 4:return t.a(2)}},t,this)}))}}])}(bc),wc=function(t){function n(t,a,o,s){var c;return r(this,n),(c=i(this,n,[t,a.sid,a.name,s])).track=void 0,c.allowed=!0,c.disabled=!1,c.currentVideoQuality=e.VideoQuality.HIGH,c.handleEnded=function(t){c.setTrack(void 0),c.emit(e.TrackEvent.Ended,t)},c.handleVisibilityChange=function(e){c.log.debug("adaptivestream video visibility ".concat(c.trackSid,", visible=").concat(e),c.logContext),c.disabled=!e,c.emitTrackUpdate()},c.handleVideoDimensionsChange=function(e){c.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),c.logContext),c.videoDimensions=e,c.emitTrackUpdate()},c.subscribed=o,c.updateInfo(a),c}return l(n,t),o(n,[{key:"setSubscribed",value:function(t){var n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);var r=new Gn({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Gt({participantSid:"",trackSids:[this.trackSid]})]});this.emit(e.TrackEvent.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}},{key:"subscriptionStatus",get:function(){return!1===this.subscribed?e.TrackPublication.SubscriptionStatus.Unsubscribed:k(n,"isSubscribed",this,1)?e.TrackPublication.SubscriptionStatus.Subscribed:e.TrackPublication.SubscriptionStatus.Desired}},{key:"permissionStatus",get:function(){return this.allowed?e.TrackPublication.PermissionStatus.Allowed:e.TrackPublication.PermissionStatus.NotAllowed}},{key:"isSubscribed",get:function(){return!1!==this.subscribed&&k(n,"isSubscribed",this,1)}},{key:"isDesired",get:function(){return!1!==this.subscribed}},{key:"isEnabled",get:function(){return!this.disabled}},{key:"setEnabled",value:function(e){this.isManualOperationAllowed()&&this.disabled!==!e&&(this.disabled=!e,this.emitTrackUpdate())}},{key:"setVideoQuality",value:function(e){this.isManualOperationAllowed()&&this.currentVideoQuality!==e&&(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}},{key:"setVideoDimensions",value:function(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.videoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.videoDimensions)||void 0===n?void 0:n.height)===e.height||(this.track instanceof vc&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}},{key:"setVideoFPS",value:function(e){this.isManualOperationAllowed()&&this.track instanceof vc&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}},{key:"videoQuality",get:function(){return this.currentVideoQuality}},{key:"setTrack",value:function(t){var i=this.subscriptionStatus,r=this.permissionStatus,a=this.track;a!==t&&(a&&(a.off(e.TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),a.off(e.TrackEvent.VisibilityChanged,this.handleVisibilityChange),a.off(e.TrackEvent.Ended,this.handleEnded),a.detach(),a.stopMonitor(),this.emit(e.TrackEvent.Unsubscribed,a)),k(n,"setTrack",this,3)([t]),t&&(t.sid=this.trackSid,t.on(e.TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(e.TrackEvent.VisibilityChanged,this.handleVisibilityChange),t.on(e.TrackEvent.Ended,this.handleEnded),this.emit(e.TrackEvent.Subscribed,t)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(i))}},{key:"setAllowed",value:function(e){var t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}},{key:"setSubscriptionError",value:function(t){this.emit(e.TrackEvent.SubscriptionFailed,t)}},{key:"updateInfo",value:function(t){k(n,"updateInfo",this,3)([t]);var i=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):i!==t.muted&&this.emit(t.muted?e.TrackEvent.Muted:e.TrackEvent.Unmuted)}},{key:"emitSubscriptionUpdateIfChanged",value:function(t){var n=this.subscriptionStatus;t!==n&&this.emit(e.TrackEvent.SubscriptionStatusChanged,n,t)}},{key:"emitPermissionUpdateIfChanged",value:function(t){this.permissionStatus!==t&&this.emit(e.TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,t)}},{key:"isManualOperationAllowed",value:function(){return this.kind===e.Track.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}},{key:"isAdaptiveStream",get:function(){return this.track instanceof vc&&this.track.isAdaptiveStream}},{key:"emitTrackUpdate",value:function(){var t=new Hn({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(t.width=Math.ceil(this.videoDimensions.width),t.height=Math.ceil(this.videoDimensions.height)):void 0!==this.currentVideoQuality?t.quality=this.currentVideoQuality:t.quality=e.VideoQuality.HIGH,this.emit(e.TrackEvent.UpdateSettings,t)}}])}(e.TrackPublication),Cc=function(t){function n(t,a,o,s,c,u,d){var l,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:e.ParticipantKind.STANDARD;return r(this,n),(l=i(this,n,[a,o||"",s,c,u,d,f])).signalClient=t,l.trackPublications=new Map,l.audioTrackPublications=new Map,l.videoTrackPublications=new Map,l.volumeMap=new Map,l}return l(n,t),o(n,[{key:"logContext",get:function(){return Object.assign(Object.assign({},k(n,"logContext",this,1)),{rpID:this.sid,remoteParticipant:this.identity})}},{key:"addTrackPublication",value:function(t){var i=this;k(n,"addTrackPublication",this,3)([t]),t.on(e.TrackEvent.UpdateSettings,function(e){i.log.debug("send update settings",Object.assign(Object.assign({},i.logContext),io(t))),i.signalClient.sendUpdateTrackSettings(e)}),t.on(e.TrackEvent.UpdateSubscription,function(e){e.participantTracks.forEach(function(e){e.participantSid=i.sid}),i.signalClient.sendUpdateSubscription(e)}),t.on(e.TrackEvent.SubscriptionPermissionChanged,function(n){i.emit(e.ParticipantEvent.TrackSubscriptionPermissionChanged,t,n)}),t.on(e.TrackEvent.SubscriptionStatusChanged,function(n){i.emit(e.ParticipantEvent.TrackSubscriptionStatusChanged,t,n)}),t.on(e.TrackEvent.Subscribed,function(n){i.emit(e.ParticipantEvent.TrackSubscribed,n,t)}),t.on(e.TrackEvent.Unsubscribed,function(n){i.emit(e.ParticipantEvent.TrackUnsubscribed,n,t)}),t.on(e.TrackEvent.SubscriptionFailed,function(n){i.emit(e.ParticipantEvent.TrackSubscriptionFailed,t.trackSid,n)})}},{key:"getTrackPublication",value:function(e){var t=k(n,"getTrackPublication",this,3)([e]);if(t)return t}},{key:"getTrackPublicationByName",value:function(e){var t=k(n,"getTrackPublicationByName",this,3)([e]);if(t)return t}},{key:"setVolume",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Track.Source.Microphone;this.volumeMap.set(n,t);var i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(t)}},{key:"getVolume",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.Track.Source.Microphone,n=this.getTrackPublication(t);return n&&n.track?n.track.getVolume():this.volumeMap.get(t)}},{key:"addSubscribedMediaTrack",value:function(t,n,i,r,a,o){var s,c=this,u=this.getTrackPublicationBySid(n);return u||n.startsWith("TR")||this.trackPublications.forEach(function(e){u||t.kind!==e.kind.toString()||(u=e)}),u?"ended"===t.readyState?(this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),io(u))),void this.emit(e.ParticipantEvent.TrackSubscriptionFailed,n)):((s="video"===t.kind?new vc(t,n,r,a):new mc(t,n,r,this.audioContext,this.audioOutput)).source=u.source,s.isMuted=u.isMuted,s.setMediaStream(i),s.start(),u.setTrack(s),this.volumeMap.has(u.source)&&s instanceof mc&&s.setVolume(this.volumeMap.get(u.source)),u):0===o?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),void this.emit(e.ParticipantEvent.TrackSubscriptionFailed,n)):(void 0===o&&(o=20),void setTimeout(function(){c.addSubscribedMediaTrack(t,n,i,r,a,o-1)},150))}},{key:"hasMetadata",get:function(){return!!this.participantInfo}},{key:"getTrackPublicationBySid",value:function(e){return this.trackPublications.get(e)}},{key:"updateInfo",value:function(t){var i=this;if(!k(n,"updateInfo",this,3)([t]))return!1;var r=new Map,a=new Map;return t.tracks.forEach(function(t){var n,o,s=i.getTrackPublicationBySid(t.sid);if(s)s.updateInfo(t);else{var c=e.Track.kindFromProto(t.type);if(!c)return;(s=new wc(c,t,null===(n=i.signalClient.connectOptions)||void 0===n?void 0:n.autoSubscribe,{loggerContextCb:function(){return i.logContext},loggerName:null===(o=i.loggerOptions)||void 0===o?void 0:o.loggerName})).updateInfo(t),a.set(t.sid,s);var u=Array.from(i.trackPublications.values()).find(function(e){return e.source===(null==s?void 0:s.source)});u&&s.source!==e.Track.Source.Unknown&&i.log.debug("received a second track publication for ".concat(i.identity," with the same source: ").concat(s.source),Object.assign(Object.assign({},i.logContext),{oldTrack:io(u),newTrack:io(s)})),i.addTrackPublication(s)}r.set(t.sid,s)}),this.trackPublications.forEach(function(e){r.has(e.trackSid)||(i.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},i.logContext),io(e))),i.unpublishTrack(e.trackSid,!0))}),a.forEach(function(t){i.emit(e.ParticipantEvent.TrackPublished,t)}),!0}},{key:"unpublishTrack",value:function(t,n){var i=this.trackPublications.get(t);if(i){var r=i.track;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(t),i.kind){case e.Track.Kind.Audio:this.audioTrackPublications.delete(t);break;case e.Track.Kind.Video:this.videoTrackPublications.delete(t)}n&&this.emit(e.ParticipantEvent.TrackUnpublished,i)}}},{key:"setAudioOutput",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return this.audioOutput=e,n=[],this.audioTrackPublications.forEach(function(t){var i;t.track instanceof mc&&n.push(t.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))}),t.n=1,Promise.all(n);case 1:return t.a(2)}},t,this)}))}},{key:"emit",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),k(n,"emit",this,3)([e].concat(i))}}],[{key:"fromParticipantInfo",value:function(e,t,i){return new n(e,t.sid,t.identity,t.name,t.metadata,t.attributes,i,t.kind)}}])}(bc);e.ConnectionState=void 0,(Tc=e.ConnectionState||(e.ConnectionState={})).Disconnected="disconnected",Tc.Connecting="connecting",Tc.Connected="connected",Tc.Reconnecting="reconnecting",Tc.SignalReconnecting="signalReconnecting";var Ec,Pc=function(t){function n(t){var a,o,c,u;if(r(this,n),(a=i(this,n)).state=e.ConnectionState.Disconnected,a.activeSpeakers=[],a.isE2EEEnabled=!1,a.audioEnabled=!0,a.isVideoPlaybackBlocked=!1,a.log=bn,a.bufferedEvents=[],a.isResuming=!1,a.connect=function(t,n,i){return Dn(a,void 0,void 0,h().m(function r(){var a,o,s,c,u,d=this;return h().w(function(r){for(;;)switch(r.n){case 0:if(mo()){r.n=2;break}if(!To()){r.n=1;break}throw Error("WebRTC isn't detected, have you called registerGlobals?");case 1:throw Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");case 2:return o=sessionStorage.getItem("token"),n&&0!==n.trim().length||null==o||(bn.info("Reload Performed, using latest token to refresh: "+o),n=o),r.n=3,this.disconnectLock.lock();case 3:if(s=r.v,this.state!==e.ConnectionState.Connected){r.n=4;break}return this.log.info("already connected to room ".concat(this.name),this.logContext),s(),r.a(2,Promise.resolve());case 4:if(!this.connectFuture){r.n=5;break}return s(),r.a(2,this.connectFuture.promise);case 5:return this.setAndEmitConnectionState(e.ConnectionState.Connecting),(null===(a=this.regionUrlProvider)||void 0===a?void 0:a.getServerUrl().toString())!==t&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),So(new URL(t))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new ac(t,n):this.regionUrlProvider.updateToken(n),this.regionUrlProvider.fetchRegionSettings().then(function(e){var t;null===(t=d.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)}).catch(function(e){d.log.warn("could not fetch region settings",Object.assign(Object.assign({},d.logContext),{error:e}))})),c=function(r,a,o){return Dn(d,void 0,void 0,h().m(function u(){var d,l,f,m,v,p,g;return h().w(function(u){for(;;)switch(u.n){case 0:return this.abortController&&this.abortController.abort(),f=new AbortController,this.abortController=f,null==s||s(),u.p=1,u.n=2,this.attemptConnection(null!=o?o:t,n,i,f);case 2:this.abortController=void 0,r(),u.n=12;break;case 3:if(u.p=3,p=u.v,!(this.regionUrlProvider&&p instanceof fa&&3!==p.reason&&0!==p.reason)){u.n=11;break}return m=null,u.p=4,u.n=5,this.regionUrlProvider.getNextBestRegionUrl(null===(d=this.abortController)||void 0===d?void 0:d.signal);case 5:m=u.v,u.n=7;break;case 6:if(u.p=6,!((g=u.v)instanceof fa)||401!==g.status&&3!==g.reason){u.n=7;break}return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),a(g),u.a(2);case 7:if(!m||(null===(l=this.abortController)||void 0===l?void 0:l.signal.aborted)){u.n=9;break}return this.log.info("Initial connection failed with ConnectionError: ".concat(p.message,". Retrying with another region: ").concat(m),this.logContext),this.recreateEngine(),u.n=8,c(r,a,m);case 8:u.n=10;break;case 9:this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Jo(p)),a(p);case 10:u.n=12;break;case 11:v=e.DisconnectReason.UNKNOWN_REASON,p instanceof fa&&(v=Jo(p)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,v),a(p);case 12:return u.a(2)}},u,this,[[4,6],[1,3]])}))},u=this.regionUrl,this.regionUrl=void 0,this.connectFuture=new Uo(function(e,t){c(e,t,u)},function(){d.clearConnectionFutures()}),r.a(2,this.connectFuture.promise)}},r,this)}))},a.connectSignal=function(e,t,n,i,r,o){return Dn(a,void 0,void 0,h().m(function a(){var s,c,u,d,l;return h().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,n.join(e,t,{autoSubscribe:i.autoSubscribe,adaptiveStream:"object"===T(r.adaptiveStream)||r.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout},o.signal);case 1:if(d=a.v,(l=d.serverInfo)||(l={version:d.serverVersion,region:d.serverRegion}),this.serverInfo=l,this.log.debug("connected to Livekit Server ".concat(Object.entries(l).map(function(e){var t=g(e,2),n=t[0],i=t[1];return"".concat(n,": ").concat(i)}).join(", ")),{room:null===(s=d.room)||void 0===s?void 0:s.name,roomSid:null===(c=d.room)||void 0===c?void 0:c.sid,identity:null===(u=d.participant)||void 0===u?void 0:u.identity}),l.version){a.n=2;break}throw new va("unknown server version");case 2:return"0.15.1"===l.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),r.dynacast=!1),a.a(2,d)}},a,this)}))},a.applyJoinResponse=function(e){var t=e.participant;if(a.localParticipant.sid=t.sid,a.localParticipant.identity=t.identity,a.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),a.options.e2ee&&a.e2eeManager)try{a.e2eeManager.setSifTrailer(e.sifTrailer)}catch(e){a.log.error(e instanceof Error?e.message:"Could not set SifTrailer",Object.assign(Object.assign({},a.logContext),{error:e}))}a.handleParticipantUpdates([t].concat(y(e.otherParticipants))),e.room&&a.handleRoomUpdate(e.room)},a.attemptConnection=function(t,n,i,r){return Dn(a,void 0,void 0,h().m(function a(){var o,s,c,u,d,l;return h().w(function(a){for(;;)switch(a.n){case 0:return this.state===e.ConnectionState.Reconnecting||this.isResuming||(null===(o=this.engine)||void 0===o?void 0:o.pendingReconnect)?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),(null===(s=this.regionUrlProvider)||void 0===s?void 0:s.isCloud())&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Rs),i),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout),a.p=1,a.n=2,this.connectSignal(t,n,this.engine,this.connOptions,this.options,r);case 2:c=a.v,this.applyJoinResponse(c),this.setupLocalParticipantEvents(),this.emit(e.RoomEvent.SignalConnected),a.n=5;break;case 3:return a.p=3,d=a.v,a.n=4,this.engine.close();case 4:throw this.recreateEngine(),u=new fa("could not establish signal connection",1),d instanceof Error&&(u.message="".concat(u.message,": ").concat(d.message)),d instanceof fa&&(u.reason=d.reason,u.status=d.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:d})),u;case 5:if(!r.signal.aborted){a.n=7;break}return a.n=6,this.engine.close();case 6:throw this.recreateEngine(),new fa("Connection attempt aborted",3);case 7:return a.p=7,a.n=8,this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,r);case 8:a.n=11;break;case 9:return a.p=9,l=a.v,a.n=10,this.engine.close();case 10:throw this.recreateEngine(),l;case 11:bo()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),bo()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(e.ConnectionState.Connected),this.emit(e.RoomEvent.Connected),this.registerConnectionReconcile();case 12:return a.a(2)}},a,this,[[7,9],[1,3]])}))},a.disconnect=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Dn(a,[].concat(n),void 0,function(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return h().m(function i(){var r,a,o,s,c;return h().w(function(i){for(;;)switch(i.n){case 0:return sessionStorage.removeItem("token"),sessionStorage.removeItem("isAudioMuted"),sessionStorage.removeItem("isVideoMuted"),i.n=1,t.disconnectLock.lock();case 1:if(c=i.v,i.p=2,t.state!==e.ConnectionState.Disconnected){i.n=3;break}return t.log.debug("already disconnected",t.logContext),i.a(2);case 3:if(t.log.info("disconnect from room",Object.assign({},t.logContext)),(t.state===e.ConnectionState.Connecting||t.state===e.ConnectionState.Reconnecting||t.isResuming)&&(t.log.warn("abort connection attempt",t.logContext),null===(r=t.abortController)||void 0===r||r.abort(),null===(o=null===(a=t.connectFuture)||void 0===a?void 0:a.reject)||void 0===o||o.call(a,new fa("Client initiated disconnect",3)),t.connectFuture=void 0),null===(s=t.engine)||void 0===s?void 0:s.client.isDisconnected){i.n=4;break}return i.n=4,t.engine.client.sendLeave();case 4:if(!t.engine){i.n=5;break}return i.n=5,t.engine.close();case 5:t.handleDisconnect(n,e.DisconnectReason.CLIENT_INITIATED),t.engine=void 0;case 6:return i.p=6,c(),i.f(6);case 7:return i.a(2)}},i,null,[[2,,6,7]])})()})},a.onPageLeave=function(){return Dn(a,void 0,void 0,h().m(function e(){var t,n,i;return h().w(function(e){for(;;)switch(e.n){case 0:alert("on page leave"),this.log.info("Page leave detected, disconnecting",this.logContext),t=sessionStorage.getItem("token"),n=sessionStorage.getItem("isAudioMuted"),i=sessionStorage.getItem("isVideoMuted"),this.disconnect(),sessionStorage.setItem("token",t),sessionStorage.setItem("isAudioMuted",n),sessionStorage.setItem("isVideoMuted",i);case 1:return e.a(2)}},e,this)}))},a.startAudio=function(){return Dn(a,void 0,void 0,h().m(function t(){var n,i,r,a,o,s,c,u=this;return h().w(function(t){for(;;)switch(t.n){case 0:return n=[],(i=Ia())&&"iOS"===i.os&&(r="livekit-dummy-audio-el",(a=document.getElementById(r))||((a=document.createElement("audio")).id=r,a.autoplay=!0,a.hidden=!0,(o=Mo()).enabled=!0,s=new MediaStream([o]),a.srcObject=s,document.addEventListener("visibilitychange",function(){a&&(a.srcObject=document.hidden?null:s,document.hidden||(u.log.debug("page visible again, triggering startAudio to resume playback and update playback status",u.logContext),u.startAudio()))}),document.body.append(a),this.once(e.RoomEvent.Disconnected,function(){null==a||a.remove(),a=null})),n.push(a)),this.remoteParticipants.forEach(function(e){e.audioTrackPublications.forEach(function(e){e.track&&e.track.attachedElements.forEach(function(e){n.push(e)})})}),t.p=1,t.n=2,Promise.all([this.acquireAudioContext()].concat(y(n.map(function(e){return e.muted=!1,e.play()}))));case 2:this.handleAudioPlaybackStarted(),t.n=4;break;case 3:throw t.p=3,c=t.v,this.handleAudioPlaybackFailed(c),c;case 4:return t.a(2)}},t,this,[[1,3]])}))},a.startVideo=function(){return Dn(a,void 0,void 0,h().m(function e(){var t,n,i,r=this;return h().w(function(e){for(;;)switch(e.n){case 0:t=[],n=s(this.remoteParticipants.values());try{for(n.s();!(i=n.n()).done;)i.value.videoTrackPublications.forEach(function(e){var n;null===(n=e.track)||void 0===n||n.attachedElements.forEach(function(e){t.includes(e)||t.push(e)})})}catch(e){n.e(e)}finally{n.f()}return e.n=1,Promise.all(t.map(function(e){return e.play()})).then(function(){r.handleVideoPlaybackStarted()}).catch(function(e){"NotAllowedError"===e.name?r.handleVideoPlaybackFailed():r.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",r.logContext)});case 1:return e.a(2)}},e,this)}))},a.handleRestarting=function(){a.clearConnectionReconcile(),a.isResuming=!1;var t,n=s(a.remoteParticipants.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;a.handleParticipantDisconnected(i.identity,i)}}catch(e){n.e(e)}finally{n.f()}a.setAndEmitConnectionState(e.ConnectionState.Reconnecting)&&a.emit(e.RoomEvent.Reconnecting)},a.handleSignalRestarted=function(t){return Dn(a,void 0,void 0,h().m(function n(){var i;return h().w(function(n){for(;;)switch(n.n){case 0:return this.log.debug("signal reconnected to server, region ".concat(t.serverRegion),Object.assign(Object.assign({},this.logContext),{region:t.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(t),n.p=1,n.n=2,this.localParticipant.republishAllTracks(void 0,!0);case 2:n.n=4;break;case 3:n.p=3,i=n.v,this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:i}));case 4:return n.p=4,n.n=5,this.engine.waitForRestarted();case 5:this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:t.serverRegion})),n.n=7;break;case 6:return n.p=6,n.v,n.a(2);case 7:this.setAndEmitConnectionState(e.ConnectionState.Connected),this.emit(e.RoomEvent.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents();case 8:return n.a(2)}},n,this,[[4,6],[1,3]])}))},a.handleParticipantUpdates=function(e){e.forEach(function(e){var t;if(e.identity!==a.localParticipant.identity){""===e.identity&&(e.identity=null!==(t=a.sidToIdentity.get(e.sid))&&void 0!==t?t:"");var n=a.remoteParticipants.get(e.identity);e.state===Et.DISCONNECTED?a.handleParticipantDisconnected(e.identity,n):n=a.getOrCreateParticipant(e.identity,e)}else a.localParticipant.updateInfo(e)})},a.handleActiveSpeakersUpdate=function(t){var n=[],i={};t.forEach(function(e){if(i[e.sid]=!0,e.sid===a.localParticipant.sid)a.localParticipant.audioLevel=e.level,a.localParticipant.setIsSpeaking(!0),n.push(a.localParticipant);else{var t=a.getRemoteParticipantBySid(e.sid);t&&(t.audioLevel=e.level,t.setIsSpeaking(!0),n.push(t))}}),i[a.localParticipant.sid]||(a.localParticipant.audioLevel=0,a.localParticipant.setIsSpeaking(!1)),a.remoteParticipants.forEach(function(e){i[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))}),a.activeSpeakers=n,a.emitWhenConnected(e.RoomEvent.ActiveSpeakersChanged,n)},a.handleSpeakersChanged=function(t){var n=new Map;a.activeSpeakers.forEach(function(e){var t=a.remoteParticipants.get(e.identity);t&&t.sid!==e.sid||n.set(e.sid,e)}),t.forEach(function(e){var t=a.getRemoteParticipantBySid(e.sid);e.sid===a.localParticipant.sid&&(t=a.localParticipant),t&&(t.audioLevel=e.level,t.setIsSpeaking(e.active),e.active?n.set(e.sid,t):n.delete(e.sid))});var i=Array.from(n.values());i.sort(function(e,t){return t.audioLevel-e.audioLevel}),a.activeSpeakers=i,a.emitWhenConnected(e.RoomEvent.ActiveSpeakersChanged,i)},a.handleStreamStateUpdate=function(t){t.streamStates.forEach(function(t){var n=a.getRemoteParticipantBySid(t.participantSid);if(n){var i=n.getTrackPublicationBySid(t.trackSid);if(i&&i.track){var r=e.Track.streamStateFromProto(t.state);r!==i.track.streamState&&(i.track.streamState=r,n.emit(e.ParticipantEvent.TrackStreamStateChanged,i,i.track.streamState),a.emitWhenConnected(e.RoomEvent.TrackStreamStateChanged,i,i.track.streamState,n))}}})},a.handleSubscriptionPermissionUpdate=function(e){var t=a.getRemoteParticipantBySid(e.participantSid);if(t){var n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)}},a.handleSubscriptionError=function(e){var t=Array.from(a.remoteParticipants.values()).find(function(t){return t.trackPublications.has(e.trackSid)});if(t){var n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)}},a.handleDataPacket=function(e){var t=a.remoteParticipants.get(e.participantIdentity);"user"===e.value.case?a.handleUserPacket(t,e.value.value,e.kind):"transcription"===e.value.case?a.handleTranscription(t,e.value.value):"sipDtmf"===e.value.case?a.handleSipDtmf(t,e.value.value):"metrics"===e.value.case?a.handleMetrics(e.value.value,t):"chatMessage"===e.value.case&&a.handleChatMessage(t,e.value.value)},a.handleUserPacket=function(t,n,i){a.emit(e.RoomEvent.DataReceived,n.payload,t,i,n.topic),null==t||t.emit(e.ParticipantEvent.DataReceived,n.payload,i,n.destinationIdentities)},a.handleSipDtmf=function(t,n){a.emit(e.RoomEvent.SipDTMFReceived,n,t),null==t||t.emit(e.ParticipantEvent.SipDTMFReceived,n)},a.bufferedSegments=new Map,a.handleTranscription=function(t,n){var i=n.transcribedParticipantIdentity===a.localParticipant.identity?a.localParticipant:a.getParticipantByIdentity(n.transcribedParticipantIdentity),r=null==i?void 0:i.trackPublications.get(n.trackId),o=function(e,t){return e.segments.map(function(e){var n,i=e.id,r=e.text,a=e.startTime,o=e.endTime,s=e.final,c=e.language,u=e.error,d=e.failureReason,l=null!==(n=t.get(i))&&void 0!==n?n:Date.now(),f=Date.now();return s?t.delete(i):t.set(i,l),{id:i,text:r,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(o.toString()),final:s,language:c,firstReceivedTime:l,lastReceivedTime:f,error:u,failureReason:d}})}(n,a.transcriptionReceivedTimes);null==r||r.emit(e.TrackEvent.TranscriptionReceived,o),null==i||i.emit(e.ParticipantEvent.TranscriptionReceived,o,r),a.emit(e.RoomEvent.TranscriptionReceived,o,i,r)},a.handleMetrics=function(t,n){a.emit(e.RoomEvent.MetricsReceived,t,n)},a.handleChatMessage=function(t,n){var i=function(e){var t=e.id,n=e.timestamp,i=e.message,r=e.editTimestamp;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}(n);a.emit(e.RoomEvent.ChatMessage,i,t)},a.handleAudioPlaybackStarted=function(){a.canPlaybackAudio||(a.audioEnabled=!0,a.emit(e.RoomEvent.AudioPlaybackStatusChanged,!0))},a.handleAudioPlaybackFailed=function(t){a.log.warn("could not playback audio",Object.assign(Object.assign({},a.logContext),{error:t})),a.canPlaybackAudio&&(a.audioEnabled=!1,a.emit(e.RoomEvent.AudioPlaybackStatusChanged,!1))},a.handleVideoPlaybackStarted=function(){a.isVideoPlaybackBlocked&&(a.isVideoPlaybackBlocked=!1,a.emit(e.RoomEvent.VideoPlaybackStatusChanged,!0))},a.handleVideoPlaybackFailed=function(){a.isVideoPlaybackBlocked||(a.isVideoPlaybackBlocked=!0,a.emit(e.RoomEvent.VideoPlaybackStatusChanged,!1))},a.handleDeviceChange=function(){return Dn(a,void 0,void 0,h().m(function t(){var n,i,r,a,o,c,u,d,l,f,m,p,g,k=this;return h().w(function(t){for(;;)switch(t.n){case 0:return r=Vo.getInstance().previousDevices,t.n=1,Vo.getInstance().getDevices(void 0,!1);case 1:if(a=t.v,"Chrome"!==(null==(o=Ia())?void 0:o.name)||"iOS"===o.os){t.n=8;break}c=s(a),t.p=2,d=h().m(function t(){var n,i;return h().w(function(t){for(;;)switch(t.n){case 0:n=u.value,(i=r.find(function(e){return e.deviceId===n.deviceId}))&&""!==i.label&&i.kind===n.kind&&i.label!==n.label&&"default"===k.getActiveDevice(n.kind)&&k.emit(e.RoomEvent.ActiveDeviceChanged,n.kind,n.deviceId);case 1:return t.a(2)}},t)}),c.s();case 3:if((u=c.n()).done){t.n=5;break}return t.d(v(d()),4);case 4:t.n=3;break;case 5:t.n=7;break;case 6:t.p=6,g=t.v,c.e(g);case 7:return t.p=7,c.f(),t.f(7);case 8:l=["audiooutput","audioinput","videoinput"],f=h().m(function e(){var t,o,s;return h().w(function(e){for(;;)switch(e.n){case 0:if(t=p[m],o=a.filter(function(e){return e.kind===t}),(s=k.getActiveDevice(t))!==(null===(n=r.filter(function(e){return e.kind===t})[0])||void 0===n?void 0:n.deviceId)){e.n=2;break}if(!(o.length>0&&(null===(i=o[0])||void 0===i?void 0:i.deviceId)!==s)){e.n=2;break}return e.n=1,k.switchActiveDevice(t,o[0].deviceId);case 1:return e.a(2,0);case 2:if(("audioinput"!==t||po())&&"videoinput"!==t){e.n=3;break}return e.a(2,0);case 3:if(!(o.length>0)||o.find(function(e){return e.deviceId===k.getActiveDevice(t)})){e.n=4;break}return e.n=4,k.switchActiveDevice(t,o[0].deviceId);case 4:return e.a(2)}},e)}),m=0,p=l;case 9:if(!(m<p.length)){t.n=12;break}return t.d(v(f()),10);case 10:if(0!==t.v){t.n=11;break}return t.a(3,11);case 11:m++,t.n=9;break;case 12:this.emit(e.RoomEvent.MediaDevicesChanged);case 13:return t.a(2)}},t,this,[[2,6,7,8]])}))},a.handleRoomUpdate=function(t){var n=a.roomInfo;a.roomInfo=t,n&&n.metadata!==t.metadata&&a.emitWhenConnected(e.RoomEvent.RoomMetadataChanged,t.metadata),(null==n?void 0:n.activeRecording)!==t.activeRecording&&a.emitWhenConnected(e.RoomEvent.RecordingStatusChanged,t.activeRecording)},a.handleConnectionQualityUpdate=function(e){e.updates.forEach(function(e){if(e.participantSid!==a.localParticipant.sid){var t=a.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)}else a.localParticipant.setConnectionQuality(e.quality)})},a.onLocalParticipantMetadataChanged=function(t){a.emit(e.RoomEvent.ParticipantMetadataChanged,t,a.localParticipant)},a.onLocalParticipantNameChanged=function(t){a.emit(e.RoomEvent.ParticipantNameChanged,t,a.localParticipant)},a.onLocalAttributesChanged=function(t){a.emit(e.RoomEvent.ParticipantAttributesChanged,t,a.localParticipant)},a.onLocalTrackMuted=function(t){a.emit(e.RoomEvent.TrackMuted,t,a.localParticipant)},a.onLocalTrackUnmuted=function(t){a.emit(e.RoomEvent.TrackUnmuted,t,a.localParticipant)},a.onTrackProcessorUpdate=function(e){var t;null===(t=null==e?void 0:e.onPublish)||void 0===t||t.call(e,a)},a.onLocalTrackPublished=function(t){return Dn(a,void 0,void 0,h().m(function n(){var i,r,a,o,s,c,u,d;return h().w(function(n){for(;;)switch(n.n){case 0:if(null===(i=t.track)||void 0===i||i.on(e.TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(r=t.track)||void 0===r||r.on(e.TrackEvent.Restarted,this.onLocalTrackRestarted),null===(s=null===(o=null===(a=t.track)||void 0===a?void 0:a.getProcessor())||void 0===o?void 0:o.onPublish)||void 0===s||s.call(o,this),this.emit(e.RoomEvent.LocalTrackPublished,t,this.localParticipant),!(t.track instanceof Ds)){n.n=2;break}return n.n=1,t.track.checkForSilence();case 1:n.v&&this.emit(e.RoomEvent.LocalAudioSilenceDetected,t);case 2:return n.n=3,null===(c=t.track)||void 0===c?void 0:c.getDeviceId(!1);case 3:u=n.v,(d=eo(t.source))&&u&&u!==this.localParticipant.activeDeviceMap.get(d)&&(this.localParticipant.activeDeviceMap.set(d,u),this.emit(e.RoomEvent.ActiveDeviceChanged,d,u));case 4:return n.a(2)}},n,this)}))},a.onLocalTrackUnpublished=function(t){var n,i;null===(n=t.track)||void 0===n||n.off(e.TrackEvent.TrackProcessorUpdate,a.onTrackProcessorUpdate),null===(i=t.track)||void 0===i||i.off(e.TrackEvent.Restarted,a.onLocalTrackRestarted),a.emit(e.RoomEvent.LocalTrackUnpublished,t,a.localParticipant)},a.onLocalTrackRestarted=function(t){return Dn(a,void 0,void 0,h().m(function n(){var i,r;return h().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,t.getDeviceId(!1);case 1:i=n.v,(r=eo(t.source))&&i&&i!==this.localParticipant.activeDeviceMap.get(r)&&(this.log.debug("local track restarted, setting ".concat(r," ").concat(i," active"),this.logContext),this.localParticipant.activeDeviceMap.set(r,i),this.emit(e.RoomEvent.ActiveDeviceChanged,r,i));case 2:return n.a(2)}},n,this)}))},a.onLocalConnectionQualityChanged=function(t){a.emit(e.RoomEvent.ConnectionQualityChanged,t,a.localParticipant)},a.onMediaDevicesError=function(t){a.emit(e.RoomEvent.MediaDevicesError,t)},a.onLocalParticipantPermissionsChanged=function(t){a.emit(e.RoomEvent.ParticipantPermissionsChanged,t,a.localParticipant)},a.onLocalChatMessageSent=function(t){a.emit(e.RoomEvent.ChatMessage,t,a.localParticipant)},a.setMaxListeners(100),a.remoteParticipants=new Map,a.sidToIdentity=new Map,a.options=Object.assign(Object.assign({},Ps),t),a.log=Sn(null!==(o=a.options.loggerName)&&void 0!==o?o:e.LoggerNames.Room),a.transcriptionReceivedTimes=new Map,a.options.audioCaptureDefaults=Object.assign(Object.assign({},Cs),null==t?void 0:t.audioCaptureDefaults),a.options.videoCaptureDefaults=Object.assign(Object.assign({},Es),null==t?void 0:t.videoCaptureDefaults),a.options.publishDefaults=Object.assign(Object.assign({},ws),null==t?void 0:t.publishDefaults),a.maybeCreateEngine(),a.disconnectLock=new jo,a.localParticipant=new Sc("","",a.engine,a.options),a.options.videoCaptureDefaults.deviceId&&a.localParticipant.activeDeviceMap.set("videoinput",Fo(a.options.videoCaptureDefaults.deviceId)),a.options.audioCaptureDefaults.deviceId&&a.localParticipant.activeDeviceMap.set("audioinput",Fo(a.options.audioCaptureDefaults.deviceId)),(null===(c=a.options.audioOutput)||void 0===c?void 0:c.deviceId)&&a.switchActiveDevice("audiooutput",Fo(a.options.audioOutput.deviceId)).catch(function(e){return a.log.warn("Could not set audio output: ".concat(e.message),a.logContext)}),a.options.e2ee&&a.setupE2EE(),bo()){var d=new AbortController;null===(u=navigator.mediaDevices)||void 0===u||u.addEventListener("devicechange",a.handleDeviceChange,{signal:d.signal}),n.cleanupRegistry&&n.cleanupRegistry.register(a,function(){d.abort()})}return a}return l(n,t),o(n,[{key:"setE2EEEnabled",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:if(!this.e2eeManager){t.n=2;break}return t.n=1,Promise.all([this.localParticipant.setE2EEEnabled(e)]);case 1:""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity),t.n=3;break;case 2:throw Error("e2ee not configured, please set e2ee settings within the room options");case 3:return t.a(2)}},t,this)}))}},{key:"setupE2EE",value:function(){var t,n=this;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new Go(this.options.e2ee),this.e2eeManager.on(e.EncryptionEvent.ParticipantEncryptionStatusChanged,function(t,i){i instanceof Sc&&(n.isE2EEEnabled=t),n.emit(e.RoomEvent.ParticipantEncryptionStatusChanged,t,i)}),this.e2eeManager.on(e.EncryptionEvent.EncryptionError,function(t){return n.emit(e.RoomEvent.EncryptionError,t)}),null===(t=this.e2eeManager)||void 0===t||t.setup(this))}},{key:"logContext",get:function(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}},{key:"isRecording",get:function(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}},{key:"getSid",value:function(){return Dn(this,void 0,void 0,h().m(function t(){var n=this;return h().w(function(t){for(;;)switch(t.n){case 0:if(this.state!==e.ConnectionState.Disconnected){t.n=1;break}return t.a(2,"");case 1:if(!this.roomInfo||""===this.roomInfo.sid){t.n=2;break}return t.a(2,this.roomInfo.sid);case 2:return t.a(2,new Promise(function(t,i){var r=function(i){""!==i.sid&&(n.engine.off(e.EngineEvent.RoomUpdate,r),t(i.sid))};n.engine.on(e.EngineEvent.RoomUpdate,r),n.once(e.RoomEvent.Disconnected,function(){n.engine.off(e.EngineEvent.RoomUpdate,r),i("Room disconnected before room server id was available")})}))}},t,this)}))}},{key:"name",get:function(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}},{key:"metadata",get:function(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}},{key:"numParticipants",get:function(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}},{key:"numPublishers",get:function(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}},{key:"maybeCreateEngine",value:function(){var t=this;if(!this.engine||this.engine.isClosed){var n=0;this.engine=new tc(this.options),this.engine.on(e.EngineEvent.ParticipantUpdate,this.handleParticipantUpdates).on(e.EngineEvent.RoomUpdate,this.handleRoomUpdate).on(e.EngineEvent.SpeakersChanged,this.handleSpeakersChanged).on(e.EngineEvent.StreamStateChanged,this.handleStreamStateUpdate).on(e.EngineEvent.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(e.EngineEvent.SubscriptionError,this.handleSubscriptionError).on(e.EngineEvent.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(e.EngineEvent.MediaTrackAdded,function(e,n,i){t.onTrackAdded(e,n,i)}).on(e.EngineEvent.Disconnected,function(e){t.handleDisconnect(t.options.stopLocalTrackOnUnpublish,e)}).on(e.EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(e.EngineEvent.DataPacketReceived,this.handleDataPacket).on(e.EngineEvent.Resuming,function(){t.clearConnectionReconcile(),t.isResuming=!0,t.log.info("Resuming signal connection",t.logContext),t.setAndEmitConnectionState(e.ConnectionState.SignalReconnecting)&&t.emit(e.RoomEvent.SignalReconnecting)}).on(e.EngineEvent.Resumed,function(){t.registerConnectionReconcile(),t.isResuming=!1,t.log.info("Resumed signal connection",t.logContext),t.updateSubscriptions(),t.emitBufferedEvents(),t.setAndEmitConnectionState(e.ConnectionState.Connected)&&t.emit(e.RoomEvent.Reconnected)}).on(e.EngineEvent.SignalResumed,function(){t.bufferedEvents=[],(t.state===e.ConnectionState.Reconnecting||t.isResuming)&&t.sendSyncState()}).on(e.EngineEvent.Restarting,this.handleRestarting).on(e.EngineEvent.SignalRestarted,this.handleSignalRestarted).on(e.EngineEvent.Offline,function(){t.setAndEmitConnectionState(e.ConnectionState.Reconnecting)&&t.emit(e.RoomEvent.Reconnecting)}).on(e.EngineEvent.DCBufferStatusChanged,function(n,i){t.emit(e.RoomEvent.DCBufferStatusChanged,n,i)}).on(e.EngineEvent.PrimaryDelay,function(e){n=Math.max(n,e)}).on(e.EngineEvent.SecondaryDelay,function(i){n=Math.max(n,i),t.emit(e.RoomEvent.ReconnectICEDelay,n/1e3),n=0}).on(e.EngineEvent.LocalTrackSubscribed,function(n){var i=t.localParticipant.getTrackPublications().find(function(e){return e.trackSid===n});i?(t.localParticipant.emit(e.ParticipantEvent.LocalTrackSubscribed,i),t.emitWhenConnected(e.RoomEvent.LocalTrackSubscribed,i,t.localParticipant)):t.log.warn("could not find local track subscription for subscribed event",t.logContext)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine)}}},{key:"prepareConnection",value:function(t,n){return Dn(this,void 0,void 0,h().m(function i(){var r,a;return h().w(function(i){for(;;)switch(i.n){case 0:if(this.state===e.ConnectionState.Disconnected){i.n=1;break}return i.a(2);case 1:if(this.log.debug("prepareConnection to ".concat(t),this.logContext),i.p=2,!So(new URL(t))||!n){i.n=6;break}return this.regionUrlProvider=new ac(t,n),i.n=3,this.regionUrlProvider.getNextBestRegionUrl();case 3:if(!(r=i.v)||this.state!==e.ConnectionState.Disconnected){i.n=5;break}return this.regionUrl=r,i.n=4,fetch(Bo(r),{method:"HEAD"});case 4:this.log.debug("prepared connection to ".concat(r),this.logContext);case 5:i.n=7;break;case 6:return i.n=7,fetch(Bo(t),{method:"HEAD"});case 7:i.n=9;break;case 8:i.p=8,a=i.v,this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:a}));case 9:return i.a(2)}},i,this,[[2,8]])}))}},{key:"getParticipantByIdentity",value:function(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}},{key:"clearConnectionFutures",value:function(){this.connectFuture=void 0}},{key:"simulateScenario",value:function(t,n){return Dn(this,void 0,void 0,h().m(function i(){var r,a,o,s=this;return h().w(function(i){for(;;)switch(i.n){case 0:r=function(){},o=t,i.n="signal-reconnect"===o?1:"speaker"===o?3:"node-failure"===o?4:"server-leave"===o?5:"migration"===o?6:"resume-reconnect"===o?7:"disconnect-signal-on-resume"===o?9:"disconnect-signal-on-resume-no-messages"===o?10:"full-reconnect"===o?11:"force-tcp"===o||"force-tls"===o?13:"subscriber-bandwidth"===o?14:"leave-full-reconnect"===o?16:17;break;case 1:return i.n=2,this.engine.client.handleOnClose("simulate disconnect");case 2:return i.a(3,17);case 3:return a=new vi({scenario:{case:"speakerUpdate",value:3}}),i.a(3,17);case 4:return a=new vi({scenario:{case:"nodeFailure",value:!0}}),i.a(3,17);case 5:return a=new vi({scenario:{case:"serverLeave",value:!0}}),i.a(3,17);case 6:return a=new vi({scenario:{case:"migration",value:!0}}),i.a(3,17);case 7:return this.engine.failNext(),i.n=8,this.engine.client.handleOnClose("simulate resume-disconnect");case 8:return i.a(3,17);case 9:return r=function(){return Dn(s,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.engine.client.handleOnClose("simulate resume-disconnect");case 1:return e.a(2)}},e,this)}))},a=new vi({scenario:{case:"disconnectSignalOnResume",value:!0}}),i.a(3,17);case 10:return r=function(){return Dn(s,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.engine.client.handleOnClose("simulate resume-disconnect");case 1:return e.a(2)}},e,this)}))},a=new vi({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}}),i.a(3,17);case 11:return this.engine.fullReconnectOnNext=!0,i.n=12,this.engine.client.handleOnClose("simulate full-reconnect");case 12:return i.a(3,17);case 13:return a=new vi({scenario:{case:"switchCandidateProtocol",value:"force-tls"===t?2:1}}),r=function(){return Dn(s,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:(n=this.engine.client.onLeave)&&n(new Xn({reason:e.DisconnectReason.CLIENT_INITIATED,action:Yn.RECONNECT}));case 1:return t.a(2)}},t,this)}))},i.a(3,17);case 14:if(void 0!==n&&"number"==typeof n){i.n=15;break}throw new Error("subscriber-bandwidth requires a number as argument");case 15:return a=new vi({scenario:{case:"subscriberBandwidth",value:BigInt(n)}}),i.a(3,17);case 16:a=new vi({scenario:{case:"leaveRequestFullReconnect",value:!0}});case 17:if(!a){i.n=19;break}return i.n=18,this.engine.client.sendSimulateScenario(a);case 18:return i.n=19,r();case 19:return i.a(2)}},i,this)}))}},{key:"canPlaybackAudio",get:function(){return this.audioEnabled}},{key:"canPlaybackVideo",get:function(){return!this.isVideoPlaybackBlocked}},{key:"getActiveDevice",value:function(e){return this.localParticipant.activeDeviceMap.get(e)}},{key:"switchActiveDevice",value:function(t,n){return Dn(this,arguments,void 0,function(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return h().m(function a(){var o,s,c,u,d,l,f,m,v,p,g,k,y,b,T,S,w,C,E,P,R,I;return h().w(function(a){for(;;)switch(a.n){case 0:if(v=!0,p=!1,g=r?{exact:n}:n,"audioinput"!==t){a.n=5;break}return p=0===i.localParticipant.audioTrackPublications.size,k=null!==(o=i.getActiveDevice(t))&&void 0!==o?o:i.options.audioCaptureDefaults.deviceId,i.options.audioCaptureDefaults.deviceId=g,y=Array.from(i.localParticipant.audioTrackPublications.values()).filter(function(t){return t.source===e.Track.Source.Microphone}),a.p=1,a.n=2,Promise.all(y.map(function(e){var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(g)}));case 2:v=a.v.every(function(e){return!0===e}),a.n=4;break;case 3:throw a.p=3,w=a.v,i.options.audioCaptureDefaults.deviceId=k,w;case 4:a.n=20;break;case 5:if("videoinput"!==t){a.n=10;break}return p=0===i.localParticipant.videoTrackPublications.size,b=null!==(s=i.getActiveDevice(t))&&void 0!==s?s:i.options.videoCaptureDefaults.deviceId,i.options.videoCaptureDefaults.deviceId=g,T=Array.from(i.localParticipant.videoTrackPublications.values()).filter(function(t){return t.source===e.Track.Source.Camera}),a.p=6,a.n=7,Promise.all(T.map(function(e){var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(g)}));case 7:v=a.v.every(function(e){return!0===e}),a.n=9;break;case 8:throw a.p=8,C=a.v,i.options.videoCaptureDefaults.deviceId=b,C;case 9:a.n=20;break;case 10:if("audiooutput"!==t){a.n=20;break}if(!(!ho()&&!i.options.webAudioMix||i.options.webAudioMix&&i.audioContext&&!("setSinkId"in i.audioContext))){a.n=11;break}throw new Error("cannot switch audio output, setSinkId not supported");case 11:if(!i.options.webAudioMix){a.n=16;break}return a.n=12,Vo.getInstance().normalizeDeviceId("audiooutput",n);case 12:if(P=c=a.v,!(E=null!==P)){a.n=13;break}E=void 0!==c;case 13:if(!E){a.n=14;break}R=c,a.n=15;break;case 14:R="";case 15:n=R;case 16:return null!==(u=(m=i.options).audioOutput)&&void 0!==u||(m.audioOutput={}),S=null!==(d=i.getActiveDevice(t))&&void 0!==d?d:i.options.audioOutput.deviceId,i.options.audioOutput.deviceId=n,a.p=17,i.options.webAudioMix&&(null===(l=i.audioContext)||void 0===l||l.setSinkId(n)),a.n=18,Promise.all(Array.from(i.remoteParticipants.values()).map(function(e){return e.setAudioOutput({deviceId:n})}));case 18:a.n=20;break;case 19:throw a.p=19,I=a.v,i.options.audioOutput.deviceId=S,I;case 20:return(p||"audiooutput"===t)&&(i.localParticipant.activeDeviceMap.set(t,"audiooutput"===t&&(null===(f=i.options.audioOutput)||void 0===f?void 0:f.deviceId)||n),i.emit(e.RoomEvent.ActiveDeviceChanged,t,n)),a.a(2,v)}},a,null,[[17,19],[6,8],[1,3]])})()})}},{key:"setupLocalParticipantEvents",value:function(){this.localParticipant.on(e.ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(e.ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(e.ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).on(e.ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(e.ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(e.ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(e.ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(e.ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(e.ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(e.ParticipantEvent.AudioStreamAcquired,this.startAudio).on(e.ParticipantEvent.ChatMessage,this.onLocalChatMessageSent).on(e.ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}},{key:"recreateEngine",value:function(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}},{key:"onTrackAdded",value:function(t,n,i){var r=this;if(this.state===e.ConnectionState.Connecting||this.state===e.ConnectionState.Reconnecting){var a=function(){r.onTrackAdded(t,n,i),o()},o=function(){r.off(e.RoomEvent.Reconnected,a),r.off(e.RoomEvent.Connected,a),r.off(e.RoomEvent.Disconnected,o)};return this.once(e.RoomEvent.Reconnected,a),this.once(e.RoomEvent.Connected,a),void this.once(e.RoomEvent.Disconnected,o)}if(this.state!==e.ConnectionState.Disconnected){var s=function(e){var t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(n.id),c=s[0],u=s[1],d=t.id;if(u&&u.startsWith("TR")&&(d=u),c!==this.localParticipant.sid){var l,f=Array.from(this.remoteParticipants.values()).find(function(e){return e.sid===c});if(f)this.options.adaptiveStream&&(l="object"===T(this.options.adaptiveStream)?this.options.adaptiveStream:{}),f.addSubscribedMediaTrack(t,d,n,i,l);else this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(c),this.logContext)}else this.log.warn("tried to create RemoteParticipant for local participant",this.logContext)}else this.log.warn("skipping incoming track after Room disconnected",this.logContext)}},{key:"handleDisconnect",value:function(){var t,n=this,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==e.ConnectionState.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(function(e){e.trackPublications.forEach(function(t){e.unpublishTrack(t.trackSid)})}),this.localParticipant.trackPublications.forEach(function(e){var t,r,a;e.track&&n.localParticipant.unpublishTrack(e.track,i),i?(null===(t=e.track)||void 0===t||t.detach(),null===(r=e.track)||void 0===r||r.stop()):null===(a=e.track)||void 0===a||a.stopMonitor()}),this.localParticipant.off(e.ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(e.ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(e.ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).off(e.ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(e.ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(e.ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(e.ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(e.ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(e.ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(e.ParticipantEvent.AudioStreamAcquired,this.startAudio).off(e.ParticipantEvent.ChatMessage,this.onLocalChatMessageSent).off(e.ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"==typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),bo()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(t=navigator.mediaDevices)||void 0===t||t.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(e.ConnectionState.Disconnected),this.emit(e.RoomEvent.Disconnected,r)}}}},{key:"handleParticipantDisconnected",value:function(t,n){var i;this.remoteParticipants.delete(t),n&&(n.trackPublications.forEach(function(e){n.unpublishTrack(e.trackSid,!0)}),this.emit(e.RoomEvent.ParticipantDisconnected,n),null===(i=this.localParticipant)||void 0===i||i.handleParticipantDisconnected(n.identity))}},{key:"acquireAudioContext",value:function(){return Dn(this,void 0,void 0,h().m(function t(){var n,i,r,a,o=this;return h().w(function(t){for(;;)switch(t.n){case 0:if("boolean"!=typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=null!==(n=$a())&&void 0!==n?n:void 0),!this.audioContext||"suspended"!==this.audioContext.state){t.n=4;break}return t.p=1,t.n=2,this.audioContext.resume();case 2:t.n=4;break;case 3:t.p=3,a=t.v,this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:a}));case 4:this.options.webAudioMix&&this.remoteParticipants.forEach(function(e){return e.setAudioContext(o.audioContext)}),this.localParticipant.setAudioContext(this.audioContext),(r="running"===(null===(i=this.audioContext)||void 0===i?void 0:i.state))!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(e.RoomEvent.AudioPlaybackStatusChanged,r));case 5:return t.a(2)}},t,this,[[1,3]])}))}},{key:"createParticipant",value:function(e,t){var n,i,r=this;return i=t?Cc.fromParticipantInfo(this.engine.client,t,{loggerContextCb:function(){return r.logContext},loggerName:this.options.loggerName}):new Cc(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:function(){return r.logContext},loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),(null===(n=this.options.audioOutput)||void 0===n?void 0:n.deviceId)&&i.setAudioOutput(this.options.audioOutput).catch(function(e){return r.log.warn("Could not set audio output: ".concat(e.message),r.logContext)}),i}},{key:"getOrCreateParticipant",value:function(t,n){var i=this;if(this.remoteParticipants.has(t)){var r=this.remoteParticipants.get(t);if(n)r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity);return r}var a=this.createParticipant(t,n);return this.remoteParticipants.set(t,a),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(e.RoomEvent.ParticipantConnected,a),a.on(e.ParticipantEvent.TrackPublished,function(t){i.emitWhenConnected(e.RoomEvent.TrackPublished,t,a)}).on(e.ParticipantEvent.TrackSubscribed,function(t,n){t.kind===e.Track.Kind.Audio?(t.on(e.TrackEvent.AudioPlaybackStarted,i.handleAudioPlaybackStarted),t.on(e.TrackEvent.AudioPlaybackFailed,i.handleAudioPlaybackFailed)):t.kind===e.Track.Kind.Video&&(t.on(e.TrackEvent.VideoPlaybackFailed,i.handleVideoPlaybackFailed),t.on(e.TrackEvent.VideoPlaybackStarted,i.handleVideoPlaybackStarted)),i.emit(e.RoomEvent.TrackSubscribed,t,n,a)}).on(e.ParticipantEvent.TrackUnpublished,function(t){i.emit(e.RoomEvent.TrackUnpublished,t,a)}).on(e.ParticipantEvent.TrackUnsubscribed,function(t,n){i.emit(e.RoomEvent.TrackUnsubscribed,t,n,a)}).on(e.ParticipantEvent.TrackSubscriptionFailed,function(t){i.emit(e.RoomEvent.TrackSubscriptionFailed,t,a)}).on(e.ParticipantEvent.TrackMuted,function(t){i.emitWhenConnected(e.RoomEvent.TrackMuted,t,a)}).on(e.ParticipantEvent.TrackUnmuted,function(t){i.emitWhenConnected(e.RoomEvent.TrackUnmuted,t,a)}).on(e.ParticipantEvent.ParticipantMetadataChanged,function(t){i.emitWhenConnected(e.RoomEvent.ParticipantMetadataChanged,t,a)}).on(e.ParticipantEvent.ParticipantNameChanged,function(t){i.emitWhenConnected(e.RoomEvent.ParticipantNameChanged,t,a)}).on(e.ParticipantEvent.AttributesChanged,function(t){i.emitWhenConnected(e.RoomEvent.ParticipantAttributesChanged,t,a)}).on(e.ParticipantEvent.ConnectionQualityChanged,function(t){i.emitWhenConnected(e.RoomEvent.ConnectionQualityChanged,t,a)}).on(e.ParticipantEvent.ParticipantPermissionsChanged,function(t){i.emitWhenConnected(e.RoomEvent.ParticipantPermissionsChanged,t,a)}).on(e.ParticipantEvent.TrackSubscriptionStatusChanged,function(t,n){i.emitWhenConnected(e.RoomEvent.TrackSubscriptionStatusChanged,t,n,a)}).on(e.ParticipantEvent.TrackSubscriptionFailed,function(t,n){i.emit(e.RoomEvent.TrackSubscriptionFailed,t,a,n)}).on(e.ParticipantEvent.TrackSubscriptionPermissionChanged,function(t,n){i.emitWhenConnected(e.RoomEvent.TrackSubscriptionPermissionChanged,t,n,a)}),n&&a.updateInfo(n),a}},{key:"sendSyncState",value:function(){var e=Array.from(this.remoteParticipants.values()).reduce(function(e,t){return e.push.apply(e,y(t.getTrackPublications())),e},[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}},{key:"updateSubscriptions",value:function(){var e,t=s(this.remoteParticipants.values());try{for(t.s();!(e=t.n()).done;){var n,i=s(e.value.videoTrackPublications.values());try{for(i.s();!(n=i.n()).done;){var r=n.value;r.isSubscribed&&r instanceof wc&&r.emitTrackUpdate()}}catch(e){i.e(e)}finally{i.f()}}}catch(e){t.e(e)}finally{t.f()}}},{key:"getRemoteParticipantBySid",value:function(e){var t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}},{key:"registerConnectionReconcile",value:function(){var t=this;this.clearConnectionReconcile();var n=0;this.connectionReconcileInterval=Aa.setInterval(function(){t.engine&&!t.engine.isClosed&&t.engine.verifyTransport()?n=0:(n++,t.log.warn("detected connection state mismatch",Object.assign(Object.assign({},t.logContext),{numFailures:n,engine:t.engine?{closed:t.engine.isClosed,transportsConnected:t.engine.verifyTransport()}:void 0})),n>=3&&(t.recreateEngine(),t.handleDisconnect(t.options.stopLocalTrackOnUnpublish,e.DisconnectReason.STATE_MISMATCH)))},4e3)}},{key:"clearConnectionReconcile",value:function(){this.connectionReconcileInterval&&Aa.clearInterval(this.connectionReconcileInterval)}},{key:"setAndEmitConnectionState",value:function(t){return t!==this.state&&(this.state=t,this.emit(e.RoomEvent.ConnectionStateChanged,this.state),!0)}},{key:"emitBufferedEvents",value:function(){var e=this;this.bufferedEvents.forEach(function(t){var n=g(t,2),i=n[0],r=n[1];e.emit.apply(e,[i].concat(y(r)))}),this.bufferedEvents=[]}},{key:"emitWhenConnected",value:function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===e.ConnectionState.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,i]);else if(this.state===e.ConnectionState.Connected)return this.emit.apply(this,[t].concat(i));return!1}},{key:"simulateParticipants",value:function(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a,o,s,c,u,d,l,f,m,v,p,g,k,b,T,S,w,C,E,P,R,I,O,N,D,_,A,L,x,M,U=this;return h().w(function(n){for(;;)switch(n.n){case 0:if(a=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants),this.handleDisconnect(),this.roomInfo=new Tt({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:z.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Rt({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(e.RoomEvent.SignalConnected),this.emit(e.RoomEvent.Connected),this.setAndEmitConnectionState(e.ConnectionState.Connected),!a.video){n.n=4;break}if(g=yc,k=e.Track.Kind.Video,b=new Dt({source:ut.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:ct.AUDIO,name:"video-dummy"}),T=Hs,!a.useRealTracks){n.n=2;break}return n.n=1,window.navigator.mediaDevices.getUserMedia({video:!0});case 1:S=n.v.getVideoTracks()[0],n.n=3;break;case 2:S=xo(160*(null!==(i=o.aspectRatios[0])&&void 0!==i?i:1),160,!0,!0);case 3:w=S,C={loggerName:this.options.loggerName,loggerContextCb:function(){return U.logContext}},E=new T(w,undefined,!1,C),P={loggerName:this.options.loggerName,loggerContextCb:function(){return U.logContext}},s=new g(k,b,E,P),this.localParticipant.addTrackPublication(s),this.localParticipant.emit(e.ParticipantEvent.LocalTrackPublished,s);case 4:if(!a.audio){n.n=8;break}if(R=yc,I=e.Track.Kind.Audio,O=new Dt({source:ut.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:ct.AUDIO}),N=Ds,!a.useRealTracks){n.n=6;break}return n.n=5,navigator.mediaDevices.getUserMedia({audio:!0});case 5:D=n.v.getAudioTracks()[0],n.n=7;break;case 6:D=Mo();case 7:_=D,A=this.audioContext,L={loggerName:this.options.loggerName,loggerContextCb:function(){return U.logContext}},x=new N(_,undefined,!1,A,L),M={loggerName:this.options.loggerName,loggerContextCb:function(){return U.logContext}},c=new R(I,O,x,M),this.localParticipant.addTrackPublication(c),this.localParticipant.emit(e.ParticipantEvent.LocalTrackPublished,c);case 8:for(u=0;u<o.count-1;u+=1)d=new Rt({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(u),state:Et.ACTIVE,tracks:[],joinedAt:z.parse(Date.now())}),l=this.getOrCreateParticipant(d.identity,d),o.video&&(f=xo(160*(null!==(r=o.aspectRatios[u%o.aspectRatios.length])&&void 0!==r?r:1),160,!1,!0),m=new Dt({source:ut.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:ct.AUDIO}),l.addSubscribedMediaTrack(f,m.sid,new MediaStream([f]),new RTCRtpReceiver),d.tracks=[].concat(y(d.tracks),[m])),o.audio&&(v=Mo(),p=new Dt({source:ut.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:ct.AUDIO}),l.addSubscribedMediaTrack(v,p.sid,new MediaStream([v]),new RTCRtpReceiver),d.tracks=[].concat(y(d.tracks),[p])),l.updateInfo(d);case 9:return n.a(2)}},n,this)}))}},{key:"emit",value:function(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];if(t!==e.RoomEvent.ActiveSpeakersChanged){var o=Rc(r).filter(function(e){return void 0!==e});this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:o}))}return k(n,"emit",this,3)([t].concat(r))}}],[{key:"getLocalDevices",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Vo.getInstance().getDevices(e,t)}}])}(Ki.EventEmitter);function Rc(e){return e.map(function(e){if(e)return Array.isArray(e)?Rc(e):"object"===T(e)?"logContext"in e&&e.logContext:e})}Pc.cleanupRegistry="undefined"!=typeof FinalizationRegistry&&new FinalizationRegistry(function(e){e()}),e.CheckStatus=void 0,(Ec=e.CheckStatus||(e.CheckStatus={}))[Ec.IDLE=0]="IDLE",Ec[Ec.RUNNING=1]="RUNNING",Ec[Ec.SKIPPED=2]="SKIPPED",Ec[Ec.SUCCESS=3]="SUCCESS",Ec[Ec.FAILED=4]="FAILED";var Ic=function(t){function n(t,a){var o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),(o=i(this,n)).status=e.CheckStatus.IDLE,o.logs=[],o.errorsAsWarnings=!1,o.url=t,o.token=a,o.name=o.constructor.name,o.room=new Pc(s.roomOptions),o.connectOptions=s.connectOptions,s.errorsAsWarnings&&(o.errorsAsWarnings=s.errorsAsWarnings),o}return l(n,t),o(n,[{key:"run",value:function(t){return Dn(this,void 0,void 0,h().m(function n(){var i;return h().w(function(n){for(;;)switch(n.n){case 0:if(this.status===e.CheckStatus.IDLE){n.n=1;break}throw Error("check is running already");case 1:return this.setStatus(e.CheckStatus.RUNNING),n.p=2,n.n=3,this.perform();case 3:n.n=5;break;case 4:n.p=4,(i=n.v)instanceof Error&&(this.errorsAsWarnings?this.appendWarning(i.message):this.appendError(i.message));case 5:return n.n=6,this.disconnect();case 6:return n.n=7,new Promise(function(e){return setTimeout(e,500)});case 7:return this.status!==e.CheckStatus.SKIPPED&&this.setStatus(this.isSuccess()?e.CheckStatus.SUCCESS:e.CheckStatus.FAILED),t&&t(),n.a(2,this.getInfo())}},n,this,[[2,4]])}))}},{key:"isSuccess",value:function(){return!this.logs.some(function(e){return"error"===e.level})}},{key:"connect",value:function(){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:if(this.room.state!==e.ConnectionState.Connected){t.n=1;break}return t.a(2,this.room);case 1:return t.n=2,this.room.connect(this.url,this.token,this.connectOptions);case 2:return t.a(2,this.room)}},t,this)}))}},{key:"disconnect",value:function(){return Dn(this,void 0,void 0,h().m(function t(){return h().w(function(t){for(;;)switch(t.n){case 0:if(!this.room||this.room.state===e.ConnectionState.Disconnected){t.n=2;break}return t.n=1,this.room.disconnect();case 1:return t.n=2,new Promise(function(e){return setTimeout(e,500)});case 2:return t.a(2)}},t,this)}))}},{key:"skip",value:function(){this.setStatus(e.CheckStatus.SKIPPED)}},{key:"appendMessage",value:function(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}},{key:"appendWarning",value:function(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}},{key:"appendError",value:function(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}},{key:"setStatus",value:function(e){this.status=e,this.emit("update",this.getInfo())}},{key:"engine",get:function(){var e;return null===(e=this.room)||void 0===e?void 0:e.engine}},{key:"getInfo",value:function(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}])}(Ki.EventEmitter);function Oc(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a,o,s,c,u,d,l,f=this;return h().w(function(n){for(;;)switch(n.n){case 0:return null!=t||(t={}),null!==(i=t.audio)&&void 0!==i||(t.audio={deviceId:"default"}),null!==(r=t.video)&&void 0!==r||(t.video={deviceId:"default"}),a=ro(t),o=a.audioProcessor,s=a.videoProcessor,c=Qa(t,Cs,Es),u=Xa(c),d=navigator.mediaDevices.getUserMedia(u),t.audio&&(Vo.userMediaPromiseMap.set("audioinput",d),d.catch(function(){return Vo.userMediaPromiseMap.delete("audioinput")})),t.video&&(Vo.userMediaPromiseMap.set("videoinput",d),d.catch(function(){return Vo.userMediaPromiseMap.delete("videoinput")})),n.n=1,d;case 1:return l=n.v,n.a(2,Promise.all(l.getTracks().map(function(t){return Dn(f,void 0,void 0,h().m(function n(){var i,r,a,d;return h().w(function(n){for(;;)switch(n.n){case 0:if((i="audio"===t.kind)?c.audio:c.video,"boolean"!=typeof(a=i?u.audio:u.video)&&(r=a),r?r.deviceId=t.getSettings().deviceId:r={deviceId:t.getSettings().deviceId},(d=_s(t,r)).kind===e.Track.Kind.Video?d.source=e.Track.Source.Camera:d.kind===e.Track.Kind.Audio&&(d.source=e.Track.Source.Microphone),d.mediaStream=l,!(d instanceof Ds&&o)){n.n=2;break}return n.n=1,d.setProcessor(o);case 1:n.n=3;break;case 2:if(!(d instanceof Hs&&s)){n.n=3;break}return n.n=3,d.setProcessor(s);case 3:return n.a(2,d)}},n)}))})))}},n)}))}function Nc(e){return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Oc({audio:!1,video:e});case 1:return n=t.v,t.a(2,n[0])}},t)}))}function Dc(e){return Dn(this,void 0,void 0,h().m(function t(){var n;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Oc({audio:e,video:!1});case 1:return n=t.v,t.a(2,n[0])}},t)}))}var _c=function(e){function t(){return r(this,t),i(this,t,arguments)}return l(t,e),o(t,[{key:"description",get:function(){return"Can publish audio"}},{key:"perform",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n,i,r,a;return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.connect();case 1:return n=e.v,e.n=2,Dc();case 2:return i=e.v,n.localParticipant.publishTrack(i),e.n=3,new Promise(function(e){return setTimeout(e,3e3)});case 3:return e.n=4,null===(t=i.sender)||void 0===t?void 0:t.getStats();case 4:if(r=e.v){e.n=5;break}throw new Error("Could not get RTCStats");case 5:if(a=0,r.forEach(function(e){"outbound-rtp"===e.type&&("audio"===e.kind||!e.kind&&e.mediaType)}),0!==a){e.n=6;break}throw new Error("Could not determine packets are sent");case 6:this.appendMessage("published ".concat(a," audio packets"));case 7:return e.a(2)}},e,this)}))}}])}(Ic),Ac=function(e){function t(){return r(this,t),i(this,t,arguments)}return l(t,e),o(t,[{key:"description",get:function(){return"Can publish video"}},{key:"perform",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n,i,r,a;return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.connect();case 1:return n=e.v,e.n=2,Nc();case 2:return i=e.v,n.localParticipant.publishTrack(i),e.n=3,new Promise(function(e){return setTimeout(e,5e3)});case 3:return e.n=4,null===(t=i.sender)||void 0===t?void 0:t.getStats();case 4:if(r=e.v){e.n=5;break}throw new Error("Could not get RTCStats");case 5:if(a=0,r.forEach(function(e){"outbound-rtp"!==e.type||"video"!==e.kind&&(e.kind||"video"!==e.mediaType)||(a+=e.packetsSent)}),0!==a){e.n=6;break}throw new Error("Could not determine packets are sent");case 6:this.appendMessage("published ".concat(a," video packets"));case 7:return e.a(2)}},e,this)}))}}])}(Ic),Lc=function(t){function n(){return r(this,n),i(this,n,arguments)}return l(n,t),o(n,[{key:"description",get:function(){return"Resuming connection after interruption"}},{key:"perform",value:function(){return Dn(this,void 0,void 0,h().m(function t(){var n,i,r,a,o,s,c,u;return h().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.connect();case 1:return i=t.v,r=!1,a=!1,s=new Promise(function(e){setTimeout(e,5e3),o=e}),c=function(){r=!0},i.on(e.RoomEvent.SignalReconnecting,c).on(e.RoomEvent.Reconnecting,c).on(e.RoomEvent.Reconnected,function(){a=!0,o(!0)}),null===(n=i.engine.client.ws)||void 0===n||n.close(),(u=i.engine.client.onClose)&&u(""),t.n=2,s;case 2:if(r){t.n=3;break}throw new Error("Did not attempt to reconnect");case 3:if(a&&i.state===e.ConnectionState.Connected){t.n=4;break}throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect");case 4:return t.a(2)}},t,this)}))}}])}(Ic),xc=function(e){function t(){return r(this,t),i(this,t,arguments)}return l(t,e),o(t,[{key:"description",get:function(){return"Can connect via TURN"}},{key:"perform",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n,i,r,a,o,c,u,d,l,f,m,v;return h().w(function(e){for(;;)switch(e.n){case 0:return i=new Xo,e.n=1,i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});case 1:r=e.v,a=!1,o=!1,c=!1,u=s(r.iceServers);try{for(u.s();!(d=u.n()).done;){l=d.value,f=s(l.urls);try{for(f.s();!(m=f.n()).done;)(v=m.value).startsWith("turn:")?(o=!0,c=!0):v.startsWith("turns:")&&(o=!0,c=!0,a=!0),v.startsWith("stun:")&&(c=!0)}catch(e){f.e(e)}finally{f.f()}}}catch(e){u.e(e)}finally{u.f()}return c?o&&!a&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),e.n=2,i.close();case 2:if(!(null===(n=null===(t=this.connectOptions)||void 0===t?void 0:t.rtcConfig)||void 0===n?void 0:n.iceServers)&&!o){e.n=4;break}return e.n=3,this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}});case 3:e.n=5;break;case 4:return this.appendWarning("No TURN servers configured."),this.skip(),e.n=5,new Promise(function(e){return setTimeout(e,0)});case 5:return e.a(2)}},e,this)}))}}])}(Ic),Mc=function(t){function n(){return r(this,n),i(this,n,arguments)}return l(n,t),o(n,[{key:"description",get:function(){return"Establishing WebRTC connection"}},{key:"perform",value:function(){return Dn(this,void 0,void 0,h().m(function t(){var n,i,r,a=this;return h().w(function(t){for(;;)switch(t.n){case 0:return n=!1,i=!1,this.room.on(e.RoomEvent.SignalConnected,function(){var e=a.room.engine.client.onTrickle;a.room.engine.client.onTrickle=function(t,r){if(t.candidate){var o=new RTCIceCandidate(t),s="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(Uc(o.address)?s+=" (private)":"tcp"===o.protocol&&"passive"===o.tcpType?(n=!0,s+=" (passive)"):"udp"===o.protocol&&(i=!0)),a.appendMessage(s)}e&&e(t,r)},a.room.engine.pcManager&&(a.room.engine.pcManager.subscriber.onIceCandidateError=function(e){e instanceof RTCPeerConnectionIceErrorEvent&&a.appendWarning("error with ICE candidate: ".concat(e.errorCode," ").concat(e.errorText," ").concat(e.url))})}),t.p=1,t.n=2,this.connect();case 2:bn.info("now the room is connected"),t.n=4;break;case 3:throw t.p=3,r=t.v,this.appendWarning("ports need to be open on firewall in order to connect."),r;case 4:n||this.appendWarning("Server is not configured for ICE/TCP"),i||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly");case 5:return t.a(2)}},t,this,[[1,3]])}))}}])}(Ic);function Uc(e){var t=e.split(".");if(4===t.length){if("10"===t[0])return!0;if("192"===t[0]&&"168"===t[1])return!0;if("172"===t[0]){var n=parseInt(t[1],10);if(n>=16&&n<=31)return!0}}return!1}var jc=function(e){function t(){return r(this,t),i(this,t,arguments)}return l(t,e),o(t,[{key:"description",get:function(){return"Connecting to signal connection via WebSocket"}},{key:"perform",value:function(){return Dn(this,void 0,void 0,h().m(function e(){var t,n,i,r,a;return h().w(function(e){for(;;)switch(e.n){case 0:return(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it"),r=new Xo,e.n=1,r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});case 1:return a=e.v,this.appendMessage("Connected to server, version ".concat(a.serverVersion,".")),(null===(t=a.serverInfo)||void 0===t?void 0:t.edition)===Ht.Cloud&&(null===(n=a.serverInfo)||void 0===n?void 0:n.region)&&this.appendMessage("LiveKit Cloud: ".concat(null===(i=a.serverInfo)||void 0===i?void 0:i.region)),e.n=2,r.close();case 2:return e.a(2)}},e,this)}))}}])}(Ic),Fc=function(t){function n(e,t){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(this,n),(a=i(this,n)).options={},a.checkResults=new Map,a.url=e,a.token=t,a.options=o,a}return l(n,t),o(n,[{key:"getNextCheckId",value:function(){var t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:e.CheckStatus.IDLE,name:"",description:""}),t}},{key:"updateCheck",value:function(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}},{key:"isSuccess",value:function(){return Array.from(this.checkResults.values()).every(function(t){return t.status!==e.CheckStatus.FAILED})}},{key:"getResults",value:function(){return Array.from(this.checkResults.values())}},{key:"createAndRunCheck",value:function(e){return Dn(this,void 0,void 0,h().m(function t(){var n,i,r,a,o=this;return h().w(function(t){for(;;)switch(t.n){case 0:return n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=function(e){o.updateCheck(n,e)},i.on("update",r),t.n=1,i.run();case 1:return a=t.v,i.off("update",r),t.a(2,a)}},t,this)}))}},{key:"checkWebsocket",value:function(){return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)if(0===e.n)return e.a(2,this.createAndRunCheck(jc))},e,this)}))}},{key:"checkWebRTC",value:function(){return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)if(0===e.n)return e.a(2,this.createAndRunCheck(Mc))},e,this)}))}},{key:"checkTURN",value:function(){return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)if(0===e.n)return e.a(2,this.createAndRunCheck(xc))},e,this)}))}},{key:"checkReconnect",value:function(){return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)if(0===e.n)return e.a(2,this.createAndRunCheck(Lc))},e,this)}))}},{key:"checkPublishAudio",value:function(){return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)if(0===e.n)return e.a(2,this.createAndRunCheck(_c))},e,this)}))}},{key:"checkPublishVideo",value:function(){return Dn(this,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)if(0===e.n)return e.a(2,this.createAndRunCheck(Ac))},e,this)}))}}])}(Ki.EventEmitter);var Bc=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),Jc=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function qc(e){var t,n=e.trim().toLowerCase();if(""!==n)return Bc.has(n)?Bc.get(n):null===(t=Array.from(Jc.entries()).find(function(e){var t=g(e,1)[0];return n.includes(t)}))||void 0===t?void 0:t[1]}e.BaseKeyProvider=ua,e.Checker=Ic,e.ConnectionCheck=Fc,e.ConnectionError=fa,e.CriticalTimers=Aa,e.CryptorError=Ca,e.DefaultReconnectPolicy=Nn,e.DeviceUnsupportedError=ha,e.ExternalE2EEKeyProvider=da,e.LivekitError=la,e.LocalAudioTrack=Ds,e.LocalParticipant=Sc,e.LocalTrack=Wo,e.LocalTrackPublication=yc,e.LocalVideoTrack=Hs,e.Mutex=jo,e.NegotiationError=ga,e.Participant=bc,e.PublishDataError=ka,e.RemoteAudioTrack=mc,e.RemoteParticipant=Cc,e.RemoteTrack=hc,e.RemoteTrackPublication=wc,e.RemoteVideoTrack=vc,e.Room=Pc,e.RpcError=sc,e.ScreenSharePresets=Ja,e.SignalRequestError=ya,e.TrackInvalidError=ma,e.UnexpectedConnectionState=pa,e.UnsupportedServer=va,e.VideoPreset=xa,e.VideoPresets=Fa,e.VideoPresets43=Ba,e.attachToElement=Ha,e.compareVersions=Po,e.createAudioAnalyser=function(e,t){var n=this,i=Object.assign({cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80},t),r=$a();if(!r)throw new Error("Audio Context not supported on this browser");var a=i.cloneTrack?e.mediaStreamTrack.clone():e.mediaStreamTrack,o=r.createMediaStreamSource(new MediaStream([a])),c=r.createAnalyser();c.minDecibels=i.minDecibels,c.maxDecibels=i.maxDecibels,c.fftSize=i.fftSize,c.smoothingTimeConstant=i.smoothingTimeConstant,o.connect(c);var u=new Uint8Array(c.frequencyBinCount);return{calculateVolume:function(){c.getByteFrequencyData(u);var e,t=0,n=s(u);try{for(n.s();!(e=n.n()).done;){var i=e.value;t+=Math.pow(i/255,2)}}catch(e){n.e(e)}finally{n.f()}return Math.sqrt(t/u.length)},analyser:c,cleanup:function(){return Dn(n,void 0,void 0,h().m(function e(){return h().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r.close();case 1:i.cloneTrack&&a.stop();case 2:return e.a(2)}},e)}))}}},e.createE2EEKey=function(){return window.crypto.getRandomValues(new Uint8Array(32))},e.createKeyMaterialFromBuffer=aa,e.createKeyMaterialFromString=ra,e.createLocalAudioTrack=Dc,e.createLocalScreenTracks=function(t){return Dn(this,void 0,void 0,h().m(function n(){var i,r,a,o,s,c;return h().w(function(n){for(;;)switch(n.n){case 0:if(void 0===t&&(t={}),void 0!==t.resolution||go()||(t.resolution=Ja.h1080fps30.resolution),void 0!==navigator.mediaDevices.getDisplayMedia){n.n=1;break}throw new ha("getDisplayMedia not supported");case 1:return i=to(t),n.n=2,navigator.mediaDevices.getDisplayMedia(i);case 2:if(r=n.v,0!==(a=r.getVideoTracks()).length){n.n=3;break}throw new ma("no video track found");case 3:return(o=new Hs(a[0],void 0,!1)).source=e.Track.Source.ScreenShare,s=[o],r.getAudioTracks().length>0&&((c=new Ds(r.getAudioTracks()[0],void 0,!1)).source=e.Track.Source.ScreenShareAudio,s.push(c)),n.a(2,s)}},n)}))},e.createLocalTracks=Oc,e.createLocalVideoTrack=Nc,e.deriveKeys=function(e,t){return Dn(this,void 0,void 0,h().m(function n(){var i,r;return h().w(function(n){for(;;)switch(n.n){case 0:return i=oa(e.algorithm.name,t),n.n=1,crypto.subtle.deriveKey(i,e,{name:Zr,length:128},!1,["encrypt","decrypt"]);case 1:return r=n.v,n.a(2,{material:e,encryptionKey:r})}},n)}))},e.detachTrack=za,e.facingModeFromDeviceLabel=qc,e.facingModeFromLocalTrack=function(e){var t,n,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e instanceof Wo?e.mediaStreamTrack:e,o=a.getSettings(),s={facingMode:null!==(t=r.defaultFacingMode)&&void 0!==t?t:"user",confidence:"low"};if("facingMode"in o){var c=o.facingMode;bn.trace("rawFacingMode",{rawFacingMode:c}),c&&"string"==typeof c&&(i=["user","environment","left","right"],void 0===(n=c)||i.includes(n))&&(s={facingMode:c,confidence:"high"})}if(["low","medium"].includes(s.confidence)){bn.trace("Try to get facing mode from device label: (".concat(a.label,")"));var u=qc(a.label);void 0!==u&&(s=u)}return s},e.getBrowser=Ia,e.getEmptyAudioStreamTrack=Mo,e.getEmptyVideoStreamTrack=function(){return Oo||(Oo=xo()),Oo.clone()},e.getLogger=Sn,e.importKey=function(e){return Dn(this,arguments,void 0,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{name:Zr},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"encrypt";return h().m(function i(){return h().w(function(i){for(;;)if(0===i.n)return i.a(2,crypto.subtle.importKey("raw",e,t,!1,"derive"===n?["deriveBits","deriveKey"]:["encrypt","decrypt"]))},i)})()})},e.isBackupCodec=ja,e.isBrowserSupported=mo,e.isE2EESupported=ta,e.isInsertableStreamSupported=ia,e.isScriptTransformSupported=na,e.isVideoFrame=function(e){return"type"in e},e.needsRbspUnescaping=function(e){for(var t=0;t<e.length-3;t++)if(0==e[t]&&0==e[t+1]&&3==e[t+2])return!0;return!1},e.parseRbsp=function(e){for(var t=[],n=e.length,i=0;i<e.length;)n-i>=3&&!e[i]&&!e[i+1]&&3==e[i+2]?(t.push(e[i++]),t.push(e[i++]),i++):t.push(e[i++]);return new Uint8Array(t)},e.protocolVersion=15,e.ratchet=function(e,t){return Dn(this,void 0,void 0,h().m(function n(){var i;return h().w(function(n){for(;;)if(0===n.n)return i=oa(e.algorithm.name,t),n.a(2,crypto.subtle.deriveBits(i,e,256))},n)}))},e.setLogExtension=function(t,n){(n?[n]:Tn).forEach(function(n){var i=n.methodFactory;n.methodFactory=function(n,r,a){var o=i(n,r,a),s=e.LogLevel[n],c=s>=r&&s<e.LogLevel.silent;return function(e,n){n?o(e,n):o(e),c&&t(s,e,n)}},n.setLevel(n.getLevel())})},e.setLogLevel=function(e,t){if(t)yn.getLogger(t).setLevel(e);else{var n,i=s(Tn);try{for(i.s();!(n=i.n()).done;){n.value.setLevel(e)}}catch(e){i.e(e)}finally{i.f()}}},e.supportsAV1=uo,e.supportsAdaptiveStream=function(){return void 0!==("undefined"==typeof ResizeObserver?"undefined":T(ResizeObserver))&&void 0!==("undefined"==typeof IntersectionObserver?"undefined":T(IntersectionObserver))},e.supportsDynacast=function(){return so()},e.supportsVP9=lo,e.version=_a,e.videoCodecs=Ua,e.writeRbsp=function(e){for(var t=[],n=0,i=0;i<e.length;++i){var r=e[i];r<=3&&n>=2&&(t.push(3),n=0),t.push(r),0==r?++n:n=0}return new Uint8Array(t)}});
//# sourceMappingURL=ecprt-client-sdk.umd.js.map
