(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&e(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const xo="modulepreload",eu=function(r){return"/"+r},ya={},nu=function(t,i,e){let n=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.all(i.map(u=>{if(u=eu(u),u in ya)return;ya[u]=!0;const o=u.endsWith(".css"),c=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${c}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":xo,o||(l.as="script",l.crossOrigin=""),l.href=u,s&&l.setAttribute("nonce",s),document.head.appendChild(l),o)return new Promise((d,f)=>{l.addEventListener("load",d),l.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${u}`)))})}))}return n.then(()=>t()).catch(a=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a})};var ba={};function tu(r,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(e){if(e!=="default"&&!(e in r)){var n=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(r,e,n.get?n:{enumerable:!0,get:function(){return i[e]}})}})}),Object.freeze(r)}function Pr(r,t){(t==null||t>r.length)&&(t=r.length);for(var i=0,e=Array(t);i<t;i++)e[i]=r[i];return e}function iu(r){if(Array.isArray(r))return r}function ru(r){if(Array.isArray(r))return Pr(r)}function au(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function O(r,t,i){return t=Pn(t),fu(r,xr()?Reflect.construct(t,i||[],Pn(r).constructor):t.apply(r,i))}function P(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function su(r,t,i){if(xr())return Reflect.construct.apply(null,arguments);var e=[null];e.push.apply(e,t);var n=new(r.bind.apply(r,e));return i&&St(n,i.prototype),n}function Sa(r,t){for(var i=0;i<t.length;i++){var e=t[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,bs(e.key),e)}}function E(r,t,i){return t&&Sa(r.prototype,t),i&&Sa(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}function $(r,t){var i=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!i){if(Array.isArray(r)||(i=ea(r))||t){i&&(r=i);var e=0,n=function(){};return{s:n,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(o){throw o},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,u=!1;return{s:function(){i=i.call(r)},n:function(){var o=i.next();return s=o.done,o},e:function(o){u=!0,a=o},f:function(){try{s||i.return==null||i.return()}finally{if(u)throw a}}}}function Ot(r,t,i){return(t=bs(t))in r?Object.defineProperty(r,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[t]=i,r}function Er(){return Er=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,t,i){var e=hu(r,t);if(e){var n=Object.getOwnPropertyDescriptor(e,t);return n.get?n.get.call(arguments.length<3?r:i):n.value}},Er.apply(null,arguments)}function Pn(r){return Pn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Pn(r)}function N(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),t&&St(r,t)}function ou(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}function xr(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xr=function(){return!!r})()}function uu(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function cu(r,t){var i=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(i!=null){var e,n,a,s,u=[],o=!0,c=!1;try{if(a=(i=i.call(r)).next,t===0){if(Object(i)!==i)return;o=!1}else for(;!(o=(e=a.call(i)).done)&&(u.push(e.value),u.length!==t);o=!0);}catch(l){c=!0,n=l}finally{try{if(!o&&i.return!=null&&(s=i.return(),Object(s)!==s))return}finally{if(c)throw n}}return u}}function lu(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function du(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fu(r,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return au(r)}function v(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var r,t,i=typeof Symbol=="function"?Symbol:{},e=i.iterator||"@@iterator",n=i.toStringTag||"@@toStringTag";function a(h,p,g,k){var y=p&&p.prototype instanceof u?p:u,S=Object.create(y.prototype);return Ne(S,"_invoke",function(T,C,w){var I,R,U,M=0,z=w||[],B=!1,K={p:0,n:0,v:r,a:Y,f:Y.bind(r,4),d:function(Z,W){return I=Z,R=0,U=r,K.n=W,s}};function Y(Z,W){for(R=Z,U=W,t=0;!B&&M&&!Q&&t<z.length;t++){var Q,ne=z[t],ge=K.p,Fe=ne[2];Z>3?(Q=Fe===W)&&(U=ne[(R=ne[4])?5:(R=3,3)],ne[4]=ne[5]=r):ne[0]<=ge&&((Q=Z<2&&ge<ne[1])?(R=0,K.v=W,K.n=ne[1]):ge<Fe&&(Q=Z<3||ne[0]>W||W>Fe)&&(ne[4]=Z,ne[5]=W,K.n=Fe,R=0))}if(Q||Z>1)return s;throw B=!0,W}return function(Z,W,Q){if(M>1)throw TypeError("Generator is already running");for(B&&W===1&&Y(W,Q),R=W,U=Q;(t=R<2?r:U)||!B;){I||(R?R<3?(R>1&&(K.n=-1),Y(R,U)):K.n=U:K.v=U);try{if(M=2,I){if(R||(Z="next"),t=I[Z]){if(!(t=t.call(I,U)))throw TypeError("iterator result is not an object");if(!t.done)return t;U=t.value,R<2&&(R=0)}else R===1&&(t=I.return)&&t.call(I),R<2&&(U=TypeError("The iterator does not provide a '"+Z+"' method"),R=1);I=r}else if((t=(B=K.n<0)?U:T.call(C,K))!==s)break}catch(ne){I=r,R=1,U=ne}finally{M=1}}return{value:t,done:B}}}(h,g,k),!0),S}var s={};function u(){}function o(){}function c(){}t=Object.getPrototypeOf;var l=[][e]?t(t([][e]())):(Ne(t={},e,function(){return this}),t),d=c.prototype=u.prototype=Object.create(l);function f(h){return Object.setPrototypeOf?Object.setPrototypeOf(h,c):(h.__proto__=c,Ne(h,n,"GeneratorFunction")),h.prototype=Object.create(d),h}return o.prototype=c,Ne(d,"constructor",c),Ne(c,"constructor",o),o.displayName="GeneratorFunction",Ne(c,n,"GeneratorFunction"),Ne(d),Ne(d,n,"Generator"),Ne(d,e,function(){return this}),Ne(d,"toString",function(){return"[object Generator]"}),(v=function(){return{w:a,m:f}})()}function Ne(r,t,i,e){var n=Object.defineProperty;try{n({},"",{})}catch{n=0}Ne=function(a,s,u,o){if(s)n?n(a,s,{value:u,enumerable:!o,configurable:!o,writable:!o}):a[s]=u;else{let c=function(l,d){Ne(a,l,function(f){return this._invoke(l,d,f)})};c("next",0),c("throw",1),c("return",2)}},Ne(r,t,i,e)}function Ta(r){if(r!=null){var t=r[typeof Symbol=="function"&&Symbol.iterator||"@@iterator"],i=0;if(t)return t.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length))return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}}}throw new TypeError(typeof r+" is not iterable")}function St(r,t){return St=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,e){return i.__proto__=e,i},St(r,t)}function te(r,t){return iu(r)||cu(r,t)||ea(r,t)||lu()}function hu(r,t){for(;!{}.hasOwnProperty.call(r,t)&&(r=Pn(r))!==null;);return r}function X(r,t,i,e){var n=Er(Pn(1&e?r.prototype:r),t,i);return 2&e&&typeof n=="function"?function(a){return n.apply(i,a)}:n}function Ue(r){return ru(r)||uu(r)||ea(r)||du()}function mu(r,t){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var e=i.call(r,t);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function bs(r){var t=mu(r,"string");return typeof t=="symbol"?t:t+""}function V(r){"@babel/helpers - typeof";return V=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(r)}function ea(r,t){if(r){if(typeof r=="string")return Pr(r,t);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Pr(r,t):void 0}}function Tt(r){var t=typeof Map=="function"?new Map:void 0;return Tt=function(i){if(i===null||!ou(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(i))return t.get(i);t.set(i,e)}function e(){return su(i,arguments,Pn(this).constructor)}return e.prototype=Object.create(i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),St(e,i)},Tt(r)}function le(r,t){if(!r)throw new Error(t)}var vu=34028234663852886e22,pu=-34028234663852886e22,gu=4294967295,ku=2147483647,yu=-2147483648;function xt(r){if(typeof r!="number")throw new Error("invalid int 32: "+V(r));if(!Number.isInteger(r)||r>ku||r<yu)throw new Error("invalid int 32: "+r)}function Rr(r){if(typeof r!="number")throw new Error("invalid uint 32: "+V(r));if(!Number.isInteger(r)||r>gu||r<0)throw new Error("invalid uint 32: "+r)}function Ss(r){if(typeof r!="number")throw new Error("invalid float 32: "+V(r));if(Number.isFinite(r)&&(r>vu||r<pu))throw new Error("invalid float 32: "+r)}var Ts=Symbol("@bufbuild/protobuf/enum-type");function bu(r){var t=r[Ts];return le(t,"missing enum type on enum object"),t}function Cs(r,t,i,e){r[Ts]=ws(t,i.map(function(n){return{no:n.no,name:n.name,localName:r[n.no]}}))}function ws(r,t,i){var e=Object.create(null),n=Object.create(null),a=[],s=$(t),u;try{for(s.s();!(u=s.n()).done;){var o=u.value,c=Ps(o);a.push(c),e[o.name]=c,n[o.no]=c}}catch(l){s.e(l)}finally{s.f()}return{typeName:r,values:a,findName:function(d){return e[d]},findNumber:function(d){return n[d]}}}function Su(r,t,i){var e={},n=$(t),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,u=Ps(s);e[u.localName]=u.no,e[u.no]=u.localName}}catch(o){n.e(o)}finally{n.f()}return Cs(e,r,t),e}function Ps(r){return"localName"in r?r:Object.assign(Object.assign({},r),{localName:r.name})}var J=function(){function r(){P(this,r)}return E(r,[{key:"equals",value:function(i){return this.getType().runtime.util.equals(this.getType(),this,i)}},{key:"clone",value:function(){return this.getType().runtime.util.clone(this)}},{key:"fromBinary",value:function(i,e){var n=this.getType(),a=n.runtime.bin,s=a.makeReadOptions(e);return a.readMessage(this,s.readerFactory(i),i.byteLength,s),this}},{key:"fromJson",value:function(i,e){var n=this.getType(),a=n.runtime.json,s=a.makeReadOptions(e);return a.readMessage(n,i,s,this),this}},{key:"fromJsonString",value:function(i,e){var n;try{n=JSON.parse(i)}catch(a){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(a instanceof Error?a.message:String(a)))}return this.fromJson(n,e)}},{key:"toBinary",value:function(i){var e=this.getType(),n=e.runtime.bin,a=n.makeWriteOptions(i),s=a.writerFactory();return n.writeMessage(this,s,a),s.finish()}},{key:"toJson",value:function(i){var e=this.getType(),n=e.runtime.json,a=n.makeWriteOptions(i);return n.writeMessage(this,a)}},{key:"toJsonString",value:function(i){var e,n=this.toJson(i);return JSON.stringify(n,null,(e=i==null?void 0:i.prettySpaces)!==null&&e!==void 0?e:0)}},{key:"toJSON",value:function(){return this.toJson({emitDefaultValues:!0})}},{key:"getType",value:function(){return Object.getPrototypeOf(this).constructor}}])}();function Tu(r,t,i,e){var n,a=(n=e==null?void 0:e.localName)!==null&&n!==void 0?n:t.substring(t.lastIndexOf(".")+1),s=Ot({},a,function(u){r.util.initFields(this),r.util.initPartial(u,this)})[a];return Object.setPrototypeOf(s.prototype,new J),Object.assign(s,{runtime:r,typeName:t,fields:r.util.newFieldList(i),fromBinary:function(o,c){return new s().fromBinary(o,c)},fromJson:function(o,c){return new s().fromJson(o,c)},fromJsonString:function(o,c){return new s().fromJsonString(o,c)},equals:function(o,c){return r.util.equals(s,o,c)}}),s}function Cu(){for(var r=0,t=0,i=0;i<28;i+=7){var e=this.buf[this.pos++];if(r|=(e&127)<<i,!(e&128))return this.assertBounds(),[r,t]}var n=this.buf[this.pos++];if(r|=(n&15)<<28,t=(n&112)>>4,!(n&128))return this.assertBounds(),[r,t];for(var a=3;a<=31;a+=7){var s=this.buf[this.pos++];if(t|=(s&127)<<a,!(s&128))return this.assertBounds(),[r,t]}throw new Error("invalid varint")}function lr(r,t,i){for(var e=0;e<28;e=e+7){var n=r>>>e,a=!(!(n>>>7)&&t==0),s=(a?n|128:n)&255;if(i.push(s),!a)return}var u=r>>>28&15|(t&7)<<4,o=!!(t>>3);if(i.push((o?u|128:u)&255),!!o){for(var c=3;c<31;c=c+7){var l=t>>>c,d=!!(l>>>7),f=(d?l|128:l)&255;if(i.push(f),!d)return}i.push(t>>>31&1)}}var ei=4294967296;function Ca(r){var t=r[0]==="-";t&&(r=r.slice(1));var i=1e6,e=0,n=0;function a(s,u){var o=Number(r.slice(s,u));n*=i,e=e*i+o,e>=ei&&(n=n+(e/ei|0),e=e%ei)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),t?Rs(e,n):na(e,n)}function wu(r,t){var i=na(r,t),e=i.hi&2147483648;e&&(i=Rs(i.lo,i.hi));var n=Es(i.lo,i.hi);return e?"-"+n:n}function Es(r,t){var i=Pu(r,t);if(r=i.lo,t=i.hi,t<=2097151)return String(ei*t+r);var e=r&16777215,n=(r>>>24|t<<8)&16777215,a=t>>16&65535,s=e+n*6777216+a*6710656,u=n+a*8147497,o=a*2,c=1e7;return s>=c&&(u+=Math.floor(s/c),s%=c),u>=c&&(o+=Math.floor(u/c),u%=c),o.toString()+wa(u)+wa(s)}function Pu(r,t){return{lo:r>>>0,hi:t>>>0}}function na(r,t){return{lo:r|0,hi:t|0}}function Rs(r,t){return t=~t,r?r=~r+1:t+=1,na(r,t)}var wa=function(t){var i=String(t);return"0000000".slice(i.length)+i};function Pa(r,t){if(r>=0){for(;r>127;)t.push(r&127|128),r=r>>>7;t.push(r)}else{for(var i=0;i<9;i++)t.push(r&127|128),r=r>>7;t.push(1)}}function Eu(){var r=this.buf[this.pos++],t=r&127;if(!(r&128))return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<7,!(r&128))return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<14,!(r&128))return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<21,!(r&128))return this.assertBounds(),t;r=this.buf[this.pos++],t|=(r&15)<<28;for(var i=5;r&128&&i<10;i++)r=this.buf[this.pos++];if(r&128)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function Ru(){var r=new DataView(new ArrayBuffer(8)),t=typeof BigInt=="function"&&typeof r.getBigInt64=="function"&&typeof r.getBigUint64=="function"&&typeof r.setBigInt64=="function"&&typeof r.setBigUint64=="function"&&((typeof process>"u"?"undefined":V(process))!="object"||V(ba)!="object"||ba.BUF_BIGINT_DISABLE!=="1");if(t){var i=BigInt("-9223372036854775808"),e=BigInt("9223372036854775807"),n=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse:function(c){var l=typeof c=="bigint"?c:BigInt(c);if(l>e||l<i)throw new Error("int64 invalid: ".concat(c));return l},uParse:function(c){var l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<n)throw new Error("uint64 invalid: ".concat(c));return l},enc:function(c){return r.setBigInt64(0,this.parse(c),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},uEnc:function(c){return r.setBigInt64(0,this.uParse(c),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},dec:function(c,l){return r.setInt32(0,c,!0),r.setInt32(4,l,!0),r.getBigInt64(0,!0)},uDec:function(c,l){return r.setInt32(0,c,!0),r.setInt32(4,l,!0),r.getBigUint64(0,!0)}}}var s=function(c){return le(/^-?[0-9]+$/.test(c),"int64 invalid: ".concat(c))},u=function(c){return le(/^[0-9]+$/.test(c),"uint64 invalid: ".concat(c))};return{zero:"0",supported:!1,parse:function(c){return typeof c!="string"&&(c=c.toString()),s(c),c},uParse:function(c){return typeof c!="string"&&(c=c.toString()),u(c),c},enc:function(c){return typeof c!="string"&&(c=c.toString()),s(c),Ca(c)},uEnc:function(c){return typeof c!="string"&&(c=c.toString()),u(c),Ca(c)},dec:function(c,l){return wu(c,l)},uDec:function(c,l){return Es(c,l)}}}var H=Ru(),D;(function(r){r[r.DOUBLE=1]="DOUBLE",r[r.FLOAT=2]="FLOAT",r[r.INT64=3]="INT64",r[r.UINT64=4]="UINT64",r[r.INT32=5]="INT32",r[r.FIXED64=6]="FIXED64",r[r.FIXED32=7]="FIXED32",r[r.BOOL=8]="BOOL",r[r.STRING=9]="STRING",r[r.BYTES=12]="BYTES",r[r.UINT32=13]="UINT32",r[r.SFIXED32=15]="SFIXED32",r[r.SFIXED64=16]="SFIXED64",r[r.SINT32=17]="SINT32",r[r.SINT64=18]="SINT64"})(D||(D={}));var pn;(function(r){r[r.BIGINT=0]="BIGINT",r[r.STRING=1]="STRING"})(pn||(pn={}));function hn(r,t,i){if(t===i)return!0;if(r==D.BYTES){if(!(t instanceof Uint8Array)||!(i instanceof Uint8Array)||t.length!==i.length)return!1;for(var e=0;e<t.length;e++)if(t[e]!==i[e])return!1;return!0}switch(r){case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return t==i}return!1}function zn(r,t){switch(r){case D.BOOL:return!1;case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return t==0?H.zero:"0";case D.DOUBLE:case D.FLOAT:return 0;case D.BYTES:return new Uint8Array(0);case D.STRING:return"";default:return 0}}function Is(r,t){switch(r){case D.BOOL:return t===!1;case D.STRING:return t==="";case D.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var fe;(function(r){r[r.Varint=0]="Varint",r[r.Bit64=1]="Bit64",r[r.LengthDelimited=2]="LengthDelimited",r[r.StartGroup=3]="StartGroup",r[r.EndGroup=4]="EndGroup",r[r.Bit32=5]="Bit32"})(fe||(fe={}));var Iu=function(){function r(t){P(this,r),this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}return E(r,[{key:"finish",value:function(){this.chunks.push(new Uint8Array(this.buf));for(var i=0,e=0;e<this.chunks.length;e++)i+=this.chunks[e].length;for(var n=new Uint8Array(i),a=0,s=0;s<this.chunks.length;s++)n.set(this.chunks[s],a),a+=this.chunks[s].length;return this.chunks=[],n}},{key:"fork",value:function(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}},{key:"join",value:function(){var i=this.finish(),e=this.stack.pop();if(!e)throw new Error("invalid state, fork stack empty");return this.chunks=e.chunks,this.buf=e.buf,this.uint32(i.byteLength),this.raw(i)}},{key:"tag",value:function(i,e){return this.uint32((i<<3|e)>>>0)}},{key:"raw",value:function(i){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(i),this}},{key:"uint32",value:function(i){for(Rr(i);i>127;)this.buf.push(i&127|128),i=i>>>7;return this.buf.push(i),this}},{key:"int32",value:function(i){return xt(i),Pa(i,this.buf),this}},{key:"bool",value:function(i){return this.buf.push(i?1:0),this}},{key:"bytes",value:function(i){return this.uint32(i.byteLength),this.raw(i)}},{key:"string",value:function(i){var e=this.textEncoder.encode(i);return this.uint32(e.byteLength),this.raw(e)}},{key:"float",value:function(i){Ss(i);var e=new Uint8Array(4);return new DataView(e.buffer).setFloat32(0,i,!0),this.raw(e)}},{key:"double",value:function(i){var e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,i,!0),this.raw(e)}},{key:"fixed32",value:function(i){Rr(i);var e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,i,!0),this.raw(e)}},{key:"sfixed32",value:function(i){xt(i);var e=new Uint8Array(4);return new DataView(e.buffer).setInt32(0,i,!0),this.raw(e)}},{key:"sint32",value:function(i){return xt(i),i=(i<<1^i>>31)>>>0,Pa(i,this.buf),this}},{key:"sfixed64",value:function(i){var e=new Uint8Array(8),n=new DataView(e.buffer),a=H.enc(i);return n.setInt32(0,a.lo,!0),n.setInt32(4,a.hi,!0),this.raw(e)}},{key:"fixed64",value:function(i){var e=new Uint8Array(8),n=new DataView(e.buffer),a=H.uEnc(i);return n.setInt32(0,a.lo,!0),n.setInt32(4,a.hi,!0),this.raw(e)}},{key:"int64",value:function(i){var e=H.enc(i);return lr(e.lo,e.hi,this.buf),this}},{key:"sint64",value:function(i){var e=H.enc(i),n=e.hi>>31,a=e.lo<<1^n,s=(e.hi<<1|e.lo>>>31)^n;return lr(a,s,this.buf),this}},{key:"uint64",value:function(i){var e=H.uEnc(i);return lr(e.lo,e.hi,this.buf),this}}])}(),Ou=function(){function r(t,i){P(this,r),this.varint64=Cu,this.uint32=Eu,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=i??new TextDecoder}return E(r,[{key:"tag",value:function(){var i=this.uint32(),e=i>>>3,n=i&7;if(e<=0||n<0||n>5)throw new Error("illegal tag: field no "+e+" wire type "+n);return[e,n]}},{key:"skip",value:function(i,e){var n=this.pos;switch(i){case fe.Varint:for(;this.buf[this.pos++]&128;);break;case fe.Bit64:this.pos+=4;case fe.Bit32:this.pos+=4;break;case fe.LengthDelimited:var a=this.uint32();this.pos+=a;break;case fe.StartGroup:for(;;){var s=this.tag(),u=te(s,2),o=u[0],c=u[1];if(c===fe.EndGroup){if(e!==void 0&&o!==e)throw new Error("invalid end group tag");break}this.skip(c,o)}break;default:throw new Error("cant skip wire type "+i)}return this.assertBounds(),this.buf.subarray(n,this.pos)}},{key:"assertBounds",value:function(){if(this.pos>this.len)throw new RangeError("premature EOF")}},{key:"int32",value:function(){return this.uint32()|0}},{key:"sint32",value:function(){var i=this.uint32();return i>>>1^-(i&1)}},{key:"int64",value:function(){return H.dec.apply(H,Ue(this.varint64()))}},{key:"uint64",value:function(){return H.uDec.apply(H,Ue(this.varint64()))}},{key:"sint64",value:function(){var i=this.varint64(),e=te(i,2),n=e[0],a=e[1],s=-(n&1);return n=(n>>>1|(a&1)<<31)^s,a=a>>>1^s,H.dec(n,a)}},{key:"bool",value:function(){var i=this.varint64(),e=te(i,2),n=e[0],a=e[1];return n!==0||a!==0}},{key:"fixed32",value:function(){return this.view.getUint32((this.pos+=4)-4,!0)}},{key:"sfixed32",value:function(){return this.view.getInt32((this.pos+=4)-4,!0)}},{key:"fixed64",value:function(){return H.uDec(this.sfixed32(),this.sfixed32())}},{key:"sfixed64",value:function(){return H.dec(this.sfixed32(),this.sfixed32())}},{key:"float",value:function(){return this.view.getFloat32((this.pos+=4)-4,!0)}},{key:"double",value:function(){return this.view.getFloat64((this.pos+=8)-8,!0)}},{key:"bytes",value:function(){var i=this.uint32(),e=this.pos;return this.pos+=i,this.assertBounds(),this.buf.subarray(e,e+i)}},{key:"string",value:function(){return this.textDecoder.decode(this.bytes())}}])}();function Nu(r,t,i,e){var n;return{typeName:t,extendee:i,get field(){if(!n){var a=typeof e=="function"?e():e;a.name=t.split(".").pop(),a.jsonName="[".concat(t,"]"),n=r.util.newFieldList([a]).list()[0]}return n},runtime:r}}function Os(r){var t=r.field.localName,i=Object.create(null);return i[t]=Du(r),[i,function(){return i[t]}]}function Du(r){var t=r.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return zn(t.T,t.L);case"message":var i=t.T,e=new i;return i.fieldWrapper?i.fieldWrapper.unwrapField(e):e;case"map":throw"map fields are not allowed to be extensions"}}function Au(r,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(var i=r.length-1;i>=0;--i)if(r[i].no==t.no)return[r[i]];return[]}return r.filter(function(e){return e.no===t.no})}var rn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),yi=[];for(var Yt=0;Yt<rn.length;Yt++)yi[rn[Yt].charCodeAt(0)]=Yt;yi[45]=rn.indexOf("+");yi[95]=rn.indexOf("/");var Ns={dec:function(t){var i=t.length*3/4;t[t.length-2]=="="?i-=2:t[t.length-1]=="="&&(i-=1);for(var e=new Uint8Array(i),n=0,a=0,s,u=0,o=0;o<t.length;o++){if(s=yi[t.charCodeAt(o)],s===void 0)switch(t[o]){case"=":a=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:u=s,a=1;break;case 1:e[n++]=u<<2|(s&48)>>4,u=s,a=2;break;case 2:e[n++]=(u&15)<<4|(s&60)>>2,u=s,a=3;break;case 3:e[n++]=(u&3)<<6|s,a=0;break}}if(a==1)throw Error("invalid base64 string.");return e.subarray(0,n)},enc:function(t){for(var i="",e=0,n,a=0,s=0;s<t.length;s++)switch(n=t[s],e){case 0:i+=rn[n>>2],a=(n&3)<<4,e=1;break;case 1:i+=rn[a|n>>4],a=(n&15)<<2,e=2;break;case 2:i+=rn[a|n>>6],i+=rn[n&63],e=0;break}return e&&(i+=rn[a],i+="=",e==1&&(i+="=")),i}};function Lu(r,t,i){As(t,r);var e=t.runtime.bin.makeReadOptions(i),n=Au(r.getType().runtime.bin.listUnknownFields(r),t.field),a=Os(t),s=te(a,2),u=s[0],o=s[1],c=$(n),l;try{for(c.s();!(l=c.n()).done;){var d=l.value;t.runtime.bin.readField(u,e.readerFactory(d.data),t.field,d.wireType,e)}}catch(f){c.e(f)}finally{c.f()}return o()}function Mu(r,t,i,e){As(t,r);var n=t.runtime.bin.makeReadOptions(e),a=t.runtime.bin.makeWriteOptions(e);if(Ds(r,t)){var s=r.getType().runtime.bin.listUnknownFields(r).filter(function(S){return S.no!=t.field.no});r.getType().runtime.bin.discardUnknownFields(r);var u=$(s),o;try{for(u.s();!(o=u.n()).done;){var c=o.value;r.getType().runtime.bin.onUnknownField(r,c.no,c.wireType,c.data)}}catch(S){u.e(S)}finally{u.f()}}var l=a.writerFactory(),d=t.field;!d.opt&&!d.repeated&&(d.kind=="enum"||d.kind=="scalar")&&(d=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(d,i,l,a);for(var f=n.readerFactory(l.finish());f.pos<f.len;){var h=f.tag(),p=te(h,2),g=p[0],k=p[1],y=f.skip(k,g);r.getType().runtime.bin.onUnknownField(r,g,k,y)}}function Ds(r,t){var i=r.getType();return t.extendee.typeName===i.typeName&&!!i.runtime.bin.listUnknownFields(r).find(function(e){return e.no==t.field.no})}function As(r,t){le(r.extendee.typeName==t.getType().typeName,"extension ".concat(r.typeName," can only be applied to message ").concat(r.extendee.typeName))}function Ls(r,t){var i=r.localName;if(r.repeated)return t[i].length>0;if(r.oneof)return t[r.oneof.localName].case===i;switch(r.kind){case"enum":case"scalar":return r.opt||r.req?t[i]!==void 0:r.kind=="enum"?t[i]!==r.T.values[0].no:!Is(r.T,t[i]);case"message":return t[i]!==void 0;case"map":return Object.keys(t[i]).length>0}}function Ea(r,t){var i=r.localName,e=!r.opt&&!r.req;if(r.repeated)t[i]=[];else if(r.oneof)t[r.oneof.localName]={case:void 0};else switch(r.kind){case"map":t[i]={};break;case"enum":t[i]=e?r.T.values[0].no:void 0;break;case"scalar":t[i]=e?zn(r.T,r.L):void 0;break;case"message":t[i]=void 0;break}}function an(r,t){if(r===null||V(r)!="object"||!Object.getOwnPropertyNames(J.prototype).every(function(e){return e in r&&typeof r[e]=="function"}))return!1;var i=r.getType();return i===null||typeof i!="function"||!("typeName"in i)||typeof i.typeName!="string"?!1:t===void 0?!0:i.typeName==t.typeName}function Ms(r,t){return an(t)||!r.fieldWrapper?t:r.fieldWrapper.wrapField(t)}D.DOUBLE,D.FLOAT,D.INT64,D.UINT64,D.INT32,D.UINT32,D.BOOL,D.STRING,D.BYTES;var Ra={ignoreUnknownFields:!1},Ia={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Uu(r){return r?Object.assign(Object.assign({},Ra),r):Ra}function Bu(r){return r?Object.assign(Object.assign({},Ia),r):Ia}var fi=Symbol(),ni=Symbol();function Ju(){return{makeReadOptions:Uu,makeWriteOptions:Bu,readMessage:function(t,i,e,n){if(i==null||Array.isArray(i)||V(i)!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Qe(i)));n=n??new t;for(var a=new Map,s=e.typeRegistry,u=0,o=Object.entries(i);u<o.length;u++){var c=te(o[u],2),l=c[0],d=c[1],f=t.fields.findJsonName(l);if(f){if(f.oneof){if(d===null&&f.kind=="scalar")continue;var h=a.get(f.oneof);if(h!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(f.oneof.name,'" present: "').concat(h,'", "').concat(l,'"'));a.set(f.oneof,l)}Oa(n,d,f,e,t)}else{var p=!1;if(s!=null&&s.findExtension&&l.startsWith("[")&&l.endsWith("]")){var g=s.findExtension(l.substring(1,l.length-1));if(g&&g.extendee.typeName==t.typeName){p=!0;var k=Os(g),y=te(k,2),S=y[0],T=y[1];Oa(S,d,g.field,e,g),Mu(n,g,T(),e)}}if(!p&&!e.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(l,'" is unknown'))}}return n},writeMessage:function(t,i){var e=t.getType(),n={},a;try{var s=$(e.fields.byNumber()),u;try{for(s.s();!(u=s.n()).done;){if(a=u.value,!Ls(a,t)){if(a.req)throw"required field not set";if(!i.emitDefaultValues||!_u(a))continue}var o=a.oneof?t[a.oneof.localName].value:t[a.localName],c=Na(a,o,i);c!==void 0&&(n[i.useProtoFieldName?a.name:a.jsonName]=c)}}catch(T){s.e(T)}finally{s.f()}var l=i.typeRegistry;if(l!=null&&l.findExtensionFor){var d=$(e.runtime.bin.listUnknownFields(t)),f;try{for(d.s();!(f=d.n()).done;){var h=f.value,p=l.findExtensionFor(e.typeName,h.no);if(p&&Ds(t,p)){var g=Lu(t,p,i),k=Na(p.field,g,i);k!==void 0&&(n[p.field.jsonName]=k)}}}catch(T){d.e(T)}finally{d.f()}}}catch(T){var y=a?"cannot encode field ".concat(e.typeName,".").concat(a.name," to JSON"):"cannot encode message ".concat(e.typeName," to JSON"),S=T instanceof Error?T.message:String(T);throw new Error(y+(S.length>0?": ".concat(S):""))}return n},readScalar:function(t,i,e){return pt(t,i,e??pn.BIGINT,!0)},writeScalar:function(t,i,e){if(i!==void 0&&(e||Is(t,i)))return ti(t,i)},debug:Qe}}function Qe(r){if(r===null)return"null";switch(V(r)){case"object":return Array.isArray(r)?"array":"object";case"string":return r.length>100?"string":'"'.concat(r.split('"').join('\\"'),'"');default:return String(r)}}function Oa(r,t,i,e,n){var a=i.localName;if(i.repeated){if(le(i.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(Qe(t)));var s=r[a],u=$(t),o;try{for(u.s();!(o=u.n()).done;){var c=o.value;if(c===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(Qe(c)));switch(i.kind){case"message":s.push(i.T.fromJson(c,e));break;case"enum":var l=dr(i.T,c,e.ignoreUnknownFields,!0);l!==ni&&s.push(l);break;case"scalar":try{s.push(pt(i.T,c,i.L,!0))}catch(B){var d="cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(Qe(c));throw B instanceof Error&&B.message.length>0&&(d+=": ".concat(B.message)),new Error(d)}break}}}catch(B){u.e(B)}finally{u.f()}}else if(i.kind=="map"){if(t===null)return;if(V(t)!="object"||Array.isArray(t))throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(Qe(t)));for(var f=r[a],h=0,p=Object.entries(t);h<p.length;h++){var g=te(p[h],2),k=g[0],y=g[1];if(y===null)throw new Error("cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: map value null"));var S=void 0;try{S=Fu(i.K,k)}catch(B){var T="cannot decode map key for field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(Qe(t));throw B instanceof Error&&B.message.length>0&&(T+=": ".concat(B.message)),new Error(T)}switch(i.V.kind){case"message":f[S]=i.V.T.fromJson(y,e);break;case"enum":var C=dr(i.V.T,y,e.ignoreUnknownFields,!0);C!==ni&&(f[S]=C);break;case"scalar":try{f[S]=pt(i.V.T,y,pn.BIGINT,!0)}catch(B){var w="cannot decode map value for field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(Qe(t));throw B instanceof Error&&B.message.length>0&&(w+=": ".concat(B.message)),new Error(w)}break}}}else switch(i.oneof&&(r=r[i.oneof.localName]={case:a},a="value"),i.kind){case"message":var I=i.T;if(t===null&&I.typeName!="google.protobuf.Value")return;var R=r[a];an(R)?R.fromJson(t,e):(r[a]=R=I.fromJson(t,e),I.fieldWrapper&&!i.oneof&&(r[a]=I.fieldWrapper.unwrapField(R)));break;case"enum":var U=dr(i.T,t,e.ignoreUnknownFields,!1);switch(U){case fi:Ea(i,r);break;case ni:break;default:r[a]=U;break}break;case"scalar":try{var M=pt(i.T,t,i.L,!1);switch(M){case fi:Ea(i,r);break;default:r[a]=M;break}}catch(B){var z="cannot decode field ".concat(n.typeName,".").concat(i.name," from JSON: ").concat(Qe(t));throw B instanceof Error&&B.message.length>0&&(z+=": ".concat(B.message)),new Error(z)}break}}function Fu(r,t){if(r===D.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return pt(r,t,pn.BIGINT,!0).toString()}function pt(r,t,i,e){if(t===null)return e?zn(r,i):fi;switch(r){case D.DOUBLE:case D.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;var n=Number(t);if(Number.isNaN(n)||!Number.isFinite(n))break;return r==D.FLOAT&&Ss(n),n;case D.INT32:case D.FIXED32:case D.SFIXED32:case D.SINT32:case D.UINT32:var a;if(typeof t=="number"?a=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(a=Number(t)),a===void 0)break;return r==D.UINT32||r==D.FIXED32?Rr(a):xt(a),a;case D.INT64:case D.SFIXED64:case D.SINT64:if(typeof t!="number"&&typeof t!="string")break;var s=H.parse(t);return i?s.toString():s;case D.FIXED64:case D.UINT64:if(typeof t!="number"&&typeof t!="string")break;var u=H.uParse(t);return i?u.toString():u;case D.BOOL:if(typeof t!="boolean")break;return t;case D.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case D.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return Ns.dec(t)}throw new Error}function dr(r,t,i,e){if(t===null)return r.typeName=="google.protobuf.NullValue"?0:e?r.values[0].no:fi;switch(V(t)){case"number":if(Number.isInteger(t))return t;break;case"string":var n=r.findName(t);if(n!==void 0)return n.no;if(i)return ni;break}throw new Error("cannot decode enum ".concat(r.typeName," from JSON: ").concat(Qe(t)))}function _u(r){return r.repeated||r.kind=="map"?!0:!(r.oneof||r.kind=="message"||r.opt||r.req)}function Na(r,t,i){if(r.kind=="map"){le(V(t)=="object"&&t!=null);var e={},n=Object.entries(t);switch(r.V.kind){case"scalar":var a=$(n),s;try{for(a.s();!(s=a.n()).done;){var u=te(s.value,2),o=u[0],c=u[1];e[o.toString()]=ti(r.V.T,c)}}catch(M){a.e(M)}finally{a.f()}break;case"message":var l=$(n),d;try{for(l.s();!(d=l.n()).done;){var f=te(d.value,2),h=f[0],p=f[1];e[h.toString()]=p.toJson(i)}}catch(M){l.e(M)}finally{l.f()}break;case"enum":var g=r.V.T,k=$(n),y;try{for(k.s();!(y=k.n()).done;){var S=te(y.value,2),T=S[0],C=S[1];e[T.toString()]=fr(g,C,i.enumAsInteger)}}catch(M){k.e(M)}finally{k.f()}break}return i.emitDefaultValues||n.length>0?e:void 0}if(r.repeated){le(Array.isArray(t));var w=[];switch(r.kind){case"scalar":for(var I=0;I<t.length;I++)w.push(ti(r.T,t[I]));break;case"enum":for(var R=0;R<t.length;R++)w.push(fr(r.T,t[R],i.enumAsInteger));break;case"message":for(var U=0;U<t.length;U++)w.push(t[U].toJson(i));break}return i.emitDefaultValues||w.length>0?w:void 0}switch(r.kind){case"scalar":return ti(r.T,t);case"enum":return fr(r.T,t,i.enumAsInteger);case"message":return Ms(r.T,t).toJson(i)}}function fr(r,t,i){var e;if(le(typeof t=="number"),r.typeName=="google.protobuf.NullValue")return null;if(i)return t;var n=r.findNumber(t);return(e=n==null?void 0:n.name)!==null&&e!==void 0?e:t}function ti(r,t){switch(r){case D.INT32:case D.SFIXED32:case D.SINT32:case D.FIXED32:case D.UINT32:return le(typeof t=="number"),t;case D.FLOAT:case D.DOUBLE:return le(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case D.STRING:return le(typeof t=="string"),t;case D.BOOL:return le(typeof t=="boolean"),t;case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return le(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case D.BYTES:return le(t instanceof Uint8Array),Ns.enc(t)}}var Un=Symbol("@bufbuild/protobuf/unknown-fields"),Da={readUnknownFields:!0,readerFactory:function(t){return new Ou(t)}},Aa={writeUnknownFields:!0,writerFactory:function(){return new Iu}};function qu(r){return r?Object.assign(Object.assign({},Da),r):Da}function ju(r){return r?Object.assign(Object.assign({},Aa),r):Aa}function Vu(){return{makeReadOptions:qu,makeWriteOptions:ju,listUnknownFields:function(t){var i;return(i=t[Un])!==null&&i!==void 0?i:[]},discardUnknownFields:function(t){delete t[Un]},writeUnknownFields:function(t,i){var e=t,n=e[Un];if(n){var a=$(n),s;try{for(a.s();!(s=a.n()).done;){var u=s.value;i.tag(u.no,u.wireType).raw(u.data)}}catch(o){a.e(o)}finally{a.f()}}},onUnknownField:function(t,i,e,n){var a=t;Array.isArray(a[Un])||(a[Un]=[]),a[Un].push({no:i,wireType:e,data:n})},readMessage:function(t,i,e,n,a){for(var s=t.getType(),u=a?i.len:i.pos+e,o,c;i.pos<u;){var l=i.tag(),d=te(l,2);if(o=d[0],c=d[1],a===!0&&c==fe.EndGroup)break;var f=s.fields.find(o);if(!f){var h=i.skip(c,o);n.readUnknownFields&&this.onUnknownField(t,o,c,h);continue}La(t,i,f,c,n)}if(a&&(c!=fe.EndGroup||o!==e))throw new Error("invalid end group tag")},readField:La,writeMessage:function(t,i,e){var n=t.getType(),a=$(n.fields.byNumber()),s;try{for(a.s();!(s=a.n()).done;){var u=s.value;if(!Ls(u,t)){if(u.req)throw new Error("cannot encode field ".concat(n.typeName,".").concat(u.name," to binary: required field not set"));continue}var o=u.oneof?t[u.oneof.localName].value:t[u.localName];Ma(u,o,i,e)}}catch(c){a.e(c)}finally{a.f()}return e.writeUnknownFields&&this.writeUnknownFields(t,i),i},writeField:function(t,i,e,n){i!==void 0&&Ma(t,i,e,n)}}}function La(r,t,i,e,n){var a=i.repeated,s=i.localName;switch(i.oneof&&(r=r[i.oneof.localName],r.case!=s&&delete r.value,r.case=s,s="value"),i.kind){case"scalar":case"enum":var u=i.kind=="enum"?D.INT32:i.T,o=hi;if(i.kind=="scalar"&&i.L>0&&(o=Wu),a){var c=r[s],l=e==fe.LengthDelimited&&u!=D.STRING&&u!=D.BYTES;if(l)for(var d=t.uint32()+t.pos;t.pos<d;)c.push(o(t,u));else c.push(o(t,u))}else r[s]=o(t,u);break;case"message":var f=i.T;a?r[s].push(ii(t,new f,n,i)):an(r[s])?ii(t,r[s],n,i):(r[s]=ii(t,new f,n,i),f.fieldWrapper&&!i.oneof&&!i.repeated&&(r[s]=f.fieldWrapper.unwrapField(r[s])));break;case"map":var h=Hu(i,t,n),p=te(h,2),g=p[0],k=p[1];r[s][g]=k;break}}function ii(r,t,i,e){var n=t.getType().runtime.bin,a=e==null?void 0:e.delimited;return n.readMessage(t,r,a?e.no:r.uint32(),i,a),t}function Hu(r,t,i){for(var e=t.uint32(),n=t.pos+e,a,s;t.pos<n;){var u=t.tag(),o=te(u,1),c=o[0];switch(c){case 1:a=hi(t,r.K);break;case 2:switch(r.V.kind){case"scalar":s=hi(t,r.V.T);break;case"enum":s=t.int32();break;case"message":s=ii(t,new r.V.T,i,void 0);break}break}}if(a===void 0&&(a=zn(r.K,pn.BIGINT)),typeof a!="string"&&typeof a!="number"&&(a=a.toString()),s===void 0)switch(r.V.kind){case"scalar":s=zn(r.V.T,pn.BIGINT);break;case"enum":s=r.V.T.values[0].no;break;case"message":s=new r.V.T;break}return[a,s]}function Wu(r,t){var i=hi(r,t);return typeof i=="bigint"?i.toString():i}function hi(r,t){switch(t){case D.STRING:return r.string();case D.BOOL:return r.bool();case D.DOUBLE:return r.double();case D.FLOAT:return r.float();case D.INT32:return r.int32();case D.INT64:return r.int64();case D.UINT64:return r.uint64();case D.FIXED64:return r.fixed64();case D.BYTES:return r.bytes();case D.FIXED32:return r.fixed32();case D.SFIXED32:return r.sfixed32();case D.SFIXED64:return r.sfixed64();case D.SINT64:return r.sint64();case D.UINT32:return r.uint32();case D.SINT32:return r.sint32()}}function Ma(r,t,i,e){le(t!==void 0);var n=r.repeated;switch(r.kind){case"scalar":case"enum":var a=r.kind=="enum"?D.INT32:r.T;if(n)if(le(Array.isArray(t)),r.packed)Ku(i,a,r.no,t);else{var s=$(t),u;try{for(s.s();!(u=s.n()).done;){var o=u.value;gt(i,a,r.no,o)}}catch(y){s.e(y)}finally{s.f()}}else gt(i,a,r.no,t);break;case"message":if(n){le(Array.isArray(t));var c=$(t),l;try{for(c.s();!(l=c.n()).done;){var d=l.value;Ua(i,e,r,d)}}catch(y){c.e(y)}finally{c.f()}}else Ua(i,e,r,t);break;case"map":le(V(t)=="object"&&t!=null);for(var f=0,h=Object.entries(t);f<h.length;f++){var p=te(h[f],2),g=p[0],k=p[1];Gu(i,e,r,g,k)}break}}function Gu(r,t,i,e,n){r.tag(i.no,fe.LengthDelimited),r.fork();var a=e;switch(i.K){case D.INT32:case D.FIXED32:case D.UINT32:case D.SFIXED32:case D.SINT32:a=Number.parseInt(e);break;case D.BOOL:le(e=="true"||e=="false"),a=e=="true";break}switch(gt(r,i.K,1,a),i.V.kind){case"scalar":gt(r,i.V.T,2,n);break;case"enum":gt(r,D.INT32,2,n);break;case"message":le(n!==void 0),r.tag(2,fe.LengthDelimited).bytes(n.toBinary(t));break}r.join()}function Ua(r,t,i,e){var n=Ms(i.T,e);i.delimited?r.tag(i.no,fe.StartGroup).raw(n.toBinary(t)).tag(i.no,fe.EndGroup):r.tag(i.no,fe.LengthDelimited).bytes(n.toBinary(t))}function gt(r,t,i,e){le(e!==void 0);var n=Us(t),a=te(n,2),s=a[0],u=a[1];r.tag(i,s)[u](e)}function Ku(r,t,i,e){if(e.length){r.tag(i,fe.LengthDelimited).fork();for(var n=Us(t),a=te(n,2),s=a[1],u=0;u<e.length;u++)r[s](e[u]);r.join()}}function Us(r){var t=fe.Varint;switch(r){case D.BYTES:case D.STRING:t=fe.LengthDelimited;break;case D.DOUBLE:case D.FIXED64:case D.SFIXED64:t=fe.Bit64;break;case D.FIXED32:case D.SFIXED32:case D.FLOAT:t=fe.Bit32;break}var i=D[r].toLowerCase();return[t,i]}function zu(){return{setEnumType:Cs,initPartial:function(t,i){if(t!==void 0){var e=i.getType(),n=$(e.fields.byMember()),a;try{var s=function(){var c=a.value,l=c.localName,d=i,f=t;if(f[l]==null)return 0;switch(c.kind){case"oneof":var h=f[l].case;if(h===void 0)return 0;var p=c.findField(h),g=f[l].value;p&&p.kind=="message"&&!an(g,p.T)?g=new p.T(g):p&&p.kind==="scalar"&&p.T===D.BYTES&&(g=ut(g)),d[l]={case:h,value:g};break;case"scalar":case"enum":var k=f[l];c.T===D.BYTES&&(k=c.repeated?k.map(ut):ut(k)),d[l]=k;break;case"map":switch(c.V.kind){case"scalar":case"enum":if(c.V.T===D.BYTES)for(var y=0,S=Object.entries(f[l]);y<S.length;y++){var T=te(S[y],2),C=T[0],w=T[1];d[l][C]=ut(w)}else Object.assign(d[l],f[l]);break;case"message":for(var I=c.V.T,R=0,U=Object.keys(f[l]);R<U.length;R++){var M=U[R],z=f[l][M];I.fieldWrapper||(z=new I(z)),d[l][M]=z}break}break;case"message":var B=c.T;if(c.repeated)d[l]=f[l].map(function(Y){return an(Y,B)?Y:new B(Y)});else{var K=f[l];B.fieldWrapper?B.typeName==="google.protobuf.BytesValue"?d[l]=ut(K):d[l]=K:d[l]=an(K,B)?K:new B(K)}break}},u;for(n.s();!(a=n.n()).done;)u=s()}catch(o){n.e(o)}finally{n.f()}}},equals:function(t,i,e){return i===e?!0:!i||!e?!1:t.fields.byMember().every(function(n){var a=i[n.localName],s=e[n.localName];if(n.repeated){if(a.length!==s.length)return!1;switch(n.kind){case"message":return a.every(function(h,p){return n.T.equals(h,s[p])});case"scalar":return a.every(function(h,p){return hn(n.T,h,s[p])});case"enum":return a.every(function(h,p){return hn(D.INT32,h,s[p])})}throw new Error("repeated cannot contain ".concat(n.kind))}switch(n.kind){case"message":var u=a,o=s;return n.T.fieldWrapper&&(u!==void 0&&!an(u)&&(u=n.T.fieldWrapper.wrapField(u)),o!==void 0&&!an(o)&&(o=n.T.fieldWrapper.wrapField(o))),n.T.equals(u,o);case"enum":return hn(D.INT32,a,s);case"scalar":return hn(n.T,a,s);case"oneof":if(a.case!==s.case)return!1;var c=n.findField(a.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(a.value,s.value);case"enum":return hn(D.INT32,a.value,s.value);case"scalar":return hn(c.T,a.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":var l=Object.keys(a).concat(Object.keys(s));switch(n.V.kind){case"message":var d=n.V.T;return l.every(function(h){return d.equals(a[h],s[h])});case"enum":return l.every(function(h){return hn(D.INT32,a[h],s[h])});case"scalar":var f=n.V.T;return l.every(function(h){return hn(f,a[h],s[h])})}break}})},clone:function(t){var i=t.getType(),e=new i,n=e,a=$(i.fields.byMember()),s;try{for(a.s();!(s=a.n()).done;){var u=s.value,o=t[u.localName],c=void 0;if(u.repeated)c=o.map(Xt);else if(u.kind=="map"){c=n[u.localName];for(var l=0,d=Object.entries(o);l<d.length;l++){var f=te(d[l],2),h=f[0],p=f[1];c[h]=Xt(p)}}else if(u.kind=="oneof"){var g=u.findField(o.case);c=g?{case:o.case,value:Xt(o.value)}:{case:void 0}}else c=Xt(o);n[u.localName]=c}}catch(T){a.e(T)}finally{a.f()}var k=$(i.runtime.bin.listUnknownFields(t)),y;try{for(k.s();!(y=k.n()).done;){var S=y.value;i.runtime.bin.onUnknownField(n,S.no,S.wireType,S.data)}}catch(T){k.e(T)}finally{k.f()}return e}}}function Xt(r){if(r===void 0)return r;if(an(r))return r.clone();if(r instanceof Uint8Array){var t=new Uint8Array(r.byteLength);return t.set(r),t}return r}function ut(r){return r instanceof Uint8Array?r:new Uint8Array(r)}function $u(r,t,i){return{syntax:r,json:Ju(),bin:Vu(),util:Object.assign(Object.assign({},zu()),{newFieldList:t,initFields:i}),makeMessageType:function(n,a,s){return Tu(this,n,a,s)},makeEnum:Su,makeEnumType:ws,getEnumType:bu,makeExtension:function(n,a,s){return Nu(this,n,a,s)}}}var Qu=function(){function r(t,i){P(this,r),this._fields=t,this._normalizer=i}return E(r,[{key:"findJsonName",value:function(i){if(!this.jsonNames){var e={},n=$(this.list()),a;try{for(n.s();!(a=n.n()).done;){var s=a.value;e[s.jsonName]=e[s.name]=s}}catch(u){n.e(u)}finally{n.f()}this.jsonNames=e}return this.jsonNames[i]}},{key:"find",value:function(i){if(!this.numbers){var e={},n=$(this.list()),a;try{for(n.s();!(a=n.n()).done;){var s=a.value;e[s.no]=s}}catch(u){n.e(u)}finally{n.f()}this.numbers=e}return this.numbers[i]}},{key:"list",value:function(){return this.all||(this.all=this._normalizer(this._fields)),this.all}},{key:"byNumber",value:function(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(function(i,e){return i.no-e.no})),this.numbersAsc}},{key:"byMember",value:function(){if(!this.members){this.members=[];var i=this.members,e,n=$(this.list()),a;try{for(n.s();!(a=n.n()).done;){var s=a.value;s.oneof?s.oneof!==e&&(e=s.oneof,i.push(e)):i.push(s)}}catch(u){n.e(u)}finally{n.f()}}return this.members}}])}();function Bs(r,t){var i=Js(r);return t?i:nc(ec(i))}function Yu(r){return Bs(r,!1)}var Xu=Js;function Js(r){for(var t=!1,i=[],e=0;e<r.length;e++){var n=r.charAt(e);switch(n){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":i.push(n),t=!1;break;default:t&&(t=!1,n=n.toUpperCase()),i.push(n);break}}return i.join("")}var Zu=new Set(["constructor","toString","toJSON","valueOf"]),xu=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Fs=function(t){return"".concat(t,"$")},ec=function(t){return xu.has(t)?Fs(t):t},nc=function(t){return Zu.has(t)?Fs(t):t},tc=function(){function r(t){P(this,r),this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=Yu(t)}return E(r,[{key:"addField",value:function(i){le(i.oneof===this,"field ".concat(i.name," not one of ").concat(this.name)),this.fields.push(i)}},{key:"findField",value:function(i){if(!this._lookup){this._lookup=Object.create(null);for(var e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[i]}}])}();function ic(r,t){var i,e,n,a,s,u,o=[],c,l=$(typeof r=="function"?r():r),d;try{for(l.s();!(d=l.n()).done;){var f=d.value,h=f;if(h.localName=Bs(f.name,f.oneof!==void 0),h.jsonName=(i=f.jsonName)!==null&&i!==void 0?i:Xu(f.name),h.repeated=(e=f.repeated)!==null&&e!==void 0?e:!1,f.kind=="scalar"&&(h.L=(n=f.L)!==null&&n!==void 0?n:pn.BIGINT),h.delimited=(a=f.delimited)!==null&&a!==void 0?a:!1,h.req=(s=f.req)!==null&&s!==void 0?s:!1,h.opt=(u=f.opt)!==null&&u!==void 0?u:!1,f.packed===void 0&&t&&(h.packed=f.kind=="enum"||f.kind=="scalar"&&f.T!=D.BYTES&&f.T!=D.STRING),f.oneof!==void 0){var p=typeof f.oneof=="string"?f.oneof:f.oneof.name;(!c||c.name!=p)&&(c=new tc(p)),h.oneof=c,c.addField(h)}o.push(h)}}catch(g){l.e(g)}finally{l.f()}return o}var m=$u("proto3",function(r){return new Qu(r,function(t){return ic(t,!0)})},function(r){var t=$(r.getType().fields.byMember()),i;try{for(t.s();!(i=t.n()).done;){var e=i.value;if(!e.opt){var n=e.localName,a=r;if(e.repeated){a[n]=[];continue}switch(e.kind){case"oneof":a[n]={case:void 0};break;case"enum":a[n]=0;break;case"map":a[n]={};break;case"scalar":a[n]=zn(e.T,e.L);break;case"message":break}}}}catch(s){t.e(s)}finally{t.f()}}),Pe=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.seconds=H.zero,e.nanos=0,m.util.initPartial(i,e),e}return N(t,r),E(t,[{key:"fromJson",value:function(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(m.json.debug(e)));var a=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!a)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");var s=Date.parse(a[1]+"-"+a[2]+"-"+a[3]+"T"+a[4]+":"+a[5]+":"+a[6]+(a[8]?a[8]:"Z"));if(Number.isNaN(s))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=H.parse(s/1e3),this.nanos=0,a[7]&&(this.nanos=parseInt("1"+a[7]+"0".repeat(9-a[7].length))-1e9),this}},{key:"toJson",value:function(e){var n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");var a="Z";if(this.nanos>0){var s=(this.nanos+1e9).toString().substring(1);s.substring(3)==="000000"?a="."+s.substring(0,3)+"Z":s.substring(6)==="000"?a="."+s.substring(0,6)+"Z":a="."+s+"Z"}return new Date(n).toISOString().replace(".000Z",a)}},{key:"toDate",value:function(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}}],[{key:"now",value:function(){return t.fromDate(new Date)}},{key:"fromDate",value:function(e){var n=e.getTime();return new t({seconds:H.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}},{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Pe.runtime=m;Pe.typeName="google.protobuf.Timestamp";Pe.fields=m.util.newFieldList(function(){return[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]});var rc=m.makeMessageType("livekit.MetricsBatch",function(){return[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Pe},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:ac,repeated:!0},{no:5,name:"events",kind:"message",T:oc,repeated:!0}]}),ac=m.makeMessageType("livekit.TimeSeriesMetric",function(){return[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:sc,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]}),sc=m.makeMessageType("livekit.MetricSample",function(){return[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Pe},{no:3,name:"value",kind:"scalar",T:2}]}),oc=m.makeMessageType("livekit.EventMetric",function(){return[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Pe},{no:7,name:"normalized_end_timestamp",kind:"message",T:Pe,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]}),Ir;(function(r){r[r.DEFAULT_AC=0]="DEFAULT_AC",r[r.OPUS=1]="OPUS",r[r.AAC=2]="AAC"})(Ir||(Ir={}));m.util.setEnumType(Ir,"livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]);var Or;(function(r){r[r.DEFAULT_VC=0]="DEFAULT_VC",r[r.H264_BASELINE=1]="H264_BASELINE",r[r.H264_MAIN=2]="H264_MAIN",r[r.H264_HIGH=3]="H264_HIGH",r[r.VP8=4]="VP8"})(Or||(Or={}));m.util.setEnumType(Or,"livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]);var Nr;(function(r){r[r.IC_DEFAULT=0]="IC_DEFAULT",r[r.IC_JPEG=1]="IC_JPEG"})(Nr||(Nr={}));m.util.setEnumType(Nr,"livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]);var Se;(function(r){r[r.AUDIO=0]="AUDIO",r[r.VIDEO=1]="VIDEO",r[r.DATA=2]="DATA"})(Se||(Se={}));m.util.setEnumType(Se,"livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]);var de;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.CAMERA=1]="CAMERA",r[r.MICROPHONE=2]="MICROPHONE",r[r.SCREEN_SHARE=3]="SCREEN_SHARE",r[r.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"})(de||(de={}));m.util.setEnumType(de,"livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]);var Je;(function(r){r[r.LOW=0]="LOW",r[r.MEDIUM=1]="MEDIUM",r[r.HIGH=2]="HIGH",r[r.OFF=3]="OFF"})(Je||(Je={}));m.util.setEnumType(Je,"livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]);var un;(function(r){r[r.POOR=0]="POOR",r[r.GOOD=1]="GOOD",r[r.EXCELLENT=2]="EXCELLENT",r[r.LOST=3]="LOST"})(un||(un={}));m.util.setEnumType(un,"livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]);var Ke;(function(r){r[r.UNSET=0]="UNSET",r[r.DISABLED=1]="DISABLED",r[r.ENABLED=2]="ENABLED"})(Ke||(Ke={}));m.util.setEnumType(Ke,"livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]);var Ce;(function(r){r[r.UNKNOWN_REASON=0]="UNKNOWN_REASON",r[r.CLIENT_INITIATED=1]="CLIENT_INITIATED",r[r.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",r[r.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",r[r.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",r[r.ROOM_DELETED=5]="ROOM_DELETED",r[r.STATE_MISMATCH=6]="STATE_MISMATCH",r[r.JOIN_FAILURE=7]="JOIN_FAILURE",r[r.MIGRATION=8]="MIGRATION",r[r.SIGNAL_CLOSE=9]="SIGNAL_CLOSE",r[r.ROOM_CLOSED=10]="ROOM_CLOSED",r[r.USER_UNAVAILABLE=11]="USER_UNAVAILABLE",r[r.USER_REJECTED=12]="USER_REJECTED",r[r.SIP_TRUNK_FAILURE=13]="SIP_TRUNK_FAILURE"})(Ce||(Ce={}));m.util.setEnumType(Ce,"livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"}]);var nn;(function(r){r[r.RR_UNKNOWN=0]="RR_UNKNOWN",r[r.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",r[r.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",r[r.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",r[r.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE"})(nn||(nn={}));m.util.setEnumType(nn,"livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]);var Ct;(function(r){r[r.SE_UNKNOWN=0]="SE_UNKNOWN",r[r.SE_CODEC_UNSUPPORTED=1]="SE_CODEC_UNSUPPORTED",r[r.SE_TRACK_NOTFOUND=2]="SE_TRACK_NOTFOUND"})(Ct||(Ct={}));m.util.setEnumType(Ct,"livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]);var Ae;(function(r){r[r.TF_STEREO=0]="TF_STEREO",r[r.TF_NO_DTX=1]="TF_NO_DTX",r[r.TF_AUTO_GAIN_CONTROL=2]="TF_AUTO_GAIN_CONTROL",r[r.TF_ECHO_CANCELLATION=3]="TF_ECHO_CANCELLATION",r[r.TF_NOISE_SUPPRESSION=4]="TF_NOISE_SUPPRESSION",r[r.TF_ENHANCED_NOISE_CANCELLATION=5]="TF_ENHANCED_NOISE_CANCELLATION"})(Ae||(Ae={}));m.util.setEnumType(Ae,"livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]);var nt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.name="",e.emptyTimeout=0,e.departureTimeout=0,e.maxParticipants=0,e.creationTime=H.zero,e.turnPassword="",e.enabledCodecs=[],e.metadata="",e.numParticipants=0,e.numPublishers=0,e.activeRecording=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);nt.runtime=m;nt.typeName="livekit.Room";nt.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:En,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:_t}]});var En=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.mime="",e.fmtpLine="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);En.runtime=m;En.typeName="livekit.Codec";En.fields=m.util.newFieldList(function(){return[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]});var ta=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.enabled=!1,e.min=0,e.max=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);ta.runtime=m;ta.typeName="livekit.PlayoutDelay";ta.fields=m.util.newFieldList(function(){return[{no:1,name:"enabled",kind:"scalar",T:8},{no:2,name:"min",kind:"scalar",T:13},{no:3,name:"max",kind:"scalar",T:13}]});var bi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.canSubscribe=!1,e.canPublish=!1,e.canPublishData=!1,e.canPublishSources=[],e.hidden=!1,e.recorder=!1,e.canUpdateMetadata=!1,e.agent=!1,e.canSubscribeMetrics=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);bi.runtime=m;bi.typeName="livekit.ParticipantPermission";bi.fields=m.util.newFieldList(function(){return[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:m.getEnumType(de),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]});var gn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.identity="",e.state=Rn.JOINING,e.tracks=[],e.metadata="",e.joinedAt=H.zero,e.name="",e.version=0,e.region="",e.isPublisher=!1,e.kind=kn.STANDARD,e.attributes={},e.disconnectReason=Ce.UNKNOWN_REASON,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);gn.runtime=m;gn.typeName="livekit.ParticipantInfo";gn.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:m.getEnumType(Rn)},{no:4,name:"tracks",kind:"message",T:cn,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:bi},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:m.getEnumType(kn)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:m.getEnumType(Ce)}]});var Rn;(function(r){r[r.JOINING=0]="JOINING",r[r.JOINED=1]="JOINED",r[r.ACTIVE=2]="ACTIVE",r[r.DISCONNECTED=3]="DISCONNECTED"})(Rn||(Rn={}));m.util.setEnumType(Rn,"livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]);var kn;(function(r){r[r.STANDARD=0]="STANDARD",r[r.INGRESS=1]="INGRESS",r[r.EGRESS=2]="EGRESS",r[r.SIP=3]="SIP",r[r.AGENT=4]="AGENT"})(kn||(kn={}));m.util.setEnumType(kn,"livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]);var ia=function(r){function t(i){var e;return P(this,t),e=O(this,t),m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);ia.runtime=m;ia.typeName="livekit.Encryption";ia.fields=m.util.newFieldList(function(){return[]});var pe;(function(r){r[r.NONE=0]="NONE",r[r.GCM=1]="GCM",r[r.CUSTOM=2]="CUSTOM"})(pe||(pe={}));m.util.setEnumType(pe,"livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]);var Si=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.mimeType="",e.mid="",e.cid="",e.layers=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Si.runtime=m;Si.typeName="livekit.SimulcastCodecInfo";Si.fields=m.util.newFieldList(function(){return[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Ye,repeated:!0}]});var cn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.type=Se.AUDIO,e.name="",e.muted=!1,e.width=0,e.height=0,e.simulcast=!1,e.disableDtx=!1,e.source=de.UNKNOWN,e.layers=[],e.mimeType="",e.mid="",e.codecs=[],e.stereo=!1,e.disableRed=!1,e.encryption=pe.NONE,e.stream="",e.audioFeatures=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);cn.runtime=m;cn.typeName="livekit.TrackInfo";cn.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:m.getEnumType(Se)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:m.getEnumType(de)},{no:10,name:"layers",kind:"message",T:Ye,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Si,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:m.getEnumType(pe)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:_t},{no:19,name:"audio_features",kind:"enum",T:m.getEnumType(Ae),repeated:!0}]});var Ye=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.quality=Je.LOW,e.width=0,e.height=0,e.bitrate=0,e.ssrc=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ye.runtime=m;Ye.typeName="livekit.VideoLayer";Ye.fields=m.util.newFieldList(function(){return[{no:1,name:"quality",kind:"enum",T:m.getEnumType(Je)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]});var qe=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.kind=re.RELIABLE,e.participantIdentity="",e.destinationIdentities=[],e.value={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);qe.runtime=m;qe.typeName="livekit.DataPacket";qe.fields=m.util.newFieldList(function(){return[{no:1,name:"kind",kind:"enum",T:m.getEnumType(re)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Dt,oneof:"value"},{no:3,name:"speaker",kind:"message",T:Ti,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:At,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Ci,oneof:"value"},{no:8,name:"metrics",kind:"message",T:rc,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:$n,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Lt,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Mt,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Ut,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Li,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Mi,oneof:"value"}]});var re;(function(r){r[r.RELIABLE=0]="RELIABLE",r[r.LOSSY=1]="LOSSY"})(re||(re={}));m.util.setEnumType(re,"livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]);var Ti=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.speakers=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ti.runtime=m;Ti.typeName="livekit.ActiveSpeakerUpdate";Ti.fields=m.util.newFieldList(function(){return[{no:1,name:"speakers",kind:"message",T:Nt,repeated:!0}]});var Nt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.level=0,e.active=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Nt.runtime=m;Nt.typeName="livekit.SpeakerInfo";Nt.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]});var Dt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.participantIdentity="",e.payload=new Uint8Array(0),e.destinationSids=[],e.destinationIdentities=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Dt.runtime=m;Dt.typeName="livekit.UserPacket";Dt.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0}]});var At=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.code=0,e.digit="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);At.runtime=m;At.typeName="livekit.SipDTMF";At.fields=m.util.newFieldList(function(){return[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]});var Ci=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.transcribedParticipantIdentity="",e.trackId="",e.segments=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ci.runtime=m;Ci.typeName="livekit.Transcription";Ci.fields=m.util.newFieldList(function(){return[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:wi,repeated:!0}]});var wi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.id="",e.text="",e.startTime=H.zero,e.endTime=H.zero,e.final=!1,e.language="",e.error=!1,e.failureReason="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);wi.runtime=m;wi.typeName="livekit.TranscriptionSegment";wi.fields=m.util.newFieldList(function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9},{no:7,name:"error",kind:"scalar",T:8},{no:8,name:"failure_reason",kind:"scalar",T:9}]});var $n=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.id="",e.timestamp=H.zero,e.message="",e.deleted=!1,e.generated=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);$n.runtime=m;$n.typeName="livekit.ChatMessage";$n.fields=m.util.newFieldList(function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]});var Lt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.id="",e.method="",e.payload="",e.responseTimeoutMs=0,e.version=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Lt.runtime=m;Lt.typeName="livekit.RpcRequest";Lt.fields=m.util.newFieldList(function(){return[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]});var Mt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.requestId="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Mt.runtime=m;Mt.typeName="livekit.RpcAck";Mt.fields=m.util.newFieldList(function(){return[{no:1,name:"request_id",kind:"scalar",T:9}]});var Ut=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.requestId="",e.value={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ut.runtime=m;Ut.typeName="livekit.RpcResponse";Ut.fields=m.util.newFieldList(function(){return[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Bt,oneof:"value"}]});var Bt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.code=0,e.message="",e.data="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Bt.runtime=m;Bt.typeName="livekit.RpcError";Bt.fields=m.util.newFieldList(function(){return[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]});var Jt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.trackSids=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Jt.runtime=m;Jt.typeName="livekit.ParticipantTracks";Jt.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]});var Pi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.edition=Qn.Standard,e.version="",e.protocol=0,e.region="",e.nodeId="",e.debugInfo="",e.agentProtocol=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Pi.runtime=m;Pi.typeName="livekit.ServerInfo";Pi.fields=m.util.newFieldList(function(){return[{no:1,name:"edition",kind:"enum",T:m.getEnumType(Qn)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]});var Qn;(function(r){r[r.Standard=0]="Standard",r[r.Cloud=1]="Cloud"})(Qn||(Qn={}));m.util.setEnumType(Qn,"livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]);var Ei=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sdk=Yn.UNKNOWN,e.version="",e.protocol=0,e.os="",e.osVersion="",e.deviceModel="",e.browser="",e.browserVersion="",e.address="",e.network="",e.otherSdks="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ei.runtime=m;Ei.typeName="livekit.ClientInfo";Ei.fields=m.util.newFieldList(function(){return[{no:1,name:"sdk",kind:"enum",T:m.getEnumType(Yn)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]});var Yn;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.JS=1]="JS",r[r.SWIFT=2]="SWIFT",r[r.ANDROID=3]="ANDROID",r[r.FLUTTER=4]="FLUTTER",r[r.GO=5]="GO",r[r.UNITY=6]="UNITY",r[r.REACT_NATIVE=7]="REACT_NATIVE",r[r.RUST=8]="RUST",r[r.PYTHON=9]="PYTHON",r[r.CPP=10]="CPP",r[r.UNITY_WEB=11]="UNITY_WEB",r[r.NODE=12]="NODE"})(Yn||(Yn={}));m.util.setEnumType(Yn,"livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]);var Ft=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.resumeConnection=Ke.UNSET,e.forceRelay=Ke.UNSET,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ft.runtime=m;Ft.typeName="livekit.ClientConfiguration";Ft.fields=m.util.newFieldList(function(){return[{no:1,name:"video",kind:"message",T:wt},{no:2,name:"screen",kind:"message",T:wt},{no:3,name:"resume_connection",kind:"enum",T:m.getEnumType(Ke)},{no:4,name:"disabled_codecs",kind:"message",T:Ri},{no:5,name:"force_relay",kind:"enum",T:m.getEnumType(Ke)}]});var wt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.hardwareEncoder=Ke.UNSET,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);wt.runtime=m;wt.typeName="livekit.VideoConfiguration";wt.fields=m.util.newFieldList(function(){return[{no:1,name:"hardware_encoder",kind:"enum",T:m.getEnumType(Ke)}]});var Ri=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.codecs=[],e.publish=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ri.runtime=m;Ri.typeName="livekit.DisabledCodecs";Ri.fields=m.util.newFieldList(function(){return[{no:1,name:"codecs",kind:"message",T:En,repeated:!0},{no:2,name:"publish",kind:"message",T:En,repeated:!0}]});var Sn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.duration=0,e.startTimestamp=H.zero,e.endTimestamp=H.zero,e.rtpClockTicks=H.zero,e.driftSamples=H.zero,e.driftMs=0,e.clockRate=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Sn.runtime=m;Sn.typeName="livekit.RTPDrift";Sn.fields=m.util.newFieldList(function(){return[{no:1,name:"start_time",kind:"message",T:Pe},{no:2,name:"end_time",kind:"message",T:Pe},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"start_timestamp",kind:"scalar",T:4},{no:5,name:"end_timestamp",kind:"scalar",T:4},{no:6,name:"rtp_clock_ticks",kind:"scalar",T:4},{no:7,name:"drift_samples",kind:"scalar",T:3},{no:8,name:"drift_ms",kind:"scalar",T:1},{no:9,name:"clock_rate",kind:"scalar",T:1}]});var ra=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.duration=0,e.packets=0,e.packetRate=0,e.bytes=H.zero,e.headerBytes=H.zero,e.bitrate=0,e.packetsLost=0,e.packetLossRate=0,e.packetLossPercentage=0,e.packetsDuplicate=0,e.packetDuplicateRate=0,e.bytesDuplicate=H.zero,e.headerBytesDuplicate=H.zero,e.bitrateDuplicate=0,e.packetsPadding=0,e.packetPaddingRate=0,e.bytesPadding=H.zero,e.headerBytesPadding=H.zero,e.bitratePadding=0,e.packetsOutOfOrder=0,e.frames=0,e.frameRate=0,e.jitterCurrent=0,e.jitterMax=0,e.gapHistogram={},e.nacks=0,e.nackAcks=0,e.nackMisses=0,e.nackRepeated=0,e.plis=0,e.firs=0,e.rttCurrent=0,e.rttMax=0,e.keyFrames=0,e.layerLockPlis=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);ra.runtime=m;ra.typeName="livekit.RTPStats";ra.fields=m.util.newFieldList(function(){return[{no:1,name:"start_time",kind:"message",T:Pe},{no:2,name:"end_time",kind:"message",T:Pe},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"packets",kind:"scalar",T:13},{no:5,name:"packet_rate",kind:"scalar",T:1},{no:6,name:"bytes",kind:"scalar",T:4},{no:39,name:"header_bytes",kind:"scalar",T:4},{no:7,name:"bitrate",kind:"scalar",T:1},{no:8,name:"packets_lost",kind:"scalar",T:13},{no:9,name:"packet_loss_rate",kind:"scalar",T:1},{no:10,name:"packet_loss_percentage",kind:"scalar",T:2},{no:11,name:"packets_duplicate",kind:"scalar",T:13},{no:12,name:"packet_duplicate_rate",kind:"scalar",T:1},{no:13,name:"bytes_duplicate",kind:"scalar",T:4},{no:40,name:"header_bytes_duplicate",kind:"scalar",T:4},{no:14,name:"bitrate_duplicate",kind:"scalar",T:1},{no:15,name:"packets_padding",kind:"scalar",T:13},{no:16,name:"packet_padding_rate",kind:"scalar",T:1},{no:17,name:"bytes_padding",kind:"scalar",T:4},{no:41,name:"header_bytes_padding",kind:"scalar",T:4},{no:18,name:"bitrate_padding",kind:"scalar",T:1},{no:19,name:"packets_out_of_order",kind:"scalar",T:13},{no:20,name:"frames",kind:"scalar",T:13},{no:21,name:"frame_rate",kind:"scalar",T:1},{no:22,name:"jitter_current",kind:"scalar",T:1},{no:23,name:"jitter_max",kind:"scalar",T:1},{no:24,name:"gap_histogram",kind:"map",K:5,V:{kind:"scalar",T:13}},{no:25,name:"nacks",kind:"scalar",T:13},{no:37,name:"nack_acks",kind:"scalar",T:13},{no:26,name:"nack_misses",kind:"scalar",T:13},{no:38,name:"nack_repeated",kind:"scalar",T:13},{no:27,name:"plis",kind:"scalar",T:13},{no:28,name:"last_pli",kind:"message",T:Pe},{no:29,name:"firs",kind:"scalar",T:13},{no:30,name:"last_fir",kind:"message",T:Pe},{no:31,name:"rtt_current",kind:"scalar",T:13},{no:32,name:"rtt_max",kind:"scalar",T:13},{no:33,name:"key_frames",kind:"scalar",T:13},{no:34,name:"last_key_frame",kind:"message",T:Pe},{no:35,name:"layer_lock_plis",kind:"scalar",T:13},{no:36,name:"last_layer_lock_pli",kind:"message",T:Pe},{no:44,name:"packet_drift",kind:"message",T:Sn},{no:45,name:"ntp_report_drift",kind:"message",T:Sn},{no:46,name:"rebased_report_drift",kind:"message",T:Sn},{no:47,name:"received_report_drift",kind:"message",T:Sn}]});var Ii=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.rtpTimestamp=0,e.rtpTimestampExt=H.zero,e.ntpTimestamp=H.zero,e.at=H.zero,e.atAdjusted=H.zero,e.packets=0,e.octets=H.zero,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ii.runtime=m;Ii.typeName="livekit.RTCPSenderReportState";Ii.fields=m.util.newFieldList(function(){return[{no:1,name:"rtp_timestamp",kind:"scalar",T:13},{no:2,name:"rtp_timestamp_ext",kind:"scalar",T:4},{no:3,name:"ntp_timestamp",kind:"scalar",T:4},{no:4,name:"at",kind:"scalar",T:3},{no:5,name:"at_adjusted",kind:"scalar",T:3},{no:6,name:"packets",kind:"scalar",T:13},{no:7,name:"octets",kind:"scalar",T:4}]});var aa=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.started=!1,e.referenceLayerSpatial=0,e.preStartTime=H.zero,e.extFirstTimestamp=H.zero,e.dummyStartTimestampOffset=H.zero,e.codecMunger={case:void 0},e.senderReportState=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);aa.runtime=m;aa.typeName="livekit.RTPForwarderState";aa.fields=m.util.newFieldList(function(){return[{no:1,name:"started",kind:"scalar",T:8},{no:2,name:"reference_layer_spatial",kind:"scalar",T:5},{no:3,name:"pre_start_time",kind:"scalar",T:3},{no:4,name:"ext_first_timestamp",kind:"scalar",T:4},{no:5,name:"dummy_start_timestamp_offset",kind:"scalar",T:4},{no:6,name:"rtp_munger",kind:"message",T:Oi},{no:7,name:"vp8_munger",kind:"message",T:Ni,oneof:"codec_munger"},{no:8,name:"sender_report_state",kind:"message",T:Ii,repeated:!0}]});var Oi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.extLastSequenceNumber=H.zero,e.extSecondLastSequenceNumber=H.zero,e.extLastTimestamp=H.zero,e.extSecondLastTimestamp=H.zero,e.lastMarker=!1,e.secondLastMarker=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Oi.runtime=m;Oi.typeName="livekit.RTPMungerState";Oi.fields=m.util.newFieldList(function(){return[{no:1,name:"ext_last_sequence_number",kind:"scalar",T:4},{no:2,name:"ext_second_last_sequence_number",kind:"scalar",T:4},{no:3,name:"ext_last_timestamp",kind:"scalar",T:4},{no:4,name:"ext_second_last_timestamp",kind:"scalar",T:4},{no:5,name:"last_marker",kind:"scalar",T:8},{no:6,name:"second_last_marker",kind:"scalar",T:8}]});var Ni=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.extLastPictureId=0,e.pictureIdUsed=!1,e.lastTl0PicIdx=0,e.tl0PicIdxUsed=!1,e.tidUsed=!1,e.lastKeyIdx=0,e.keyIdxUsed=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ni.runtime=m;Ni.typeName="livekit.VP8MungerState";Ni.fields=m.util.newFieldList(function(){return[{no:1,name:"ext_last_picture_id",kind:"scalar",T:5},{no:2,name:"picture_id_used",kind:"scalar",T:8},{no:3,name:"last_tl0_pic_idx",kind:"scalar",T:13},{no:4,name:"tl0_pic_idx_used",kind:"scalar",T:8},{no:5,name:"tid_used",kind:"scalar",T:8},{no:6,name:"last_key_idx",kind:"scalar",T:13},{no:7,name:"key_idx_used",kind:"scalar",T:8}]});var _t=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.unixMicro=H.zero,e.ticks=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);_t.runtime=m;_t.typeName="livekit.TimedVersion";_t.fields=m.util.newFieldList(function(){return[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]});var sa=function(r){function t(i){var e;return P(this,t),e=O(this,t),m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);sa.runtime=m;sa.typeName="livekit.DataStream";sa.fields=m.util.newFieldList(function(){return[]});var Pt;(function(r){r[r.CREATE=0]="CREATE",r[r.UPDATE=1]="UPDATE",r[r.DELETE=2]="DELETE",r[r.REACTION=3]="REACTION"})(Pt||(Pt={}));m.util.setEnumType(Pt,"livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]);var Di=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.operationType=Pt.CREATE,e.version=0,e.replyToStreamId="",e.attachedStreamIds=[],e.generated=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Di.runtime=m;Di.typeName="livekit.DataStream.TextHeader";Di.fields=m.util.newFieldList(function(){return[{no:1,name:"operation_type",kind:"enum",T:m.getEnumType(Pt)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}]});var Ai=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.fileName="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ai.runtime=m;Ai.typeName="livekit.DataStream.FileHeader";Ai.fields=m.util.newFieldList(function(){return[{no:1,name:"file_name",kind:"scalar",T:9}]});var Li=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.streamId="",e.timestamp=H.zero,e.topic="",e.mimeType="",e.encryptionType=pe.NONE,e.extensions={},e.contentHeader={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Li.runtime=m;Li.typeName="livekit.DataStream.Header";Li.fields=m.util.newFieldList(function(){return[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:m.getEnumType(pe)},{no:8,name:"extensions",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Di,oneof:"content_header"},{no:10,name:"file_header",kind:"message",T:Ai,oneof:"content_header"}]});var Mi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.streamId="",e.chunkIndex=H.zero,e.content=new Uint8Array(0),e.complete=!1,e.version=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Mi.runtime=m;Mi.typeName="livekit.DataStream.Chunk";Mi.fields=m.util.newFieldList(function(){return[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"complete",kind:"scalar",T:8},{no:5,name:"version",kind:"scalar",T:5},{no:6,name:"iv",kind:"scalar",T:12,opt:!0}]});var uc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var _s={exports:{}};(function(r){(function(t,i){r.exports?r.exports=i():t.log=i()})(uc,function(){var t=function(){},i="undefined",e=(typeof window>"u"?"undefined":V(window))!==i&&V(window.navigator)!==i&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],a={},s=null;function u(g,k){var y=g[k];if(typeof y.bind=="function")return y.bind(g);try{return Function.prototype.bind.call(y,g)}catch{return function(){return Function.prototype.apply.apply(y,[g,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(g){return g==="debug"&&(g="log"),(typeof console>"u"?"undefined":V(console))===i?!1:g==="trace"&&e?o:console[g]!==void 0?u(console,g):console.log!==void 0?u(console,"log"):t}function l(){for(var g=this.getLevel(),k=0;k<n.length;k++){var y=n[k];this[y]=k<g?t:this.methodFactory(y,g,this.name)}if(this.log=this.debug,(typeof console>"u"?"undefined":V(console))===i&&g<this.levels.SILENT)return"No console available for logging"}function d(g){return function(){(typeof console>"u"?"undefined":V(console))!==i&&(l.call(this),this[g].apply(this,arguments))}}function f(g,k,y){return c(g)||d.apply(this,arguments)}function h(g,k){var y=this,S,T,C,w="loglevel";typeof g=="string"?w+=":"+g:V(g)==="symbol"&&(w=void 0);function I(B){var K=(n[B]||"silent").toUpperCase();if(!((typeof window>"u"?"undefined":V(window))===i||!w)){try{window.localStorage[w]=K;return}catch{}try{window.document.cookie=encodeURIComponent(w)+"="+K+";"}catch{}}}function R(){var B;if(!((typeof window>"u"?"undefined":V(window))===i||!w)){try{B=window.localStorage[w]}catch{}if(V(B)===i)try{var K=window.document.cookie,Y=encodeURIComponent(w),Z=K.indexOf(Y+"=");Z!==-1&&(B=/^([^;]+)/.exec(K.slice(Z+Y.length+1))[1])}catch{}return y.levels[B]===void 0&&(B=void 0),B}}function U(){if(!((typeof window>"u"?"undefined":V(window))===i||!w)){try{window.localStorage.removeItem(w)}catch{}try{window.document.cookie=encodeURIComponent(w)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function M(B){var K=B;if(typeof K=="string"&&y.levels[K.toUpperCase()]!==void 0&&(K=y.levels[K.toUpperCase()]),typeof K=="number"&&K>=0&&K<=y.levels.SILENT)return K;throw new TypeError("log.setLevel() called with invalid level: "+B)}y.name=g,y.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},y.methodFactory=k||f,y.getLevel=function(){return C??T??S},y.setLevel=function(B,K){return C=M(B),K!==!1&&I(C),l.call(y)},y.setDefaultLevel=function(B){T=M(B),R()||y.setLevel(B,!1)},y.resetLevel=function(){C=null,U(),l.call(y)},y.enableAll=function(B){y.setLevel(y.levels.TRACE,B)},y.disableAll=function(B){y.setLevel(y.levels.SILENT,B)},y.rebuild=function(){if(s!==y&&(S=M(s.getLevel())),l.call(y),s===y)for(var B in a)a[B].rebuild()},S=M(s?s.getLevel():"WARN");var z=R();z!=null&&(C=M(z)),l.call(y)}s=new h,s.getLogger=function(k){if(V(k)!=="symbol"&&typeof k!="string"||k==="")throw new TypeError("You must supply a name when creating a logger.");var y=a[k];return y||(y=a[k]=new h(k,s.methodFactory)),y};var p=(typeof window>"u"?"undefined":V(window))!==i?window.log:void 0;return s.noConflict=function(){return(typeof window>"u"?"undefined":V(window))!==i&&window.log===s&&(window.log=p),s},s.getLoggers=function(){return a},s.default=s,s})})(_s);var Ui=_s.exports,mi;(function(r){r[r.trace=0]="trace",r[r.debug=1]="debug",r[r.info=2]="info",r[r.warn=3]="warn",r[r.error=4]="error",r[r.silent=5]="silent"})(mi||(mi={}));var ze;(function(r){r.Default="livekit",r.Room="livekit-room",r.Participant="livekit-participant",r.Track="livekit-track",r.Publication="livekit-track-publication",r.Engine="livekit-engine",r.Signal="livekit-signal",r.PCManager="livekit-pc-manager",r.PCTransport="livekit-pc-transport",r.E2EE="lk-e2ee"})(ze||(ze={}));var x=Ui.getLogger("livekit"),lc=Object.values(ze).map(function(r){return Ui.getLogger(r)});x.setDefaultLevel(mi.info);function ln(r){var t=Ui.getLogger(r);return t.setDefaultLevel(x.getLevel()),t}function dc(r,t){{var i=$(lc),e;try{for(i.s();!(e=i.n()).done;){var n=e.value;n.setLevel(r)}}catch(a){i.e(a)}finally{i.f()}}}var fc=Ui.getLogger("lk-e2ee"),ct=7e3,hc=[0,300,2*2*300,3*3*300,4*4*300,ct,ct,ct,ct,ct],mc=function(){function r(t){P(this,r),this._retryDelays=t!==void 0?Ue(t):hc}return E(r,[{key:"nextRetryDelayInMs",value:function(i){if(i.retryCount>=this._retryDelays.length)return null;var e=this._retryDelays[i.retryCount];return i.retryCount<=1?e:e+Math.random()*1e3}}])}();function b(r,t,i,e){function n(a){return a instanceof i?a:new i(function(s){s(a)})}return new(i||(i=Promise))(function(a,s){function u(l){try{c(e.next(l))}catch(d){s(d)}}function o(l){try{c(e.throw(l))}catch(d){s(d)}}function c(l){l.done?a(l.value):n(l.value).then(u,o)}c((e=e.apply(r,t||[])).next())})}function Ba(r){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&r[t],e=0;if(i)return i.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&e>=r.length&&(r=void 0),{value:r&&r[e++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Jn(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],i;return t?t.call(r):(r=typeof Ba=="function"?Ba(r):r[Symbol.iterator](),i={},e("next"),e("throw"),e("return"),i[Symbol.asyncIterator]=function(){return this},i);function e(a){i[a]=r[a]&&function(s){return new Promise(function(u,o){s=r[a](s),n(u,o,s.done,s.value)})}}function n(a,s,u,o){Promise.resolve(o).then(function(c){a({value:c,done:u})},s)}}var Te;(function(r){r[r.PUBLISHER=0]="PUBLISHER",r[r.SUBSCRIBER=1]="SUBSCRIBER"})(Te||(Te={}));m.util.setEnumType(Te,"livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]);var In;(function(r){r[r.ACTIVE=0]="ACTIVE",r[r.PAUSED=1]="PAUSED"})(In||(In={}));m.util.setEnumType(In,"livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]);var vi;(function(r){r[r.UDP=0]="UDP",r[r.TCP=1]="TCP",r[r.TLS=2]="TLS"})(vi||(vi={}));m.util.setEnumType(vi,"livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]);var Dr;(function(r){r[r.AddAudioTrack=0]="AddAudioTrack",r[r.AddVideoTrack=1]="AddVideoTrack",r[r.Join=2]="Join",r[r.Leave=3]="Leave",r[r.MuteAudio=4]="MuteAudio",r[r.MuteVideo=5]="MuteVideo",r[r.UnmuteAudio=6]="UnmuteAudio",r[r.UnmuteVideo=7]="UnmuteVideo"})(Dr||(Dr={}));m.util.setEnumType(Dr,"livekit.RequestType",[{no:0,name:"AddAudioTrack"},{no:1,name:"AddVideoTrack"},{no:2,name:"Join"},{no:3,name:"Leave"},{no:4,name:"MuteAudio"},{no:5,name:"MuteVideo"},{no:6,name:"UnmuteAudio"},{no:7,name:"UnmuteVideo"}]);var Bi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.message={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Bi.runtime=m;Bi.typeName="livekit.SignalRequest";Bi.fields=m.util.newFieldList(function(){return[{no:1,name:"offer",kind:"message",T:Ze,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ze,oneof:"message"},{no:3,name:"trickle",kind:"message",T:tt,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Xn,oneof:"message"},{no:5,name:"mute",kind:"message",T:it,oneof:"message"},{no:6,name:"subscription",kind:"message",T:On,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:qt,oneof:"message"},{no:8,name:"leave",kind:"message",T:Nn,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Vt,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Kt,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:zt,oneof:"message"},{no:13,name:"simulate",kind:"message",T:De,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Ht,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Qt,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:jt,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:ji,oneof:"message"},{no:19,name:"health_check",kind:"message",T:ir,oneof:"message"}]});var Et=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.message={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Et.runtime=m;Et.typeName="livekit.SignalResponse";Et.fields=m.util.newFieldList(function(){return[{no:1,name:"join",kind:"message",T:Ji,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ze,oneof:"message"},{no:3,name:"offer",kind:"message",T:Ze,oneof:"message"},{no:4,name:"trickle",kind:"message",T:tt,oneof:"message"},{no:5,name:"update",kind:"message",T:qi,oneof:"message"},{no:6,name:"track_published",kind:"message",T:rt,oneof:"message"},{no:8,name:"leave",kind:"message",T:Nn,oneof:"message"},{no:9,name:"mute",kind:"message",T:it,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Vi,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Hi,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Gi,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:zi,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Qi,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Yi,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:_i,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Fi,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Xi,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:er,oneof:"message"},{no:22,name:"health_check_response",kind:"message",T:rr,oneof:"message"},{no:23,name:"request_response",kind:"message",T:nr,oneof:"message"},{no:24,name:"track_subscribed",kind:"message",T:tr,oneof:"message"}]});var Tn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.codec="",e.cid="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Tn.runtime=m;Tn.typeName="livekit.SimulcastCodec";Tn.fields=m.util.newFieldList(function(){return[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]});var Xn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.cid="",e.name="",e.type=Se.AUDIO,e.width=0,e.height=0,e.muted=!1,e.disableDtx=!1,e.source=de.UNKNOWN,e.layers=[],e.simulcastCodecs=[],e.sid="",e.stereo=!1,e.disableRed=!1,e.encryption=pe.NONE,e.stream="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Xn.runtime=m;Xn.typeName="livekit.AddTrackRequest";Xn.fields=m.util.newFieldList(function(){return[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:m.getEnumType(Se)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:m.getEnumType(de)},{no:9,name:"layers",kind:"message",T:Ye,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Tn,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:m.getEnumType(pe)},{no:15,name:"stream",kind:"scalar",T:9}]});var tt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.candidateInit="",e.target=Te.PUBLISHER,e.final=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);tt.runtime=m;tt.typeName="livekit.TrickleRequest";tt.fields=m.util.newFieldList(function(){return[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:m.getEnumType(Te)},{no:3,name:"final",kind:"scalar",T:8}]});var it=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.muted=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);it.runtime=m;it.typeName="livekit.MuteTrackRequest";it.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]});var Ji=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.otherParticipants=[],e.serverVersion="",e.iceServers=[],e.subscriberPrimary=!1,e.alternativeUrl="",e.serverRegion="",e.pingTimeout=0,e.pingInterval=0,e.sifTrailer=new Uint8Array(0),e.enabledPublishCodecs=[],e.fastPublish=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ji.runtime=m;Ji.typeName="livekit.JoinResponse";Ji.fields=m.util.newFieldList(function(){return[{no:1,name:"room",kind:"message",T:nt},{no:2,name:"participant",kind:"message",T:gn},{no:3,name:"other_participants",kind:"message",T:gn,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Wt,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Ft},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Pi},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:En,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]});var Fi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.iceServers=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Fi.runtime=m;Fi.typeName="livekit.ReconnectResponse";Fi.fields=m.util.newFieldList(function(){return[{no:1,name:"ice_servers",kind:"message",T:Wt,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Ft}]});var rt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.cid="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);rt.runtime=m;rt.typeName="livekit.TrackPublishedResponse";rt.fields=m.util.newFieldList(function(){return[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:cn}]});var _i=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);_i.runtime=m;_i.typeName="livekit.TrackUnpublishedResponse";_i.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9}]});var Ze=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.type="",e.sdp="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ze.runtime=m;Ze.typeName="livekit.SessionDescription";Ze.fields=m.util.newFieldList(function(){return[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]});var qi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participants=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);qi.runtime=m;qi.typeName="livekit.ParticipantUpdate";qi.fields=m.util.newFieldList(function(){return[{no:1,name:"participants",kind:"message",T:gn,repeated:!0}]});var On=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSids=[],e.subscribe=!1,e.participantTracks=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);On.runtime=m;On.typeName="livekit.UpdateSubscription";On.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Jt,repeated:!0}]});var qt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSids=[],e.disabled=!1,e.quality=Je.LOW,e.width=0,e.height=0,e.fps=0,e.priority=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);qt.runtime=m;qt.typeName="livekit.UpdateTrackSettings";qt.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:m.getEnumType(Je)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]});var jt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",e.features=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);jt.runtime=m;jt.typeName="livekit.UpdateLocalAudioTrack";jt.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:m.getEnumType(Ae),repeated:!0}]});var ji=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",e.width=0,e.height=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);ji.runtime=m;ji.typeName="livekit.UpdateLocalVideoTrack";ji.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]});var Nn=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.canReconnect=!1,e.reason=Ce.UNKNOWN_REASON,e.action=Xe.DISCONNECT,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Nn.runtime=m;Nn.typeName="livekit.LeaveRequest";Nn.fields=m.util.newFieldList(function(){return[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:m.getEnumType(Ce)},{no:3,name:"action",kind:"enum",T:m.getEnumType(Xe)},{no:4,name:"regions",kind:"message",T:Zi}]});var Xe;(function(r){r[r.DISCONNECT=0]="DISCONNECT",r[r.RESUME=1]="RESUME",r[r.RECONNECT=2]="RECONNECT"})(Xe||(Xe={}));m.util.setEnumType(Xe,"livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]);var Vt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",e.layers=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Vt.runtime=m;Vt.typeName="livekit.UpdateVideoLayers";Vt.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Ye,repeated:!0}]});var Ht=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.metadata="",e.name="",e.attributes={},e.requestId=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ht.runtime=m;Ht.typeName="livekit.UpdateParticipantMetadata";Ht.fields=m.util.newFieldList(function(){return[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]});var Wt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.urls=[],e.username="",e.credential="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Wt.runtime=m;Wt.typeName="livekit.ICEServer";Wt.fields=m.util.newFieldList(function(){return[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]});var Vi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.speakers=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Vi.runtime=m;Vi.typeName="livekit.SpeakersChanged";Vi.fields=m.util.newFieldList(function(){return[{no:1,name:"speakers",kind:"message",T:Nt,repeated:!0}]});var Hi=function(r){function t(i){var e;return P(this,t),e=O(this,t),m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Hi.runtime=m;Hi.typeName="livekit.RoomUpdate";Hi.fields=m.util.newFieldList(function(){return[{no:1,name:"room",kind:"message",T:nt}]});var Wi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.quality=un.POOR,e.score=0,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Wi.runtime=m;Wi.typeName="livekit.ConnectionQualityInfo";Wi.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:m.getEnumType(un)},{no:3,name:"score",kind:"scalar",T:2}]});var Gi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.updates=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Gi.runtime=m;Gi.typeName="livekit.ConnectionQualityUpdate";Gi.fields=m.util.newFieldList(function(){return[{no:1,name:"updates",kind:"message",T:Wi,repeated:!0}]});var Ki=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.trackSid="",e.state=In.ACTIVE,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Ki.runtime=m;Ki.typeName="livekit.StreamStateInfo";Ki.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:m.getEnumType(In)}]});var zi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.streamStates=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);zi.runtime=m;zi.typeName="livekit.StreamStateUpdate";zi.fields=m.util.newFieldList(function(){return[{no:1,name:"stream_states",kind:"message",T:Ki,repeated:!0}]});var at=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.quality=Je.LOW,e.enabled=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);at.runtime=m;at.typeName="livekit.SubscribedQuality";at.fields=m.util.newFieldList(function(){return[{no:1,name:"quality",kind:"enum",T:m.getEnumType(Je)},{no:2,name:"enabled",kind:"scalar",T:8}]});var $i=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.codec="",e.qualities=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);$i.runtime=m;$i.typeName="livekit.SubscribedCodec";$i.fields=m.util.newFieldList(function(){return[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:at,repeated:!0}]});var Qi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",e.subscribedQualities=[],e.subscribedCodecs=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Qi.runtime=m;Qi.typeName="livekit.SubscribedQualityUpdate";Qi.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:at,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:$i,repeated:!0}]});var Gt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.allTracks=!1,e.trackSids=[],e.participantIdentity="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Gt.runtime=m;Gt.typeName="livekit.TrackPermission";Gt.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]});var Kt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.allParticipants=!1,e.trackPermissions=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Kt.runtime=m;Kt.typeName="livekit.SubscriptionPermission";Kt.fields=m.util.newFieldList(function(){return[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Gt,repeated:!0}]});var Yi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.participantSid="",e.trackSid="",e.allowed=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Yi.runtime=m;Yi.typeName="livekit.SubscriptionPermissionUpdate";Yi.fields=m.util.newFieldList(function(){return[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]});var zt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.publishTracks=[],e.dataChannels=[],e.trackSidsDisabled=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);zt.runtime=m;zt.typeName="livekit.SyncState";zt.fields=m.util.newFieldList(function(){return[{no:1,name:"answer",kind:"message",T:Ze},{no:2,name:"subscription",kind:"message",T:On},{no:3,name:"publish_tracks",kind:"message",T:rt,repeated:!0},{no:4,name:"data_channels",kind:"message",T:$t,repeated:!0},{no:5,name:"offer",kind:"message",T:Ze},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]});var $t=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.label="",e.id=0,e.target=Te.PUBLISHER,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);$t.runtime=m;$t.typeName="livekit.DataChannelInfo";$t.fields=m.util.newFieldList(function(){return[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:m.getEnumType(Te)}]});var De=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.scenario={case:void 0},m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);De.runtime=m;De.typeName="livekit.SimulateScenario";De.fields=m.util.newFieldList(function(){return[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:m.getEnumType(vi),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]});var Qt=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.timestamp=H.zero,e.rtt=H.zero,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Qt.runtime=m;Qt.typeName="livekit.Ping";Qt.fields=m.util.newFieldList(function(){return[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]});var Xi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.lastPingTimestamp=H.zero,e.timestamp=H.zero,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Xi.runtime=m;Xi.typeName="livekit.Pong";Xi.fields=m.util.newFieldList(function(){return[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]});var Zi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.regions=[],m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);Zi.runtime=m;Zi.typeName="livekit.RegionSettings";Zi.fields=m.util.newFieldList(function(){return[{no:1,name:"regions",kind:"message",T:xi,repeated:!0}]});var xi=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.region="",e.url="",e.distance=H.zero,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);xi.runtime=m;xi.typeName="livekit.RegionInfo";xi.fields=m.util.newFieldList(function(){return[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]});var er=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",e.err=Ct.SE_UNKNOWN,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);er.runtime=m;er.typeName="livekit.SubscriptionResponse";er.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:m.getEnumType(Ct)}]});var nr=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.requestId=0,e.reason=Zn.OK,e.message="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);nr.runtime=m;nr.typeName="livekit.RequestResponse";nr.fields=m.util.newFieldList(function(){return[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:m.getEnumType(Zn)},{no:3,name:"message",kind:"scalar",T:9}]});var Zn;(function(r){r[r.OK=0]="OK",r[r.NOT_FOUND=1]="NOT_FOUND",r[r.NOT_ALLOWED=2]="NOT_ALLOWED",r[r.LIMIT_EXCEEDED=3]="LIMIT_EXCEEDED"})(Zn||(Zn={}));m.util.setEnumType(Zn,"livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]);var tr=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.trackSid="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);tr.runtime=m;tr.typeName="livekit.TrackSubscribed";tr.fields=m.util.newFieldList(function(){return[{no:1,name:"track_sid",kind:"scalar",T:9}]});var ir=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sid="",e.roomName="",e.egressId="",e.nodeId="",e.timestamp=H.zero,e.connId="",e.errorMessage="",e.isNormalClosure=!1,m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);ir.runtime=m;ir.typeName="livekit.HealthCheck";ir.fields=m.util.newFieldList(function(){return[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"room_name",kind:"scalar",T:9},{no:3,name:"egress_id",kind:"scalar",T:9},{no:4,name:"node_id",kind:"scalar",T:9},{no:5,name:"timestamp",kind:"scalar",T:3},{no:6,name:"conn_id",kind:"scalar",T:9},{no:7,name:"error_message",kind:"scalar",T:9},{no:8,name:"is_normal_closure",kind:"scalar",T:8}]});var rr=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.connId="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);rr.runtime=m;rr.typeName="livekit.HealthCheckResponse";rr.fields=m.util.newFieldList(function(){return[{no:1,name:"conn_id",kind:"scalar",T:9}]});var oa=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.sdk=Rt.UNKNOWN,e.os="",e.deviceId="",e.date="",e.ipaddress="",e.nwSignalStrength="",m.util.initPartial(i,e),e}return N(t,r),E(t,null,[{key:"fromBinary",value:function(e,n){return new t().fromBinary(e,n)}},{key:"fromJson",value:function(e,n){return new t().fromJson(e,n)}},{key:"fromJsonString",value:function(e,n){return new t().fromJsonString(e,n)}},{key:"equals",value:function(e,n){return m.util.equals(t,e,n)}}])}(J);oa.runtime=m;oa.typeName="livekit.DeviceInfo";oa.fields=m.util.newFieldList(function(){return[{no:1,name:"sdk",kind:"enum",T:m.getEnumType(Rt)},{no:2,name:"os",kind:"scalar",T:9},{no:3,name:"deviceId",kind:"scalar",T:9},{no:4,name:"date",kind:"scalar",T:9},{no:5,name:"ipaddress",kind:"scalar",T:9},{no:6,name:"nw_signal_strength",kind:"scalar",T:9}]});var Rt;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.JS=1]="JS",r[r.SWIFT=2]="SWIFT",r[r.ANDROID=3]="ANDROID",r[r.FLUTTER=4]="FLUTTER",r[r.GO=5]="GO",r[r.UNITY=6]="UNITY",r[r.REACT_NATIVE=7]="REACT_NATIVE",r[r.RUST=8]="RUST"})(Rt||(Rt={}));m.util.setEnumType(Rt,"livekit.DeviceInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"}]);var ua={exports:{}},jn=(typeof Reflect>"u"?"undefined":V(Reflect))==="object"?Reflect:null,Ja=jn&&typeof jn.apply=="function"?jn.apply:function(t,i,e){return Function.prototype.apply.call(t,i,e)},ri;jn&&typeof jn.ownKeys=="function"?ri=jn.ownKeys:Object.getOwnPropertySymbols?ri=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ri=function(t){return Object.getOwnPropertyNames(t)};function vc(r){console&&console.warn&&console.warn(r)}var qs=Number.isNaN||function(t){return t!==t};function ae(){ae.init.call(this)}ua.exports=ae;ua.exports.once=yc;ae.EventEmitter=ae;ae.prototype._events=void 0;ae.prototype._eventsCount=0;ae.prototype._maxListeners=void 0;var Fa=10;function ar(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+V(r))}Object.defineProperty(ae,"defaultMaxListeners",{enumerable:!0,get:function(){return Fa},set:function(t){if(typeof t!="number"||t<0||qs(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Fa=t}});ae.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ae.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||qs(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function js(r){return r._maxListeners===void 0?ae.defaultMaxListeners:r._maxListeners}ae.prototype.getMaxListeners=function(){return js(this)};ae.prototype.emit=function(t){for(var i=[],e=1;e<arguments.length;e++)i.push(arguments[e]);var n=t==="error",a=this._events;if(a!==void 0)n=n&&a.error===void 0;else if(!n)return!1;if(n){var s;if(i.length>0&&(s=i[0]),s instanceof Error)throw s;var u=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw u.context=s,u}var o=a[t];if(o===void 0)return!1;if(typeof o=="function")Ja(o,this,i);else for(var c=o.length,l=Ks(o,c),e=0;e<c;++e)Ja(l[e],this,i);return!0};function Vs(r,t,i,e){var n,a,s;if(ar(i),a=r._events,a===void 0?(a=r._events=Object.create(null),r._eventsCount=0):(a.newListener!==void 0&&(r.emit("newListener",t,i.listener?i.listener:i),a=r._events),s=a[t]),s===void 0)s=a[t]=i,++r._eventsCount;else if(typeof s=="function"?s=a[t]=e?[i,s]:[s,i]:e?s.unshift(i):s.push(i),n=js(r),n>0&&s.length>n&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=r,u.type=t,u.count=s.length,vc(u)}return r}ae.prototype.addListener=function(t,i){return Vs(this,t,i,!1)};ae.prototype.on=ae.prototype.addListener;ae.prototype.prependListener=function(t,i){return Vs(this,t,i,!0)};function pc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Hs(r,t,i){var e={fired:!1,wrapFn:void 0,target:r,type:t,listener:i},n=pc.bind(e);return n.listener=i,e.wrapFn=n,n}ae.prototype.once=function(t,i){return ar(i),this.on(t,Hs(this,t,i)),this};ae.prototype.prependOnceListener=function(t,i){return ar(i),this.prependListener(t,Hs(this,t,i)),this};ae.prototype.removeListener=function(t,i){var e,n,a,s,u;if(ar(i),n=this._events,n===void 0)return this;if(e=n[t],e===void 0)return this;if(e===i||e.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,e.listener||i));else if(typeof e!="function"){for(a=-1,s=e.length-1;s>=0;s--)if(e[s]===i||e[s].listener===i){u=e[s].listener,a=s;break}if(a<0)return this;a===0?e.shift():gc(e,a),e.length===1&&(n[t]=e[0]),n.removeListener!==void 0&&this.emit("removeListener",t,u||i)}return this};ae.prototype.off=ae.prototype.removeListener;ae.prototype.removeAllListeners=function(t){var i,e,n;if(e=this._events,e===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete e[t]),this;if(arguments.length===0){var a=Object.keys(e),s;for(n=0;n<a.length;++n)s=a[n],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=e[t],typeof i=="function")this.removeListener(t,i);else if(i!==void 0)for(n=i.length-1;n>=0;n--)this.removeListener(t,i[n]);return this};function Ws(r,t,i){var e=r._events;if(e===void 0)return[];var n=e[t];return n===void 0?[]:typeof n=="function"?i?[n.listener||n]:[n]:i?kc(n):Ks(n,n.length)}ae.prototype.listeners=function(t){return Ws(this,t,!0)};ae.prototype.rawListeners=function(t){return Ws(this,t,!1)};ae.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):Gs.call(r,t)};ae.prototype.listenerCount=Gs;function Gs(r){var t=this._events;if(t!==void 0){var i=t[r];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}ae.prototype.eventNames=function(){return this._eventsCount>0?ri(this._events):[]};function Ks(r,t){for(var i=new Array(t),e=0;e<t;++e)i[e]=r[e];return i}function gc(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function kc(r){for(var t=new Array(r.length),i=0;i<t.length;++i)t[i]=r[i].listener||r[i];return t}function yc(r,t){return new Promise(function(i,e){function n(s){r.removeListener(t,a),e(s)}function a(){typeof r.removeListener=="function"&&r.removeListener("error",n),i([].slice.call(arguments))}zs(r,t,a,{once:!0}),t!=="error"&&bc(r,n,{once:!0})})}function bc(r,t,i){typeof r.on=="function"&&zs(r,"error",t,i)}function zs(r,t,i,e){if(typeof r.on=="function")e.once?r.once(t,i):r.on(t,i);else if(typeof r.addEventListener=="function")r.addEventListener(t,function n(a){e.once&&r.removeEventListener(t,n),i(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+V(r))}var en=ua.exports,$s=!0,Qs=!0;function mt(r,t,i){var e=r.match(t);return e&&e.length>=i&&parseFloat(e[i],10)}function Dn(r,t,i){if(r.RTCPeerConnection){var e=r.RTCPeerConnection.prototype,n=e.addEventListener;e.addEventListener=function(s,u){if(s!==t)return n.apply(this,arguments);var o=function(l){var d=i(l);d&&(u.handleEvent?u.handleEvent(d):u(d))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,o),n.apply(this,[s,o])};var a=e.removeEventListener;e.removeEventListener=function(s,u){if(s!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(u))return a.apply(this,arguments);var o=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[s,o])},Object.defineProperty(e,"on"+t,{get:function(){return this["_on"+t]},set:function(u){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),u&&this.addEventListener(t,this["_on"+t]=u)},enumerable:!0,configurable:!0})}}function Sc(r){return typeof r!="boolean"?new Error("Argument type: "+V(r)+". Please use a boolean."):($s=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function Tc(r){return typeof r!="boolean"?new Error("Argument type: "+V(r)+". Please use a boolean."):(Qs=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function Ys(){if((typeof window>"u"?"undefined":V(window))==="object"){if($s)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ca(r,t){Qs&&console.warn(r+" is deprecated, please use "+t+" instead.")}function Cc(r){var t={browser:null,version:null};if(typeof r>"u"||!r.navigator||!r.navigator.userAgent)return t.browser="Not a browser.",t;var i=r.navigator;if(i.mozGetUserMedia)t.browser="firefox",t.version=parseInt(mt(i.userAgent,/Firefox\/(\d+)\./,1));else if(i.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(mt(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(r.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(mt(i.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype,t._safariVersion=mt(i.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function _a(r){return Object.prototype.toString.call(r)==="[object Object]"}function Xs(r){return _a(r)?Object.keys(r).reduce(function(t,i){var e=_a(r[i]),n=e?Xs(r[i]):r[i],a=e&&!Object.keys(n).length;return n===void 0||a?t:Object.assign(t,Ot({},i,n))},{}):r}function Ar(r,t,i){!t||i.has(t.id)||(i.set(t.id,t),Object.keys(t).forEach(function(e){e.endsWith("Id")?Ar(r,r.get(t[e]),i):e.endsWith("Ids")&&t[e].forEach(function(n){Ar(r,r.get(n),i)})}))}function qa(r,t,i){var e=i?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;var a=[];return r.forEach(function(s){s.type==="track"&&s.trackIdentifier===t.id&&a.push(s)}),a.forEach(function(s){r.forEach(function(u){u.type===e&&u.trackId===s.id&&Ar(r,u,n)})}),n}var ja=Ys;function Zs(r,t){var i=r&&r.navigator;if(i.mediaDevices){var e=function(c){if(V(c)!=="object"||c.mandatory||c.optional)return c;var l={};return Object.keys(c).forEach(function(d){if(!(d==="require"||d==="advanced"||d==="mediaSource")){var f=V(c[d])==="object"?c[d]:{ideal:c[d]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);var h=function(k,y){return k?k+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(f.ideal!==void 0){l.optional=l.optional||[];var p={};typeof f.ideal=="number"?(p[h("min",d)]=f.ideal,l.optional.push(p),p={},p[h("max",d)]=f.ideal,l.optional.push(p)):(p[h("",d)]=f.ideal,l.optional.push(p))}f.exact!==void 0&&typeof f.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[h("",d)]=f.exact):["min","max"].forEach(function(g){f[g]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[h(g,d)]=f[g])})}}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},n=function(c,l){if(t.version>=61)return l(c);if(c=JSON.parse(JSON.stringify(c)),c&&V(c.audio)==="object"){var d=function(k,y,S){y in k&&!(S in k)&&(k[S]=k[y],delete k[y])};c=JSON.parse(JSON.stringify(c)),d(c.audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=e(c.audio)}if(c&&V(c.video)==="object"){var f=c.video.facingMode;f=f&&(V(f)==="object"?f:{ideal:f});var h=t.version<66;if(f&&(f.exact==="user"||f.exact==="environment"||f.ideal==="user"||f.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete c.video.facingMode;var p;if(f.exact==="environment"||f.ideal==="environment"?p=["back","rear"]:(f.exact==="user"||f.ideal==="user")&&(p=["front"]),p)return i.mediaDevices.enumerateDevices().then(function(g){g=g.filter(function(y){return y.kind==="videoinput"});var k=g.find(function(y){return p.some(function(S){return y.label.toLowerCase().includes(S)})});return!k&&g.length&&p.includes("back")&&(k=g[g.length-1]),k&&(c.video.deviceId=f.exact?{exact:k.deviceId}:{ideal:k.deviceId}),c.video=e(c.video),ja("chrome: "+JSON.stringify(c)),l(c)})}c.video=e(c.video)}return ja("chrome: "+JSON.stringify(c)),l(c)},a=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(c,l,d){n(c,function(f){i.webkitGetUserMedia(f,l,function(h){d&&d(a(h))})})};if(i.getUserMedia=s.bind(i),i.mediaDevices.getUserMedia){var u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(o){return n(o,function(c){return u(c).then(function(l){if(c.audio&&!l.getAudioTracks().length||c.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(function(d){d.stop()}),new DOMException("","NotFoundError");return l},function(l){return Promise.reject(a(l))})})}}}}function wc(r,t){if(!(r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices)&&r.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}r.navigator.mediaDevices.getDisplayMedia=function(e){return t(e).then(function(n){var a=e.video&&e.video.width,s=e.video&&e.video.height,u=e.video&&e.video.frameRate;return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:u||3}},a&&(e.video.mandatory.maxWidth=a),s&&(e.video.mandatory.maxHeight=s),r.navigator.mediaDevices.getUserMedia(e)})}}}function xs(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function eo(r){if(V(r)==="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._ontrackpoly||(this._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(a){var s;r.RTCPeerConnection.prototype.getReceivers?s=e.getReceivers().find(function(o){return o.track&&o.track.id===a.track.id}):s={track:a.track};var u=new Event("track");u.track=a.track,u.receiver=s,u.transceiver={receiver:s},u.streams=[n.stream],e.dispatchEvent(u)}),n.stream.getTracks().forEach(function(a){var s;r.RTCPeerConnection.prototype.getReceivers?s=e.getReceivers().find(function(o){return o.track&&o.track.id===a.id}):s={track:a};var u=new Event("track");u.track=a,u.receiver=s,u.transceiver={receiver:s},u.streams=[n.stream],e.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Dn(r,"track",function(i){return i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i})}function no(r){if(V(r)==="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){var t=function(o,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=o.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:o}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var i=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(o,c){var l=i.apply(this,arguments);return l||(l=t(this,o),this._senders.push(l)),l};var e=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(o){e.apply(this,arguments);var c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}var n=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(o){var c=this;this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(function(l){c._senders.push(t(c,l))})};var a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(o){var c=this;this._senders=this._senders||[],a.apply(this,[o]),o.getTracks().forEach(function(l){var d=c._senders.find(function(f){return f.track===l});d&&c._senders.splice(c._senders.indexOf(d),1)})}}else if(V(r)==="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){var s=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){var o=this,c=s.apply(this,[]);return c.forEach(function(l){return l._pc=o}),c},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function to(r){if(r.RTCPeerConnection){var t=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),a=n[0],s=n[1],u=n[2];if(arguments.length>0&&typeof a=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof a!="function"))return t.apply(this,[]);var o=function(f){var h={},p=f.result();return p.forEach(function(g){var k={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(function(y){k[y]=g.stat(y)}),h[k.id]=k}),h},c=function(f){return new Map(Object.keys(f).map(function(h){return[h,f[h]]}))};if(arguments.length>=2){var l=function(f){s(c(o(f)))};return t.apply(this,[l,a])}return new Promise(function(d,f){t.apply(e,[function(h){d(c(o(h)))},f])}).then(s,u)}}}function io(r){if(V(r)==="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver){if(!("getStats"in r.RTCRtpSender.prototype)){var t=r.RTCPeerConnection.prototype.getSenders;t&&(r.RTCPeerConnection.prototype.getSenders=function(){var s=this,u=t.apply(this,[]);return u.forEach(function(o){return o._pc=s}),u});var i=r.RTCPeerConnection.prototype.addTrack;i&&(r.RTCPeerConnection.prototype.addTrack=function(){var s=i.apply(this,arguments);return s._pc=this,s}),r.RTCRtpSender.prototype.getStats=function(){var s=this;return this._pc.getStats().then(function(u){return qa(u,s.track,!0)})}}if(!("getStats"in r.RTCRtpReceiver.prototype)){var e=r.RTCPeerConnection.prototype.getReceivers;e&&(r.RTCPeerConnection.prototype.getReceivers=function(){var s=this,u=e.apply(this,[]);return u.forEach(function(o){return o._pc=s}),u}),Dn(r,"track",function(a){return a.receiver._pc=a.srcElement,a}),r.RTCRtpReceiver.prototype.getStats=function(){var s=this;return this._pc.getStats().then(function(u){return qa(u,s.track,!1)})}}if("getStats"in r.RTCRtpSender.prototype&&"getStats"in r.RTCRtpReceiver.prototype){var n=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){var s=arguments[0],u,o,c;return this.getSenders().forEach(function(l){l.track===s&&(u?c=!0:u=l)}),this.getReceivers().forEach(function(l){return l.track===s&&(o?c=!0:o=l),l.track===s}),c||u&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):u?u.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}}}function ro(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){var s=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(u){return s._shimmedLocalStreams[u][0]})};var t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(s,u){if(!u)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var o=t.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(o)===-1&&this._shimmedLocalStreams[u.id].push(o):this._shimmedLocalStreams[u.id]=[u,o],o};var i=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(s){var u=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(function(l){var d=u.getSenders().find(function(f){return f.track===l});if(d)throw new DOMException("Track already exists.","InvalidAccessError")});var o=this.getSenders();i.apply(this,arguments);var c=this.getSenders().filter(function(l){return o.indexOf(l)===-1});this._shimmedLocalStreams[s.id]=[s].concat(c)};var e=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],e.apply(this,arguments)};var n=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(s){var u=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(function(o){var c=u._shimmedLocalStreams[o].indexOf(s);c!==-1&&u._shimmedLocalStreams[o].splice(c,1),u._shimmedLocalStreams[o].length===1&&delete u._shimmedLocalStreams[o]}),n.apply(this,arguments)}}function ao(r,t){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&t.version>=65)return ro(r);var i=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){var l=this,d=i.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(function(f){return l._reverseStreams[f.id]})};var e=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(l){var d=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(function(h){var p=d.getSenders().find(function(g){return g.track===h});if(p)throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){var f=new r.MediaStream(l.getTracks());this._streams[l.id]=f,this._reverseStreams[f.id]=l,l=f}e.apply(this,[l])};var n=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},r.RTCPeerConnection.prototype.addTrack=function(l,d){var f=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(function(y){return y===l}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var p=this.getSenders().find(function(y){return y.track===l});if(p)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var g=this._streams[d.id];if(g)g.addTrack(l),Promise.resolve().then(function(){f.dispatchEvent(new Event("negotiationneeded"))});else{var k=new r.MediaStream([l]);this._streams[d.id]=k,this._reverseStreams[k.id]=d,this.addStream(k)}return this.getSenders().find(function(y){return y.track===l})};function a(c,l){var d=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(function(f){var h=c._reverseStreams[f],p=c._streams[h.id];d=d.replace(new RegExp(p.id,"g"),h.id)}),new RTCSessionDescription({type:l.type,sdp:d})}function s(c,l){var d=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(function(f){var h=c._reverseStreams[f],p=c._streams[h.id];d=d.replace(new RegExp(h.id,"g"),p.id)}),new RTCSessionDescription({type:l.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){var l=r.RTCPeerConnection.prototype[c],d=Ot({},c,function(){var f=this,h=arguments,p=arguments.length&&typeof arguments[0]=="function";return p?l.apply(this,[function(g){var k=a(f,g);h[0].apply(null,[k])},function(g){h[1]&&h[1].apply(null,g)},arguments[2]]):l.apply(this,arguments).then(function(g){return a(f,g)})});r.RTCPeerConnection.prototype[c]=d[c]});var u=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?u.apply(this,arguments):(arguments[0]=s(this,arguments[0]),u.apply(this,arguments))};var o=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get:function(){var l=o.get.apply(this);return l.type===""?l:a(this,l)}}),r.RTCPeerConnection.prototype.removeTrack=function(l){var d=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var f=l._pc===this;if(!f)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var h;Object.keys(this._streams).forEach(function(p){var g=d._streams[p].getTracks().find(function(k){return l.track===k});g&&(h=d._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Lr(r,t){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){var e=r.RTCPeerConnection.prototype[i],n=Ot({},i,function(){return arguments[0]=new(i==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)});r.RTCPeerConnection.prototype[i]=n[i]})}function so(r,t){Dn(r,"negotiationneeded",function(i){var e=i.target;if(!((t.version<72||e.getConfiguration&&e.getConfiguration().sdpSemantics==="plan-b")&&e.signalingState!=="stable"))return i})}var Va=Object.freeze({__proto__:null,fixNegotiationNeeded:so,shimAddTrackRemoveTrack:ao,shimAddTrackRemoveTrackWithNative:ro,shimGetDisplayMedia:wc,shimGetSendersWithDtmf:no,shimGetStats:to,shimGetUserMedia:Zs,shimMediaStream:xs,shimOnTrack:eo,shimPeerConnection:Lr,shimSenderReceiverGetStats:io});function oo(r,t){var i=r&&r.navigator,e=r&&r.MediaStreamTrack;if(i.getUserMedia=function(o,c,l){ca("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(o).then(c,l)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){var n=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},a=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(o){return V(o)==="object"&&V(o.audio)==="object"&&(o=JSON.parse(JSON.stringify(o)),n(o.audio,"autoGainControl","mozAutoGainControl"),n(o.audio,"noiseSuppression","mozNoiseSuppression")),a(o)},e&&e.prototype.getSettings){var s=e.prototype.getSettings;e.prototype.getSettings=function(){var o=s.apply(this,arguments);return n(o,"mozAutoGainControl","autoGainControl"),n(o,"mozNoiseSuppression","noiseSuppression"),o}}if(e&&e.prototype.applyConstraints){var u=e.prototype.applyConstraints;e.prototype.applyConstraints=function(o){return this.kind==="audio"&&V(o)==="object"&&(o=JSON.parse(JSON.stringify(o)),n(o,"autoGainControl","mozAutoGainControl"),n(o,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[o])}}}}function Pc(r,t){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(e){if(!(e&&e.video)){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return e.video===!0?e.video={mediaSource:t}:e.video.mediaSource=t,r.navigator.mediaDevices.getUserMedia(e)})}function uo(r){V(r)==="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Mr(r,t){if(!(V(r)!=="object"||!(r.RTCPeerConnection||r.mozRTCPeerConnection))){!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){var a=r.RTCPeerConnection.prototype[n],s=Ot({},n,function(){return arguments[0]=new(n==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)});r.RTCPeerConnection.prototype[n]=s[n]});var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){var a=Array.prototype.slice.call(arguments),s=a[0],u=a[1],o=a[2];return e.apply(this,[s||null]).then(function(c){if(t.version<53&&!u)try{c.forEach(function(l){l.type=i[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach(function(d,f){c.set(f,Object.assign({},d,{type:i[d.type]||d.type}))})}return c}).then(u,o)}}}function co(r){if(V(r)==="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&!(r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)){var t=r.RTCPeerConnection.prototype.getSenders;t&&(r.RTCPeerConnection.prototype.getSenders=function(){var n=this,a=t.apply(this,[]);return a.forEach(function(s){return s._pc=n}),a});var i=r.RTCPeerConnection.prototype.addTrack;i&&(r.RTCPeerConnection.prototype.addTrack=function(){var n=i.apply(this,arguments);return n._pc=this,n}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function lo(r){if(V(r)==="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&!(r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)){var t=r.RTCPeerConnection.prototype.getReceivers;t&&(r.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach(function(a){return a._pc=e}),n}),Dn(r,"track",function(i){return i.receiver._pc=i.srcElement,i}),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function fo(r){!r.RTCPeerConnection||"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(i){var e=this;ca("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&i.getTracks().includes(n.track)&&e.removeTrack(n)})})}function ho(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function mo(r){if(V(r)==="object"&&r.RTCPeerConnection){var t=r.RTCPeerConnection.prototype.addTransceiver;t&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;e===void 0&&(e=[]),e=Ue(e);var n=e.length>0;n&&e.forEach(function(o){if("rid"in o){var c=/^[a-z0-9]{0,16}$/i;if(!c.test(o.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var a=t.apply(this,arguments);if(n){var s=a.sender,u=s.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=e,s.sendEncodings=e,this.setParametersPromises.push(s.setParameters(u).then(function(){delete s.sendEncodings}).catch(function(){delete s.sendEncodings})))}return a})}}function vo(r){if(V(r)==="object"&&r.RTCRtpSender){var t=r.RTCRtpSender.prototype.getParameters;t&&(r.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function po(r){if(V(r)==="object"&&r.RTCPeerConnection){var t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(n,e)}).finally(function(){n.setParametersPromises=[]}):t.apply(this,arguments)}}}function go(r){if(V(r)==="object"&&r.RTCPeerConnection){var t=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(n,e)}).finally(function(){n.setParametersPromises=[]}):t.apply(this,arguments)}}}var Ha=Object.freeze({__proto__:null,shimAddTransceiver:mo,shimCreateAnswer:go,shimCreateOffer:po,shimGetDisplayMedia:Pc,shimGetParameters:vo,shimGetUserMedia:oo,shimOnTrack:uo,shimPeerConnection:Mr,shimRTCDataChannel:ho,shimReceiverGetStats:lo,shimRemoveStream:fo,shimSenderGetStats:co});function ko(r){if(!(V(r)!=="object"||!r.RTCPeerConnection)){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){var t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(a){return t.call(n,a,e)}),e.getVideoTracks().forEach(function(a){return t.call(n,a,e)})},r.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,a=arguments.length,s=new Array(a>1?a-1:0),u=1;u<a;u++)s[u-1]=arguments[u];return s&&s.forEach(function(o){n._localStreams?n._localStreams.includes(o)||n._localStreams.push(o):n._localStreams=[o]}),t.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(e){var n=this;this._localStreams||(this._localStreams=[]);var a=this._localStreams.indexOf(e);if(a!==-1){this._localStreams.splice(a,1);var s=e.getTracks();this.getSenders().forEach(function(u){s.includes(u.track)&&n.removeTrack(u)})}})}}function yo(r){if(!(V(r)!=="object"||!r.RTCPeerConnection)&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var n=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(function(s){if(n._remoteStreams||(n._remoteStreams=[]),!n._remoteStreams.includes(s)){n._remoteStreams.push(s);var u=new Event("addstream");u.stream=s,n.dispatchEvent(u)}})})}});var t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(function(a){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(a)>=0)){e._remoteStreams.push(a);var s=new Event("addstream");s.stream=a,e.dispatchEvent(s)}})}),t.apply(e,arguments)}}}function bo(r){if(!(V(r)!=="object"||!r.RTCPeerConnection)){var t=r.RTCPeerConnection.prototype,i=t.createOffer,e=t.createAnswer,n=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(c,l){var d=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[d]);return l?(f.then(c,l),Promise.resolve()):f},t.createAnswer=function(c,l){var d=arguments.length>=2?arguments[2]:arguments[0],f=e.apply(this,[d]);return l?(f.then(c,l),Promise.resolve()):f};var u=function(c,l,d){var f=n.apply(this,[c]);return d?(f.then(l,d),Promise.resolve()):f};t.setLocalDescription=u,u=function(c,l,d){var f=a.apply(this,[c]);return d?(f.then(l,d),Promise.resolve()):f},t.setRemoteDescription=u,u=function(c,l,d){var f=s.apply(this,[c]);return d?(f.then(l,d),Promise.resolve()):f},t.addIceCandidate=u}}function So(r){var t=r&&r.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var i=t.mediaDevices,e=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=function(n){return e(To(n))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(a,s,u){t.mediaDevices.getUserMedia(a).then(s,u)}).bind(t))}function To(r){return r&&r.video!==void 0?Object.assign({},r,{video:Xs(r.video)}):r}function Co(r){if(r.RTCPeerConnection){var t=r.RTCPeerConnection;r.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var a=[],s=0;s<e.iceServers.length;s++){var u=e.iceServers[s];u.urls===void 0&&u.url?(ca("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,a.push(u)):a.push(e.iceServers[s])}e.iceServers=a}return new t(e,n)},r.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function wo(r){V(r)==="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Po(r){var t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(e){if(e){typeof e.offerToReceiveAudio<"u"&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find(function(s){return s.receiver.track.kind==="audio"});e.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):e.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof e.offerToReceiveVideo<"u"&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var a=this.getTransceivers().find(function(s){return s.receiver.track.kind==="video"});e.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):e.offerToReceiveVideo===!0&&!a&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Eo(r){V(r)!=="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}var Wa=Object.freeze({__proto__:null,shimAudioContext:Eo,shimCallbacksAPI:bo,shimConstraints:To,shimCreateOfferLegacy:Po,shimGetUserMedia:So,shimLocalStreamsAPI:ko,shimRTCIceServerUrls:Co,shimRemoteStreamsAPI:yo,shimTrackEventTransceiver:wo}),Ro={exports:{}};(function(r){var t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(function(e){return e.trim()})},t.splitSections=function(i){var e=i.split(`
m=`);return e.map(function(n,a){return(a>0?"m="+n:n).trim()+`\r
`})},t.getDescription=function(i){var e=t.splitSections(i);return e&&e[0]},t.getMediaSections=function(i){var e=t.splitSections(i);return e.shift(),e},t.matchPrefix=function(i,e){return t.splitLines(i).filter(function(n){return n.indexOf(e)===0})},t.parseCandidate=function(i){var e;i.indexOf("a=candidate:")===0?e=i.substring(12).split(" "):e=i.substring(10).split(" ");for(var n={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]},a=8;a<e.length;a+=2)switch(e[a]){case"raddr":n.relatedAddress=e[a+1];break;case"rport":n.relatedPort=parseInt(e[a+1],10);break;case"tcptype":n.tcpType=e[a+1];break;case"ufrag":n.ufrag=e[a+1],n.usernameFragment=e[a+1];break;default:n[e[a]]===void 0&&(n[e[a]]=e[a+1]);break}return n},t.writeCandidate=function(i){var e=[];e.push(i.foundation);var n=i.component;n==="rtp"?e.push(1):n==="rtcp"?e.push(2):e.push(n),e.push(i.protocol.toUpperCase()),e.push(i.priority),e.push(i.address||i.ip),e.push(i.port);var a=i.type;return e.push("typ"),e.push(a),a!=="host"&&i.relatedAddress&&i.relatedPort&&(e.push("raddr"),e.push(i.relatedAddress),e.push("rport"),e.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(e.push("tcptype"),e.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(e.push("ufrag"),e.push(i.usernameFragment||i.ufrag)),"candidate:"+e.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){var e=i.substring(9).split(" "),n={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),n.name=e[0],n.clockRate=parseInt(e[1],10),n.channels=e.length===3?parseInt(e[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(i){var e=i.payloadType;i.preferredPayloadType!==void 0&&(e=i.preferredPayloadType);var n=i.channels||i.numChannels||1;return"a=rtpmap:"+e+" "+i.name+"/"+i.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(i){var e=i.substring(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1],attributes:e.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){for(var e={},n,a=i.substring(i.indexOf(" ")+1).split(";"),s=0;s<a.length;s++)n=a[s].trim().split("="),e[n[0].trim()]=n[1];return e},t.writeFmtp=function(i){var e="",n=i.payloadType;if(i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){var a=[];Object.keys(i.parameters).forEach(function(s){i.parameters[s]!==void 0?a.push(s+"="+i.parameters[s]):a.push(s)}),e+="a=fmtp:"+n+" "+a.join(";")+`\r
`}return e},t.parseRtcpFb=function(i){var e=i.substring(i.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},t.writeRtcpFb=function(i){var e="",n=i.payloadType;return i.preferredPayloadType!==void 0&&(n=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(function(a){e+="a=rtcp-fb:"+n+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),e},t.parseSsrcMedia=function(i){var e=i.indexOf(" "),n={ssrc:parseInt(i.substring(7,e),10)},a=i.indexOf(":",e);return a>-1?(n.attribute=i.substring(e+1,a),n.value=i.substring(a+1)):n.attribute=i.substring(e+1),n},t.parseSsrcGroup=function(i){var e=i.substring(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(function(n){return parseInt(n,10)})}},t.getMid=function(i){var e=t.matchPrefix(i,"a=mid:")[0];if(e)return e.substring(6)},t.parseFingerprint=function(i){var e=i.substring(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}},t.getDtlsParameters=function(i,e){var n=t.matchPrefix(i+e,"a=fingerprint:");return{role:"auto",fingerprints:n.map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,e){var n="a=setup:"+e+`\r
`;return i.fingerprints.forEach(function(a){n+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),n},t.parseCryptoLine=function(i){var e=i.substring(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(V(i.keyParams)==="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;var e=i.substring(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,e){var n=t.matchPrefix(i+e,"a=crypto:");return n.map(t.parseCryptoLine)},t.getIceParameters=function(i,e){var n=t.matchPrefix(i+e,"a=ice-ufrag:")[0],a=t.matchPrefix(i+e,"a=ice-pwd:")[0];return n&&a?{usernameFragment:n.substring(12),password:a.substring(10)}:null},t.writeIceParameters=function(i){var e="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(e+=`a=ice-lite\r
`),e},t.parseRtpParameters=function(i){var e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(i),a=n[0].split(" ");e.profile=a[2];for(var s=3;s<a.length;s++){var u=a[s],o=t.matchPrefix(i,"a=rtpmap:"+u+" ")[0];if(o){var c=t.parseRtpMap(o),l=t.matchPrefix(i,"a=fmtp:"+u+" ");switch(c.parameters=l.length?t.parseFmtp(l[0]):{},c.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),e.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(c.name.toUpperCase());break}}}t.matchPrefix(i,"a=extmap:").forEach(function(f){e.headerExtensions.push(t.parseExtmap(f))});var d=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return e.codecs.forEach(function(f){d.forEach(function(h){var p=f.rtcpFeedback.find(function(g){return g.type===h.type&&g.parameter===h.parameter});p||f.rtcpFeedback.push(h)})}),e},t.writeRtpDescription=function(i,e){var n="";n+="m="+i+" ",n+=e.codecs.length>0?"9":"0",n+=" "+(e.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=e.codecs.map(function(s){return s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType}).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,e.codecs.forEach(function(s){n+=t.writeRtpMap(s),n+=t.writeFmtp(s),n+=t.writeRtcpFb(s)});var a=0;return e.codecs.forEach(function(s){s.maxptime>a&&(a=s.maxptime)}),a>0&&(n+="a=maxptime:"+a+`\r
`),e.headerExtensions&&e.headerExtensions.forEach(function(s){n+=t.writeExtmap(s)}),n},t.parseRtpEncodingParameters=function(i){var e=[],n=t.parseRtpParameters(i),a=n.fecMechanisms.indexOf("RED")!==-1,s=n.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(i,"a=ssrc:").map(function(f){return t.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),o=u.length>0&&u[0].ssrc,c,l=t.matchPrefix(i,"a=ssrc-group:FID").map(function(f){var h=f.substring(17).split(" ");return h.map(function(p){return parseInt(p,10)})});l.length>0&&l[0].length>1&&l[0][0]===o&&(c=l[0][1]),n.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var h={ssrc:o,codecPayloadType:parseInt(f.parameters.apt,10)};o&&c&&(h.rtx={ssrc:c}),e.push(h),a&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:o,mechanism:s?"red+ulpfec":"red"},e.push(h))}}),e.length===0&&o&&e.push({ssrc:o});var d=t.matchPrefix(i,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,e.forEach(function(f){f.maxBitrate=d})),e},t.parseRtcpParameters=function(i){var e={},n=t.matchPrefix(i,"a=ssrc:").map(function(u){return t.parseSsrcMedia(u)}).filter(function(u){return u.attribute==="cname"})[0];n&&(e.cname=n.value,e.ssrc=n.ssrc);var a=t.matchPrefix(i,"a=rtcp-rsize");e.reducedSize=a.length>0,e.compound=a.length===0;var s=t.matchPrefix(i,"a=rtcp-mux");return e.mux=s.length>0,e},t.writeRtcpParameters=function(i){var e="";return i.reducedSize&&(e+=`a=rtcp-rsize\r
`),i.mux&&(e+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(e+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),e},t.parseMsid=function(i){var e,n=t.matchPrefix(i,"a=msid:");if(n.length===1)return e=n[0].substring(7).split(" "),{stream:e[0],track:e[1]};var a=t.matchPrefix(i,"a=ssrc:").map(function(s){return t.parseSsrcMedia(s)}).filter(function(s){return s.attribute==="msid"});if(a.length>0)return e=a[0].value.split(" "),{stream:e[0],track:e[1]}},t.parseSctpDescription=function(i){var e=t.parseMLine(i),n=t.matchPrefix(i,"a=max-message-size:"),a;n.length>0&&(a=parseInt(n[0].substring(19),10)),isNaN(a)&&(a=65536);var s=t.matchPrefix(i,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:e.fmt,maxMessageSize:a};var u=t.matchPrefix(i,"a=sctpmap:");if(u.length>0){var o=u[0].substring(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:a}}},t.writeSctpDescription=function(i,e){var n=[];return i.protocol!=="DTLS/SCTP"?n=["m="+i.kind+" 9 "+i.protocol+" "+e.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+e.port+`\r
`]:n=["m="+i.kind+" 9 "+i.protocol+" "+e.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+e.port+" "+e.protocol+` 65535\r
`],e.maxMessageSize!==void 0&&n.push("a=max-message-size:"+e.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,e,n){var a,s=e!==void 0?e:2;i?a=i:a=t.generateSessionId();var u=n||"thisisadapterortc";return`v=0\r
o=`+u+" "+a+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,e){for(var n=t.splitLines(i),a=0;a<n.length;a++)switch(n[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[a].substring(2)}return e?t.getDirection(e):"sendrecv"},t.getKind=function(i){var e=t.splitLines(i),n=e[0].split(" ");return n[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){var e=t.splitLines(i),n=e[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(i){var e=t.matchPrefix(i,"o=")[0],n=e.substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;for(var e=t.splitLines(i),n=0;n<e.length;n++)if(e[n].length<2||e[n].charAt(1)!=="=")return!1;return!0},r.exports=t})(Ro);var Io=Ro.exports,Vn=cc(Io),Ec=tu({__proto__:null,default:Vn},[Io]);function ai(r){if(!(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)){var t=r.RTCIceCandidate;r.RTCIceCandidate=function(e){if(V(e)==="object"&&e.candidate&&e.candidate.indexOf("a=")===0&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){var n=new t(e),a=Vn.parseCandidate(e.candidate);for(var s in a)s in n||Object.defineProperty(n,s,{value:a[s]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},r.RTCIceCandidate.prototype=t.prototype,Dn(r,"icecandidate",function(i){return i.candidate&&Object.defineProperty(i,"candidate",{value:new r.RTCIceCandidate(i.candidate),writable:"false"}),i})}}function Ur(r){!r.RTCIceCandidate||r.RTCIceCandidate&&"relayProtocol"in r.RTCIceCandidate.prototype||Dn(r,"icecandidate",function(t){if(t.candidate){var i=Vn.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function si(r,t){if(r.RTCPeerConnection){"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get:function(){return typeof this._sctp>"u"?null:this._sctp}});var i=function(o){if(!o||!o.sdp)return!1;var c=Vn.splitSections(o.sdp);return c.shift(),c.some(function(l){var d=Vn.parseMLine(l);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},e=function(o){var c=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;var l=parseInt(c[1],10);return l!==l?-1:l},n=function(o){var c=65536;return t.browser==="firefox"&&(t.version<57?o===-1?c=16384:c=2147483637:t.version<60?c=t.version===57?65535:65536:c=2147483637),c},a=function(o,c){var l=65536;t.browser==="firefox"&&t.version===57&&(l=65535);var d=Vn.matchPrefix(o.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substring(19),10):t.browser==="firefox"&&c!==-1&&(l=2147483637),l},s=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){var o=this.getConfiguration(),c=o.sdpSemantics;c==="plan-b"&&Object.defineProperty(this,"sctp",{get:function(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){var l=e(arguments[0]),d=n(l),f=a(arguments[0],l),h;d===0&&f===0?h=Number.POSITIVE_INFINITY:d===0||f===0?h=Math.max(d,f):h=Math.min(d,f);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return h}}),this._sctp=p}return s.apply(this,arguments)}}}function oi(r){if(!(r.RTCPeerConnection&&"createDataChannel"in r.RTCPeerConnection.prototype))return;function t(e,n){var a=e.send;e.send=function(){var u=arguments[0],o=u.length||u.size||u.byteLength;if(e.readyState==="open"&&n.sctp&&o>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return a.apply(e,arguments)}}var i=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){var n=i.apply(this,arguments);return t(n,this),n},Dn(r,"datachannel",function(e){return t(e.channel,e.target),e})}function Br(r){if(!(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)){var t=r.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(i){var e=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(n){var a=n.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;var s=new Event("connectionstatechange",n);a.dispatchEvent(s)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),e.apply(this,arguments)}})}}function Jr(r,t){if(r.RTCPeerConnection&&!(t.browser==="chrome"&&t.version>=71)&&!(t.browser==="safari"&&t._safariVersion>=13.1)){var i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){var a=n.sdp.split(`
`).filter(function(s){return s.trim()!=="a=extmap-allow-mixed"}).join(`
`);r.RTCSessionDescription&&n instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:n.type,sdp:a}):n.sdp=a}return i.apply(this,arguments)}}}function ui(r,t){if(r.RTCPeerConnection&&r.RTCPeerConnection.prototype){var i=r.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}function ci(r,t){if(r.RTCPeerConnection&&r.RTCPeerConnection.prototype){var i=r.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(r.RTCPeerConnection.prototype.setLocalDescription=function(){var n=this,a=arguments[0]||{};if(V(a)!=="object"||a.type&&a.sdp)return i.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer";break}if(a.sdp||a.type!=="offer"&&a.type!=="answer")return i.apply(this,[a]);var s=a.type==="offer"?this.createOffer:this.createAnswer;return s.apply(this).then(function(u){return i.apply(n,[u])})})}}var Rc=Object.freeze({__proto__:null,removeExtmapAllowMixed:Jr,shimAddIceCandidateNullOrEmpty:ui,shimConnectionState:Br,shimMaxMessageSize:si,shimParameterlessSetLocalDescription:ci,shimRTCIceCandidate:ai,shimRTCIceCandidateRelayProtocol:Ur,shimSendThrowTypeError:oi});function Ic(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=r.window,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},e=Ys,n=Cc(t),a={browserDetails:n,commonShim:Rc,extractVersion:mt,disableLog:Sc,disableWarnings:Tc,sdp:Ec};switch(n.browser){case"chrome":if(!Va||!Lr||!i.shimChrome)return e("Chrome shim is not included in this adapter release."),a;if(n.version===null)return e("Chrome shim can not determine version, not shimming."),a;e("adapter.js shimming chrome."),a.browserShim=Va,ui(t,n),ci(t),Zs(t,n),xs(t),Lr(t,n),eo(t),ao(t,n),no(t),to(t),io(t),so(t,n),ai(t),Ur(t),Br(t),si(t,n),oi(t),Jr(t,n);break;case"firefox":if(!Ha||!Mr||!i.shimFirefox)return e("Firefox shim is not included in this adapter release."),a;e("adapter.js shimming firefox."),a.browserShim=Ha,ui(t,n),ci(t),oo(t,n),Mr(t,n),uo(t),fo(t),co(t),lo(t),ho(t),mo(t),vo(t),po(t),go(t),ai(t),Br(t),si(t,n),oi(t);break;case"safari":if(!Wa||!i.shimSafari)return e("Safari shim is not included in this adapter release."),a;e("adapter.js shimming safari."),a.browserShim=Wa,ui(t,n),ci(t),Co(t),Po(t),bo(t),ko(t),yo(t),wo(t),So(t),Eo(t),ai(t),Ur(t),si(t,n),oi(t),Jr(t,n);break;default:e("Unsupported browser!");break}return a}Ic({window:typeof window>"u"?void 0:window});var Oc=10,Zt="lk_e2ee",Nc="LKFrameEncryptionKey",Dc={sharedKey:!1,ratchetSalt:Nc,ratchetWindowSize:8,failureTolerance:Oc,keyringSize:16},vn;(function(r){r.SetKey="setKey",r.RatchetRequest="ratchetRequest",r.KeyRatcheted="keyRatcheted"})(vn||(vn={}));var Ga;(function(r){r.KeyRatcheted="keyRatcheted"})(Ga||(Ga={}));var mn;(function(r){r.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",r.EncryptionError="encryptionError"})(mn||(mn={}));var Ka;(function(r){r.Error="cryptorError"})(Ka||(Ka={}));function Ac(){return Lc()||Fr()}function Fr(){return typeof window.RTCRtpScriptTransform<"u"}function Lc(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function Mc(r){return b(this,void 0,void 0,v().m(function t(){var i,e;return v().w(function(n){for(;;)switch(n.n){case 0:return i=new TextEncoder,n.n=1,crypto.subtle.importKey("raw",i.encode(r),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);case 1:return e=n.v,n.a(2,e)}},t)}))}function Uc(r){return b(this,void 0,void 0,v().m(function t(){var i;return v().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,crypto.subtle.importKey("raw",r,"HKDF",!1,["deriveBits","deriveKey"]);case 1:return i=e.v,e.a(2,i)}},t)}))}var Bc=function(r){function t(){var i,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return P(this,t),i=O(this,t),i.onKeyRatcheted=function(n,a){x.debug("key ratcheted event received",{material:n,keyIndex:a})},i.keyInfoMap=new Map,i.options=Object.assign(Object.assign({},Dc),e),i.on(vn.KeyRatcheted,i.onKeyRatcheted),i}return N(t,r),E(t,[{key:"onSetEncryptionKey",value:function(e,n,a){var s={key:e,participantIdentity:n,keyIndex:a};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(a??0),s),this.emit(vn.SetKey,s)}},{key:"getKeys",value:function(){return Array.from(this.keyInfoMap.values())}},{key:"getOptions",value:function(){return this.options}},{key:"ratchetKey",value:function(e,n){this.emit(vn.RatchetRequest,e,n)}}])}(en.EventEmitter),Jc=function(r){function t(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};P(this,t);var e=Object.assign(Object.assign({},i),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1});return O(this,t,[e])}return N(t,r),E(t,[{key:"setKey",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s;return v().w(function(u){for(;;)switch(u.n){case 0:if(typeof e!="string"){u.n=2;break}return u.n=1,Mc(e);case 1:s=u.v,u.n=4;break;case 2:return u.n=3,Uc(e);case 3:s=u.v;case 4:a=s,this.onSetEncryptionKey(a);case 5:return u.a(2)}},n,this)}))}}])}(Bc),An=function(r){function t(i,e){var n;return P(this,t),n=O(this,t,[e||"an error has occured"]),n.code=i,n}return N(t,r),E(t)}(Tt(Error)),se=function(r){function t(i,e,n,a){var s;return P(this,t),s=O(this,t,[1,i]),s.status=n,s.reason=e,s.context=a,s}return N(t,r),E(t)}(An),la=function(r){function t(i){return P(this,t),O(this,t,[21,i??"device is unsupported"])}return N(t,r),E(t)}(An),sn=function(r){function t(i){return P(this,t),O(this,t,[20,i??"track is invalid"])}return N(t,r),E(t)}(An),Fc=function(r){function t(i){return P(this,t),O(this,t,[10,i??"unsupported server"])}return N(t,r),E(t)}(An),ve=function(r){function t(i){return P(this,t),O(this,t,[12,i??"unexpected connection state"])}return N(t,r),E(t)}(An),_r=function(r){function t(i){return P(this,t),O(this,t,[13,i??"unable to negotiate"])}return N(t,r),E(t)}(An),za=function(r){function t(i,e){var n;return P(this,t),n=O(this,t,[15,i]),n.reason=e,n}return N(t,r),E(t)}(An),It;(function(r){r.PermissionDenied="PermissionDenied",r.NotFound="NotFound",r.DeviceInUse="DeviceInUse",r.Other="Other"})(It||(It={}));(function(r){function t(i){if(i&&"name"in i)return i.name==="NotFoundError"||i.name==="DevicesNotFoundError"?r.NotFound:i.name==="NotAllowedError"||i.name==="PermissionDeniedError"?r.PermissionDenied:i.name==="NotReadableError"||i.name==="TrackStartError"?r.DeviceInUse:r.Other}r.getFailure=t})(It||(It={}));var $a;(function(r){r[r.InvalidKey=0]="InvalidKey",r[r.MissingKey=1]="MissingKey",r[r.InternalError=2]="InternalError"})($a||($a={}));var A;(function(r){r.Connected="connected",r.Reconnecting="reconnecting",r.SignalReconnecting="signalReconnecting",r.Reconnected="reconnected",r.Disconnected="disconnected",r.ConnectionStateChanged="connectionStateChanged",r.MediaDevicesChanged="mediaDevicesChanged",r.ParticipantConnected="participantConnected",r.ParticipantDisconnected="participantDisconnected",r.TrackPublished="trackPublished",r.TrackSubscribed="trackSubscribed",r.TrackSubscriptionFailed="trackSubscriptionFailed",r.TrackUnpublished="trackUnpublished",r.TrackUnsubscribed="trackUnsubscribed",r.TrackMuted="trackMuted",r.TrackUnmuted="trackUnmuted",r.LocalTrackPublished="localTrackPublished",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalAudioSilenceDetected="localAudioSilenceDetected",r.ActiveSpeakersChanged="activeSpeakersChanged",r.ParticipantMetadataChanged="participantMetadataChanged",r.ParticipantNameChanged="participantNameChanged",r.ParticipantAttributesChanged="participantAttributesChanged",r.RoomMetadataChanged="roomMetadataChanged",r.DataReceived="dataReceived",r.SipDTMFReceived="sipDTMFReceived",r.TranscriptionReceived="transcriptionReceived",r.ConnectionQualityChanged="connectionQualityChanged",r.TrackStreamStateChanged="trackStreamStateChanged",r.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",r.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",r.AudioPlaybackStatusChanged="audioPlaybackChanged",r.VideoPlaybackStatusChanged="videoPlaybackChanged",r.MediaDevicesError="mediaDevicesError",r.ParticipantPermissionsChanged="participantPermissionsChanged",r.SignalConnected="signalConnected",r.RecordingStatusChanged="recordingStatusChanged",r.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",r.EncryptionError="encryptionError",r.DCBufferStatusChanged="dcBufferStatusChanged",r.ActiveDeviceChanged="activeDeviceChanged",r.ChatMessage="chatMessage",r.ReconnectPrimaryDelay="reconnectPrimaryDelay",r.ReconnectSecondaryDelay="reconnectSecondaryDelay",r.ReconnectICEDelay="reconnectICEDelay",r.LocalTrackSubscribed="localTrackSubscribed",r.MetricsReceived="metricsReceived"})(A||(A={}));var F;(function(r){r.TrackPublished="trackPublished",r.TrackSubscribed="trackSubscribed",r.TrackSubscriptionFailed="trackSubscriptionFailed",r.TrackUnpublished="trackUnpublished",r.TrackUnsubscribed="trackUnsubscribed",r.TrackMuted="trackMuted",r.TrackUnmuted="trackUnmuted",r.LocalTrackPublished="localTrackPublished",r.LocalTrackUnpublished="localTrackUnpublished",r.ParticipantMetadataChanged="participantMetadataChanged",r.ParticipantNameChanged="participantNameChanged",r.DataReceived="dataReceived",r.SipDTMFReceived="sipDTMFReceived",r.TranscriptionReceived="transcriptionReceived",r.IsSpeakingChanged="isSpeakingChanged",r.ConnectionQualityChanged="connectionQualityChanged",r.TrackStreamStateChanged="trackStreamStateChanged",r.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",r.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",r.MediaDevicesError="mediaDevicesError",r.AudioStreamAcquired="audioStreamAcquired",r.ParticipantPermissionsChanged="participantPermissionsChanged",r.PCTrackAdded="pcTrackAdded",r.AttributesChanged="attributesChanged",r.ChatMessage="chatMessage",r.LocalTrackSubscribed="localTrackSubscribed"})(F||(F={}));var q;(function(r){r.TransportsCreated="transportsCreated",r.Connected="connected",r.Disconnected="disconnected",r.Resuming="resuming",r.Resumed="resumed",r.Restarting="restarting",r.Restarted="restarted",r.SignalResumed="signalResumed",r.SignalRestarted="signalRestarted",r.Closing="closing",r.MediaTrackAdded="mediaTrackAdded",r.ActiveSpeakersUpdate="activeSpeakersUpdate",r.DataPacketReceived="dataPacketReceived",r.PrimaryDelay="primaryDelay",r.SecondaryDelay="secondaryDelay",r.TranscriptionReceived="transcriptionReceived",r.RTPVideoMapUpdate="rtpVideoMapUpdate",r.DCBufferStatusChanged="dcBufferStatusChanged",r.ParticipantUpdate="participantUpdate",r.RoomUpdate="roomUpdate",r.SpeakersChanged="speakersChanged",r.StreamStateChanged="streamStateChanged",r.ConnectionQualityUpdate="connectionQualityUpdate",r.SubscriptionError="subscriptionError",r.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",r.RemoteMute="remoteMute",r.SubscribedQualityUpdate="subscribedQualityUpdate",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalTrackSubscribed="localTrackSubscribed",r.Offline="offline",r.SignalRequestResponse="signalRequestResponse"})(q||(q={}));var _;(function(r){r.Message="message",r.Muted="muted",r.Unmuted="unmuted",r.Restarted="restarted",r.Ended="ended",r.Subscribed="subscribed",r.Unsubscribed="unsubscribed",r.UpdateSettings="updateSettings",r.UpdateSubscription="updateSubscription",r.AudioPlaybackStarted="audioPlaybackStarted",r.AudioPlaybackFailed="audioPlaybackFailed",r.AudioSilenceDetected="audioSilenceDetected",r.VisibilityChanged="visibilityChanged",r.VideoDimensionsChanged="videoDimensionsChanged",r.VideoPlaybackStarted="videoPlaybackStarted",r.VideoPlaybackFailed="videoPlaybackFailed",r.ElementAttached="elementAttached",r.ElementDetached="elementDetached",r.UpstreamPaused="upstreamPaused",r.UpstreamResumed="upstreamResumed",r.SubscriptionPermissionChanged="subscriptionPermissionChanged",r.SubscriptionStatusChanged="subscriptionStatusChanged",r.SubscriptionFailed="subscriptionFailed",r.TrackProcessorUpdate="trackProcessorUpdate",r.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",r.TranscriptionReceived="transcriptionReceived",r.TimeSyncUpdate="timeSyncUpdate"})(_||(_={}));function da(r,t,i){var e,n,a;t===void 0&&(t=50),i===void 0&&(i={});var s=(e=i.isImmediate)!=null&&e,u=(n=i.callback)!=null&&n,o=i.maxWait,c=Date.now(),l=[];function d(){if(o!==void 0){var h=Date.now()-c;if(h+t>=o)return o-h}return t}var f=function(){var p=[].slice.call(arguments),g=this;return new Promise(function(k,y){var S=s&&a===void 0;if(a!==void 0&&clearTimeout(a),a=setTimeout(function(){if(a=void 0,c=Date.now(),!s){var C=r.apply(g,p);u&&u(C),l.forEach(function(w){return(0,w.resolve)(C)}),l=[]}},d()),S){var T=r.apply(g,p);return u&&u(T),k(T)}l.push({resolve:k,reject:y})})};return f.cancel=function(h){a!==void 0&&clearTimeout(a),l.forEach(function(p){return(0,p.reject)(h)}),l=[]},f}var _c=/version\/(\d+(\.?_?\d+)+)/i,hr;function xe(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(typeof navigator>"u")){var i=navigator.userAgent.toLowerCase();if(hr===void 0||t){var e=qc.find(function(n){var a=n.test;return a.test(i)});hr=e==null?void 0:e.describe(i)}return hr}}var qc=[{test:/firefox|iceweasel|fxios/i,describe:function(t){var i={name:"Firefox",version:li(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:mr(t)};return i}},{test:/chrom|crios|crmo/i,describe:function(t){var i={name:"Chrome",version:li(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:mr(t)};return i}},{test:/safari|applewebkit/i,describe:function(t){var i={name:"Safari",version:li(_c,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:mr(t)};return i}}];function li(r,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,e=t.match(r);return e&&e.length>=i&&e[i]||""}function mr(r){return r.includes("mac os")?li(/\(.+?(\d+_\d+(:?_\d+)?)/,r,1).replace(/_/g,"."):void 0}var jc="25.3.8",Vc=jc,Hc=15,ye=E(function r(){P(this,r)});ye.setTimeout=function(){return setTimeout.apply(void 0,arguments)};ye.setInterval=function(){return setInterval.apply(void 0,arguments)};ye.clearTimeout=function(){return clearTimeout.apply(void 0,arguments)};ye.clearInterval=function(){return clearInterval.apply(void 0,arguments)};var Re=function(){function r(t,i,e,n,a){if(P(this,r),V(t)==="object")this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else if(i!==void 0&&e!==void 0)this.width=t,this.height=i,this.aspectRatio=t/i,this.encoding={maxBitrate:e,maxFramerate:n,priority:a};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}return E(r,[{key:"resolution",get:function(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}])}(),Wc=["vp8","h264"],Gc=["vp8","h264","vp9","av1"];function Kc(r){return!!Wc.find(function(t){return t===r})}var qr;(function(r){r.telephone={maxBitrate:12e3},r.speech={maxBitrate:24e3},r.music={maxBitrate:48e3},r.musicStereo={maxBitrate:64e3},r.musicHighQuality={maxBitrate:96e3},r.musicHighQualityStereo={maxBitrate:128e3}})(qr||(qr={}));var Ve={h540:new Re(960,540,5e5,25),h720:new Re(1280,720,125e4,30)},jr={h540:new Re(720,540,55e4,25),h720:new Re(960,720,12e5,30)},sr={h360fps3:new Re(640,360,2e5,3,"medium"),h360fps15:new Re(640,360,4e5,15,"medium"),h720fps5:new Re(1280,720,8e5,5,"medium"),h720fps15:new Re(1280,720,15e5,15,"medium"),h720fps30:new Re(1280,720,2e6,30,"medium"),h1080fps15:new Re(1920,1080,25e5,15,"medium"),h1080fps30:new Re(1920,1080,5e6,30,"medium"),original:new Re(0,0,7e6,30,"medium")};function zc(r){if(!(typeof r>"u"))return typeof structuredClone=="function"?structuredClone(r):JSON.parse(JSON.stringify(r))}var $c=5e3,lt=[],we;(function(r){r[r.LOW=0]="LOW",r[r.MEDIUM=1]="MEDIUM",r[r.HIGH=2]="HIGH"})(we||(we={}));var L=function(r){function t(i,e){var n,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};P(this,t);var s;return n=O(this,t),n.attachedElements=[],n.isMuted=!1,n.streamState=t.StreamState.Active,n.isInBackground=!1,n._currentBitrate=0,n.log=x,n.appVisibilityChangedListener=function(){n.backgroundTimeout&&clearTimeout(n.backgroundTimeout),document.visibilityState==="hidden"?n.backgroundTimeout=setTimeout(function(){return n.handleAppVisibilityChanged()},$c):n.handleAppVisibilityChanged()},n.log=ln((s=a.loggerName)!==null&&s!==void 0?s:ze.Track),n.loggerContextCb=a.loggerContextCb,n.setMaxListeners(100),n.kind=e,n._mediaStreamTrack=i,n._mediaStreamID=i.id,n.source=t.Source.Unknown,n}return N(t,r),E(t,[{key:"logContext",get:function(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),oe(this))}},{key:"currentBitrate",get:function(){return this._currentBitrate}},{key:"mediaStreamTrack",get:function(){return this._mediaStreamTrack}},{key:"mediaStreamID",get:function(){return this._mediaStreamID}},{key:"attach",value:function(e){var n=this,a="audio";this.kind===t.Kind.Video&&(a="video"),this.attachedElements.length===0&&this.kind===t.Kind.Video&&this.addAppVisibilityListener(),e||(a==="audio"&&(lt.forEach(function(o){o.parentElement===null&&!e&&(e=o)}),e&&lt.splice(lt.indexOf(e),1)),e||(e=document.createElement(a))),this.attachedElements.includes(e)||this.attachedElements.push(e),_n(this.mediaStreamTrack,e);var s=e.srcObject.getTracks(),u=s.some(function(o){return o.kind==="audio"});return e.play().then(function(){n.emit(u?_.AudioPlaybackStarted:_.VideoPlaybackStarted)}).catch(function(o){o.name==="NotAllowedError"?n.emit(u?_.AudioPlaybackFailed:_.VideoPlaybackFailed,o):o.name==="AbortError"?x.debug("".concat(u?"audio":"video"," playback aborted, likely due to new play request")):x.warn("could not playback ".concat(u?"audio":"video"),o),u&&e&&s.some(function(c){return c.kind==="video"})&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(function(){}))}),this.emit(_.ElementAttached,e),e}},{key:"detach",value:function(e){var n=this;try{if(e){Hn(this.mediaStreamTrack,e);var a=this.attachedElements.indexOf(e);return a>=0&&(this.attachedElements.splice(a,1),this.recycleElement(e),this.emit(_.ElementDetached,e)),e}var s=[];return this.attachedElements.forEach(function(u){Hn(n.mediaStreamTrack,u),s.push(u),n.recycleElement(u),n.emit(_.ElementDetached,u)}),this.attachedElements=[],s}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}},{key:"stop",value:function(){this.stopMonitor(),this._mediaStreamTrack.stop()}},{key:"enable",value:function(){this._mediaStreamTrack.enabled=!0}},{key:"disable",value:function(){this._mediaStreamTrack.enabled=!1}},{key:"stopMonitor",value:function(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}},{key:"updateLoggerOptions",value:function(e){e.loggerName&&(this.log=ln(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}},{key:"recycleElement",value:function(e){if(e instanceof HTMLAudioElement){var n=!0;e.pause(),lt.forEach(function(a){a.parentElement||(n=!1)}),n&&lt.push(e)}}},{key:"handleAppVisibilityChanged",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this;return v().w(function(a){for(;;)switch(a.n){case 0:this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===t.Kind.Video&&setTimeout(function(){return n.attachedElements.forEach(function(s){return s.play().catch(function(){})})},0);case 1:return a.a(2)}},e,this)}))}},{key:"addAppVisibilityListener",value:function(){Ie()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}},{key:"removeAppVisibilityListener",value:function(){Ie()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}])}(en.EventEmitter);function _n(r,t){var i;t.srcObject instanceof MediaStream?i=t.srcObject:i=new MediaStream;var e;r.kind==="audio"?e=i.getAudioTracks():e=i.getVideoTracks(),e.includes(r)||(e.forEach(function(n){i.removeTrack(n)}),i.addTrack(r)),(!yn()||!(t instanceof HTMLVideoElement))&&(t.autoplay=!0),t.muted=i.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==i&&(t.srcObject=i,(yn()||xn())&&t instanceof HTMLVideoElement&&setTimeout(function(){t.srcObject=i,t.play().catch(function(){})},0))}function Hn(r,t){if(t.srcObject instanceof MediaStream){var i=t.srcObject;i.removeTrack(r),i.getTracks().length>0?t.srcObject=i:t.srcObject=null}}(function(r){var t;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(t=r.Kind||(r.Kind={}));var i;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(i=r.Source||(r.Source={}));var e;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(e=r.StreamState||(r.StreamState={}));function n(c){switch(c){case t.Audio:return Se.AUDIO;case t.Video:return Se.VIDEO;default:return Se.DATA}}r.kindToProto=n;function a(c){switch(c){case Se.AUDIO:return t.Audio;case Se.VIDEO:return t.Video;default:return t.Unknown}}r.kindFromProto=a;function s(c){switch(c){case i.Camera:return de.CAMERA;case i.Microphone:return de.MICROPHONE;case i.ScreenShare:return de.SCREEN_SHARE;case i.ScreenShareAudio:return de.SCREEN_SHARE_AUDIO;default:return de.UNKNOWN}}r.sourceToProto=s;function u(c){switch(c){case de.CAMERA:return i.Camera;case de.MICROPHONE:return i.Microphone;case de.SCREEN_SHARE:return i.ScreenShare;case de.SCREEN_SHARE_AUDIO:return i.ScreenShareAudio;default:return i.Unknown}}r.sourceFromProto=u;function o(c){switch(c){case In.ACTIVE:return e.Active;case In.PAUSED:return e.Paused;default:return e.Unknown}}r.streamStateFromProto=o})(L||(L={}));function Oo(r,t,i){var e,n,a,s,u,o=ha(r??{}),c=o.optionsWithoutProcessor,l=o.audioProcessor,d=o.videoProcessor,f=(e=zc(c))!==null&&e!==void 0?e:{};return f.audio===!0&&(f.audio={}),f.video===!0&&(f.video={}),f.audio&&(Vr(f.audio,t),(n=(s=f.audio).deviceId)!==null&&n!==void 0||(s.deviceId="default"),l&&(f.audio.processor=l)),f.video&&(Vr(f.video,i),(a=(u=f.video).deviceId)!==null&&a!==void 0||(u.deviceId="default"),d&&(f.video.processor=d)),f}function Vr(r,t){return Object.keys(t).forEach(function(i){r[i]===void 0&&(r[i]=t[i])}),r}function or(r){var t,i,e,n,a={};if(r.video)if(V(r.video)==="object"){var s={},u=s,o=r.video;Object.keys(o).forEach(function(c){switch(c){case"resolution":Vr(u,o.resolution);break;default:u[c]=o[c]}}),a.video=s,(t=(e=a.video).deviceId)!==null&&t!==void 0||(e.deviceId="default")}else a.video=r.video?{deviceId:"default"}:!1;else a.video=!1;return r.audio?V(r.audio)==="object"?(a.audio=r.audio,(i=(n=a.audio).deviceId)!==null&&i!==void 0||(n.deviceId="default")):a.audio={deviceId:"default"}:a.audio=!1,a}function Qc(r){return b(this,arguments,void 0,function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return v().m(function e(){var n,a,s,u,o,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(n=fa(),!n){l.n=2;break}return a=n.createAnalyser(),a.fftSize=2048,s=a.frequencyBinCount,u=new Uint8Array(s),o=n.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])),o.connect(a),l.n=1,Ge(i);case 1:return a.getByteTimeDomainData(u),c=u.some(function(d){return d!==128&&d!==0}),n.close(),l.a(2,!c);case 2:return l.a(2,!1)}},e)})()})}function fa(){var r=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(r)return new r({latencyHint:"interactive"})}function Qa(r){return r===L.Source.Microphone?"audioinput":r===L.Source.Camera?"videoinput":void 0}function Yc(r){var t,i,e=(t=r.video)!==null&&t!==void 0?t:!0;return r.resolution&&r.resolution.width>0&&r.resolution.height>0&&(e=typeof e=="boolean"?{}:e,yn()?e=Object.assign(Object.assign({},e),{width:{max:r.resolution.width},height:{max:r.resolution.height},frameRate:r.resolution.frameRate}):e=Object.assign(Object.assign({},e),{width:{ideal:r.resolution.width},height:{ideal:r.resolution.height},frameRate:r.resolution.frameRate})),{audio:(i=r.audio)!==null&&i!==void 0?i:!1,video:e,controller:r.controller,selfBrowserSurface:r.selfBrowserSurface,surfaceSwitching:r.surfaceSwitching,systemAudio:r.systemAudio,preferCurrentTab:r.preferCurrentTab}}function di(r){return r.split("/")[1].toLowerCase()}function Xc(r){var t=[];return r.forEach(function(i){i.track!==void 0&&t.push(new rt({cid:i.track.mediaStreamID,track:i.trackInfo}))}),t}function oe(r){return r instanceof L?{trackID:r.sid,source:r.source,muted:r.isMuted,enabled:r.mediaStreamTrack.enabled,kind:r.kind,streamID:r.mediaStreamID,streamTrackID:r.mediaStreamTrack.id}:{trackID:r.trackSid,enabled:r.isEnabled,muted:r.isMuted,trackInfo:Object.assign({mimeType:r.mimeType,name:r.trackName,encrypted:r.isEncrypted,kind:r.kind,source:r.source},r.track?oe(r.track):{})}}function Zc(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function ha(r){var t=Object.assign({},r),i,e;return V(t.audio)==="object"&&t.audio.processor&&(i=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),V(t.video)==="object"&&t.video.processor&&(e=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:i,videoProcessor:e,optionsWithoutProcessor:t}}function xc(r,t){var i,e=[].concat(Ue(Object.keys(t)),Ue(Object.keys(r))),n={},a=$(e),s;try{for(a.s();!(s=a.n()).done;){var u=s.value;r[u]!==t[u]&&(n[u]=(i=t[u])!==null&&i!==void 0?i:"")}}catch(o){a.e(o)}finally{a.f()}return n}var el="|",Ya="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function nl(r){var t=r.split(el);return t.length>1?[t[0],r.substr(t[0].length+1)]:[r,""]}function Ge(r){return b(this,void 0,void 0,v().m(function t(){return v().w(function(i){for(;;)switch(i.n){case 0:return i.a(2,new Promise(function(e){return ye.setTimeout(e,r)}))}},t)}))}function Hr(){return"addTransceiver"in RTCPeerConnection.prototype}function Wr(){return"addTrack"in RTCPeerConnection.prototype}function No(){if(!("getCapabilities"in RTCRtpSender)||yn())return!1;var r=RTCRtpSender.getCapabilities("video"),t=!1;if(r){var i=$(r.codecs),e;try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.mimeType==="video/AV1"){t=!0;break}}}catch(a){i.e(a)}finally{i.f()}}return t}function Do(){if(!("getCapabilities"in RTCRtpSender)||xn())return!1;if(yn()){var r=xe();if(r!=null&&r.version&&et(r.version,"16")<0)return!1}var t=RTCRtpSender.getCapabilities("video"),i=!1;if(t){var e=$(t.codecs),n;try{for(e.s();!(n=e.n()).done;){var a=n.value;if(a.mimeType==="video/VP9"){i=!0;break}}}catch(s){e.e(s)}finally{e.f()}}return i}function kt(r){return r==="av1"||r==="vp9"}function Gr(r){return document?(r||(r=document.createElement("audio")),"setSinkId"in r):!1}function tl(){return typeof RTCPeerConnection>"u"?!1:Hr()||Wr()}function xn(){var r;return((r=xe())===null||r===void 0?void 0:r.name)==="Firefox"}function yn(){var r;return((r=xe())===null||r===void 0?void 0:r.name)==="Safari"}function il(){var r=xe();return(r==null?void 0:r.name)==="Safari"&&r.version.startsWith("17.")}function Ao(){var r,t;return Ie()?(t=(r=navigator.userAgentData)===null||r===void 0?void 0:r.mobile)!==null&&t!==void 0?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function rl(){var r=xe(),t="17.2";if(r)return r.name!=="Safari"&&r.os!=="iOS"||r.os==="iOS"&&r.osVersion&&et(t,r.osVersion)>=0?!0:r.name==="Safari"&&et(t,r.version)>=0}function Ie(){return typeof document<"u"}function dn(){return navigator.product=="ReactNative"}function Kr(r){return r.hostname.endsWith(".livekit.cloud")||r.hostname.endsWith(".livekit.run")}function Lo(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Mo(){if(dn()){var r=Lo();if(r)return r.platform}}function Xa(){if(Ie())return window.devicePixelRatio;if(dn()){var r=Lo();if(r)return r.devicePixelRatio}return 1}function et(r,t){for(var i=r.split("."),e=t.split("."),n=Math.min(i.length,e.length),a=0;a<n;++a){var s=parseInt(i[a],10),u=parseInt(e[a],10);if(s>u)return 1;if(s<u)return-1;if(a===n-1&&s===u)return 0}return r===""&&t!==""?-1:t===""?1:i.length==e.length?0:i.length<e.length?-1:1}function al(r){var t=$(r),i;try{for(t.s();!(i=t.n()).done;){var e=i.value;e.target.handleResize(e)}}catch(n){t.e(n)}finally{t.f()}}function sl(r){var t=$(r),i;try{for(t.s();!(i=t.n()).done;){var e=i.value;e.target.handleVisibilityChanged(e)}}catch(n){t.e(n)}finally{t.f()}}var vr=null,Za=function(){return vr||(vr=new ResizeObserver(al)),vr},pr=null,xa=function(){return pr||(pr=new IntersectionObserver(sl,{root:null,rootMargin:"0px"})),pr};function ol(){var r,t=new Ei({sdk:Yn.JS,protocol:Hc,version:Vc});return dn()&&(t.os=(r=Mo())!==null&&r!==void 0?r:""),t}function es(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,n=document.createElement("canvas");n.width=r,n.height=t;var a=n.getContext("2d");a==null||a.fillRect(0,0,n.width,n.height),e&&a&&(a.beginPath(),a.arc(r/2,t/2,50,0,Math.PI*2,!0),a.closePath(),a.fillStyle="grey",a.fill());var s=n.captureStream(),u=s.getTracks(),o=te(u,1),c=o[0];if(!c)throw Error("Could not get empty media stream video track");return c.enabled=i,c}var dt;function gr(){if(!dt){var r=new AudioContext,t=r.createOscillator(),i=r.createGain();i.gain.setValueAtTime(0,0);var e=r.createMediaStreamDestination();t.connect(i),i.connect(e),t.start();var n=e.stream.getAudioTracks(),a=te(n,1);if(dt=a[0],!dt)throw Error("Could not get empty media stream audio track");dt.enabled=!1}return dt.clone()}var Uo=E(function r(t,i){var e=this;P(this,r),this.onFinally=i,this.promise=new Promise(function(n,a){return b(e,void 0,void 0,v().m(function s(){return v().w(function(u){for(;;)switch(u.n){case 0:if(this.resolve=n,this.reject=a,!t){u.n=1;break}return u.n=1,t(n,a);case 1:return u.a(2)}},s,this)}))}).finally(function(){var n;return(n=e.onFinally)===null||n===void 0?void 0:n.call(e)})});function ul(r,t){var i=this,e=Object.assign({cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80},t),n=fa();if(!n)throw new Error("Audio Context not supported on this browser");var a=e.cloneTrack?r.mediaStreamTrack.clone():r.mediaStreamTrack,s=n.createMediaStreamSource(new MediaStream([a])),u=n.createAnalyser();u.minDecibels=e.minDecibels,u.maxDecibels=e.maxDecibels,u.fftSize=e.fftSize,u.smoothingTimeConstant=e.smoothingTimeConstant,s.connect(u);var o=new Uint8Array(u.frequencyBinCount),c=function(){u.getByteFrequencyData(o);var f=0,h=$(o),p;try{for(h.s();!(p=h.n()).done;){var g=p.value;f+=Math.pow(g/255,2)}}catch(y){h.e(y)}finally{h.f()}var k=Math.sqrt(f/o.length);return k},l=function(){return b(i,void 0,void 0,v().m(function f(){return v().w(function(h){for(;;)switch(h.n){case 0:return h.n=1,n.close();case 1:e.cloneTrack&&a.stop();case 2:return h.a(2)}},f)}))};return{calculateVolume:c,analyser:u,cleanup:l}}var Me=function(){function r(){P(this,r),this._locking=Promise.resolve(),this._locks=0}return E(r,[{key:"isLocked",value:function(){return this._locks>0}},{key:"lock",value:function(){var i=this;this._locks+=1;var e,n=new Promise(function(s){return e=function(){i._locks-=1,s()}}),a=this._locking.then(function(){return e});return this._locking=this._locking.then(function(){return n}),a}}])}();function cl(r){return Gc.includes(r)}function Cn(r){if(typeof r=="string"||typeof r=="number")return r;if(Array.isArray(r))return r[0];if(r.exact)return Array.isArray(r.exact)?r.exact[0]:r.exact;if(r.ideal)return Array.isArray(r.ideal)?r.ideal[0]:r.ideal;throw Error("could not unwrap constraint")}function ll(r){return r.startsWith("http")?r.replace(/^(http)/,"ws"):r}function ns(r){return r.startsWith("ws")?r.replace(/^(ws)/,"http"):r}function dl(r,t){return r.segments.map(function(i){var e=i.id,n=i.text,a=i.startTime,s=i.endTime,u=i.final,o=i.language,c=i.error,l=i.failureReason,d,f=(d=t.get(e))!==null&&d!==void 0?d:Date.now(),h=Date.now();return u?t.delete(e):t.set(e,f),{id:e,text:n,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(s.toString()),final:u,language:o,firstReceivedTime:f,lastReceivedTime:h,error:c,failureReason:l}})}function fl(r){var t=r.id,i=r.timestamp,e=r.message,n=r.editTimestamp;return{id:t,timestamp:Number.parseInt(i.toString()),editTimestamp:n?Number.parseInt(n.toString()):void 0,message:e}}function ts(r){switch(r.reason){case 4:return r.context;case 3:return Ce.CLIENT_INITIATED;case 0:return Ce.USER_REJECTED;case 1:return Ce.JOIN_FAILURE;default:return Ce.UNKNOWN_REASON}}var kr="default",We=function(){function r(){P(this,r),this._previousDevices=[]}return E(r,[{key:"previousDevices",get:function(){return this._previousDevices}},{key:"getDevices",value:function(i){return b(this,arguments,void 0,function(e){var n=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return v().m(function s(){var u,o,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:if(!(((u=r.userMediaPromiseMap)===null||u===void 0?void 0:u.size)>0)){f.n=6;break}if(x.debug("awaiting getUserMedia promise"),f.p=1,!e){f.n=3;break}return f.n=2,r.userMediaPromiseMap.get(e);case 2:f.n=4;break;case 3:return f.n=4,Promise.all(r.userMediaPromiseMap.values());case 4:f.n=6;break;case 5:f.p=5,f.v,x.warn("error waiting for media permissons");case 6:return f.n=7,navigator.mediaDevices.enumerateDevices();case 7:if(o=f.v,!(a&&!(yn()&&n.hasDeviceInUse(e)))){f.n=10;break}if(c=o.filter(function(h){return h.kind===e}).length===0||o.some(function(h){var p=h.label==="",g=e?h.kind===e:!0;return p&&g}),!c){f.n=10;break}return l={video:e!=="audioinput"&&e!=="audiooutput",audio:e!=="videoinput"&&{deviceId:"default"}},f.n=8,navigator.mediaDevices.getUserMedia(l);case 8:return d=f.v,f.n=9,navigator.mediaDevices.enumerateDevices();case 9:o=f.v,d.getTracks().forEach(function(h){h.stop()});case 10:return n._previousDevices=o,e&&(o=o.filter(function(h){return h.kind===e})),f.a(2,o)}},s,null,[[1,5]])})()})}},{key:"normalizeDeviceId",value:function(i,e,n){return b(this,void 0,void 0,v().m(function a(){var s,u,o;return v().w(function(c){for(;;)switch(c.n){case 0:if(e===kr){c.n=1;break}return c.a(2,e);case 1:return c.n=2,this.getDevices(i);case 2:if(s=c.v,u=s.find(function(l){return l.deviceId===kr}),u){c.n=3;break}return x.warn("could not reliably determine default device"),c.a(2,void 0);case 3:if(o=s.find(function(l){return l.deviceId!==kr&&l.groupId===(n??u.groupId)}),o){c.n=4;break}return x.warn("could not reliably determine default device"),c.a(2,void 0);case 4:return c.a(2,o==null?void 0:o.deviceId)}},a,this)}))}},{key:"hasDeviceInUse",value:function(i){return i?r.userMediaPromiseMap.has(i):r.userMediaPromiseMap.size>0}}],[{key:"getInstance",value:function(){return this.instance===void 0&&(this.instance=new r),this.instance}}])}();We.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];We.userMediaPromiseMap=new Map;var hl=1e3,Wn=function(r){function t(i,e,n){var a,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,u=arguments.length>4?arguments[4]:void 0;return P(this,t),a=O(this,t,[i,e,u]),a.manuallyStopped=!1,a._isUpstreamPaused=!1,a.handleTrackMuteEvent=function(){return a.debouncedTrackMuteHandler().catch(function(){return a.log.debug("track mute bounce got cancelled by an unmute event",a.logContext)})},a.debouncedTrackMuteHandler=da(function(){return b(a,void 0,void 0,v().m(function o(){return v().w(function(c){for(;;)switch(c.n){case 0:return c.n=1,this.pauseUpstream();case 1:return c.a(2)}},o,this)}))},5e3),a.handleTrackUnmuteEvent=function(){return b(a,void 0,void 0,v().m(function o(){return v().w(function(c){for(;;)switch(c.n){case 0:return this.debouncedTrackMuteHandler.cancel("unmute"),c.n=1,this.resumeUpstream();case 1:return c.a(2)}},o,this)}))},a.handleEnded=function(){a.isInBackground&&(a.reacquireTrack=!0),a._mediaStreamTrack.removeEventListener("mute",a.handleTrackMuteEvent),a._mediaStreamTrack.removeEventListener("unmute",a.handleTrackUnmuteEvent),a.emit(_.Ended,a)},a.reacquireTrack=!1,a.providedByUser=s,a.muteLock=new Me,a.pauseUpstreamLock=new Me,a.processorLock=new Me,a.restartLock=new Me,a.setMediaStreamTrack(i,!0),a._constraints=i.getConstraints(),n&&(a._constraints=n),a}return N(t,r),E(t,[{key:"sender",get:function(){return this._sender},set:function(e){this._sender=e}},{key:"constraints",get:function(){return this._constraints}},{key:"id",get:function(){return this._mediaStreamTrack.id}},{key:"dimensions",get:function(){if(this.kind===L.Kind.Video){var e=this._mediaStreamTrack.getSettings(),n=e.width,a=e.height;if(n&&a)return{width:n,height:a}}}},{key:"isUpstreamPaused",get:function(){return this._isUpstreamPaused}},{key:"isUserProvided",get:function(){return this.providedByUser}},{key:"mediaStreamTrack",get:function(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}},{key:"getSourceTrackSettings",value:function(){return this._mediaStreamTrack.getSettings()}},{key:"setMediaStreamTrack",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s=this,u,o;return v().w(function(c){for(;;)switch(c.n){case 0:if(!(e===this._mediaStreamTrack&&!n)){c.n=1;break}return c.a(2);case 1:if(this._mediaStreamTrack&&(this.attachedElements.forEach(function(l){Hn(s._mediaStreamTrack,l)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),!(this.processor&&e)){c.n=7;break}return c.n=2,this.processorLock.lock();case 2:if(o=c.v,c.p=3,this.log.debug("restarting processor",this.logContext),this.kind!=="unknown"){c.n=4;break}throw TypeError("cannot set processor on track of unknown kind");case 4:return this.processorElement&&(_n(e,this.processorElement),this.processorElement.muted=!0),c.n=5,this.processor.restart({track:e,kind:this.kind,element:this.processorElement});case 5:u=this.processor.processedTrack;case 6:return c.p=6,o(),c.f(6);case 7:if(!this.sender){c.n=8;break}return c.n=8,this.sender.replaceTrack(u??e);case 8:if(!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,!e){c.n=10;break}return this._mediaStreamTrack.enabled=!this.isMuted,c.n=9,this.resumeUpstream();case 9:this.attachedElements.forEach(function(l){_n(u??e,l)});case 10:return c.a(2)}},a,this,[[3,,6,7]])}))}},{key:"waitForDimensions",value:function(){return b(this,arguments,void 0,function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:hl;return v().m(function a(){var s,u,o;return v().w(function(c){for(;;)switch(c.n){case 0:if(e.kind!==L.Kind.Audio){c.n=1;break}throw new Error("cannot get dimensions for audio tracks");case 1:if(((s=xe())===null||s===void 0?void 0:s.os)!=="iOS"){c.n=2;break}return c.n=2,Ge(10);case 2:u=Date.now();case 3:if(!(Date.now()-u<n)){c.n=6;break}if(o=e.dimensions,!o){c.n=4;break}return c.a(2,o);case 4:return c.n=5,Ge(50);case 5:c.n=3;break;case 6:throw new sn("unable to get track dimensions after timeout");case 7:return c.a(2)}},a)})()})}},{key:"setDeviceId",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(!(this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Cn(e))){a.n=1;break}return a.a(2,!0);case 1:if(this._constraints.deviceId=e,!this.isMuted){a.n=2;break}return a.a(2,!0);case 2:return a.n=3,this.restartTrack();case 3:return a.a(2,Cn(e)===this._mediaStreamTrack.getSettings().deviceId)}},n,this)}))}},{key:"getDeviceId",value:function(){return b(this,arguments,void 0,function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return v().m(function a(){var s,u,o,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(e.source!==L.Source.ScreenShare){l.n=1;break}return l.a(2);case 1:return s=e._mediaStreamTrack.getSettings(),u=s.deviceId,o=s.groupId,c=e.kind===L.Kind.Audio?"audioinput":"videoinput",l.a(2,n?We.getInstance().normalizeDeviceId(c,u,o):u)}},a)})()})}},{key:"mute",value:function(){return b(this,void 0,void 0,v().m(function e(){return v().w(function(n){for(;;)switch(n.n){case 0:return this.setTrackMuted(!0),n.a(2,this)}},e,this)}))}},{key:"unmute",value:function(){return b(this,void 0,void 0,v().m(function e(){return v().w(function(n){for(;;)switch(n.n){case 0:return this.setTrackMuted(!1),n.a(2,this)}},e,this)}))}},{key:"replaceTrack",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s,u;return v().w(function(o){for(;;)switch(o.n){case 0:if(this.sender){o.n=1;break}throw new sn("unable to replace an unpublished track");case 1:return typeof n=="boolean"?s=n:n!==void 0&&(s=n.userProvidedTrack,u=n.stopProcessor),this.providedByUser=s??!0,this.log.debug("replace MediaStreamTrack",this.logContext),o.n=2,this.setMediaStreamTrack(e);case 2:if(!(u&&this.processor)){o.n=3;break}return o.n=3,this.stopProcessor();case 3:return o.a(2,this)}},a,this)}))}},{key:"restart",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,u,o,c;return v().w(function(l){for(;;)switch(l.n){case 0:return this.manuallyStopped=!1,l.n=1,this.restartLock.lock();case 1:return s=l.v,l.p=2,e||(e=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e})),u={audio:!1,video:!1},this.kind===L.Kind.Video?u.video=e:u.audio=e,this.attachedElements.forEach(function(d){Hn(a.mediaStreamTrack,d)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop(),l.n=3,navigator.mediaDevices.getUserMedia(u);case 3:return o=l.v,c=o.getTracks()[0],c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),l.n=4,this.setMediaStreamTrack(c);case 4:return this._constraints=e,this.emit(_.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),l.a(2,this);case 5:return l.p=5,s(),l.f(5);case 6:return l.a(2)}},n,this,[[2,,5,6]])}))}},{key:"setTrackMuted",value:function(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?_.Muted:_.Unmuted,this))}},{key:"needsReAcquisition",get:function(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}},{key:"handleAppVisibilityChanged",value:function(){var e=this,n=Object.create(null,{handleAppVisibilityChanged:{get:function(){return X(t,"handleAppVisibilityChanged",e,1)}}});return b(this,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,n.handleAppVisibilityChanged.call(this);case 1:if(Ao()){s.n=2;break}return s.a(2);case 2:if(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!(!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted)){s.n=4;break}return this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),s.n=3,this.restart();case 3:this.reacquireTrack=!1;case 4:return s.a(2)}},a,this)}))}},{key:"stop",value:function(){var e;this.manuallyStopped=!0,X(t,"stop",this,3)([]),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}},{key:"pauseUpstream",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,this.pauseUpstreamLock.lock();case 1:if(n=s.v,s.p=2,this._isUpstreamPaused!==!0){s.n=3;break}return s.a(2);case 3:if(this.sender){s.n=4;break}return this.log.warn("unable to pause upstream for an unpublished track",this.logContext),s.a(2);case 4:if(this._isUpstreamPaused=!0,this.emit(_.UpstreamPaused,this),a=xe(),!((a==null?void 0:a.name)==="Safari"&&et(a.version,"12.0")<0)){s.n=5;break}throw new la("pauseUpstream is not supported on Safari < 12.");case 5:return s.n=6,this.sender.replaceTrack(null);case 6:return s.p=6,n(),s.f(6);case 7:return s.a(2)}},e,this,[[2,,6,7]])}))}},{key:"resumeUpstream",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,this.pauseUpstreamLock.lock();case 1:if(n=a.v,a.p=2,this._isUpstreamPaused!==!1){a.n=3;break}return a.a(2);case 3:if(this.sender){a.n=4;break}return this.log.warn("unable to resume upstream for an unpublished track",this.logContext),a.a(2);case 4:return this._isUpstreamPaused=!1,this.emit(_.UpstreamResumed,this),a.n=5,this.sender.replaceTrack(this.mediaStreamTrack);case 5:return a.p=5,n(),a.f(5);case 6:return a.a(2)}},e,this,[[2,,5,6]])}))}},{key:"getRTCStatsReport",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:if(!((n=this.sender)===null||n===void 0)&&n.getStats){s.n=1;break}return s.a(2);case 1:return s.n=2,this.sender.getStats();case 2:return a=s.v,s.a(2,a)}},e,this)}))}},{key:"setProcessor",value:function(e){return b(this,arguments,void 0,function(n){var a=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return v().m(function u(){var o,c,l,d,f,h,p;return v().w(function(g){for(;;)switch(g.n){case 0:return g.n=1,a.processorLock.lock();case 1:return l=g.v,g.p=2,a.log.debug("setting up processor",a.logContext),a.processorElement=(o=a.processorElement)!==null&&o!==void 0?o:document.createElement(a.kind),d={kind:a.kind,track:a._mediaStreamTrack,element:a.processorElement,audioContext:a.audioContext},g.n=3,n.init(d);case 3:if(!a.processor){g.n=4;break}return g.n=4,a.stopProcessor();case 4:if(a.kind!=="unknown"){g.n=5;break}throw TypeError("cannot set processor on track of unknown kind");case 5:if(_n(a._mediaStreamTrack,a.processorElement),a.processorElement.muted=!0,a.processorElement.play().catch(function(k){return a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{error:k}))}),a.processor=n,!a.processor.processedTrack){g.n=6;break}f=$(a.attachedElements);try{for(f.s();!(h=f.n()).done;)p=h.value,p!==a.processorElement&&s&&(Hn(a._mediaStreamTrack,p),_n(a.processor.processedTrack,p))}catch(k){f.e(k)}finally{f.f()}return g.n=6,(c=a.sender)===null||c===void 0?void 0:c.replaceTrack(a.processor.processedTrack);case 6:a.emit(_.TrackProcessorUpdate,a.processor);case 7:return g.p=7,l(),g.f(7);case 8:return g.a(2)}},u,null,[[2,,7,8]])})()})}},{key:"getProcessor",value:function(){return this.processor}},{key:"stopProcessor",value:function(){return b(this,arguments,void 0,function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return v().m(function a(){var s,u;return v().w(function(o){for(;;)switch(o.n){case 0:if(e.processor){o.n=1;break}return o.a(2);case 1:return e.log.debug("stopping processor",e.logContext),(s=e.processor.processedTrack)===null||s===void 0||s.stop(),o.n=2,e.processor.destroy();case 2:return e.processor=void 0,n||((u=e.processorElement)===null||u===void 0||u.remove(),e.processorElement=void 0),o.n=3,e._mediaStreamTrack.applyConstraints(e._constraints);case 3:return o.n=4,e.setMediaStreamTrack(e._mediaStreamTrack,!0);case 4:e.emit(_.TrackProcessorUpdate);case 5:return o.a(2)}},a)})()})}}])}(L),ml=function(r){function t(i){var e;return P(this,t),e=O(this,t),e.onWorkerMessage=function(n){var a,s,u=n.data,o=u.kind,c=u.data;switch(o){case"error":x.error(c.error.message),e.emit(mn.EncryptionError,c.error);break;case"initAck":c.enabled&&e.keyProvider.getKeys().forEach(function(d){e.postKey(d)});break;case"enable":if(c.enabled&&e.keyProvider.getKeys().forEach(function(d){e.postKey(d)}),e.encryptionEnabled!==c.enabled&&c.participantIdentity===((a=e.room)===null||a===void 0?void 0:a.localParticipant.identity))e.emit(mn.ParticipantEncryptionStatusChanged,c.enabled,e.room.localParticipant),e.encryptionEnabled=c.enabled;else if(c.participantIdentity){var l=(s=e.room)===null||s===void 0?void 0:s.getParticipantByIdentity(c.participantIdentity);if(!l)throw TypeError("couldn't set encryption status, participant not found".concat(c.participantIdentity));e.emit(mn.ParticipantEncryptionStatusChanged,c.enabled,l)}break;case"ratchetKey":e.keyProvider.emit(vn.KeyRatcheted,c.material,c.keyIndex);break}},e.onWorkerError=function(n){x.error("e2ee worker encountered an error:",{error:n.error}),e.emit(mn.EncryptionError,n.error)},e.keyProvider=i.keyProvider,e.worker=i.worker,e.encryptionEnabled=!1,e}return N(t,r),E(t,[{key:"setup",value:function(e){if(!Ac())throw new la("tried to setup end-to-end encryption on an unsupported browser");if(x.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);var n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:fc.getLevel()}};this.worker&&(x.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}},{key:"setParticipantCryptorEnabled",value:function(e,n){x.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}},{key:"setSifTrailer",value:function(e){!e||e.length===0?x.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}},{key:"setupEngine",value:function(e){var n=this;e.on(q.RTPVideoMapUpdate,function(a){n.postRTPMap(a)})}},{key:"setupEventListeners",value:function(e,n){var a=this;e.on(A.TrackPublished,function(s,u){return a.setParticipantCryptorEnabled(s.trackInfo.encryption!==pe.NONE,u.identity)}),e.on(A.ConnectionStateChanged,function(s){s===ee.Connected&&e.remoteParticipants.forEach(function(u){u.trackPublications.forEach(function(o){a.setParticipantCryptorEnabled(o.trackInfo.encryption!==pe.NONE,u.identity)})})}).on(A.TrackUnsubscribed,function(s,u,o){var c,l={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:s.mediaStreamID}};(c=a.worker)===null||c===void 0||c.postMessage(l)}).on(A.TrackSubscribed,function(s,u,o){a.setupE2EEReceiver(s,o.identity,u.trackInfo)}).on(A.SignalConnected,function(){if(!a.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(function(s){a.postKey(s)}),a.setParticipantCryptorEnabled(a.room.localParticipant.isE2EEEnabled,a.room.localParticipant.identity)}),e.localParticipant.on(F.LocalTrackPublished,function(s){return b(a,void 0,void 0,v().m(function u(){return v().w(function(o){for(;;)switch(o.n){case 0:this.setupE2EESender(s.track,s.track.sender);case 1:return o.a(2)}},u,this)}))}),n.on(vn.SetKey,function(s){return a.postKey(s)}).on(vn.RatchetRequest,function(s,u){return a.postRatchetRequest(s,u)})}},{key:"postRatchetRequest",value:function(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");var a={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(a)}},{key:"postKey",value:function(e){var n=e.key,a=e.participantIdentity,s=e.keyIndex,u;if(!this.worker)throw Error("could not set key, worker is missing");var o={kind:"setKey",data:{participantIdentity:a,isPublisher:a===((u=this.room)===null||u===void 0?void 0:u.localParticipant.identity),key:n,keyIndex:s}};this.worker.postMessage(o)}},{key:"postEnable",value:function(e,n){if(this.worker){var a={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(a)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}},{key:"postRTPMap",value:function(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");var a={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a)}},{key:"postSifTrailer",value:function(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");var n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}},{key:"setupE2EEReceiver",value:function(e,n,a){if(e.receiver){if(!(a!=null&&a.mimeType)||a.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?di(a.mimeType):void 0)}}},{key:"setupE2EESender",value:function(e,n){if(!(e instanceof Wn)||!n){n||x.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}},{key:"handleReceiver",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function u(){var o,c,l,d,f,h;return v().w(function(p){for(;;)switch(p.n){case 0:if(this.worker){p.n=1;break}return p.a(2);case 1:if(!Fr()){p.n=2;break}o={kind:"decode",participantIdentity:a,trackId:n,codec:s},e.transform=new RTCRtpScriptTransform(this.worker,o),p.n=4;break;case 2:if(!(Zt in e&&s)){p.n=3;break}return c={kind:"updateCodec",data:{trackId:n,codec:s,participantIdentity:a}},this.worker.postMessage(c),p.a(2);case 3:l=e.writableStream,d=e.readableStream,(!l||!d)&&(f=e.createEncodedStreams(),e.writableStream=f.writable,l=f.writable,e.readableStream=f.readable,d=f.readable),h={kind:"decode",data:{readableStream:d,writableStream:l,trackId:n,codec:s,participantIdentity:a}},this.worker.postMessage(h,[d,l]);case 4:e[Zt]=!0;case 5:return p.a(2)}},u,this)}))}},{key:"handleSender",value:function(e,n,a){var s;if(!(Zt in e||!this.worker)){if(!(!((s=this.room)===null||s===void 0)&&s.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Fr()){x.info("initialize script transform");var u={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:a};e.transform=new RTCRtpScriptTransform(this.worker,u)}else{x.info("initialize encoded streams");var o=e.createEncodedStreams(),c={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:a,trackId:n,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(c,[o.readable,o.writable])}e[Zt]=!0}}}])}(en.EventEmitter),yt;(function(r){r[r.WAITING=0]="WAITING",r[r.RUNNING=1]="RUNNING",r[r.COMPLETED=2]="COMPLETED"})(yt||(yt={}));var vl=function(){function r(){P(this,r),this.pendingTasks=new Map,this.taskMutex=new Me,this.nextTaskIndex=0}return E(r,[{key:"run",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:return n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:yt.WAITING},this.pendingTasks.set(n.id,n),s.n=1,this.taskMutex.lock();case 1:return a=s.v,s.p=2,n.executedAt=Date.now(),n.status=yt.RUNNING,s.n=3,i();case 3:return s.a(2,s.v);case 4:return s.p=4,n.status=yt.COMPLETED,this.pendingTasks.delete(n.id),a(),s.f(4);case 5:return s.a(2)}},e,this,[[2,,4,5]])}))}},{key:"flush",value:function(){return b(this,void 0,void 0,v().m(function i(){var e=this;return v().w(function(n){for(;;)switch(n.n){case 0:return n.a(2,this.run(function(){return b(e,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:return s.a(2)}},a)}))}))}},i,this)}))}},{key:"snapshot",value:function(){return Array.from(this.pendingTasks.values())}}])}(),pl=["syncState","trickle","offer","answer","simulate","leave"];function gl(r){var t=pl.indexOf(r.case)>=0;return x.trace("request allowed to bypass queue:",{canPass:t,req:r}),t}var ue;(function(r){r[r.CONNECTING=0]="CONNECTING",r[r.CONNECTED=1]="CONNECTED",r[r.RECONNECTING=2]="RECONNECTING",r[r.DISCONNECTING=3]="DISCONNECTING",r[r.DISCONNECTED=4]="DISCONNECTED"})(ue||(ue={}));var ma=function(){function r(){var t=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};P(this,r);var n;this.rtt=0,this.state=ue.DISCONNECTED,this.log=x,this._requestId=0,this.resetCallbacks=function(){t.onAnswer=void 0,t.onLeave=void 0,t.onLocalTrackPublished=void 0,t.onLocalTrackUnpublished=void 0,t.onNegotiateRequested=void 0,t.onOffer=void 0,t.onRemoteMuteChanged=void 0,t.onSubscribedQualityUpdate=void 0,t.onTokenRefresh=void 0,t.onTrickle=void 0,t.onClose=void 0},this.log=ln((n=e.loggerName)!==null&&n!==void 0?n:ze.Signal),this.loggerContextCb=e.loggerContextCb,this.useJSON=i,this.requestQueue=new vl,this.queuedRequests=[],this.closingLock=new Me,this.connectionLock=new Me,this.state=ue.DISCONNECTED}return E(r,[{key:"currentState",get:function(){return this.state}},{key:"isDisconnected",get:function(){return this.state===ue.DISCONNECTING||this.state===ue.DISCONNECTED}},{key:"isEstablishingConnection",get:function(){return this.state===ue.CONNECTING||this.state===ue.RECONNECTING}},{key:"getNextRequestId",value:function(){return this._requestId+=1,this._requestId}},{key:"logContext",get:function(){var i,e;return(e=(i=this.loggerContextCb)===null||i===void 0?void 0:i.call(this))!==null&&e!==void 0?e:{}}},{key:"join",value:function(i,e,n,a){return b(this,void 0,void 0,v().m(function s(){var u;return v().w(function(o){for(;;)switch(o.n){case 0:return this.state=ue.CONNECTING,this.options=n,o.n=1,this.connect(i,e,n,a);case 1:return u=o.v,o.a(2,u)}},s,this)}))}},{key:"reconnect",value:function(i,e,n,a){return b(this,void 0,void 0,v().m(function s(){var u;return v().w(function(o){for(;;)switch(o.n){case 0:if(this.options){o.n=1;break}return this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext),o.a(2);case 1:return this.state=ue.RECONNECTING,this.clearPingInterval(),o.n=2,this.connect(i,e,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:a}));case 2:return u=o.v,o.a(2,u)}},s,this)}))}},{key:"connect",value:function(i,e,n,a){var s=this;this.connectOptions=n,i=ll(i),i=i.replace(/\/$/,""),i+="/rtc";var u=ol(),o=kl(e,u,n);return new Promise(function(c,l){return b(s,void 0,void 0,v().m(function d(){var f=this,h,p,g;return v().w(function(k){for(;;)switch(k.n){case 0:return k.n=1,this.connectionLock.lock();case 1:if(h=k.v,k.p=2,p=function(){return b(f,void 0,void 0,v().m(function S(){return v().w(function(T){for(;;)switch(T.n){case 0:this.close(),clearTimeout(g),l(new se("room connection has been cancelled (signal)",3));case 1:return T.a(2)}},S,this)}))},g=setTimeout(function(){f.close(),l(new se("room connection has timed out (signal)",1))},n.websocketTimeout),a!=null&&a.aborted&&p(),a==null||a.addEventListener("abort",p),this.log.debug("connecting to ".concat(i+o),this.logContext),!this.ws){k.n=3;break}return k.n=3,this.close(!1);case 3:this.ws=new WebSocket(i+o),this.ws.binaryType="arraybuffer",this.ws.onopen=function(){clearTimeout(g)},this.ws.onerror=function(y){return b(f,void 0,void 0,v().m(function S(){var T,C;return v().w(function(w){for(;;)switch(w.n){case 0:if(this.state===ue.CONNECTED){w.n=8;break}return this.state=ue.DISCONNECTED,clearTimeout(g),w.p=1,w.n=2,fetch("http".concat(i.substring(2),"/validate").concat(o));case 2:if(T=w.v,!T.status.toFixed(0).startsWith("4")){w.n=4;break}return w.n=3,T.text();case 3:C=w.v,l(new se(C,0,T.status)),w.n=5;break;case 4:l(new se("Internal error",2,T.status));case 5:w.n=7;break;case 6:w.p=6,w.v,l(new se("server was not reachable",1));case 7:return w.a(2);case 8:this.handleWSError(y);case 9:return w.a(2)}},S,this,[[1,6]])}))},this.ws.onmessage=function(y){return b(f,void 0,void 0,v().m(function S(){var T,C,w,I,R,U;return v().w(function(M){for(;;)switch(M.n){case 0:if(typeof y.data!="string"){M.n=1;break}R=JSON.parse(y.data),I=Et.fromJson(R,{ignoreUnknownFields:!0}),M.n=3;break;case 1:if(!(y.data instanceof ArrayBuffer)){M.n=2;break}I=Et.fromBinary(new Uint8Array(y.data)),M.n=3;break;case 2:return this.log.error("could not decode websocket message: ".concat(V(y.data)),this.logContext),M.a(2);case 3:if(this.state===ue.CONNECTED){M.n=4;break}if(U=!1,((T=I.message)===null||T===void 0?void 0:T.case)==="join"?(this.state=ue.CONNECTED,a==null||a.removeEventListener("abort",p),this.pingTimeoutDuration=I.message.value.pingTimeout,this.pingIntervalDuration=I.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),c(I.message.value)):this.state===ue.RECONNECTING&&I.message.case!=="leave"?(this.state=ue.CONNECTED,a==null||a.removeEventListener("abort",p),this.startPingInterval(),((C=I.message)===null||C===void 0?void 0:C.case)==="reconnect"?c(I.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),c(void 0),U=!0)):this.isEstablishingConnection&&I.message.case==="leave"?l(new se("Received leave request while trying to (re)connect",4,void 0,I.message.value.reason)):n.reconnect||l(new se("did not receive join response, got ".concat((w=I.message)===null||w===void 0?void 0:w.case," instead"),2)),U){M.n=4;break}return M.a(2);case 4:if(!this.signalLatency){M.n=5;break}return M.n=5,Ge(this.signalLatency);case 5:this.handleSignalResponse(I);case 6:return M.a(2)}},S,this)}))},this.ws.onclose=function(y){f.isEstablishingConnection&&l(new se("Websocket got closed during a (re)connection attempt",2)),f.log.warn("websocket closed",Object.assign(Object.assign({},f.logContext),{reason:y.reason,code:y.code,wasClean:y.wasClean,state:f.state})),f.handleOnClose(y.reason)};case 4:return k.p=4,h(),k.f(4);case 5:return k.a(2)}},d,this,[[2,,4,5]])}))})}},{key:"close",value:function(){return b(this,arguments,void 0,function(){var i=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return v().m(function n(){var a,s;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,i.closingLock.lock();case 1:if(a=u.v,u.p=2,i.clearPingInterval(),e&&(i.state=ue.DISCONNECTING),!i.ws){u.n=4;break}if(i.ws.onmessage=null,i.ws.onopen=null,i.ws.onclose=null,s=new Promise(function(o){i.ws?i.ws.onclose=function(){o()}:o()}),!(i.ws.readyState<i.ws.CLOSING)){u.n=3;break}return i.ws.close(),u.n=3,Promise.race([s,Ge(250)]);case 3:i.ws=void 0;case 4:return u.p=4,e&&(i.state=ue.DISCONNECTED),a(),u.f(4);case 5:return u.a(2)}},n,null,[[2,,4,5]])})()})}},{key:"sendOffer",value:function(i){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:i.sdp})),this.sendRequest({case:"offer",value:pi(i)})}},{key:"sendAnswer",value:function(i){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:i.sdp})),this.sendRequest({case:"answer",value:pi(i)})}},{key:"sendIceCandidate",value:function(i,e){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:i})),this.sendRequest({case:"trickle",value:new tt({candidateInit:JSON.stringify(i),target:e})})}},{key:"sendMuteTrack",value:function(i,e){return this.log.debug("sending Mute Track req to server",Object.assign(Object.assign({},this.logContext),{trackSid:i,muted:e})),this.sendRequest({case:"mute",value:new it({sid:i,muted:e})})}},{key:"sendAddTrack",value:function(i){return this.log.debug("sending Add Track req to server",Object.assign(Object.assign({},this.logContext),{req:i})),this.sendRequest({case:"addTrack",value:i})}},{key:"sendUpdateLocalMetadata",value:function(i,e){return b(this,arguments,void 0,function(n,a){var s=this,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return v().m(function o(){var c;return v().w(function(l){for(;;)switch(l.n){case 0:return c=s.getNextRequestId(),l.n=1,s.sendRequest({case:"updateMetadata",value:new Ht({requestId:c,metadata:n,name:a,attributes:u})});case 1:return l.a(2,c)}},o)})()})}},{key:"sendUpdateTrackSettings",value:function(i){this.log.debug("sending Update Track setting req to server",Object.assign(Object.assign({},this.logContext),{settings:i})),this.sendRequest({case:"trackSetting",value:i})}},{key:"sendUpdateSubscription",value:function(i){return this.log.debug("sending Update Subscription req to server",Object.assign(Object.assign({},this.logContext),{sub:i})),this.sendRequest({case:"subscription",value:i})}},{key:"sendSyncState",value:function(i){return this.log.debug("sending sync state req to server",Object.assign(Object.assign({},this.logContext),{sync:i})),this.sendRequest({case:"syncState",value:i})}},{key:"sendUpdateVideoLayers",value:function(i,e){return this.log.debug("sending update video layer req to server",Object.assign(Object.assign({},this.logContext),{trackSid:i,layers:e})),this.sendRequest({case:"updateLayers",value:new Vt({trackSid:i,layers:e})})}},{key:"sendUpdateSubscriptionPermissions",value:function(i,e){return this.log.debug("sending update subscription permission req to server",Object.assign(Object.assign({},this.logContext),{allParticipants:i,trackPermissions:e})),this.sendRequest({case:"subscriptionPermission",value:new Kt({allParticipants:i,trackPermissions:e})})}},{key:"sendSimulateScenario",value:function(i){return this.log.debug("sending simulate scenario req to server",Object.assign(Object.assign({},this.logContext),{scenario:i})),this.sendRequest({case:"simulate",value:i})}},{key:"sendPing",value:function(){return this.log.debug("sending ping req to server",this.logContext),Promise.all([this.sendRequest({case:"ping",value:H.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Qt({timestamp:H.parse(Date.now()),rtt:H.parse(this.rtt)})})])}},{key:"sendUpdateLocalAudioTrack",value:function(i,e){return this.sendRequest({case:"updateAudioTrack",value:new jt({trackSid:i,features:e})})}},{key:"sendLeave",value:function(){return this.log.debug("sending leave req to server",this.logContext),this.sendRequest({case:"leave",value:new Nn({canReconnect:!1,reason:Ce.CLIENT_INITIATED,action:Xe.DISCONNECT})})}},{key:"sendRequest",value:function(i){return b(this,arguments,void 0,function(e){var n=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return v().m(function s(){var u,o;return v().w(function(c){for(;;)switch(c.n){case 0:if(n.log.debug("sending request  to server ",Object.assign(Object.assign({},n.logContext),{message:e})),u=!a&&!gl(e),!(u&&n.state===ue.RECONNECTING)){c.n=1;break}return n.queuedRequests.push(function(){return b(n,void 0,void 0,v().m(function l(){return v().w(function(d){for(;;)switch(d.n){case 0:return d.n=1,this.sendRequest(e,!0);case 1:return d.a(2)}},l,this)}))}),c.a(2);case 1:if(a){c.n=2;break}return c.n=2,n.requestQueue.flush();case 2:if(!n.signalLatency){c.n=3;break}return c.n=3,Ge(n.signalLatency);case 3:if(!(!n.ws||n.ws.readyState!==n.ws.OPEN)){c.n=4;break}return n.log.error("cannot send signal request before connected, type: ".concat(e==null?void 0:e.case),n.logContext),c.a(2);case 4:o=new Bi({message:e});try{n.useJSON?n.ws.send(o.toJsonString()):n.ws.send(o.toBinary())}catch(l){n.log.error("error sending signal message",Object.assign(Object.assign({},n.logContext),{error:l}))}case 5:return c.a(2)}},s)})()})}},{key:"handleSignalResponse",value:function(i){var e,n,a=i.message;if(a==null){this.log.debug("received unsupported message",this.logContext);return}var s=!1;if(a.case==="answer"){this.log.debug("the answer response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i}));var u=is(a.value);this.onAnswer&&this.onAnswer(u)}else if(a.case==="offer"){this.log.debug("the offer response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i}));var o=is(a.value);this.onOffer&&this.onOffer(o)}else if(a.case==="trickle"){this.log.debug("the trickle response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i}));var c=JSON.parse(a.value.candidateInit);this.onTrickle&&this.onTrickle(c,a.value.target)}else a.case==="update"?(this.log.debug("the update response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onParticipantUpdate&&this.onParticipantUpdate((e=a.value.participants)!==null&&e!==void 0?e:[])):a.case==="trackPublished"?(this.log.debug("the trackPublished response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onLocalTrackPublished&&this.onLocalTrackPublished(a.value)):a.case==="speakersChanged"?(this.log.debug("the speakersChanged response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onSpeakersChanged&&this.onSpeakersChanged((n=a.value.speakers)!==null&&n!==void 0?n:[])):a.case==="leave"?(this.log.debug("the leave response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onLeave&&this.onLeave(a.value)):a.case==="mute"?(this.log.debug("the mute response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onRemoteMuteChanged&&this.onRemoteMuteChanged(a.value.sid,a.value.muted)):a.case==="roomUpdate"?(this.log.debug("the roomUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onRoomUpdate&&a.value.room&&this.onRoomUpdate(a.value.room)):a.case==="connectionQuality"?(this.log.debug("the connectionQuality response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onConnectionQuality&&this.onConnectionQuality(a.value)):a.case==="streamStateUpdate"?(this.log.debug("the streamStateUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onStreamStateUpdate&&this.onStreamStateUpdate(a.value)):a.case==="subscribedQualityUpdate"?(this.log.debug("the subscribedQualityUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(a.value)):a.case==="subscriptionPermissionUpdate"?(this.log.debug("the subscriptionPermissionUpdate response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(a.value)):a.case==="refreshToken"?(this.log.debug("the refreshToken response from server is: ",Object.assign(Object.assign({},this.logContext),{response:i})),this.onTokenRefresh&&this.onTokenRefresh(a.value)):a.case==="trackUnpublished"?(this.log.debug("the trackUnpublished response from server is:",Object.assign(Object.assign({},this.logContext),{response:i})),this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(a.value)):a.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(a.value):a.case==="pong"||(a.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(a.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):a.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(a.value):a.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(a.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:a.case})));s||this.resetPingTimeout()}},{key:"setReconnected",value:function(){for(;this.queuedRequests.length>0;){var i=this.queuedRequests.shift();i&&this.requestQueue.run(i)}}},{key:"handleOnClose",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:if(this.state!==ue.DISCONNECTED){a.n=1;break}return a.a(2);case 1:return n=this.onClose,a.n=2,this.close();case 2:this.log.debug("websocket connection closed: ".concat(i),Object.assign(Object.assign({},this.logContext),{reason:i})),n&&n(i);case 3:return a.a(2)}},e,this)}))}},{key:"handleWSError",value:function(i){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:i}))}},{key:"resetPingTimeout",value:function(){var i=this;if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=ye.setTimeout(function(){i.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-i.pingTimeoutDuration*1e3).toUTCString()),i.logContext),i.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}},{key:"clearPingTimeout",value:function(){this.pingTimeout&&ye.clearTimeout(this.pingTimeout)}},{key:"startPingInterval",value:function(){var i=this;if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=ye.setInterval(function(){i.sendPing()},this.pingIntervalDuration*1e3)}},{key:"clearPingInterval",value:function(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&ye.clearInterval(this.pingInterval)}}])}();function is(r){var t={type:"offer",sdp:r.sdp};switch(r.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=r.type;break}return t}function pi(r){var t=new Ze({sdp:r.sdp,type:r.type});return t}function kl(r,t,i){var e,n=new URLSearchParams;return n.set("access_token",r),i.reconnect&&(n.set("reconnect","1"),i.sid&&n.set("sid",i.sid)),n.set("auto_subscribe",i.autoSubscribe?"1":"0"),n.set("sdk",dn()?"reactnative":"js"),n.set("version",t.version),n.set("protocol",t.protocol.toString()),t.deviceModel&&n.set("device_model",t.deviceModel),t.os&&n.set("os",t.os),t.osVersion&&n.set("os_version",t.osVersion),t.browser&&n.set("browser",t.browser),t.browserVersion&&n.set("browser_version",t.browserVersion),i.adaptiveStream&&n.set("adaptive_stream","1"),i.reconnectReason&&n.set("reconnect_reason",i.reconnectReason.toString()),!((e=navigator.connection)===null||e===void 0)&&e.type&&n.set("network",navigator.connection.type),"?".concat(n.toString())}var Bo={},Jo={exports:{}},rs=Jo.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var i="candidate:%s %d %s %d %s %d typ %s";return i+=t.raddr!=null?" raddr %s rport %d":"%v%v",i+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(i+=" generation %d"),i+=t["network-id"]!=null?" network-id %d":"%v",i+=t["network-cost"]!=null?" network-cost %d":"%v",i}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var i="ssrc:%d";return t.attribute!=null&&(i+=" %s",t.value!=null&&(i+=":%s")),i}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var i="mediaclk:";return i+=t.id!=null?"id=%s %s":"%v%s",i+=t.mediaClockValue!=null?"=%s":"",i+=t.rateNumerator!=null?" rate=%s":"",i+=t.rateDenominator!=null?"/%s":"",i}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(rs).forEach(function(r){var t=rs[r];t.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})});var Fo=Jo.exports;(function(r){var t=function(o){return String(Number(o))===o?Number(o):o},i=function(o,c,l,d){if(d&&!l)c[d]=t(o[1]);else for(var f=0;f<l.length;f+=1)o[f+1]!=null&&(c[l[f]]=t(o[f+1]))},e=function(o,c,l){var d=o.name&&o.names;o.push&&!c[o.push]?c[o.push]=[]:d&&!c[o.name]&&(c[o.name]={});var f=o.push?{}:d?c[o.name]:c;i(l.match(o.reg),f,o.names,o.name),o.push&&c[o.push].push(f)},n=Fo,a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(u){var o={},c=[],l=o;return u.split(/(\r\n|\r|\n)/).filter(a).forEach(function(d){var f=d[0],h=d.slice(2);f==="m"&&(c.push({rtp:[],fmtp:[]}),l=c[c.length-1]);for(var p=0;p<(n[f]||[]).length;p+=1){var g=n[f][p];if(g.reg.test(h))return e(g,l,h)}}),o.media=c,o};var s=function(o,c){var l=c.split(/=(.+)/,2);return l.length===2?o[l[0]]=t(l[1]):l.length===1&&c.length>1&&(o[l[0]]=void 0),o};r.parseParams=function(u){return u.split(/;\s?/).reduce(s,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(u){return u.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(u){for(var o=[],c=u.split(" ").map(t),l=0;l<c.length;l+=3)o.push({component:c[l],ip:c[l+1],port:c[l+2]});return o},r.parseImageAttributes=function(u){return u.split(" ").map(function(o){return o.substring(1,o.length-1).split(",").reduce(s,{})})},r.parseSimulcastStreamList=function(u){return u.split(";").map(function(o){return o.split(",").map(function(c){var l,d=!1;return c[0]!=="~"?l=t(c):(l=t(c.substring(1,c.length)),d=!0),{scid:l,paused:d}})})}})(Bo);var yr=Fo,yl=/%[sdv%]/g,bl=function(t){var i=1,e=arguments,n=e.length;return t.replace(yl,function(a){if(i>=n)return a;var s=e[i];switch(i+=1,a){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},ft=function(t,i,e){var n=i.format instanceof Function?i.format(i.push?e:e[i.name]):i.format,a=[t+"="+n];if(i.names)for(var s=0;s<i.names.length;s+=1){var u=i.names[s];i.name?a.push(e[i.name][u]):a.push(e[i.names[s]])}else a.push(e[i.name]);return bl.apply(null,a)},Sl=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Tl=["i","c","b","a"],Cl=function(t,i){i=i||{},t.version==null&&(t.version=0),t.name==null&&(t.name=" "),t.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var e=i.outerOrder||Sl,n=i.innerOrder||Tl,a=[];return e.forEach(function(s){yr[s].forEach(function(u){u.name in t&&t[u.name]!=null?a.push(ft(s,u,t)):u.push in t&&t[u.push]!=null&&t[u.push].forEach(function(o){a.push(ft(s,u,o))})})}),t.media.forEach(function(s){a.push(ft("m",yr.m[0],s)),n.forEach(function(u){yr[u].forEach(function(o){o.name in s&&s[o.name]!=null?a.push(ft(u,o,s)):o.push in s&&s[o.push]!=null&&s[o.push].forEach(function(c){a.push(ft(u,o,c))})})})}),a.join(`\r
`)+`\r
`},wl=Bo,Pl=Cl,br=Pl,vt=wl.parse,El=.7,Rl=20,Gn={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"},as=function(r){function t(i){var e,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};P(this,t);var a;return e=O(this,t),e.log=x,e.ddExtID=0,e.pendingCandidates=[],e.restartingIce=!1,e.renegotiate=!1,e.trackBitrates=[],e.remoteStereoMids=[],e.remoteNackMids=[],e.negotiate=da(function(s){return b(e,void 0,void 0,v().m(function u(){var o;return v().w(function(c){for(;;)switch(c.n){case 0:return this.emit(Gn.NegotiationStarted),c.p=1,c.n=2,this.createAndSendOffer();case 2:c.n=5;break;case 3:if(c.p=3,o=c.v,!s){c.n=4;break}s(o),c.n=5;break;case 4:throw o;case 5:return c.a(2)}},u,this,[[1,3]])}))},Rl),e.close=function(){e._pc&&(e._pc.close(),e._pc.onconnectionstatechange=null,e._pc.oniceconnectionstatechange=null,e._pc.onicegatheringstatechange=null,e._pc.ondatachannel=null,e._pc.onnegotiationneeded=null,e._pc.onsignalingstatechange=null,e._pc.onicecandidate=null,e._pc.ondatachannel=null,e._pc.ontrack=null,e._pc.onconnectionstatechange=null,e._pc.oniceconnectionstatechange=null,e._pc=null)},e.log=ln((a=n.loggerName)!==null&&a!==void 0?a:ze.PCTransport),e.loggerOptions=n,e.config=i,e._pc=e.createPC(),e}return N(t,r),E(t,[{key:"pc",get:function(){return this._pc||(this._pc=this.createPC()),this._pc}},{key:"createPC",value:function(){var e=this,n=new RTCPeerConnection(this.config);return n.onicecandidate=function(a){var s;a.candidate&&((s=e.onIceCandidate)===null||s===void 0||s.call(e,a.candidate))},n.onicecandidateerror=function(a){var s;(s=e.onIceCandidateError)===null||s===void 0||s.call(e,a)},n.oniceconnectionstatechange=function(){var a;(a=e.onIceConnectionStateChange)===null||a===void 0||a.call(e,n.iceConnectionState)},n.onsignalingstatechange=function(){var a;(a=e.onSignalingStatechange)===null||a===void 0||a.call(e,n.signalingState)},n.onconnectionstatechange=function(){var a;(a=e.onConnectionStateChange)===null||a===void 0||a.call(e,n.connectionState)},n.ondatachannel=function(a){var s;(s=e.onDataChannel)===null||s===void 0||s.call(e,a)},n.ontrack=function(a){var s;(s=e.onTrack)===null||s===void 0||s.call(e,a)},n}},{key:"logContext",get:function(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}},{key:"isICEConnected",get:function(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}},{key:"addIceCandidate",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(!(this.pc.remoteDescription&&!this.restartingIce)){a.n=1;break}return a.a(2,this.pc.addIceCandidate(e));case 1:this.pendingCandidates.push(e);case 2:return a.a(2)}},n,this)}))}},{key:"setRemoteDescription",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,u,o,c,l,d,f;return v().w(function(h){for(;;)switch(h.n){case 0:return u=void 0,e.type==="offer"?(o=Il(e),c=o.stereoMids,l=o.nackMids,this.remoteStereoMids=c,this.remoteNackMids=l):e.type==="answer"&&(d=vt((s=e.sdp)!==null&&s!==void 0?s:""),d.media.forEach(function(p){p.type==="audio"&&a.trackBitrates.some(function(g){if(!g.transceiver||p.mid!=g.transceiver.mid)return!1;var k=0;if(p.rtp.some(function(w){return w.codec.toUpperCase()===g.codec.toUpperCase()?(k=w.payload,!0):!1}),k===0)return!0;var y=!1,S=$(p.fmtp),T;try{for(S.s();!(T=S.n()).done;){var C=T.value;if(C.payload===k){C.config=C.config.split(";").filter(function(w){return!w.includes("maxaveragebitrate")}).join(";"),g.maxbr>0&&(C.config+=";maxaveragebitrate=".concat(g.maxbr*1e3)),y=!0;break}}}catch(w){S.e(w)}finally{S.f()}return y||g.maxbr>0&&p.fmtp.push({payload:k,config:"maxaveragebitrate=".concat(g.maxbr*1e3)}),!0})}),u=br(d)),h.n=1,this.setMungedSDP(e,u,!0);case 1:if(this.pendingCandidates.forEach(function(p){a.pc.addIceCandidate(p)}),this.pendingCandidates=[],this.restartingIce=!1,!this.renegotiate){h.n=3;break}return this.renegotiate=!1,h.n=2,this.createAndSendOffer();case 2:h.n=4;break;case 3:e.type==="answer"&&(this.emit(Gn.NegotiationComplete),e.sdp&&(f=vt(e.sdp),f.media.forEach(function(p){p.type==="video"&&a.emit(Gn.RTPVideoPayloadTypes,p.rtp)})));case 4:return h.a(2)}},n,this)}))}},{key:"createAndSendOffer",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,u,o,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(this.onOffer!==void 0){l.n=1;break}return l.a(2);case 1:if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),!(this._pc&&this._pc.signalingState==="have-local-offer")){l.n=5;break}if(u=this._pc.remoteDescription,!(e!=null&&e.iceRestart&&u)){l.n=3;break}return l.n=2,this._pc.setRemoteDescription(u);case 2:l.n=4;break;case 3:return this.renegotiate=!0,l.a(2);case 4:l.n=6;break;case 5:if(!(!this._pc||this._pc.signalingState==="closed")){l.n=6;break}return this.log.warn("could not createOffer with closed peer connection",this.logContext),l.a(2);case 6:return this.log.debug("starting to negotiate",this.logContext),l.n=7,this.pc.createOffer(e);case 7:return o=l.v,this.log.debug("original offer",Object.assign({sdp:o.sdp},this.logContext)),c=vt((s=o.sdp)!==null&&s!==void 0?s:""),c.media.forEach(function(d){os(d),d.type==="audio"?ss(d,[],[]):d.type==="video"&&a.trackBitrates.some(function(f){if(!d.msid||!f.cid||!d.msid.includes(f.cid))return!1;var h=0;if(d.rtp.some(function(S){return S.codec.toUpperCase()===f.codec.toUpperCase()?(h=S.payload,!0):!1}),h===0||(kt(f.codec)&&a.ensureVideoDDExtensionForSVC(d,c),f.codec!=="av1"))return!0;var p=Math.round(f.maxbr*El),g=$(d.fmtp),k;try{for(g.s();!(k=g.n()).done;){var y=k.value;if(y.payload===h){y.config.includes("x-google-start-bitrate")||(y.config+=";x-google-start-bitrate=".concat(p));break}}}catch(S){g.e(S)}finally{g.f()}return!0})}),l.n=8,this.setMungedSDP(o,br(c));case 8:this.onOffer(o);case 9:return l.a(2)}},n,this)}))}},{key:"createAndSetAnswer",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this,a,s,u;return v().w(function(o){for(;;)switch(o.n){case 0:return o.n=1,this.pc.createAnswer();case 1:return s=o.v,u=vt((a=s.sdp)!==null&&a!==void 0?a:""),u.media.forEach(function(c){os(c),c.type==="audio"&&ss(c,n.remoteStereoMids,n.remoteNackMids)}),o.n=2,this.setMungedSDP(s,br(u));case 2:return o.a(2,s)}},e,this)}))}},{key:"createDataChannel",value:function(e,n){return this.pc.createDataChannel(e,n)}},{key:"addTransceiver",value:function(e,n){return this.pc.addTransceiver(e,n)}},{key:"addTrack",value:function(e){if(!this._pc)throw new ve("PC closed, cannot add track");return this._pc.addTrack(e)}},{key:"setTrackCodecBitrate",value:function(e){this.trackBitrates.push(e)}},{key:"setConfiguration",value:function(e){var n;if(!this._pc)throw new ve("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}},{key:"canRemoveTrack",value:function(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}},{key:"removeTrack",value:function(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}},{key:"getConnectionState",value:function(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}},{key:"getICEConnectionState",value:function(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}},{key:"getSignallingState",value:function(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}},{key:"getTransceivers",value:function(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}},{key:"getSenders",value:function(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}},{key:"getLocalDescription",value:function(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}},{key:"getRemoteDescription",value:function(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}},{key:"getStats",value:function(){return this.pc.getStats()}},{key:"getConnectedAddress",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,u,o,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(this._pc){l.n=1;break}return l.a(2);case 1:return a="",s=new Map,u=new Map,l.n=2,this._pc.getStats();case 2:if(o=l.v,o.forEach(function(d){switch(d.type){case"transport":a=d.selectedCandidatePairId;break;case"candidate-pair":a===""&&d.selected&&(a=d.id),s.set(d.id,d);break;case"remote-candidate":u.set(d.id,"".concat(d.address,":").concat(d.port));break}}),a!==""){l.n=3;break}return l.a(2,void 0);case 3:if(c=(n=s.get(a))===null||n===void 0?void 0:n.remoteCandidateId,c!==void 0){l.n=4;break}return l.a(2,void 0);case 4:return l.a(2,u.get(c))}},e,this)}))}},{key:"setMungedSDP",value:function(e,n,a){return b(this,void 0,void 0,v().m(function s(){var u,o,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:if(!n){f.n=6;break}if(u=e.sdp,e.sdp=n,f.p=1,this.log.debug("setting munged ".concat(a?"remote":"local"," description"),this.logContext),!a){f.n=3;break}return f.n=2,this.pc.setRemoteDescription(e);case 2:f.n=4;break;case 3:return f.n=4,this.pc.setLocalDescription(e);case 4:return f.a(2);case 5:f.p=5,l=f.v,this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:l,sdp:n})),e.sdp=u;case 6:if(f.p=6,!a){f.n=8;break}return f.n=7,this.pc.setRemoteDescription(e);case 7:f.n=9;break;case 8:return f.n=9,this.pc.setLocalDescription(e);case 9:f.n=11;break;case 10:throw f.p=10,d=f.v,o="unknown error",d instanceof Error?o=d.message:typeof d=="string"&&(o=d),c={error:o,sdp:e.sdp},!a&&this.pc.remoteDescription&&(c.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:c})),new _r(o);case 11:return f.a(2)}},s,this,[[6,10],[1,5]])}))}},{key:"ensureVideoDDExtensionForSVC",value:function(e,n){var a,s,u=(a=e.ext)===null||a===void 0?void 0:a.some(function(c){return c.uri===Ya});if(!u){if(this.ddExtID===0){var o=0;n.media.forEach(function(c){var l;c.type==="video"&&((l=c.ext)===null||l===void 0||l.forEach(function(d){d.value>o&&(o=d.value)}))}),this.ddExtID=o+1}(s=e.ext)===null||s===void 0||s.push({value:this.ddExtID,uri:Ya})}}}])}(en.EventEmitter);function ss(r,t,i){var e=0;r.rtp.some(function(n){return n.codec==="opus"?(e=n.payload,!0):!1}),e>0&&(r.rtcpFb||(r.rtcpFb=[]),i.includes(r.mid)&&!r.rtcpFb.some(function(n){return n.payload===e&&n.type==="nack"})&&r.rtcpFb.push({payload:e,type:"nack"}),t.includes(r.mid)&&r.fmtp.some(function(n){return n.payload===e?(n.config.includes("stereo=1")||(n.config+=";stereo=1"),!0):!1}))}function Il(r){var t,i=[],e=[],n=vt((t=r.sdp)!==null&&t!==void 0?t:""),a=0;return n.media.forEach(function(s){var u;s.type==="audio"&&(s.rtp.some(function(o){return o.codec==="opus"?(a=o.payload,!0):!1}),!((u=s.rtcpFb)===null||u===void 0)&&u.some(function(o){return o.payload===a&&o.type==="nack"})&&e.push(s.mid),s.fmtp.some(function(o){return o.payload===a?(o.config.includes("sprop-stereo=1")&&i.push(s.mid),!0):!1}))}),{stereoMids:i,nackMids:e}}function os(r){if(r.connection){var t=r.connection.ip.indexOf(":")>=0;(r.connection.version===4&&t||r.connection.version===6&&!t)&&(r.connection.ip="0.0.0.0",r.connection.version=4)}}var zr="vp8",Ol={audioPreset:qr.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:sr.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:zr,backupCodec:!0},_o={deviceId:"default",autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},qo={deviceId:"default",resolution:Ve.h720.resolution},Nl={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new mc,disconnectOnPageLeave:!0,webAudioMix:!1},va={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3},ce;(function(r){r[r.NEW=0]="NEW",r[r.CONNECTING=1]="CONNECTING",r[r.CONNECTED=2]="CONNECTED",r[r.FAILED=3]="FAILED",r[r.CLOSING=4]="CLOSING",r[r.CLOSED=5]="CLOSED"})(ce||(ce={}));var Dl=function(){function r(t,i,e){var n=this;P(this,r);var a;this.peerConnectionTimeout=va.peerConnectionTimeout,this.log=x,this.updateState=function(){var s,u=n.state,o=n.requiredTransports.map(function(c){return c.getConnectionState()});o.every(function(c){return c==="connected"})?n.state=ce.CONNECTED:o.some(function(c){return c==="failed"})?n.state=ce.FAILED:o.some(function(c){return c==="connecting"})?n.state=ce.CONNECTING:o.every(function(c){return c==="closed"})?n.state=ce.CLOSED:o.some(function(c){return c==="closed"})?n.state=ce.CLOSING:o.every(function(c){return c==="new"})&&(n.state=ce.NEW),u!==n.state&&(n.log.debug("pc state change: from ".concat(ce[u]," to ").concat(ce[n.state]),n.logContext),(s=n.onStateChange)===null||s===void 0||s.call(n,n.state,n.publisher.getConnectionState(),n.subscriber.getConnectionState()))},this.log=ln((a=e.loggerName)!==null&&a!==void 0?a:ze.PCManager),this.loggerOptions=e,this.isPublisherConnectionRequired=!i,this.isSubscriberConnectionRequired=i,this.publisher=new as(t,e),this.subscriber=new as(t,e),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=function(s){var u;(u=n.onIceCandidate)===null||u===void 0||u.call(n,s,Te.PUBLISHER)},this.subscriber.onIceCandidate=function(s){var u;(u=n.onIceCandidate)===null||u===void 0||u.call(n,s,Te.SUBSCRIBER)},this.subscriber.onDataChannel=function(s){var u;(u=n.onDataChannel)===null||u===void 0||u.call(n,s)},this.subscriber.onTrack=function(s){var u;(u=n.onTrack)===null||u===void 0||u.call(n,s)},this.publisher.onOffer=function(s){var u;(u=n.onPublisherOffer)===null||u===void 0||u.call(n,s)},this.state=ce.NEW,this.connectionLock=new Me,this.remoteOfferLock=new Me}return E(r,[{key:"needsPublisher",get:function(){return this.isPublisherConnectionRequired}},{key:"needsSubscriber",get:function(){return this.isSubscriberConnectionRequired}},{key:"currentState",get:function(){return this.state}},{key:"logContext",get:function(){var i,e;return Object.assign({},(e=(i=this.loggerOptions).loggerContextCb)===null||e===void 0?void 0:e.call(i))}},{key:"requirePublisher",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=i,this.updateState()}},{key:"requireSubscriber",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=i,this.updateState()}},{key:"createAndSendPublisherOffer",value:function(i){return this.publisher.createAndSendOffer(i)}},{key:"setPublisherAnswer",value:function(i){return this.publisher.setRemoteDescription(i)}},{key:"removeTrack",value:function(i){return this.publisher.removeTrack(i)}},{key:"close",value:function(){return b(this,void 0,void 0,v().m(function i(){var e,n,a,s;return v().w(function(u){for(;;)switch(u.n){case 0:if(this.publisher&&this.publisher.getSignallingState()!=="closed"){e=this.publisher,n=$(e.getSenders());try{for(n.s();!(a=n.n()).done;){s=a.value;try{e.canRemoveTrack()&&e.removeTrack(s)}catch(o){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:o}))}}}catch(o){n.e(o)}finally{n.f()}}return u.n=1,Promise.all([this.publisher.close(),this.subscriber.close()]);case 1:this.updateState();case 2:return u.a(2)}},i,this)}))}},{key:"triggerIceRestart",value:function(){return b(this,void 0,void 0,v().m(function i(){return v().w(function(e){for(;;)switch(e.n){case 0:if(this.subscriber.restartingIce=!0,!this.needsPublisher){e.n=1;break}return e.n=1,this.createAndSendPublisherOffer({iceRestart:!0});case 1:return e.a(2)}},i,this)}))}},{key:"addIceCandidate",value:function(i,e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(e!==Te.PUBLISHER){a.n=2;break}return a.n=1,this.publisher.addIceCandidate(i);case 1:a.n=3;break;case 2:return a.n=3,this.subscriber.addIceCandidate(i);case 3:return a.a(2)}},n,this)}))}},{key:"createSubscriberAnswerFromOffer",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:return this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:i.type,sdp:i.sdp,signalingState:this.subscriber.getSignallingState().toString()})),s.n=1,this.remoteOfferLock.lock();case 1:return n=s.v,s.p=2,s.n=3,this.subscriber.setRemoteDescription(i);case 3:return s.n=4,this.subscriber.createAndSetAnswer();case 4:return a=s.v,s.a(2,a);case 5:return s.p=5,n(),s.f(5);case 6:return s.a(2)}},e,this,[[2,,5,6]])}))}},{key:"updateConfiguration",value:function(i,e){this.publisher.setConfiguration(i),this.subscriber.setConfiguration(i),e&&this.triggerIceRestart()}},{key:"ensurePCTransportConnection",value:function(i,e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,u;return v().w(function(o){for(;;)switch(o.n){case 0:return o.n=1,this.connectionLock.lock();case 1:return u=o.v,o.p=2,this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),o.n=3,Promise.all((s=this.requiredTransports)===null||s===void 0?void 0:s.map(function(c){return a.ensureTransportConnected(c,i,e)}));case 3:return o.p=3,u(),o.f(3);case 4:return o.a(2)}},n,this,[[2,,3,4]])}))}},{key:"negotiate",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n=this;return v().w(function(a){for(;;)switch(a.n){case 0:return a.a(2,new Promise(function(s,u){return b(n,void 0,void 0,v().m(function o(){var c=this,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return l=setTimeout(function(){u("negotiation timed out")},this.peerConnectionTimeout),d=function(){clearTimeout(l),u("negotiation aborted")},i.signal.addEventListener("abort",d),this.publisher.once(Gn.NegotiationStarted,function(){i.signal.aborted||c.publisher.once(Gn.NegotiationComplete,function(){clearTimeout(l),s()})}),f.n=1,this.publisher.negotiate(function(h){clearTimeout(l),u(h)});case 1:return f.a(2)}},o,this)}))}))}},e)}))}},{key:"addPublisherTransceiver",value:function(i,e){return this.publisher.addTransceiver(i,e)}},{key:"addPublisherTrack",value:function(i){return this.publisher.addTrack(i)}},{key:"createPublisherDataChannel",value:function(i,e){return this.publisher.createDataChannel(i,e)}},{key:"getConnectedAddress",value:function(i){return i===Te.PUBLISHER?this.publisher.getConnectedAddress():i===Te.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}},{key:"requiredTransports",get:function(){var i=[];return this.isPublisherConnectionRequired&&i.push(this.publisher),this.isSubscriberConnectionRequired&&i.push(this.subscriber),i}},{key:"ensureTransportConnected",value:function(i,e){return b(this,arguments,void 0,function(n,a){var s=this,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return v().m(function o(){var c;return v().w(function(l){for(;;)switch(l.n){case 0:if(c=n.getConnectionState(),c!=="connected"){l.n=1;break}return l.a(2);case 1:return l.a(2,new Promise(function(d,f){return b(s,void 0,void 0,v().m(function h(){var p=this,g,k;return v().w(function(y){for(;;)switch(y.n){case 0:g=function(){p.log.warn("abort transport connection",p.logContext),ye.clearTimeout(k),f(new se("room connection has been cancelled",3))},a!=null&&a.signal.aborted&&g(),a==null||a.signal.addEventListener("abort",g),k=ye.setTimeout(function(){a==null||a.signal.removeEventListener("abort",g),f(new se("could not establish pc connection",2))},u);case 1:if(this.state===ce.CONNECTED){y.n=4;break}return y.n=2,Ge(50);case 2:if(!(a!=null&&a.signal.aborted)){y.n=3;break}return f(new se("room connection has been cancelled",3)),y.a(2);case 3:y.n=1;break;case 4:ye.clearTimeout(k),a==null||a.signal.removeEventListener("abort",g),d();case 5:return y.a(2)}},h,this)}))}))}},o)})()})}}])}(),pa=2e3;function ur(r,t){if(!t)return 0;var i,e;return"bytesReceived"in r?(i=r.bytesReceived,e=t.bytesReceived):"bytesSent"in r&&(i=r.bytesSent,e=t.bytesSent),i===void 0||e===void 0||r.timestamp===void 0||t.timestamp===void 0?0:(i-e)*8*1e3/(r.timestamp-t.timestamp)}var he=function(r){function t(i,e){var n,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;return P(this,t),n=O(this,t,[i,L.Kind.Audio,e,a,u]),n.stopOnMute=!1,n.isKrispNoiseFilterEnabled=!1,n.monitorSender=function(){return b(n,void 0,void 0,v().m(function o(){var c,l;return v().w(function(d){for(;;)switch(d.n){case 0:if(this.sender){d.n=1;break}return this._currentBitrate=0,d.a(2);case 1:return d.p=1,d.n=2,this.getSenderStats();case 2:c=d.v,d.n=4;break;case 3:return d.p=3,l=d.v,this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l})),d.a(2);case 4:c&&this.prevStats&&(this._currentBitrate=ur(c,this.prevStats)),this.prevStats=c;case 5:return d.a(2)}},o,this,[[1,3]])}))},n.handleKrispNoiseFilterEnable=function(){n.isKrispNoiseFilterEnabled=!0,n.log.debug("Krisp noise filter enabled",n.logContext),n.emit(_.AudioTrackFeatureUpdate,n,Ae.TF_ENHANCED_NOISE_CANCELLATION,!0)},n.handleKrispNoiseFilterDisable=function(){n.isKrispNoiseFilterEnabled=!1,n.log.debug("Krisp noise filter disabled",n.logContext),n.emit(_.AudioTrackFeatureUpdate,n,Ae.TF_ENHANCED_NOISE_CANCELLATION,!1)},n.audioContext=s,n.checkForSilence(),n}return N(t,r),E(t,[{key:"enhancedNoiseCancellation",get:function(){return this.isKrispNoiseFilterEnabled}},{key:"mute",value:function(){var e=this,n=Object.create(null,{mute:{get:function(){return X(t,"mute",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,this.muteLock.lock();case 1:if(s=u.v,u.p=2,!this.isMuted){u.n=3;break}return this.log.debug("Track already muted",this.logContext),u.a(2,this);case 3:return this.source===L.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),u.n=4,n.mute.call(this);case 4:return u.a(2,this);case 5:return u.p=5,s(),u.f(5);case 6:return u.a(2)}},a,this,[[2,,5,6]])}))}},{key:"unmute",value:function(){var e=this,n=Object.create(null,{unmute:{get:function(){return X(t,"unmute",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s,u;return v().w(function(o){for(;;)switch(o.n){case 0:return o.n=1,this.muteLock.lock();case 1:if(s=o.v,o.p=2,this.isMuted){o.n=3;break}return this.log.debug("Track already unmuted",this.logContext),o.a(2,this);case 3:if(u=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Cn(this._constraints.deviceId),!(this.source===L.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||u)&&!this.isUserProvided)){o.n=4;break}return this.log.debug("reacquiring mic track",this.logContext),o.n=4,this.restartTrack();case 4:return o.n=5,n.unmute.call(this);case 5:return o.a(2,this);case 6:return o.p=6,s(),o.f(6);case 7:return o.a(2)}},a,this,[[2,,6,7]])}))}},{key:"restartTrack",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s;return v().w(function(u){for(;;)switch(u.n){case 0:return e&&(s=or({audio:e}),typeof s.audio!="boolean"&&(a=s.audio)),u.n=1,this.restart(a);case 1:return u.a(2)}},n,this)}))}},{key:"restart",value:function(e){var n=this,a=Object.create(null,{restart:{get:function(){return X(t,"restart",n,1)}}});return b(this,void 0,void 0,v().m(function s(){var u;return v().w(function(o){for(;;)switch(o.n){case 0:return o.n=1,a.restart.call(this,e);case 1:return u=o.v,this.checkForSilence(),o.a(2,u)}},s,this)}))}},{key:"startMonitor",value:function(){var e=this;Ie()&&(this.monitorInterval||(this.monitorInterval=setInterval(function(){e.monitorSender()},pa)))}},{key:"setProcessor",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,u;return v().w(function(o){for(;;)switch(o.n){case 0:return o.n=1,this.processorLock.lock();case 1:if(s=o.v,o.p=2,this.audioContext){o.n=3;break}throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");case 3:if(!this.processor){o.n=4;break}return o.n=4,this.stopProcessor();case 4:return u={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext},this.log.debug("setting up audio processor ".concat(e.name),this.logContext),o.n=5,e.init(u);case 5:if(this.processor=e,!this.processor.processedTrack){o.n=7;break}return o.n=6,(a=this.sender)===null||a===void 0?void 0:a.replaceTrack(this.processor.processedTrack);case 6:this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable);case 7:this.emit(_.TrackProcessorUpdate,this.processor);case 8:return o.p=8,s(),o.f(8);case 9:return o.a(2)}},n,this,[[2,,8,9]])}))}},{key:"setAudioContext",value:function(e){this.audioContext=e}},{key:"getSenderStats",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s;return v().w(function(u){for(;;)switch(u.n){case 0:if(!((n=this.sender)===null||n===void 0)&&n.getStats){u.n=1;break}return u.a(2,void 0);case 1:return u.n=2,this.sender.getStats();case 2:return a=u.v,a.forEach(function(o){o.type==="outbound-rtp"&&(s={type:"audio",streamId:o.id,packetsSent:o.packetsSent,packetsLost:o.packetsLost,bytesSent:o.bytesSent,timestamp:o.timestamp,roundTripTime:o.roundTripTime,jitter:o.jitter})}),u.a(2,s)}},e,this)}))}},{key:"checkForSilence",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,Qc(this);case 1:return n=a.v,n&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(_.AudioSilenceDetected)),a.a(2,n)}},e,this)}))}}])}(Wn);function jo(r,t,i){switch(r.kind){case"audio":return new he(r,t,!1,void 0,i);case"video":return new ke(r,t,!1,i);default:throw new sn("unsupported track type: ".concat(r.kind))}}var Al=Object.values(Ve),Ll=Object.values(jr),Ml=Object.values(sr),Ul=[Ve.h540,Ve.h720],Bl=[jr.h540,jr.h720],Jl=function(t){var i=[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}];return i.map(function(e){var n,a;return new Re(Math.floor(t.width/e.scaleResolutionDownBy),Math.floor(t.height/e.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(e.scaleResolutionDownBy,2)*(((n=t.encoding.maxFramerate)!==null&&n!==void 0?n:30)/((a=e.fps)!==null&&a!==void 0?a:30))))),e.fps,t.encoding.priority)})},$r=["q","h","f"];function Qr(r,t,i,e){var n,a,s=e==null?void 0:e.videoEncoding;r&&(s=e==null?void 0:e.screenShareEncoding);var u=e==null?void 0:e.simulcast,o=e==null?void 0:e.scalabilityMode,c=e==null?void 0:e.videoCodec;if(!s&&!u&&!o||!t||!i)return[{}];s||(s=Vo(r,t,i,c),x.debug("using video encoding",s));var l=s.maxFramerate,d=new Re(t,i,s.maxBitrate,s.maxFramerate,s.priority);if(o&&kt(c)){var f=new Ho(o),h=[];if(f.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(o));var p=xe();if(yn()||dn()||(p==null?void 0:p.name)==="Chrome"&&et(p==null?void 0:p.version,"113")<0){for(var g=f.suffix=="h"?2:3,k=0;k<f.spatial;k+=1)h.push({rid:$r[2-k],maxBitrate:s.maxBitrate/Math.pow(g,k),maxFramerate:d.encoding.maxFramerate});h[0].scalabilityMode=o}else h.push({maxBitrate:s.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:o});return d.encoding.priority&&(h[0].priority=d.encoding.priority,h[0].networkPriority=d.encoding.priority),x.debug("using svc encoding",{encodings:h}),h}if(!u)return[s];var y=[];r?y=(n=cs(e==null?void 0:e.screenShareSimulcastLayers))!==null&&n!==void 0?n:us(r,d):y=(a=cs(e==null?void 0:e.videoSimulcastLayers))!==null&&a!==void 0?a:us(r,d);var S;if(y.length>0){var T=y[0];if(y.length>1){var C=y,w=te(C,2);S=w[1]}var I=Math.max(t,i);if(I>=960&&S)return Sr(t,i,[T,S,d],l);if(I>=480)return Sr(t,i,[T,d],l)}return Sr(t,i,[d])}function Fl(r,t,i){var e,n,a,s;if(!(!i.backupCodec||i.backupCodec===!0||i.backupCodec.codec===i.videoCodec)){t!==i.backupCodec.codec&&x.warn("requested a different codec than specified as backup",{serverRequested:t,backup:i.backupCodec.codec}),i.videoCodec=t,i.videoEncoding=i.backupCodec.encoding;var u=r.mediaStreamTrack.getSettings(),o=(e=u.width)!==null&&e!==void 0?e:(n=r.dimensions)===null||n===void 0?void 0:n.width,c=(a=u.height)!==null&&a!==void 0?a:(s=r.dimensions)===null||s===void 0?void 0:s.height,l=Qr(r.source===L.Source.ScreenShare,o,c,i);return l}}function Vo(r,t,i,e){for(var n=_l(r,t,i),a=n[0].encoding,s=Math.max(t,i),u=0;u<n.length;u+=1){var o=n[u];if(a=o.encoding,o.width>=s)break}if(e)switch(e){case"av1":a=Object.assign({},a),a.maxBitrate=a.maxBitrate*.7;break;case"vp9":a=Object.assign({},a),a.maxBitrate=a.maxBitrate*.85;break}return a}function _l(r,t,i){if(r)return Ml;var e=t>i?t/i:i/t;return Math.abs(e-16/9)<Math.abs(e-4/3)?Al:Ll}function us(r,t){if(r)return Jl(t);var i=t.width,e=t.height,n=i>e?i/e:e/i;return Math.abs(n-16/9)<Math.abs(n-4/3)?Ul:Bl}function Sr(r,t,i,e){var n=[];if(i.forEach(function(u,o){if(!(o>=$r.length)){var c=Math.min(r,t),l=$r[o],d={rid:l,scaleResolutionDownBy:Math.max(1,c/Math.min(u.width,u.height)),maxBitrate:u.encoding.maxBitrate},f=e&&u.encoding.maxFramerate?Math.min(e,u.encoding.maxFramerate):u.encoding.maxFramerate;f&&(d.maxFramerate=f);var h=xn()||o===0;u.encoding.priority&&h&&(d.priority=u.encoding.priority,d.networkPriority=u.encoding.priority),n.push(d)}}),dn()&&Mo()==="ios"){var a=void 0;n.forEach(function(u){a?u.maxFramerate&&u.maxFramerate>a&&(a=u.maxFramerate):a=u.maxFramerate});var s=!0;n.forEach(function(u){var o;u.maxFramerate!=a&&(s&&(s=!1,x.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),x.info('Setting framerate of encoding "'.concat((o=u.rid)!==null&&o!==void 0?o:"",'" to ').concat(a)),u.maxFramerate=a)})}return n}function cs(r){if(r)return r.sort(function(t,i){var e=t.encoding,n=i.encoding;return e.maxBitrate>n.maxBitrate?1:e.maxBitrate<n.maxBitrate?-1:e.maxBitrate===n.maxBitrate&&e.maxFramerate&&n.maxFramerate?e.maxFramerate>n.maxFramerate?1:-1:0})}var Ho=function(){function r(t){P(this,r);var i=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!i)throw new Error("invalid scalability mode");if(this.spatial=parseInt(i[1]),this.temporal=parseInt(i[2]),i.length>3)switch(i[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=i[3]}}return E(r,[{key:"toString",value:function(){var i;return"L".concat(this.spatial,"T").concat(this.temporal).concat((i=this.suffix)!==null&&i!==void 0?i:"")}}])}();function ql(r){return r.source===L.Source.ScreenShare||r.constraints.height&&Cn(r.constraints.height)>=1080?"maintain-resolution":"balanced"}var jl=5e3,ke=function(r){function t(i,e){var n,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3?arguments[3]:void 0;return P(this,t),n=O(this,t,[i,L.Kind.Video,e,a,s]),n.simulcastCodecs=new Map,n.degradationPreference="balanced",n.monitorSender=function(){return b(n,void 0,void 0,v().m(function u(){var o=this,c,l,d,f;return v().w(function(h){for(;;)switch(h.n){case 0:if(this.sender){h.n=1;break}return this._currentBitrate=0,h.a(2);case 1:return h.p=1,h.n=2,this.getSenderStats();case 2:c=h.v,h.n=4;break;case 3:return h.p=3,f=h.v,this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:f})),h.a(2);case 4:l=new Map(c.map(function(p){return[p.rid,p]})),this.prevStats&&(d=0,l.forEach(function(p,g){var k,y=(k=o.prevStats)===null||k===void 0?void 0:k.get(g);d+=ur(p,y)}),this._currentBitrate=d),this.prevStats=l;case 5:return h.a(2)}},u,this,[[1,3]])}))},n.senderLock=new Me,n}return N(t,r),E(t,[{key:"sender",get:function(){return this._sender},set:function(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}},{key:"isSimulcast",get:function(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}},{key:"startMonitor",value:function(e){var n=this,a;if(this.signalClient=e,!!Ie()){var s=(a=this.sender)===null||a===void 0?void 0:a.getParameters();s&&(this.encodings=s.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(function(){n.monitorSender()},pa))}}},{key:"stop",value:function(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(function(e){e.mediaStreamTrack.stop()}),X(t,"stop",this,3)([])}},{key:"pauseUpstream",value:function(){var e=this,n=Object.create(null,{pauseUpstream:{get:function(){return X(t,"pauseUpstream",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s,u,o,c,l,d,f,h,p,g;return v().w(function(k){for(;;)switch(k.n){case 0:return k.n=1,n.pauseUpstream.call(this);case 1:k.p=1,d=!0,f=Jn(this.simulcastCodecs.values());case 2:return k.n=3,f.next();case 3:if(h=k.v,s=h.done,s){k.n=5;break}return c=h.value,d=!1,p=c,k.n=4,(l=p.sender)===null||l===void 0?void 0:l.replaceTrack(null);case 4:d=!0,k.n=2;break;case 5:k.n=7;break;case 6:k.p=6,g=k.v,u={error:g};case 7:if(k.p=7,k.p=8,!(!d&&!s&&(o=f.return))){k.n=9;break}return k.n=9,o.call(f);case 9:if(k.p=9,!u){k.n=10;break}throw u.error;case 10:return k.f(9);case 11:return k.f(7);case 12:return k.a(2)}},a,this,[[8,,9,11],[1,6,7,12]])}))}},{key:"resumeUpstream",value:function(){var e=this,n=Object.create(null,{resumeUpstream:{get:function(){return X(t,"resumeUpstream",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s,u,o,c,l,d,f,h,p,g;return v().w(function(k){for(;;)switch(k.n){case 0:return k.n=1,n.resumeUpstream.call(this);case 1:k.p=1,d=!0,f=Jn(this.simulcastCodecs.values());case 2:return k.n=3,f.next();case 3:if(h=k.v,s=h.done,s){k.n=5;break}return c=h.value,d=!1,p=c,k.n=4,(l=p.sender)===null||l===void 0?void 0:l.replaceTrack(p.mediaStreamTrack);case 4:d=!0,k.n=2;break;case 5:k.n=7;break;case 6:k.p=6,g=k.v,u={error:g};case 7:if(k.p=7,k.p=8,!(!d&&!s&&(o=f.return))){k.n=9;break}return k.n=9,o.call(f);case 9:if(k.p=9,!u){k.n=10;break}throw u.error;case 10:return k.f(9);case 11:return k.f(7);case 12:return k.a(2)}},a,this,[[8,,9,11],[1,6,7,12]])}))}},{key:"mute",value:function(){var e=this,n=Object.create(null,{mute:{get:function(){return X(t,"mute",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,this.muteLock.lock();case 1:if(s=u.v,u.p=2,!this.isMuted){u.n=3;break}return this.log.debug("Track already muted",this.logContext),u.a(2,this);case 3:return this.source===L.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),u.n=4,n.mute.call(this);case 4:return u.a(2,this);case 5:return u.p=5,s(),u.f(5);case 6:return u.a(2)}},a,this,[[2,,5,6]])}))}},{key:"unmute",value:function(){var e=this,n=Object.create(null,{unmute:{get:function(){return X(t,"unmute",e,1)}}});return b(this,void 0,void 0,v().m(function a(){var s;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,this.muteLock.lock();case 1:if(s=u.v,u.p=2,this.isMuted){u.n=3;break}return this.log.debug("Track already unmuted",this.logContext),u.a(2,this);case 3:if(!(this.source===L.Source.Camera&&!this.isUserProvided)){u.n=4;break}return this.log.debug("reacquiring camera track",this.logContext),u.n=4,this.restartTrack();case 4:return u.n=5,n.unmute.call(this);case 5:return u.a(2,this);case 6:return u.p=6,s(),u.f(6);case 7:return u.a(2)}},a,this,[[2,,6,7]])}))}},{key:"setTrackMuted",value:function(e){X(t,"setTrackMuted",this,3)([e]);var n=$(this.simulcastCodecs.values()),a;try{for(n.s();!(a=n.n()).done;){var s=a.value;s.mediaStreamTrack.enabled=!e}}catch(u){n.e(u)}finally{n.f()}}},{key:"getSenderStats",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s;return v().w(function(u){for(;;)switch(u.n){case 0:if(!((n=this.sender)===null||n===void 0)&&n.getStats){u.n=1;break}return u.a(2,[]);case 1:return a=[],u.n=2,this.sender.getStats();case 2:return s=u.v,s.forEach(function(o){var c;if(o.type==="outbound-rtp"){var l={type:"video",streamId:o.id,frameHeight:o.frameHeight,frameWidth:o.frameWidth,framesPerSecond:o.framesPerSecond,framesSent:o.framesSent,firCount:o.firCount,pliCount:o.pliCount,nackCount:o.nackCount,packetsSent:o.packetsSent,bytesSent:o.bytesSent,qualityLimitationReason:o.qualityLimitationReason,qualityLimitationDurations:o.qualityLimitationDurations,qualityLimitationResolutionChanges:o.qualityLimitationResolutionChanges,rid:(c=o.rid)!==null&&c!==void 0?c:o.id,retransmittedPacketsSent:o.retransmittedPacketsSent,targetBitrate:o.targetBitrate,timestamp:o.timestamp},d=s.get(o.remoteId);d&&(l.jitter=d.jitter,l.packetsLost=d.packetsLost,l.roundTripTime=d.roundTripTime),a.push(l)}}),a.sort(function(o,c){var l,d;return((l=c.frameWidth)!==null&&l!==void 0?l:0)-((d=o.frameWidth)!==null&&d!==void 0?d:0)}),u.a(2,a)}},e,this)}))}},{key:"setPublishingQuality",value:function(e){for(var n=[],a=we.LOW;a<=we.HIGH;a+=1)n.push(new at({quality:a,enabled:a<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(n)}},{key:"restartTrack",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,u,o,c,l,d,f,h,p,g;return v().w(function(k){for(;;)switch(k.n){case 0:return e&&(l=or({video:e}),typeof l.video!="boolean"&&(c=l.video)),k.n=1,this.restart(c);case 1:k.p=1,d=!0,f=Jn(this.simulcastCodecs.values());case 2:return k.n=3,f.next();case 3:if(h=k.v,a=h.done,a){k.n=5;break}if(o=h.value,d=!1,p=o,!p.sender){k.n=4;break}return p.mediaStreamTrack=this.mediaStreamTrack.clone(),k.n=4,p.sender.replaceTrack(p.mediaStreamTrack);case 4:d=!0,k.n=2;break;case 5:k.n=7;break;case 6:k.p=6,g=k.v,s={error:g};case 7:if(k.p=7,k.p=8,!(!d&&!a&&(u=f.return))){k.n=9;break}return k.n=9,u.call(f);case 9:if(k.p=9,!s){k.n=10;break}throw s.error;case 10:return k.f(9);case 11:return k.f(7);case 12:return k.a(2)}},n,this,[[8,,9,11],[1,6,7,12]])}))}},{key:"setProcessor",value:function(e){var n=this,a=Object.create(null,{setProcessor:{get:function(){return X(t,"setProcessor",n,1)}}});return b(this,arguments,void 0,function(s){var u=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return v().m(function c(){var l,d,f,h,p,g,k,y,S,T,C;return v().w(function(w){for(;;)switch(w.n){case 0:return w.n=1,a.setProcessor.call(u,s,o);case 1:if(!(!((p=u.processor)===null||p===void 0)&&p.processedTrack)){w.n=13;break}w.p=2,k=!0,y=Jn(u.simulcastCodecs.values());case 3:return w.n=4,y.next();case 4:if(S=w.v,l=S.done,l){w.n=6;break}return h=S.value,k=!1,T=h,w.n=5,(g=T.sender)===null||g===void 0?void 0:g.replaceTrack(u.processor.processedTrack);case 5:k=!0,w.n=3;break;case 6:w.n=8;break;case 7:w.p=7,C=w.v,d={error:C};case 8:if(w.p=8,w.p=9,!(!k&&!l&&(f=y.return))){w.n=10;break}return w.n=10,f.call(y);case 10:if(w.p=10,!d){w.n=11;break}throw d.error;case 11:return w.f(10);case 12:return w.f(8);case 13:return w.a(2)}},c,null,[[9,,10,12],[2,7,8,13]])})()})}},{key:"setDegradationPreference",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a;return v().w(function(s){for(;;)switch(s.n){case 0:if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext),a=this.sender.getParameters(),a.degradationPreference=e,this.sender.setParameters(a)}catch(u){this.log.warn("failed to set degradationPreference",Object.assign({error:u},this.logContext))}case 1:return s.a(2)}},n,this)}))}},{key:"addSimulcastTrack",value:function(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}var a={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,a),a}},{key:"setSimulcastTrackSender",value:function(e,n){var a=this,s=this.simulcastCodecs.get(e);s&&(s.sender=n,setTimeout(function(){a.subscribedCodecs&&a.setPublishingCodecs(a.subscribedCodecs)},jl))}},{key:"setPublishingCodecs",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,u,o,c,l,d,f,h,p,g,k,y,S,T;return v().w(function(C){for(;;)switch(C.n){case 0:if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!(!this.codec&&e.length>0)){C.n=2;break}return C.n=1,this.setPublishingLayers(e[0].qualities);case 1:return C.a(2,[]);case 2:this.subscribedCodecs=e,f=[],C.p=3,a=!0,s=Jn(e);case 4:return C.n=5,s.next();case 5:if(u=C.v,o=u.done,o){C.n=17;break}if(d=u.value,a=!1,h=d,!(!this.codec||this.codec===h.codec)){C.n=7;break}return C.n=6,this.setPublishingLayers(h.qualities);case 6:C.n=16;break;case 7:if(p=this.simulcastCodecs.get(h.codec),this.log.debug("try setPublishingCodec for ".concat(h.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:p})),!(!p||!p.sender)){C.n=15;break}g=$(h.qualities),C.p=8,g.s();case 9:if((k=g.n()).done){C.n=11;break}if(y=k.value,!y.enabled){C.n=10;break}return f.push(h.codec),C.a(3,11);case 10:C.n=9;break;case 11:C.n=13;break;case 12:C.p=12,S=C.v,g.e(S);case 13:return C.p=13,g.f(),C.f(13);case 14:C.n=16;break;case 15:if(!p.encodings){C.n=16;break}return this.log.debug("try setPublishingLayersForSender ".concat(h.codec),this.logContext),C.n=16,ls(p.sender,p.encodings,h.qualities,this.senderLock,this.log,this.logContext);case 16:a=!0,C.n=4;break;case 17:C.n=19;break;case 18:C.p=18,T=C.v,c={error:T};case 19:if(C.p=19,C.p=20,!(!a&&!o&&(l=s.return))){C.n=21;break}return C.n=21,l.call(s);case 21:if(C.p=21,!c){C.n=22;break}throw c.error;case 22:return C.f(21);case 23:return C.f(19);case 24:return C.a(2,f)}},n,this,[[20,,21,23],[8,12,13,14],[3,18,19,24]])}))}},{key:"setPublishingLayers",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),!(!this.sender||!this.encodings)){a.n=1;break}return a.a(2);case 1:return a.n=2,ls(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext);case 2:return a.a(2)}},n,this)}))}},{key:"handleAppVisibilityChanged",value:function(){var e=this,n=Object.create(null,{handleAppVisibilityChanged:{get:function(){return X(t,"handleAppVisibilityChanged",e,1)}}});return b(this,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,n.handleAppVisibilityChanged.call(this);case 1:if(Ao()){s.n=2;break}return s.a(2);case 2:this.isInBackground&&this.source===L.Source.Camera&&(this._mediaStreamTrack.enabled=!1);case 3:return s.a(2)}},a,this)}))}}])}(Wn);function ls(r,t,i,e,n,a){return b(this,void 0,void 0,v().m(function s(){var u,o,c,l,d,f,h;return v().w(function(p){for(;;)switch(p.n){case 0:return p.n=1,e.lock();case 1:if(u=p.v,n.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:r,qualities:i,senderEncodings:t})),p.p=2,o=r.getParameters(),c=o.encodings,c){p.n=3;break}return p.a(2);case 3:if(c.length===t.length){p.n=4;break}return n.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:c,senderEncodings:t})),p.a(2);case 4:if(l=!1,d=!1,d&&c[0].scalabilityMode?(f=c[0],h=Je.OFF,i.forEach(function(g){g.enabled&&(h===Je.OFF||g.quality>h)&&(h=g.quality)}),h===Je.OFF?f.active&&(f.active=!1,l=!0):f.active||(l=!0,f.active=!0)):c.forEach(function(g,k){var y,S=(y=g.rid)!==null&&y!==void 0?y:"";S===""&&(S="q");var T=Wo(S),C=i.find(function(w){return w.quality===T});C&&g.active!==C.enabled&&(l=!0,g.active=C.enabled,n.debug("setting layer ".concat(C.quality," to ").concat(g.active?"enabled":"disabled"),a),xn()&&(C.enabled?(g.scaleResolutionDownBy=t[k].scaleResolutionDownBy,g.maxBitrate=t[k].maxBitrate,g.maxFrameRate=t[k].maxFrameRate):(g.scaleResolutionDownBy=4,g.maxBitrate=10,g.maxFrameRate=2)))}),!l){p.n=5;break}return o.encodings=c,n.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:o.encodings})),p.n=5,r.setParameters(o);case 5:return p.p=5,u(),p.f(5);case 6:return p.a(2)}},s,null,[[2,,5,6]])}))}function Wo(r){switch(r){case"f":return we.HIGH;case"h":return we.MEDIUM;case"q":return we.LOW;default:return we.HIGH}}function ds(r,t,i,e){if(!i)return[new Ye({quality:we.HIGH,width:r,height:t,bitrate:0,ssrc:0})];if(e){for(var n=i[0].scalabilityMode,a=new Ho(n),s=[],u=a.suffix=="h"?1.5:2,o=a.suffix=="h"?2:3,c=0;c<a.spatial;c+=1)s.push(new Ye({quality:Math.min(we.HIGH,a.spatial-1)-c,width:Math.ceil(r/Math.pow(u,c)),height:Math.ceil(t/Math.pow(u,c)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(o,c)):0,ssrc:0}));return s}return i.map(function(l){var d,f,h,p=(d=l.scaleResolutionDownBy)!==null&&d!==void 0?d:1,g=Wo((f=l.rid)!==null&&f!==void 0?f:"");return new Ye({quality:g,width:Math.ceil(r/p),height:Math.ceil(t/p),bitrate:(h=l.maxBitrate)!==null&&h!==void 0?h:0,ssrc:0})})}var fs="_lossy",hs="_reliable",ms=2*1e3,Tr="leave-reconnect",_e;(function(r){r[r.New=0]="New",r[r.Connected=1]="Connected",r[r.Disconnected=2]="Disconnected",r[r.Reconnecting=3]="Reconnecting",r[r.Closed=4]="Closed"})(_e||(_e={}));var Vl=function(r){function t(i){var e;P(this,t);var n;return e=O(this,t),e.options=i,e.rtcConfig={},e.peerConnectionTimeout=va.peerConnectionTimeout,e.fullReconnectOnNext=!1,e.subscriberPrimary=!1,e.hasPublished=!1,e.pcState=_e.New,e._isClosed=!0,e.pendingTrackResolvers={},e.reconnectAttempts=0,e.reconnectStart=0,e.attemptingReconnect=!1,e.joinAttempts=0,e.maxJoinAttempts=1,e.firstReconnectAttempt=!0,e.shouldFailNext=!1,e.log=x,e.disconnectStartTimePrimary=0,e.disconnectStartTimeSecondary=0,e.handleDataChannel=function(a){return b(e,[a],void 0,function(s){var u=this,o=s.channel;return v().m(function c(){return v().w(function(l){for(;;)switch(l.n){case 0:if(o){l.n=1;break}return l.a(2);case 1:if(o.label!==hs){l.n=2;break}u.reliableDCSub=o,l.n=4;break;case 2:if(o.label!==fs){l.n=3;break}u.lossyDCSub=o,l.n=4;break;case 3:return l.a(2);case 4:u.log.debug("on data channel ".concat(o.id,", ").concat(o.label),u.logContext),o.onmessage=u.handleDataMessage;case 5:return l.a(2)}},c)})()})},e.handleDataMessage=function(a){return b(e,void 0,void 0,v().m(function s(){var u,o,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return f.n=1,this.dataProcessLock.lock();case 1:if(c=f.v,f.p=2,!(a.data instanceof ArrayBuffer)){f.n=3;break}l=a.data,f.n=6;break;case 3:if(!(a.data instanceof Blob)){f.n=5;break}return f.n=4,a.data.arrayBuffer();case 4:l=f.v,f.n=6;break;case 5:return this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:a.data})),f.a(2);case 6:d=qe.fromBinary(new Uint8Array(l)),((u=d.value)===null||u===void 0?void 0:u.case)==="speaker"?this.emit(q.ActiveSpeakersUpdate,d.value.value.speakers):(((o=d.value)===null||o===void 0?void 0:o.case)==="user"&&Wl(d,d.value.value),this.emit(q.DataPacketReceived,d));case 7:return f.p=7,c(),f.f(7);case 8:return f.a(2)}},s,this,[[2,,7,8]])}))},e.handleDataError=function(a){var s=a.currentTarget,u=s.maxRetransmits===0?"lossy":"reliable";if(a instanceof ErrorEvent&&a.error){var o=a.error.error;e.log.error("DataChannel error on ".concat(u,": ").concat(a.message),Object.assign(Object.assign({},e.logContext),{error:o}))}else e.log.error("Unknown DataChannel error on ".concat(u),Object.assign(Object.assign({},e.logContext),{event:a}))},e.handleBufferedAmountLow=function(a){var s=a.currentTarget,u=s.maxRetransmits===0?re.LOSSY:re.RELIABLE;e.updateAndEmitDCBufferStatus(u)},e.handleDisconnect=function(a,s){if(!e._isClosed){e.log.warn("".concat(a," disconnected"),e.logContext),e.reconnectAttempts===0&&(e.reconnectStart=Date.now());var u=function(d){e.log.warn("could not recover connection after ".concat(e.reconnectAttempts," attempts, ").concat(d,"ms. giving up"),e.logContext),e.emit(q.Disconnected),e.close()},o=Date.now()-e.reconnectStart,c=e.getNextRetryDelay({elapsedMs:o,retryCount:e.reconnectAttempts});if(c===null){u(o);return}a===Tr&&(c=0),e.log.debug("reconnecting in ".concat(c,"ms"),e.logContext),e.clearReconnectTimeout(),e.token&&e.regionUrlProvider&&e.regionUrlProvider.updateToken(e.token),e.reconnectTimeout=ye.setTimeout(function(){return e.attemptReconnect(s).finally(function(){return e.reconnectTimeout=void 0})},c)}},e.waitForRestarted=function(){return new Promise(function(a,s){e.pcState===_e.Connected&&a();var u=function(){e.off(q.Disconnected,o),a()},o=function(){e.off(q.Restarted,u),s()};e.once(q.Restarted,u),e.once(q.Disconnected,o)})},e.updateAndEmitDCBufferStatus=function(a){var s=e.isBufferStatusLow(a);typeof s<"u"&&s!==e.dcBufferStatus.get(a)&&(e.dcBufferStatus.set(a,s),e.emit(q.DCBufferStatusChanged,s,a))},e.isBufferStatusLow=function(a){var s=e.dataChannelForKind(a);if(s)return s.bufferedAmount<=s.bufferedAmountLowThreshold},e.handleBrowserOnLine=function(){e.client.currentState===ue.RECONNECTING&&(e.clearReconnectTimeout(),e.attemptReconnect(nn.RR_SIGNAL_DISCONNECTED))},e.log=ln((n=i.loggerName)!==null&&n!==void 0?n:ze.Engine),e.loggerOptions={loggerName:i.loggerName,loggerContextCb:function(){return e.logContext}},e.client=new ma(void 0,e.loggerOptions),e.client.signalLatency=e.options.expSignalLatency,e.reconnectPolicy=e.options.reconnectPolicy,e.registerOnLineListener(),e.closingLock=new Me,e.dataProcessLock=new Me,e.dcBufferStatus=new Map([[re.LOSSY,!0],[re.RELIABLE,!0]]),e.client.onParticipantUpdate=function(a){return e.emit(q.ParticipantUpdate,a)},e.client.onConnectionQuality=function(a){return e.emit(q.ConnectionQualityUpdate,a)},e.client.onRoomUpdate=function(a){return e.emit(q.RoomUpdate,a)},e.client.onSubscriptionError=function(a){return e.emit(q.SubscriptionError,a)},e.client.onSubscriptionPermissionUpdate=function(a){return e.emit(q.SubscriptionPermissionUpdate,a)},e.client.onSpeakersChanged=function(a){return e.emit(q.SpeakersChanged,a)},e.client.onStreamStateUpdate=function(a){return e.emit(q.StreamStateChanged,a)},e.client.onRequestResponse=function(a){return e.emit(q.SignalRequestResponse,a)},e}return N(t,r),E(t,[{key:"isClosed",get:function(){return this._isClosed}},{key:"pendingReconnect",get:function(){return!!this.reconnectTimeout}},{key:"logContext",get:function(){var e,n,a,s,u,o,c,l;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(s=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.room)===null||s===void 0?void 0:s.sid,participant:(o=(u=this.latestJoinResponse)===null||u===void 0?void 0:u.participant)===null||o===void 0?void 0:o.identity,pID:(l=(c=this.latestJoinResponse)===null||c===void 0?void 0:c.participant)===null||l===void 0?void 0:l.sid}}},{key:"join",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function u(){var o,c;return v().w(function(l){for(;;)switch(l.n){case 0:return this.url=e,this.token=n,this.signalOpts=a,this.maxJoinAttempts=a.maxRetries,l.p=1,this.joinAttempts+=1,this.setupSignalClientCallbacks(),l.n=2,this.client.join(e,n,a,s);case 2:if(o=l.v,this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.pcManager){l.n=3;break}return l.n=3,this.configure(o);case 3:return(!this.subscriberPrimary||o.fastPublish)&&this.negotiate(),this.clientConfiguration=o.clientConfiguration,l.a(2,o);case 4:if(l.p=4,c=l.v,!(c instanceof se)){l.n=5;break}if(c.reason!==1){l.n=5;break}if(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),!(this.joinAttempts<this.maxJoinAttempts)){l.n=5;break}return l.a(2,this.join(e,n,a,s));case 5:throw c;case 6:return l.a(2)}},u,this,[[1,4]])}))}},{key:"close",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,this.closingLock.lock();case 1:if(n=a.v,!this.isClosed){a.n=2;break}return n(),a.a(2);case 2:return a.p=2,this._isClosed=!0,this.joinAttempts=0,this.emit(q.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),a.n=3,this.cleanupPeerConnections();case 3:return a.n=4,this.cleanupClient();case 4:return a.p=4,n(),a.f(4);case 5:return a.a(2)}},e,this,[[2,,4,5]])}))}},{key:"cleanupPeerConnections",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,(n=this.pcManager)===null||n===void 0?void 0:n.close();case 1:this.pcManager=void 0,a=function(o){o&&(o.close(),o.onbufferedamountlow=null,o.onclose=null,o.onclosing=null,o.onerror=null,o.onmessage=null,o.onopen=null)},a(this.lossyDC),a(this.lossyDCSub),a(this.reliableDC),a(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0;case 2:return s.a(2)}},e,this)}))}},{key:"cleanupClient",value:function(){return b(this,void 0,void 0,v().m(function e(){return v().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,this.client.close();case 1:this.client.resetCallbacks();case 2:return n.a(2)}},e,this)}))}},{key:"addTrack",value:function(e){var n=this;if(this.pendingTrackResolvers[e.cid])throw new sn("a track with the same ID has already been published");return new Promise(function(a,s){var u=setTimeout(function(){delete n.pendingTrackResolvers[e.cid],s(new se("publication of local track timed out, no response from server",2))},1e4);n.pendingTrackResolvers[e.cid]={resolve:function(c){clearTimeout(u),a(c)},reject:function(){clearTimeout(u),s(new Error("Cancelled publication by calling unpublish"))}},n.client.sendAddTrack(e)})}},{key:"removeTrack",value:function(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){var n=this.pendingTrackResolvers[e.track.id].reject;n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(a){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:a}))}return!1}},{key:"updateMuteStatus",value:function(e,n){this.client.sendMuteTrack(e,n)}},{key:"dataSubscriberReadyState",get:function(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}},{key:"getConnectedServerAddress",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.a(2,(n=this.pcManager)===null||n===void 0?void 0:n.getConnectedAddress())}},e,this)}))}},{key:"setRegionUrlProvider",value:function(e){this.regionUrlProvider=e}},{key:"configure",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,u,o;return v().w(function(c){for(;;)switch(c.n){case 0:if(!(this.pcManager&&this.pcManager.currentState!==ce.NEW)){c.n=1;break}return c.a(2);case 1:this.participantSid=(s=e.participant)===null||s===void 0?void 0:s.sid,o=this.makeRTCConfiguration(e),this.pcManager=new Dl(o,e.subscriberPrimary,this.loggerOptions),this.emit(q.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=function(l,d){a.client.sendIceCandidate(l,d)},this.pcManager.onPublisherOffer=function(l){a.client.sendOffer(l)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=function(l,d,f){return b(a,void 0,void 0,v().m(function h(){var p,g,k;return v().w(function(y){for(;;)switch(y.n){case 0:this.log.debug("primary PC state changed ".concat(l),this.logContext),["closed","disconnected","failed"].includes(d)&&(this.publisherConnectionPromise=void 0),l===ce.CONNECTED?(p=this.pcState===_e.New,this.pcState=_e.Connected,p&&this.emit(q.Connected,e)):l===ce.FAILED&&this.pcState===_e.Connected&&(this.pcState=_e.Disconnected,this.handleDisconnect("peerconnection failed",f==="failed"?nn.RR_SUBSCRIBER_FAILED:nn.RR_PUBLISHER_FAILED)),g=this.client.isDisconnected||this.client.currentState===ue.RECONNECTING,k=[ce.FAILED,ce.CLOSING,ce.CLOSED].includes(l),g&&k&&!this._isClosed&&this.emit(q.Offline);case 1:return y.a(2)}},h,this)}))},this.pcManager.onTrack=function(l){a.emit(q.MediaTrackAdded,l.track,l.streams[0],l.receiver)},Hl((u=e.serverInfo)===null||u===void 0?void 0:u.protocol)||this.createDataChannels();case 2:return c.a(2)}},n,this)}))}},{key:"setupSignalClientCallbacks",value:function(){var e=this;this.client.onAnswer=function(n){return b(e,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:if(this.pcManager){s.n=1;break}return s.a(2);case 1:return this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:n.type})),s.n=2,this.pcManager.setPublisherAnswer(n);case 2:return s.a(2)}},a,this)}))},this.client.onTrickle=function(n,a){e.pcManager&&(e.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},e.logContext),{candidate:n,target:a})),e.pcManager.addIceCandidate(n,a))},this.client.onOffer=function(n){return b(e,void 0,void 0,v().m(function a(){var s;return v().w(function(u){for(;;)switch(u.n){case 0:if(this.pcManager){u.n=1;break}return u.a(2);case 1:return u.n=2,this.pcManager.createSubscriberAnswerFromOffer(n);case 2:s=u.v,this.client.sendAnswer(s);case 3:return u.a(2)}},a,this)}))},this.client.onLocalTrackPublished=function(n){var a;if(e.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},e.logContext),{cid:n.cid,track:(a=n.track)===null||a===void 0?void 0:a.sid})),!e.pendingTrackResolvers[n.cid]){e.log.error("missing track resolver for ".concat(n.cid),Object.assign(Object.assign({},e.logContext),{cid:n.cid}));return}var s=e.pendingTrackResolvers[n.cid].resolve;delete e.pendingTrackResolvers[n.cid],s(n.track)},this.client.onLocalTrackUnpublished=function(n){e.emit(q.LocalTrackUnpublished,n)},this.client.onLocalTrackSubscribed=function(n){e.emit(q.LocalTrackSubscribed,n)},this.client.onTokenRefresh=function(n){e.token=n,sessionStorage.setItem("token",e.token)},this.client.onRemoteMuteChanged=function(n,a){e.emit(q.RemoteMute,n,a)},this.client.onSubscribedQualityUpdate=function(n){e.emit(q.SubscribedQualityUpdate,n)},this.client.onClose=function(){e.handleDisconnect("signal",nn.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=function(n){switch(e.log.debug("client leave request",Object.assign(Object.assign({},e.logContext),{reason:n==null?void 0:n.reason})),sessionStorage.removeItem("token"),sessionStorage.removeItem("isAudioMuted"),sessionStorage.removeItem("isVideoMuted"),n.regions&&e.regionUrlProvider&&(e.log.debug("updating regions",e.logContext),e.regionUrlProvider.setServerReportedRegions(n.regions)),n.action){case Xe.DISCONNECT:e.emit(q.Disconnected,n==null?void 0:n.reason),e.close();break;case Xe.RECONNECT:e.fullReconnectOnNext=!0,e.handleDisconnect(Tr);break;case Xe.RESUME:e.handleDisconnect(Tr)}}}},{key:"makeRTCConfiguration",value:function(e){var n,a=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),a.encodedInsertableStreams=!0),e.iceServers&&!a.iceServers){var s=[];e.iceServers.forEach(function(u){var o={urls:u.urls};u.username&&(o.username=u.username),u.credential&&(o.credential=u.credential),s.push(o)}),a.iceServers=s}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Ke.ENABLED&&(a.iceTransportPolicy="relay"),a.sdpSemantics="unified-plan",a.continualGatheringPolicy="gather_continually",a}},{key:"createDataChannels",value:function(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(fs,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(hs,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}},{key:"createSender",value:function(e,n,a){return b(this,void 0,void 0,v().m(function s(){var u,o;return v().w(function(c){for(;;)switch(c.n){case 0:if(!Hr()){c.n=2;break}return c.n=1,this.createTransceiverRTCRtpSender(e,n,a);case 1:return u=c.v,c.a(2,u);case 2:if(!Wr()){c.n=4;break}return this.log.warn("using add-track fallback",this.logContext),c.n=3,this.createRTCRtpSender(e.mediaStreamTrack);case 3:return o=c.v,c.a(2,o);case 4:throw new ve("Required webRTC APIs not supported on this device");case 5:return c.a(2)}},s,this)}))}},{key:"createSimulcastSender",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function u(){return v().w(function(o){for(;;)switch(o.n){case 0:if(!Hr()){o.n=1;break}return o.a(2,this.createSimulcastTransceiverSender(e,n,a,s));case 1:if(!Wr()){o.n=2;break}return this.log.debug("using add-track fallback",this.logContext),o.a(2,this.createRTCRtpSender(e.mediaStreamTrack));case 2:throw new ve("Cannot stream on this device");case 3:return o.a(2)}},u,this)}))}},{key:"createTransceiverRTCRtpSender",value:function(e,n,a){return b(this,void 0,void 0,v().m(function s(){var u,o,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(this.pcManager){l.n=1;break}throw new ve("publisher is closed");case 1:return u=[],e.mediaStream&&u.push(e.mediaStream),e instanceof ke&&(e.codec=n.videoCodec),o={direction:"sendonly",streams:u},a&&(o.sendEncodings=a),l.n=2,this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o);case 2:return c=l.v,l.a(2,c.sender)}},s,this)}))}},{key:"createSimulcastTransceiverSender",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function u(){var o,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(this.pcManager){l.n=1;break}throw new ve("publisher is closed");case 1:return o={direction:"sendonly"},s&&(o.sendEncodings=s),l.n=2,this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,o);case 2:if(c=l.v,a.videoCodec){l.n=3;break}return l.a(2);case 3:return e.setSimulcastTrackSender(a.videoCodec,c.sender),l.a(2,c.sender)}},u,this)}))}},{key:"createRTCRtpSender",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(this.pcManager){a.n=1;break}throw new ve("publisher is closed");case 1:return a.a(2,this.pcManager.addPublisherTrack(e))}},n,this)}))}},{key:"attemptReconnect",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,u,o,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(!this._isClosed){l.n=1;break}return l.a(2);case 1:if(!this.attemptingReconnect){l.n=2;break}return x.warn("already attempting reconnect, returning early",this.logContext),l.a(2);case 2:if((((a=this.clientConfiguration)===null||a===void 0?void 0:a.resumeConnection)===Ke.DISABLED||((u=(s=this.pcManager)===null||s===void 0?void 0:s.currentState)!==null&&u!==void 0?u:ce.NEW)===ce.NEW)&&(this.fullReconnectOnNext=!0),l.p=3,this.attemptingReconnect=!0,!this.fullReconnectOnNext){l.n=5;break}return l.n=4,this.restartConnection();case 4:l.n=6;break;case 5:return l.n=6,this.resumeConnection(e);case 6:this.clearPendingReconnect(),this.fullReconnectOnNext=!1,l.n=9;break;case 7:if(l.p=7,c=l.v,this.reconnectAttempts+=1,o=!0,c instanceof ve?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:c})),o=!1):c instanceof Bn||(this.fullReconnectOnNext=!0),!o){l.n=8;break}this.handleDisconnect("reconnect",nn.RR_UNKNOWN),l.n=9;break;case 8:return this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(q.Disconnected),l.n=9,this.close();case 9:return l.p=9,this.attemptingReconnect=!1,l.f(9);case 10:return l.a(2)}},n,this,[[3,7,9,10]])}))}},{key:"getNextRetryDelay",value:function(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}},{key:"restartConnection",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,u,o,c,l,d,f;return v().w(function(h){for(;;)switch(h.n){case 0:if(h.p=0,!(!this.url||!this.token)){h.n=1;break}throw new ve("could not reconnect, url or token not saved");case 1:if(this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(q.Restarting),this.client.isDisconnected){h.n=2;break}return h.n=2,this.client.sendLeave();case 2:return h.n=3,this.cleanupPeerConnections();case 3:return h.n=4,this.cleanupClient();case 4:if(h.p=4,this.signalOpts){h.n=5;break}throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Bn;case 5:return h.n=6,this.join(e??this.url,this.token,this.signalOpts);case 6:o=h.v,h.n=9;break;case 7:if(h.p=7,d=h.v,!(d instanceof se&&d.reason===0)){h.n=8;break}throw new ve("could not reconnect, token might be expired");case 8:throw new Bn;case 9:if(!this.shouldFailNext){h.n=10;break}throw this.shouldFailNext=!1,new Error("simulated failure");case 10:return this.client.setReconnected(),this.emit(q.SignalRestarted,o),h.n=11,this.waitForPCReconnected();case 11:if(this.client.currentState===ue.CONNECTED){h.n=12;break}throw new Bn("Signal connection got severed during reconnect");case 12:this.client.setReconnected(),this.emit(q.SignalRestarted,o),(a=this.regionUrlProvider)===null||a===void 0||a.resetAttempts(),this.emit(q.Restarted),c=Date.now(),this.disconnectStartTimePrimary==0&&(this.disconnectStartTimePrimary=c),this.disconnectStartTimeSecondary==0&&(this.disconnectStartTimeSecondary=c),this.emit(q.PrimaryDelay,c-this.disconnectStartTimePrimary),this.emit(q.SecondaryDelay,c-this.disconnectStartTimeSecondary),this.disconnectStartTimePrimary=this.disconnectStartTimeSecondary=0,h.n=17;break;case 13:return h.p=13,f=h.v,h.n=14,(s=this.regionUrlProvider)===null||s===void 0?void 0:s.getNextBestRegionUrl();case 14:if(l=h.v,!l){h.n=16;break}return h.n=15,this.restartConnection(l);case 15:return h.a(2);case 16:throw(u=this.regionUrlProvider)===null||u===void 0||u.resetAttempts(),f;case 17:return h.a(2)}},n,this,[[4,7],[0,13]])}))}},{key:"resumeConnection",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,u,o,c;return v().w(function(l){for(;;)switch(l.n){case 0:if(!(!this.url||!this.token)){l.n=1;break}throw new ve("could not reconnect, url or token not saved");case 1:if(this.pcManager){l.n=2;break}throw new ve("publisher and subscriber connections unset");case 2:return this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(q.Resuming),l.p=3,this.setupSignalClientCallbacks(),l.n=4,this.client.reconnect(this.url,this.token,this.participantSid,e);case 4:s=l.v,l.n=8;break;case 5:if(l.p=5,c=l.v,u="",c instanceof Error&&(u=c.message,this.log.error(c.message,Object.assign(Object.assign({},this.logContext),{error:c}))),!(c instanceof se&&c.reason===0)){l.n=6;break}throw new ve("could not reconnect, token might be expired");case 6:if(!(c instanceof se&&c.reason===4)){l.n=7;break}throw c;case 7:throw new Bn(u);case 8:if(this.emit(q.SignalResumed),s?(o=this.makeRTCConfiguration(s),this.pcManager.updateConfiguration(o)):this.log.warn("Did not receive reconnect response",this.logContext),!this.shouldFailNext){l.n=9;break}throw this.shouldFailNext=!1,new Error("simulated failure");case 9:return l.n=10,this.pcManager.triggerIceRestart();case 10:return l.n=11,this.waitForPCReconnected();case 11:if(this.client.currentState===ue.CONNECTED){l.n=12;break}throw new Bn("Signal connection got severed during reconnect");case 12:this.hasPublished&&(this.disconnectStartTimePrimary==0||this.disconnectStartTimeSecondary==0)&&this.firstReconnectAttempt&&(this.disconnectStartTimePrimary=this.disconnectStartTimeSecondary=Date.now(),this.firstReconnectAttempt=!1),this.client.setReconnected(),((a=this.reliableDC)===null||a===void 0?void 0:a.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(q.Resumed);case 13:return l.a(2)}},n,this,[[3,5]])}))}},{key:"waitForPCInitialConnection",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:if(this.pcManager){s.n=1;break}throw new ve("PC manager is closed");case 1:return s.n=2,this.pcManager.ensurePCTransportConnection(n,e);case 2:return s.a(2)}},a,this)}))}},{key:"waitForPCReconnected",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,u,o;return v().w(function(c){for(;;)switch(c.n){case 0:return this.pcState=_e.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext),c.p=1,c.n=2,Ge(ms);case 2:if(this.pcManager){c.n=3;break}throw new ve("PC manager is closed");case 3:return c.n=4,this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout);case 4:a=Date.now(),s=a,this.pcState=_e.Reconnecting;case 5:if(!(s-a<this.peerConnectionTimeout)){c.n=8;break}if(this.primaryPC!==void 0){c.n=6;break}return c.a(3,8);case 6:s-a>ms&&((n=this.primaryPC)===null||n===void 0?void 0:n.connectionState)==="connected"&&(u=Date.now(),this.disconnectStartTimePrimary==0&&(this.disconnectStartTimePrimary=u),this.disconnectStartTimeSecondary==0&&(this.disconnectStartTimeSecondary=u),this.emit(q.PrimaryDelay,u-this.disconnectStartTimePrimary),this.emit(q.SecondaryDelay,u-this.disconnectStartTimeSecondary),this.disconnectStartTimePrimary=0,this.disconnectStartTimeSecondary=0,this.firstReconnectAttempt=!0);case 7:c.n=5;break;case 8:c.n=10;break;case 9:throw c.p=9,o=c.v,this.pcState=_e.Disconnected,new se("could not establish PC connection, ".concat(o.message),2);case 10:return c.a(2)}},e,this,[[1,9]])}))}},{key:"sendDataPacket",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s,u;return v().w(function(o){for(;;)switch(o.n){case 0:return s=e.toBinary(),o.n=1,this.ensurePublisherConnected(n);case 1:u=this.dataChannelForKind(n),u&&u.send(s),this.updateAndEmitDCBufferStatus(n);case 2:return o.a(2)}},a,this)}))}},{key:"ensureDataTransportConnected",value:function(e){return b(this,arguments,void 0,function(n){var a=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return v().m(function u(){var o,c,l,d,f,h;return v().w(function(p){for(;;)switch(p.n){case 0:if(a.pcManager){p.n=1;break}throw new ve("PC manager is closed");case 1:if(c=s?a.pcManager.subscriber:a.pcManager.publisher,l=s?"Subscriber":"Publisher",c){p.n=2;break}throw new se("".concat(l," connection not set"),2);case 2:if(d=!1,!s&&!a.dataChannelForKind(n,s)&&(a.createDataChannels(),d=!0),!d&&!s&&!a.pcManager.publisher.isICEConnected&&a.pcManager.publisher.getICEConnectionState()!=="checking"&&(d=!0),d&&a.negotiate(),f=a.dataChannelForKind(n,s),(f==null?void 0:f.readyState)!=="open"){p.n=3;break}return p.a(2);case 3:h=new Date().getTime()+a.peerConnectionTimeout;case 4:if(!(new Date().getTime()<h)){p.n=7;break}if(!(c.isICEConnected&&((o=a.dataChannelForKind(n,s))===null||o===void 0?void 0:o.readyState)==="open")){p.n=5;break}return p.a(2);case 5:return p.n=6,Ge(50);case 6:p.n=4;break;case 7:throw new se("could not establish ".concat(l," connection, state: ").concat(c.getICEConnectionState()),2);case 8:return p.a(2)}},u)})()})}},{key:"ensurePublisherConnected",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),a.n=1,this.publisherConnectionPromise;case 1:return a.a(2)}},n,this)}))}},{key:"verifyTransport",value:function(){return!(!this.pcManager||this.pcManager.currentState!==ce.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}},{key:"negotiate",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this;return v().w(function(a){for(;;)switch(a.n){case 0:return a.a(2,new Promise(function(s,u){return b(n,void 0,void 0,v().m(function o(){var c=this,l,d,f;return v().w(function(h){for(;;)switch(h.n){case 0:if(this.pcManager){h.n=1;break}return u(new _r("PC manager is closed")),h.a(2);case 1:return this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels(),l=new AbortController,d=function(){l.abort(),c.log.debug("engine disconnected while negotiation was ongoing",c.logContext),s()},this.isClosed&&u("cannot negotiate on closed engine"),this.on(q.Closing,d),this.pcManager.publisher.once(Gn.RTPVideoPayloadTypes,function(p){var g=new Map;p.forEach(function(k){var y=k.codec.toLowerCase();cl(y)&&g.set(k.payload,y)}),c.emit(q.RTPVideoMapUpdate,g)}),h.p=2,h.n=3,this.pcManager.negotiate(l);case 3:s(),h.n=5;break;case 4:h.p=4,f=h.v,f instanceof _r&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",nn.RR_UNKNOWN),u(f);case 5:return h.p=5,this.off(q.Closing,d),h.f(5);case 6:return h.a(2)}},o,this,[[2,4,5,6]])}))}))}},e)}))}},{key:"dataChannelForKind",value:function(e,n){if(n){if(e===re.LOSSY)return this.lossyDCSub;if(e===re.RELIABLE)return this.reliableDCSub}else{if(e===re.LOSSY)return this.lossyDC;if(e===re.RELIABLE)return this.reliableDC}}},{key:"sendSyncState",value:function(e,n){var a,s;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}var u=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),c=(s=(a=this.signalOpts)===null||a===void 0?void 0:a.autoSubscribe)!==null&&s!==void 0?s:!0,l=new Array,d=new Array;e.forEach(function(f){f.isDesired!==c&&l.push(f.trackSid),f.isEnabled||d.push(f.trackSid)}),this.client.sendSyncState(new zt({answer:u?pi({sdp:u.sdp,type:u.type}):void 0,offer:o?pi({sdp:o.sdp,type:o.type}):void 0,subscription:new On({trackSids:l,subscribe:!c,participantTracks:[]}),publishTracks:Xc(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:d}))}},{key:"failNext",value:function(){this.shouldFailNext=!0}},{key:"dataChannelsInfo",value:function(){var e=[],n=function(s,u){(s==null?void 0:s.id)!==void 0&&s.id!==null&&e.push(new $t({label:s.label,id:s.id,target:u}))};return n(this.dataChannelForKind(re.LOSSY),Te.PUBLISHER),n(this.dataChannelForKind(re.RELIABLE),Te.PUBLISHER),n(this.dataChannelForKind(re.LOSSY,!0),Te.SUBSCRIBER),n(this.dataChannelForKind(re.RELIABLE,!0),Te.SUBSCRIBER),e}},{key:"clearReconnectTimeout",value:function(){this.reconnectTimeout&&ye.clearTimeout(this.reconnectTimeout)}},{key:"clearPendingReconnect",value:function(){this.clearReconnectTimeout(),this.reconnectAttempts=0}},{key:"registerOnLineListener",value:function(){Ie()&&window.addEventListener("online",this.handleBrowserOnLine)}},{key:"deregisterOnLineListener",value:function(){Ie()&&window.removeEventListener("online",this.handleBrowserOnLine)}}])}(en.EventEmitter),Bn=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t)}(Tt(Error));function Hl(r){return r!==void 0&&r>13}function Wl(r,t){var i=r.participantIdentity?r.participantIdentity:t.participantIdentity;r.participantIdentity=i,t.participantIdentity=i;var e=r.destinationIdentities.length!==0?r.destinationIdentities:t.destinationIdentities;r.destinationIdentities=e,t.destinationIdentities=e}var vs=function(){function r(t,i){P(this,r),this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=i}return E(r,[{key:"updateToken",value:function(i){this.token=i}},{key:"isCloud",value:function(){return Kr(this.serverUrl)}},{key:"getServerUrl",value:function(){return this.serverUrl}},{key:"getNextBestRegionUrl",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n=this,a,s;return v().w(function(u){for(;;)switch(u.n){case 0:if(this.isCloud()){u.n=1;break}throw Error("region availability is only supported for LiveKit Cloud domains");case 1:if(!(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)){u.n=3;break}return u.n=2,this.fetchRegionSettings(i);case 2:this.regionSettings=u.v;case 3:if(a=this.regionSettings.regions.filter(function(o){return!n.attemptedRegions.find(function(c){return c.url===o.url})}),!(a.length>0)){u.n=4;break}return s=a[0],this.attemptedRegions.push(s),x.debug("next region: ".concat(s.region)),u.a(2,s.url);case 4:return u.a(2,null);case 5:return u.a(2)}},e,this)}))}},{key:"resetAttempts",value:function(){this.attemptedRegions=[]}},{key:"fetchRegionSettings",value:function(i){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,fetch("".concat(Gl(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:i});case 1:if(n=s.v,!n.ok){s.n=3;break}return s.n=2,n.json();case 2:return a=s.v,this.lastUpdateAt=Date.now(),s.a(2,a);case 3:throw new se("Could not fetch region settings: ".concat(n.statusText),n.status===401?0:2,n.status);case 4:return s.a(2)}},e,this)}))}},{key:"setServerReportedRegions",value:function(i){this.regionSettings=i,this.lastUpdateAt=Date.now()}}])}();function Gl(r){return"".concat(r.protocol.replace("ws","http"),"//").concat(r.host,"/settings")}var Ee=function(r){function t(i,e,n){var a;return P(this,t),a=O(this,t,[e]),a.code=i,a.message=gs(e,t.MAX_MESSAGE_BYTES),a.data=n?gs(n,t.MAX_DATA_BYTES):void 0,a}return N(t,r),E(t,[{key:"toProto",value:function(){return new Bt({code:this.code,message:this.message,data:this.data})}}],[{key:"fromProto",value:function(e){return new t(e.code,e.message,e.data)}},{key:"builtIn",value:function(e,n){return new t(t.ErrorCode[e],t.ErrorMessage[e],n)}}])}(Tt(Error));Ee.MAX_MESSAGE_BYTES=256;Ee.MAX_DATA_BYTES=15360;Ee.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403};Ee.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server"};var ps=15360;function Yr(r){var t=new TextEncoder;return t.encode(r).length}function gs(r,t){if(Yr(r)<=t)return r;for(var i=0,e=r.length,n=new TextEncoder;i<e;){var a=Math.floor((i+e+1)/2);n.encode(r.slice(0,a)).length<=t?i=a:e=a-1}return r.slice(0,i)}var Go=function(r){function t(i,e,n,a,s){var u;return P(this,t),u=O(this,t,[i,n,s]),u.sid=e,u.receiver=a,u}return N(t,r),E(t,[{key:"setMuted",value:function(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?_.Muted:_.Unmuted,this))}},{key:"setMediaStream",value:function(e){var n=this;this.mediaStream=e;var a=function(u){u.track===n._mediaStreamTrack&&(e.removeEventListener("removetrack",a),n.receiver&&"playoutDelayHint"in n.receiver&&(n.receiver.playoutDelayHint=void 0),n.receiver=void 0,n._currentBitrate=0,n.emit(_.Ended,n))};e.addEventListener("removetrack",a)}},{key:"start",value:function(){this.startMonitor(),X(t,"enable",this,3)([])}},{key:"stop",value:function(){this.stopMonitor(),X(t,"disable",this,3)([])}},{key:"getRTCStatsReport",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:if(!((n=this.receiver)===null||n===void 0)&&n.getStats){s.n=1;break}return s.a(2);case 1:return s.n=2,this.receiver.getStats();case 2:return a=s.v,s.a(2,a)}},e,this)}))}},{key:"setPlayoutDelay",value:function(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}},{key:"getPlayoutDelay",value:function(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}},{key:"startMonitor",value:function(){var e=this;this.monitorInterval||(this.monitorInterval=setInterval(function(){return e.monitorReceiver()},pa)),Zc()&&this.registerTimeSyncUpdate()}},{key:"registerTimeSyncUpdate",value:function(){var e=this,n=function(){var s;e.timeSyncHandle=requestAnimationFrame(function(){return n()});var u=(s=e.receiver)===null||s===void 0?void 0:s.getSynchronizationSources()[0];if(u){var o=u.timestamp,c=u.rtpTimestamp;c&&e.rtpTimestamp!==c&&(e.emit(_.TimeSyncUpdate,{timestamp:o,rtpTimestamp:c}),e.rtpTimestamp=c)}};n()}}])}(L),bt=function(r){function t(i,e,n,a,s,u){var o;return P(this,t),o=O(this,t,[i,e,L.Kind.Audio,n,u]),o.monitorReceiver=function(){return b(o,void 0,void 0,v().m(function c(){var l;return v().w(function(d){for(;;)switch(d.n){case 0:if(this.receiver){d.n=1;break}return this._currentBitrate=0,d.a(2);case 1:return d.n=2,this.getReceiverStats();case 2:l=d.v,l&&this.prevStats&&this.receiver&&(this._currentBitrate=ur(l,this.prevStats)),this.prevStats=l;case 3:return d.a(2)}},c,this)}))},o.audioContext=a,o.webAudioPluginNodes=[],s&&(o.sinkId=s.deviceId),o}return N(t,r),E(t,[{key:"setVolume",value:function(e){var n,a=$(this.attachedElements),s;try{for(a.s();!(s=a.n()).done;){var u=s.value;this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):u.volume=e}}catch(o){a.e(o)}finally{a.f()}dn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}},{key:"getVolume",value:function(){if(this.elementVolume)return this.elementVolume;if(dn())return 1;var e=0;return this.attachedElements.forEach(function(n){n.volume>e&&(e=n.volume)}),e}},{key:"setSinkId",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return this.sinkId=e,a.n=1,Promise.all(this.attachedElements.map(function(s){if(Gr(s))return s.setSinkId(e)}));case 1:return a.a(2)}},n,this)}))}},{key:"attach",value:function(e){var n=this.attachedElements.length===0;return e?X(t,"attach",this,3)([e]):e=X(t,"attach",this,3)([]),this.sinkId&&Gr(e)&&e.setSinkId(this.sinkId),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}},{key:"detach",value:function(e){var n;return e?(n=X(t,"detach",this,3)([e]),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=X(t,"detach",this,3)([]),this.disconnectWebAudio()),n}},{key:"setAudioContext",value:function(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}},{key:"setWebAudioPlugins",value:function(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}},{key:"connectWebAudio",value:function(e,n){var a=this;this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);var s=this.sourceNode;this.webAudioPluginNodes.forEach(function(u){s.connect(u),s=u}),this.gainNode=e.createGain(),s.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(function(){e.state!=="running"&&a.emit(_.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(function(u){a.emit(_.AudioPlaybackFailed,u)})}},{key:"disconnectWebAudio",value:function(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}},{key:"getReceiverStats",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a;return v().w(function(s){for(;;)switch(s.n){case 0:if(!(!this.receiver||!this.receiver.getStats)){s.n=1;break}return s.a(2);case 1:return s.n=2,this.receiver.getStats();case 2:return n=s.v,n.forEach(function(u){u.type==="inbound-rtp"&&(a={type:"audio",streamId:u.id,timestamp:u.timestamp,jitter:u.jitter,bytesReceived:u.bytesReceived,concealedSamples:u.concealedSamples,concealmentEvents:u.concealmentEvents,silentConcealedSamples:u.silentConcealedSamples,silentConcealmentEvents:u.silentConcealmentEvents,totalAudioEnergy:u.totalAudioEnergy,totalSamplesDuration:u.totalSamplesDuration})}),s.a(2,a)}},e,this)}))}}])}(Go),Cr=100,Kn=function(r){function t(i,e,n,a,s){var u;return P(this,t),u=O(this,t,[i,e,L.Kind.Video,n,s]),u.elementInfos=[],u.monitorReceiver=function(){return b(u,void 0,void 0,v().m(function o(){var c;return v().w(function(l){for(;;)switch(l.n){case 0:if(this.receiver){l.n=1;break}return this._currentBitrate=0,l.a(2);case 1:return l.n=2,this.getReceiverStats();case 2:c=l.v,c&&this.prevStats&&this.receiver&&(this._currentBitrate=ur(c,this.prevStats)),this.prevStats=c;case 3:return l.a(2)}},o,this)}))},u.debouncedHandleResize=da(function(){u.updateDimensions()},Cr),u.adaptiveStreamSettings=a,u}return N(t,r),E(t,[{key:"isAdaptiveStream",get:function(){return this.adaptiveStreamSettings!==void 0}},{key:"mediaStreamTrack",get:function(){return this._mediaStreamTrack}},{key:"setMuted",value:function(e){var n=this;X(t,"setMuted",this,3)([e]),this.attachedElements.forEach(function(a){e?Hn(n._mediaStreamTrack,a):_n(n._mediaStreamTrack,a)})}},{key:"attach",value:function(e){if(e?X(t,"attach",this,3)([e]):e=X(t,"attach",this,3)([]),this.adaptiveStreamSettings&&this.elementInfos.find(function(a){return a.element===e})===void 0){var n=new Kl(e);this.observeElementInfo(n)}return e}},{key:"observeElementInfo",value:function(e){var n=this;this.adaptiveStreamSettings&&this.elementInfos.find(function(a){return a===e})===void 0?(e.handleResize=function(){n.debouncedHandleResize()},e.handleVisibilityChanged=function(){n.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}},{key:"stopObservingElementInfo",value:function(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}var n=this.elementInfos.filter(function(o){return o===e}),a=$(n),s;try{for(a.s();!(s=a.n()).done;){var u=s.value;u.stopObserving()}}catch(o){a.e(o)}finally{a.f()}this.elementInfos=this.elementInfos.filter(function(o){return o!==e}),this.updateVisibility(),this.debouncedHandleResize()}},{key:"detach",value:function(e){var n=[];if(e)return this.stopObservingElement(e),X(t,"detach",this,3)([e]);n=X(t,"detach",this,3)([]);var a=$(n),s;try{for(a.s();!(s=a.n()).done;){var u=s.value;this.stopObservingElement(u)}}catch(o){a.e(o)}finally{a.f()}return n}},{key:"getDecoderImplementation",value:function(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}},{key:"getReceiverStats",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,u;return v().w(function(o){for(;;)switch(o.n){case 0:if(!(!this.receiver||!this.receiver.getStats)){o.n=1;break}return o.a(2);case 1:return o.n=2,this.receiver.getStats();case 2:return n=o.v,s="",u=new Map,n.forEach(function(c){c.type==="inbound-rtp"?(s=c.codecId,a={type:"video",streamId:c.id,framesDecoded:c.framesDecoded,framesDropped:c.framesDropped,framesReceived:c.framesReceived,packetsReceived:c.packetsReceived,packetsLost:c.packetsLost,frameWidth:c.frameWidth,frameHeight:c.frameHeight,pliCount:c.pliCount,firCount:c.firCount,nackCount:c.nackCount,jitter:c.jitter,timestamp:c.timestamp,bytesReceived:c.bytesReceived,decoderImplementation:c.decoderImplementation}):c.type==="codec"&&u.set(c.id,c)}),a&&s!==""&&u.get(s)&&(a.mimeType=u.get(s).mimeType),o.a(2,a)}},e,this)}))}},{key:"stopObservingElement",value:function(e){var n=this.elementInfos.filter(function(o){return o.element===e}),a=$(n),s;try{for(a.s();!(s=a.n()).done;){var u=s.value;this.stopObservingElementInfo(u)}}catch(o){a.e(o)}finally{a.f()}}},{key:"handleAppVisibilityChanged",value:function(){var e=this,n=Object.create(null,{handleAppVisibilityChanged:{get:function(){return X(t,"handleAppVisibilityChanged",e,1)}}});return b(this,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,n.handleAppVisibilityChanged.call(this);case 1:if(this.isAdaptiveStream){s.n=2;break}return s.a(2);case 2:this.updateVisibility();case 3:return s.a(2)}},a,this)}))}},{key:"updateVisibility",value:function(){var e=this,n,a,s=this.elementInfos.reduce(function(l,d){return Math.max(l,d.visibilityChangedAt||0)},0),u=!((a=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&a!==void 0)||a?this.isInBackground:!1,o=this.elementInfos.some(function(l){return l.pictureInPicture}),c=this.elementInfos.some(function(l){return l.visible})&&!u||o;if(this.lastVisible!==c){if(!c&&Date.now()-s<Cr){ye.setTimeout(function(){e.updateVisibility()},Cr);return}this.lastVisible=c,this.emit(_.VisibilityChanged,c,this)}}},{key:"updateDimensions",value:function(){var e,n,a=0,s=0,u=this.getPixelDensity(),o=$(this.elementInfos),c;try{for(o.s();!(c=o.n()).done;){var l=c.value,d=l.width()*u,f=l.height()*u;d+f>a+s&&(a=d,s=f)}}catch(h){o.e(h)}finally{o.f()}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===a&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===s||(this.lastDimensions={width:a,height:s},this.emit(_.VideoDimensionsChanged,this.lastDimensions,this))}},{key:"getPixelDensity",value:function(){var e,n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;if(n==="screen")return Xa();if(!n){var a=Xa();return a>2?2:1}return n}}])}(Go),Kl=function(){function r(t,i){var e=this;P(this,r),this.onVisibilityChanged=function(n){var a,s=n.target,u=n.isIntersecting;s===e.element&&(e.isIntersecting=u,e.isPiP=ht(e.element),e.visibilityChangedAt=Date.now(),(a=e.handleVisibilityChanged)===null||a===void 0||a.call(e))},this.onEnterPiP=function(){var n,a,s;(a=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||a===void 0||a.addEventListener("pagehide",e.onLeavePiP),e.isPiP=ht(e.element),(s=e.handleVisibilityChanged)===null||s===void 0||s.call(e)},this.onLeavePiP=function(){var n;e.isPiP=ht(e.element),(n=e.handleVisibilityChanged)===null||n===void 0||n.call(e)},this.element=t,this.isIntersecting=i??Xr(t),this.isPiP=Ie()&&ht(t),this.visibilityChangedAt=0}return E(r,[{key:"visible",get:function(){return this.isPiP||this.isIntersecting}},{key:"pictureInPicture",get:function(){return this.isPiP}},{key:"width",value:function(){return this.element.clientWidth}},{key:"height",value:function(){return this.element.clientHeight}},{key:"observe",value:function(){var i=this,e,n,a;this.isIntersecting=Xr(this.element),this.isPiP=ht(this.element),this.element.handleResize=function(){var s;(s=i.handleResize)===null||s===void 0||s.call(i)},this.element.handleVisibilityChanged=this.onVisibilityChanged,xa().observe(this.element),Za().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(a=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||a===void 0||a.addEventListener("pagehide",this.onLeavePiP)}},{key:"stopObserving",value:function(){var i,e,n,a,s;(i=xa())===null||i===void 0||i.unobserve(this.element),(e=Za())===null||e===void 0||e.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(n=window.documentPictureInPicture)===null||n===void 0||n.removeEventListener("enter",this.onEnterPiP),(s=(a=window.documentPictureInPicture)===null||a===void 0?void 0:a.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}])}();function ht(r){var t,i;return document.pictureInPictureElement===r?!0:!((t=window.documentPictureInPicture)===null||t===void 0)&&t.window?Xr(r,(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window):!1}function Xr(r,t){for(var i=t||window,e=r.offsetTop,n=r.offsetLeft,a=r.offsetWidth,s=r.offsetHeight,u=r,o=u.hidden,c=getComputedStyle(r),l=c.display;r.offsetParent;)r=r.offsetParent,e+=r.offsetTop,n+=r.offsetLeft;return e<i.pageYOffset+i.innerHeight&&n<i.pageXOffset+i.innerWidth&&e+s>i.pageYOffset&&n+a>i.pageXOffset&&!o&&l!=="none"}var tn=function(r){function t(i,e,n,a){var s;P(this,t);var u;return s=O(this,t),s.metadataMuted=!1,s.encryption=pe.NONE,s.log=x,s.handleMuted=function(){s.emit(_.Muted)},s.handleUnmuted=function(){s.emit(_.Unmuted)},s.log=ln((u=a==null?void 0:a.loggerName)!==null&&u!==void 0?u:ze.Publication),s.loggerContextCb=s.loggerContextCb,s.setMaxListeners(100),s.kind=i,s.trackSid=e,s.trackName=n,s.source=L.Source.Unknown,s}return N(t,r),E(t,[{key:"setTrack",value:function(e){this.track&&(this.track.off(_.Muted,this.handleMuted),this.track.off(_.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(_.Muted,this.handleMuted),e.on(_.Unmuted,this.handleUnmuted))}},{key:"logContext",get:function(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),oe(this))}},{key:"isMuted",get:function(){return this.metadataMuted}},{key:"isEnabled",get:function(){return!0}},{key:"isSubscribed",get:function(){return this.track!==void 0}},{key:"isEncrypted",get:function(){return this.encryption!==pe.NONE}},{key:"audioTrack",get:function(){if(this.track instanceof he||this.track instanceof bt)return this.track}},{key:"videoTrack",get:function(){if(this.track instanceof ke||this.track instanceof Kn)return this.track}},{key:"updateInfo",value:function(e){this.trackSid=e.sid,this.trackName=e.name,this.source=L.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===L.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}])}(en.EventEmitter);(function(r){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(r.SubscriptionStatus||(r.SubscriptionStatus={})),function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"}(r.PermissionStatus||(r.PermissionStatus={}))})(tn||(tn={}));var gi=function(r){function t(i,e,n,a){var s;return P(this,t),s=O(this,t,[i,e.sid,e.name,a]),s.track=void 0,s.handleTrackEnded=function(){s.emit(_.Ended)},s.updateInfo(e),s.setTrack(n),s}return N(t,r),E(t,[{key:"isUpstreamPaused",get:function(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}},{key:"setTrack",value:function(e){this.track&&this.track.off(_.Ended,this.handleTrackEnded),X(t,"setTrack",this,3)([e]),e&&e.on(_.Ended,this.handleTrackEnded)}},{key:"isMuted",get:function(){return this.track?this.track.isMuted:X(t,"isMuted",this,1)}},{key:"audioTrack",get:function(){return X(t,"audioTrack",this,1)}},{key:"videoTrack",get:function(){return X(t,"videoTrack",this,1)}},{key:"mute",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.a(2,(n=this.track)===null||n===void 0?void 0:n.mute())}},e,this)}))}},{key:"unmute",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.a(2,(n=this.track)===null||n===void 0?void 0:n.unmute())}},e,this)}))}},{key:"pauseUpstream",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,(n=this.track)===null||n===void 0?void 0:n.pauseUpstream();case 1:return a.a(2)}},e,this)}))}},{key:"resumeUpstream",value:function(){return b(this,void 0,void 0,v().m(function e(){var n;return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,(n=this.track)===null||n===void 0?void 0:n.resumeUpstream();case 1:return a.a(2)}},e,this)}))}},{key:"getTrackFeatures",value:function(){var e;if(this.track instanceof he){var n=this.track.getSourceTrackSettings(),a=new Set;return n.autoGainControl&&a.add(Ae.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&a.add(Ae.TF_ECHO_CANCELLATION),n.noiseSuppression&&a.add(Ae.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&a.add(Ae.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||a.add(Ae.TF_NO_DTX),this.track.enhancedNoiseCancellation&&a.add(Ae.TF_ENHANCED_NOISE_CANCELLATION),Array.from(a.values())}else return[]}}])}(tn),He;(function(r){r.Excellent="excellent",r.Good="good",r.Poor="poor",r.Lost="lost",r.Unknown="unknown"})(He||(He={}));function zl(r){switch(r){case un.EXCELLENT:return He.Excellent;case un.GOOD:return He.Good;case un.POOR:return He.Poor;case un.LOST:return He.Lost;default:return He.Unknown}}var Ko=function(r){function t(i,e,n,a,s,u){var o,c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:kn.STANDARD;P(this,t);var l;return o=O(this,t),o.audioLevel=0,o.isSpeaking=!1,o._connectionQuality=He.Unknown,o.log=x,o.log=ln((l=u==null?void 0:u.loggerName)!==null&&l!==void 0?l:ze.Participant),o.loggerOptions=u,o.setMaxListeners(100),o.sid=i,o.identity=e,o.name=n,o.metadata=a,o.audioTrackPublications=new Map,o.videoTrackPublications=new Map,o.trackPublications=new Map,o._kind=c,o._attributes=s??{},o}return N(t,r),E(t,[{key:"logContext",get:function(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}},{key:"isEncrypted",get:function(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(function(e){return e.isEncrypted})}},{key:"isAgent",get:function(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===kn.AGENT}},{key:"kind",get:function(){return this._kind}},{key:"attributes",get:function(){return Object.freeze(Object.assign({},this._attributes))}},{key:"getTrackPublications",value:function(){return Array.from(this.trackPublications.values())}},{key:"getTrackPublication",value:function(e){var n=$(this.trackPublications),a;try{for(n.s();!(a=n.n()).done;){var s=te(a.value,2),u=s[1];if(u.source===e)return u}}catch(o){n.e(o)}finally{n.f()}}},{key:"getTrackPublicationByName",value:function(e){var n=$(this.trackPublications),a;try{for(n.s();!(a=n.n()).done;){var s=te(a.value,2),u=s[1];if(u.trackName===e)return u}}catch(o){n.e(o)}finally{n.f()}}},{key:"connectionQuality",get:function(){return this._connectionQuality}},{key:"isCameraEnabled",get:function(){var e,n=this.getTrackPublication(L.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}},{key:"isMicrophoneEnabled",get:function(){var e,n=this.getTrackPublication(L.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}},{key:"isScreenShareEnabled",get:function(){var e=this.getTrackPublication(L.Source.ScreenShare);return!!e}},{key:"isLocal",get:function(){return!1}},{key:"joinedAt",get:function(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}},{key:"updateInfo",value:function(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}},{key:"_setMetadata",value:function(e){var n=this.metadata!==e,a=this.metadata;this.metadata=e,n&&this.emit(F.ParticipantMetadataChanged,a)}},{key:"_setName",value:function(e){var n=this.name!==e;this.name=e,n&&this.emit(F.ParticipantNameChanged,e)}},{key:"_setAttributes",value:function(e){var n=xc(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(F.AttributesChanged,n)}},{key:"setPermissions",value:function(e){var n=this,a,s,u,o,c,l,d=this.permissions,f=e.canPublish!==((a=this.permissions)===null||a===void 0?void 0:a.canPublish)||e.canSubscribe!==((s=this.permissions)===null||s===void 0?void 0:s.canSubscribe)||e.canPublishData!==((u=this.permissions)===null||u===void 0?void 0:u.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((c=this.permissions)===null||c===void 0?void 0:c.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some(function(h,p){var g;return h!==((g=n.permissions)===null||g===void 0?void 0:g.canPublishSources[p])})||e.canSubscribeMetrics!==((l=this.permissions)===null||l===void 0?void 0:l.canSubscribeMetrics);return this.permissions=e,f&&this.emit(F.ParticipantPermissionsChanged,d,e),f}},{key:"setIsSpeaking",value:function(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(F.IsSpeakingChanged,e))}},{key:"setConnectionQuality",value:function(e){var n=this;this._lastProtoQuality=e,this._qualityChangeTimeout&&clearTimeout(this._qualityChangeTimeout),this._qualityChangeTimeout=setTimeout(function(){var a=zl(n._lastProtoQuality),s=n._connectionQuality;s!==a&&(n._connectionQuality=a,console.log("Connection quality changed from ".concat(s," to ").concat(a)),n.emit(F.ConnectionQualityChanged,a)),n._qualityChangeTimeout=void 0},15e3)}},{key:"setAudioContext",value:function(e){this.audioContext=e,this.audioTrackPublications.forEach(function(n){return(n.track instanceof bt||n.track instanceof he)&&n.track.setAudioContext(e)})}},{key:"addTrackPublication",value:function(e){var n=this;e.on(_.Muted,function(){n.emit(F.TrackMuted,e)}),e.on(_.Unmuted,function(){n.emit(F.TrackUnmuted,e)});var a=e;switch(a.track&&(a.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case L.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case L.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}])}(en.EventEmitter);function $l(r){var t,i,e;if(!r.participantSid&&!r.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Gt({participantIdentity:(t=r.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(i=r.participantSid)!==null&&i!==void 0?i:"",allTracks:(e=r.allowAll)!==null&&e!==void 0?e:!1,trackSids:r.allowedTrackSids||[]})}var wn=function(r){function t(i,e,n,a){var s;return P(this,t),s=O(this,t,[i,e,void 0,void 0,void 0,{loggerName:a.loggerName,loggerContextCb:function(){return s.engine.logContext}}]),s.pendingPublishing=new Set,s.pendingPublishPromises=new Map,s.participantTrackPermissions=[],s.allParticipantsAllowedToSubscribe=!0,s.encryptionType=pe.NONE,s.audioMuted=!1,s.videoMuted=!1,s.enabledPublishVideoCodecs=[],s.rpcHandlers=new Map,s.pendingAcks=new Map,s.pendingResponses=new Map,s.handleReconnecting=function(){s.reconnectFuture||(s.reconnectFuture=new Uo)},s.handleReconnected=function(){var u,o;(o=(u=s.reconnectFuture)===null||u===void 0?void 0:u.resolve)===null||o===void 0||o.call(u),s.reconnectFuture=void 0,s.updateTrackSubscriptionPermissions()},s.handleDisconnected=function(){var u,o;s.reconnectFuture&&(s.reconnectFuture.promise.catch(function(c){return s.log.warn(c.message,s.logContext)}),(o=(u=s.reconnectFuture)===null||u===void 0?void 0:u.reject)===null||o===void 0||o.call(u,"Got disconnected during reconnection attempt"),s.reconnectFuture=void 0)},s.handleSignalRequestResponse=function(u){var o=u.requestId,c=u.reason,l=u.message,d=s.pendingSignalRequests.get(o);d&&(c!==Zn.OK&&d.reject(new za(l,c)),s.pendingSignalRequests.delete(o))},s.handleDataPacket=function(u){switch(u.value.case){case"rpcRequest":var o=u.value.value;s.handleIncomingRpcRequest(u.participantIdentity,o.id,o.method,o.payload,o.responseTimeoutMs);break;case"rpcResponse":var c=u.value.value,l=null,d=null;c.value.case==="payload"?l=c.value.value:c.value.case==="error"&&(d=Ee.fromProto(c.value.value)),s.handleIncomingRpcResponse(c.requestId,l,d);break;case"rpcAck":var f=u.value.value;s.handleIncomingRpcAck(f.requestId);break}},s.updateTrackSubscriptionPermissions=function(){s.log.debug("updating track subscription permissions",Object.assign(Object.assign({},s.logContext),{allParticipantsAllowed:s.allParticipantsAllowedToSubscribe,participantTrackPermissions:s.participantTrackPermissions})),s.engine.client.sendUpdateSubscriptionPermissions(s.allParticipantsAllowedToSubscribe,s.participantTrackPermissions.map(function(u){return $l(u)}))},s.onTrackUnmuted=function(u){s.onTrackMuted(u,u.isUpstreamPaused)},s.onTrackMuted=function(u,o){if(o===void 0&&(o=!0),!u.sid){s.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},s.logContext),oe(u)));return}u.kind==L.Kind.Audio?o?sessionStorage.setItem("isAudioMuted","true"):sessionStorage.setItem("isAudioMuted","false"):o?sessionStorage.setItem("isVideoMuted","true"):sessionStorage.setItem("isVideoMuted","false"),s.engine.updateMuteStatus(u.sid,o)},s.onTrackUpstreamPaused=function(u){s.log.debug("upstream paused",Object.assign(Object.assign({},s.logContext),oe(u))),s.onTrackMuted(u,!0)},s.onTrackUpstreamResumed=function(u){s.log.debug("upstream resumed",Object.assign(Object.assign({},s.logContext),oe(u))),s.onTrackMuted(u,u.isMuted)},s.onTrackFeatureUpdate=function(u){var o=s.audioTrackPublications.get(u.sid);if(!o){s.log.warn("Could not update local audio track settings, missing publication for track ".concat(u.sid),s.logContext);return}s.engine.client.sendUpdateLocalAudioTrack(o.trackSid,o.getTrackFeatures())},s.handleSubscribedQualityUpdate=function(u){return b(s,void 0,void 0,v().m(function o(){var c,l,d,f,h,p,g,k,y,S,T,C,w;return v().w(function(I){for(;;)switch(I.n){case 0:if(!((h=this.roomOptions)===null||h===void 0)&&h.dynacast){I.n=1;break}return I.a(2);case 1:if(g=this.videoTrackPublications.get(u.trackSid),g){I.n=2;break}return this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid})),I.a(2);case 2:if(!(u.subscribedCodecs.length>0)){I.n=17;break}if(g.videoTrack){I.n=3;break}return I.a(2);case 3:return I.n=4,g.videoTrack.setPublishingCodecs(u.subscribedCodecs);case 4:k=I.v,I.p=5,y=!0,S=Jn(k);case 6:return I.n=7,S.next();case 7:if(T=I.v,c=T.done,c){I.n=9;break}if(f=T.value,y=!1,C=f,!Kc(C)){I.n=8;break}return this.log.debug("publish ".concat(C," for ").concat(g.videoTrack.sid),Object.assign(Object.assign({},this.logContext),oe(g))),I.n=8,this.publishAdditionalCodecForTrack(g.videoTrack,C,g.options);case 8:y=!0,I.n=6;break;case 9:I.n=11;break;case 10:I.p=10,w=I.v,l={error:w};case 11:if(I.p=11,I.p=12,!(!y&&!c&&(d=S.return))){I.n=13;break}return I.n=13,d.call(S);case 13:if(I.p=13,!l){I.n=14;break}throw l.error;case 14:return I.f(13);case 15:return I.f(11);case 16:I.n=18;break;case 17:if(!(u.subscribedQualities.length>0)){I.n=18;break}return I.n=18,(p=g.videoTrack)===null||p===void 0?void 0:p.setPublishingLayers(u.subscribedQualities);case 18:return I.a(2)}},o,this,[[12,,13,15],[5,10,11,16]])}))},s.handleLocalTrackUnpublished=function(u){var o=s.trackPublications.get(u.trackSid);if(!o){s.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},s.logContext),{trackSid:u.trackSid}));return}s.unpublishTrack(o.track)},s.handleTrackEnded=function(u){return b(s,void 0,void 0,v().m(function o(){var c;return v().w(function(l){for(;;)switch(l.n){case 0:if(!(u.source===L.Source.ScreenShare||u.source===L.Source.ScreenShareAudio)){l.n=1;break}this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),oe(u))),this.unpublishTrack(u),l.n=12;break;case 1:if(!u.isUserProvided){l.n=3;break}return l.n=2,u.mute();case 2:l.n=12;break;case 3:if(!(u instanceof he||u instanceof ke)){l.n=12;break}if(l.p=4,!Ie()){l.n=9;break}return l.p=5,l.n=6,navigator==null?void 0:navigator.permissions.query({name:u.source===L.Source.Camera?"camera":"microphone"});case 6:if(c=l.v,!(c&&c.state==="denied")){l.n=7;break}throw this.log.warn("user has revoked access to ".concat(u.source),Object.assign(Object.assign({},this.logContext),oe(u))),c.onchange=function(){c.state!=="denied"&&(u.isMuted||u.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied");case 7:l.n=9;break;case 8:l.p=8,l.v;case 9:if(u.isMuted){l.n=10;break}return this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),oe(u))),l.n=10,u.restartTrack();case 10:l.n=12;break;case 11:return l.p=11,l.v,this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),oe(u))),l.n=12,u.mute();case 12:return l.a(2)}},o,this,[[5,8],[4,11]])}))},s.audioTrackPublications=new Map,s.videoTrackPublications=new Map,s.trackPublications=new Map,s.engine=n,s.roomOptions=a,s.setupEngine(n),s.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),s.pendingSignalRequests=new Map,s}return N(t,r),E(t,[{key:"lastCameraError",get:function(){return this.cameraError}},{key:"lastMicrophoneError",get:function(){return this.microphoneError}},{key:"isE2EEEnabled",get:function(){return this.encryptionType!==pe.NONE}},{key:"getTrackPublication",value:function(e){var n=X(t,"getTrackPublication",this,3)([e]);if(n)return n}},{key:"getTrackPublicationByName",value:function(e){var n=X(t,"getTrackPublicationByName",this,3)([e]);if(n)return n}},{key:"setupEngine",value:function(e){var n=this;this.engine=e,this.engine.on(q.RemoteMute,function(a,s){var u=n.trackPublications.get(a);!u||!u.track||(s?(u.kind=="audio"?(n.audioMuted=!0,sessionStorage.setItem("isAudioMuted","true")):(n.videoMuted=!0,sessionStorage.setItem("isVideoMuted","true")),u.mute()):(u.kind=="audio"?sessionStorage.setItem("isAudioMuted","false"):sessionStorage.setItem("isVideoMuted","false"),u.unmute()))}),this.engine.on(q.Connected,this.handleReconnected).on(q.SignalRestarted,this.handleReconnected).on(q.SignalResumed,this.handleReconnected).on(q.Restarting,this.handleReconnecting).on(q.Resuming,this.handleReconnecting).on(q.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(q.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(q.Disconnected,this.handleDisconnected).on(q.SignalRequestResponse,this.handleSignalRequestResponse).on(q.DataPacketReceived,this.handleDataPacket)}},{key:"setMetadata",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,this.requestMetadataUpdate({metadata:e});case 1:return a.a(2)}},n,this)}))}},{key:"setName",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,this.requestMetadataUpdate({name:e});case 1:return a.a(2)}},n,this)}))}},{key:"setAttributes",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return a.n=1,this.requestMetadataUpdate({attributes:e});case 1:return a.a(2)}},n,this)}))}},{key:"requestMetadataUpdate",value:function(e){return b(this,arguments,void 0,function(n){var a=this,s=n.metadata,u=n.name,o=n.attributes;return v().m(function c(){return v().w(function(l){for(;;)switch(l.n){case 0:return l.a(2,new Promise(function(d,f){return b(a,void 0,void 0,v().m(function h(){var p=this,g,k,y,S,T,C;return v().w(function(w){for(;;)switch(w.n){case 0:return w.p=0,y=!1,w.n=1,this.engine.client.sendUpdateLocalMetadata((g=s??this.metadata)!==null&&g!==void 0?g:"",(k=u??this.name)!==null&&k!==void 0?k:"",o);case 1:S=w.v,T=performance.now(),this.pendingSignalRequests.set(S,{resolve:d,reject:function(R){f(R),y=!0},values:{name:u,metadata:s,attributes:o}});case 2:if(!(performance.now()-T<5e3&&!y)){w.n=5;break}if(!((!u||this.name===u)&&(!s||this.metadata===s)&&(!o||Object.entries(o).every(function(I){var R=te(I,2),U=R[0],M=R[1];return p.attributes[U]===M||M===""&&!p.attributes[U]})))){w.n=3;break}return this.pendingSignalRequests.delete(S),d(),w.a(2);case 3:return w.n=4,Ge(50);case 4:w.n=2;break;case 5:f(new za("Request to update local metadata timed out","TimeoutError")),w.n=7;break;case 6:w.p=6,C=w.v,C instanceof Error&&f(C);case 7:return w.a(2)}},h,this,[[0,6]])}))}))}},c)})()})}},{key:"setCameraEnabled",value:function(e,n,a){return this.setTrackEnabled(L.Source.Camera,e,n,a)}},{key:"setMicrophoneEnabled",value:function(e,n,a){return this.setTrackEnabled(L.Source.Microphone,e,n,a)}},{key:"setScreenShareEnabled",value:function(e,n,a){return this.setTrackEnabled(L.Source.ScreenShare,e,n,a)}},{key:"setPermissions",value:function(e){var n=this.permissions,a=X(t,"setPermissions",this,3)([e]);return a&&n&&this.emit(F.ParticipantPermissionsChanged,n),a}},{key:"setE2EEEnabled",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:return this.encryptionType=e?pe.GCM:pe.NONE,a.n=1,this.republishAllTracks(void 0,!1);case 1:return a.a(2)}},n,this)}))}},{key:"setTrackEnabled",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function u(){var o,c,l,d,f,h,p,g,k,y,S,T,C,w,I;return v().w(function(R){for(;;)switch(R.n){case 0:if(this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),!this.republishPromise){R.n=1;break}return R.n=1,this.republishPromise;case 1:if(l=this.getTrackPublication(e),!n){R.n=21;break}if(!(l&&l.track)){R.n=2;break}this.onTrackMuted(l.track,!1),R.n=20;break;case 2:if(!this.pendingPublishing.has(e)){R.n=5;break}return R.n=3,this.waitForPendingPublicationOfSource(e);case 3:return f=R.v,f||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),R.n=4,f==null?void 0:f.unmute();case 4:return R.a(2,f);case 5:this.pendingPublishing.add(e),R.p=6,C=e,R.n=C===L.Source.Camera?7:C===L.Source.Microphone?9:C===L.Source.ScreenShare?11:13;break;case 7:return R.n=8,this.createTracks({video:(o=a)!==null&&o!==void 0?o:!0});case 8:return d=R.v,R.a(3,14);case 9:return R.n=10,this.createTracks({audio:(c=a)!==null&&c!==void 0?c:!0});case 10:return d=R.v,R.a(3,14);case 11:return R.n=12,this.createScreenTracks(Object.assign({},a));case 12:return d=R.v,R.a(3,14);case 13:throw new sn(e);case 14:R.n=16;break;case 15:throw R.p=15,w=R.v,d==null||d.forEach(function(U){U.stop()}),w instanceof Error&&this.emit(F.MediaDevicesError,w),this.pendingPublishing.delete(e),w;case 16:R.p=16,h=[],p=$(d);try{for(p.s();!(g=p.n()).done;)k=g.value,this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),oe(k))),h.push(this.publishTrack(k,s))}catch(U){p.e(U)}finally{p.f()}return R.n=17,Promise.all(h);case 17:y=R.v,S=te(y,1),l=S[0],R.n=19;break;case 18:throw R.p=18,I=R.v,d==null||d.forEach(function(U){U.stop()}),I;case 19:return R.p=19,this.pendingPublishing.delete(e),R.f(19);case 20:R.n=26;break;case 21:if(!(!(l!=null&&l.track)&&this.pendingPublishing.has(e))){R.n=23;break}return R.n=22,this.waitForPendingPublicationOfSource(e);case 22:l=R.v,l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}));case 23:if(!(l&&l.track)){R.n=26;break}if(e!==L.Source.ScreenShare){R.n=25;break}return R.n=24,this.unpublishTrack(l.track);case 24:l=R.v,T=this.getTrackPublication(L.Source.ScreenShareAudio),T&&T.track&&this.unpublishTrack(T.track),R.n=26;break;case 25:l.source=="microphone"&&(this.audioMuted=!0),l.source=="camera"&&(this.videoMuted=!0),this.onTrackMuted(l.track,!0);case 26:return R.a(2,l)}},u,this,[[16,18,19,20],[6,15]])}))}},{key:"enableCameraAndMicrophone",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this,a;return v().w(function(s){for(;;)switch(s.n){case 0:if(!(this.pendingPublishing.has(L.Source.Camera)||this.pendingPublishing.has(L.Source.Microphone))){s.n=1;break}return s.a(2);case 1:return this.pendingPublishing.add(L.Source.Camera),this.pendingPublishing.add(L.Source.Microphone),s.p=2,s.n=3,this.createTracks({audio:!0,video:!0});case 3:return a=s.v,s.n=4,Promise.all(a.map(function(u){return n.publishTrack(u)}));case 4:return s.p=4,this.pendingPublishing.delete(L.Source.Camera),this.pendingPublishing.delete(L.Source.Microphone),s.f(4);case 5:return s.a(2)}},e,this,[[2,,4,5]])}))}},{key:"createTracks",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,u,o,c,l,d,f,h,p,g;return v().w(function(k){for(;;)switch(k.n){case 0:return e??(e={}),o=ha(e),c=o.audioProcessor,l=o.videoProcessor,d=o.optionsWithoutProcessor,f=Oo(d,(s=this.roomOptions)===null||s===void 0?void 0:s.audioCaptureDefaults,(u=this.roomOptions)===null||u===void 0?void 0:u.videoCaptureDefaults),h=or(f),k.p=1,k.n=2,navigator.mediaDevices.getUserMedia(h);case 2:p=k.v,k.n=4;break;case 3:throw k.p=3,g=k.v,g instanceof Error&&(h.audio&&(this.microphoneError=g),h.video&&(this.cameraError=g)),g;case 4:return h.audio&&(this.microphoneError=void 0,this.emit(F.AudioStreamAcquired)),h.video&&(this.cameraError=void 0),k.a(2,Promise.all(p.getTracks().map(function(y){return b(a,void 0,void 0,v().m(function S(){var T=this,C,w,I,R;return v().w(function(U){for(;;)switch(U.n){case 0:if(C=y.kind==="audio",C?f.audio:f.video,I=C?h.audio:h.video,typeof I!="boolean"&&(w=I),R=jo(y,w,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return T.logContext}}),R.kind===L.Kind.Video?R.source=L.Source.Camera:R.kind===L.Kind.Audio&&(R.source=L.Source.Microphone,R.setAudioContext(this.audioContext)),R.mediaStream=p,!(R instanceof he&&c)){U.n=2;break}return U.n=1,R.setProcessor(c);case 1:U.n=3;break;case 2:if(!(R instanceof ke&&l)){U.n=3;break}return U.n=3,R.setProcessor(l);case 3:return U.a(2,R)}},S,this)}))})))}},n,this,[[1,3]])}))}},{key:"createScreenTracks",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,u,o,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia!==void 0){f.n=1;break}throw new la("getDisplayMedia not supported");case 1:return e.resolution===void 0&&!il()&&(e.resolution=sr.h1080fps30.resolution),s=Yc(e),f.n=2,navigator.mediaDevices.getDisplayMedia(s);case 2:if(u=f.v,o=u.getVideoTracks(),o.length!==0){f.n=3;break}throw new sn("no video track found");case 3:return c=new ke(o[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return a.logContext}}),c.source=L.Source.ScreenShare,e.contentHint&&(c.mediaStreamTrack.contentHint=e.contentHint),l=[c],u.getAudioTracks().length>0&&(this.emit(F.AudioStreamAcquired),d=new he(u.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return a.logContext}}),d.source=L.Source.ScreenShareAudio,l.push(d)),f.a(2,l)}},n,this)}))}},{key:"publishTrack",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){return v().w(function(s){for(;;)switch(s.n){case 0:return s.a(2,this.publishOrRepublishTrack(e,n))}},a,this)}))}},{key:"publishOrRepublishTrack",value:function(e,n){return b(this,arguments,void 0,function(a,s){var u=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return v().m(function c(){var l,d,f,h,p,g,k,y,S,T,C,w,I,R,U;return v().w(function(M){for(;;)switch(M.n){case 0:return a instanceof he&&a.setAudioContext(u.audioContext),M.n=1,(l=u.reconnectFuture)===null||l===void 0?void 0:l.promise;case 1:if(!(u.republishPromise&&!o)){M.n=2;break}return M.n=2,u.republishPromise;case 2:if(!(a instanceof Wn&&u.pendingPublishPromises.has(a))){M.n=3;break}return M.n=3,u.pendingPublishPromises.get(a);case 3:if(!(a instanceof MediaStreamTrack)){M.n=4;break}p=a.getConstraints(),M.n=9;break;case 4:p=a.constraints,g=void 0,I=a.source,M.n=I===L.Source.Microphone?5:I===L.Source.Camera?6:7;break;case 5:return g="audioinput",M.a(3,8);case 6:g="videoinput";case 7:return M.a(3,8);case 8:g&&u.activeDeviceMap.has(g)&&(p=Object.assign(Object.assign({},p),{deviceId:u.activeDeviceMap.get(g)}));case 9:if(!(a instanceof MediaStreamTrack)){M.n=14;break}R=a.kind,M.n=R==="audio"?10:R==="video"?11:12;break;case 10:return a=new he(a,p,!0,u.audioContext,{loggerName:u.roomOptions.loggerName,loggerContextCb:function(){return u.logContext}}),M.a(3,13);case 11:return a=new ke(a,p,!0,{loggerName:u.roomOptions.loggerName,loggerContextCb:function(){return u.logContext}}),M.a(3,13);case 12:throw new sn("unsupported MediaStreamTrack kind ".concat(a.kind));case 13:M.n=15;break;case 14:a.updateLoggerOptions({loggerName:u.roomOptions.loggerName,loggerContextCb:function(){return u.logContext}});case 15:if(u.trackPublications.forEach(function(z){z.track&&z.track===a&&(k=z)}),!k){M.n=16;break}return u.log.warn("track has already been published, skipping",Object.assign(Object.assign({},u.logContext),oe(k))),M.a(2,k);case 16:return y="channelCount"in a.mediaStreamTrack.getSettings()&&a.mediaStreamTrack.getSettings().channelCount===2||a.mediaStreamTrack.getConstraints().channelCount===2,S=(d=s==null?void 0:s.forceStereo)!==null&&d!==void 0?d:y,S&&(s||(s={}),s.dtx===void 0&&u.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},u.logContext),oe(a))),s.red===void 0&&u.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(f=s.dtx)!==null&&f!==void 0||(s.dtx=!1),(h=s.red)!==null&&h!==void 0||(s.red=!1)),T=Object.assign(Object.assign({},u.roomOptions.publishDefaults),s),!rl()&&u.roomOptions.e2ee&&(u.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},u.logContext)),T.simulcast=!1),T.source&&(a.source=T.source),C=u.publish(a,T,S),u.pendingPublishPromises.set(a,C),M.p=17,M.n=18,C;case 18:return w=M.v,M.a(2,w);case 19:throw M.p=19,U=M.v,U;case 20:return M.p=20,u.pendingPublishPromises.delete(a),M.f(20);case 21:return M.a(2)}},c,null,[[17,19,20,21]])})()})}},{key:"publish",value:function(e,n,a){return b(this,void 0,void 0,v().m(function s(){var u=this,o,c,l,d,f,h,p,g,k,y,S,T,C,w,I,R,U,M,z,B,K,Y,Z;return v().w(function(W){for(;;)switch(W.n){case 0:if(S=Array.from(this.trackPublications.values()).find(function(Q){return e instanceof Wn&&Q.source===e.source}),S&&e.source!==L.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),oe(e))),n.stopMicTrackOnMute&&e instanceof he&&(e.stopOnMute=!0),e.source===L.Source.ScreenShare&&xn()&&(n.simulcast=!1),n.videoCodec==="av1"&&!No()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!Do()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=zr),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(function(Q){return n.videoCodec===di(Q.mime)})||(n.videoCodec=di(this.enabledPublishVideoCodecs[0].mime))),T=n.videoCodec,e.on(_.Muted,this.onTrackMuted),e.on(_.Unmuted,this.onTrackUnmuted),e.on(_.Ended,this.handleTrackEnded),e.on(_.UpstreamPaused,this.onTrackUpstreamPaused),e.on(_.UpstreamResumed,this.onTrackUpstreamResumed),e.on(_.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),C=new Xn({cid:e.mediaStreamTrack.id,name:n.name,type:L.kindToProto(e.kind),muted:e.isMuted,source:L.sourceToProto(e.source),disableDtx:!(!((o=n.dtx)!==null&&o!==void 0)||o),encryption:this.encryptionType,stereo:a,disableRed:this.isE2EEEnabled||!(!((c=n.red)!==null&&c!==void 0)||c),stream:n==null?void 0:n.stream}),e.kind!==L.Kind.Video){W.n=5;break}return R={width:0,height:0},W.p=1,W.n=2,e.waitForDimensions();case 2:R=W.v,W.n=4;break;case 3:W.p=3,W.v,U=(d=(l=this.roomOptions.videoCaptureDefaults)===null||l===void 0?void 0:l.resolution)!==null&&d!==void 0?d:Ve.h720.resolution,R={width:U.width,height:U.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),oe(e)),{dims:R}));case 4:C.width=R.width,C.height=R.height,e instanceof ke&&(kt(T)&&(e.source===L.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),oe(e))))),n.scalabilityMode=(f=n.scalabilityMode)!==null&&f!==void 0?f:"L3T3_KEY"),C.simulcastCodecs=[new Tn({codec:T,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:zr}),n.backupCodec&&T!==n.backupCodec.codec&&C.encryption===pe.NONE?(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),C.simulcastCodecs.push(new Tn({codec:n.backupCodec.codec,cid:""}))):n.videoCodec&&(C.simulcastCodecs=[new Tn({codec:n.videoCodec,cid:e.mediaStreamTrack.id})])),w=Qr(e.source===L.Source.ScreenShare,C.width,C.height,n),C.layers=ds(C.width,C.height,w,kt(n.videoCodec)),w.length==1&&(I=Vo(e.source===L.Source.ScreenShare,C.width,C.height,n.videoCodec),w=[{maxBitrate:I.maxBitrate,maxFramerate:I.maxFramerate,active:!0}]),W.n=6;break;case 5:e.kind===L.Kind.Audio&&n.audioBitrate&&(w=[{maxBitrate:(h=n.audioPreset)===null||h===void 0?void 0:h.maxBitrate,priority:(g=(p=n.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&g!==void 0?g:"high",networkPriority:(y=(k=n.audioPreset)===null||k===void 0?void 0:k.priority)!==null&&y!==void 0?y:"high"}]);case 6:if(!(!this.engine||this.engine.isClosed)){W.n=7;break}throw new ve("cannot publish track when not connected");case 7:if(M=function(){return b(u,void 0,void 0,v().m(function ne(){var ge,Fe,Ln,bn,fn,ot,be,Mn;return v().w(function(me){for(;;)switch(me.n){case 0:if(this.engine.pcManager){me.n=1;break}throw new ve("pcManager is not ready");case 1:return me.n=2,this.engine.createSender(e,n,w);case 2:if(e.sender=me.v,e instanceof ke&&((ge=n.degradationPreference)!==null&&ge!==void 0||(n.degradationPreference=ql(e)),e.setDegradationPreference(n.degradationPreference)),!w){me.n=11;break}if(!(xn()&&e.kind===L.Kind.Audio)){me.n=10;break}bn=void 0,fn=$(this.engine.pcManager.publisher.getTransceivers()),me.p=3,fn.s();case 4:if((ot=fn.n()).done){me.n=6;break}if(be=ot.value,be.sender!==e.sender){me.n=5;break}return bn=be,me.a(3,6);case 5:me.n=4;break;case 6:me.n=8;break;case 7:me.p=7,Mn=me.v,fn.e(Mn);case 8:return me.p=8,fn.f(),me.f(8);case 9:bn&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:bn,codec:"opus",maxbr:!((Fe=w[0])===null||Fe===void 0)&&Fe.maxBitrate?w[0].maxBitrate/1e3:0}),me.n=11;break;case 10:e.codec&&kt(e.codec)&&(!((Ln=w[0])===null||Ln===void 0)&&Ln.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:C.cid,codec:e.codec,maxbr:w[0].maxBitrate/1e3});case 11:return me.n=12,this.engine.negotiate();case 12:return me.a(2)}},ne,this,[[3,7,8,9]])}))},!(this.enabledPublishVideoCodecs.length>0)){W.n=9;break}return W.n=8,Promise.all([this.engine.addTrack(C),M()]);case 8:B=W.v,z=B[0],W.n=11;break;case 9:return W.n=10,this.engine.addTrack(C);case 10:return z=W.v,z.codecs.forEach(function(Q){K===void 0&&(K=Q.mimeType)}),K&&e.kind===L.Kind.Video&&(Y=di(K),Y!==T&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),oe(e)),{codec:Y})),n.videoCodec=Y,w=Qr(e.source===L.Source.ScreenShare,C.width,C.height,n))),W.n=11,M();case 11:return Z=new gi(e.kind,z,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:function(){return u.logContext}}),Z.options=n,e.sid=z.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:w,trackInfo:z})),e instanceof ke?e.startMonitor(this.engine.client):e instanceof he&&e.startMonitor(),this.addTrackPublication(Z),this.emit(F.LocalTrackPublished,Z),W.a(2,Z)}},s,this,[[1,3]])}))}},{key:"isLocal",get:function(){return!0}},{key:"publishAdditionalCodecForTrack",value:function(e,n,a){return b(this,void 0,void 0,v().m(function s(){var u=this,o,c,l,d,f,h,p,g,k;return v().w(function(y){for(;;)switch(y.n){case 0:if(this.encryptionType===pe.NONE){y.n=1;break}return y.a(2);case 1:if(this.trackPublications.forEach(function(S){S.track&&S.track===e&&(c=S)}),c){y.n=2;break}throw new sn("track is not published");case 2:if(e instanceof ke){y.n=3;break}throw new sn("track is not a video track");case 3:if(l=Object.assign(Object.assign({},(o=this.roomOptions)===null||o===void 0?void 0:o.publishDefaults),a),d=Fl(e,n,l),d){y.n=4;break}return this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),oe(e))),y.a(2);case 4:if(f=e.addSimulcastTrack(n,d),f){y.n=5;break}return y.a(2);case 5:if(h=new Xn({cid:f.mediaStreamTrack.id,type:L.kindToProto(e.kind),muted:e.isMuted,source:L.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:l.videoCodec,cid:f.mediaStreamTrack.id}]}),h.layers=ds(h.width,h.height,d),!(!this.engine||this.engine.isClosed)){y.n=6;break}throw new ve("cannot publish track when not connected");case 6:return p=function(){return b(u,void 0,void 0,v().m(function T(){var C;return v().w(function(w){for(;;)switch(w.n){case 0:return C={direction:"sendonly"},d&&(C.sendEncodings=d),w.n=1,this.engine.createSimulcastSender(e,f,l,d);case 1:return w.n=2,this.engine.negotiate();case 2:return w.a(2)}},T,this)}))},y.n=7,Promise.all([this.engine.addTrack(h),p()]);case 7:g=y.v,k=g[0],this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:d,trackInfo:k}));case 8:return y.a(2)}},s,this)}))}},{key:"unpublishTrack",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s,u,o,c,l,d,f,h,p,g,k,y,S,T,C;return v().w(function(w){for(;;)switch(w.n){case 0:if(!(e instanceof Wn)){w.n=1;break}if(o=this.pendingPublishPromises.get(e),!o){w.n=1;break}return this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),oe(e))),w.n=1,o;case 1:if(c=this.getPublicationForTrack(e),l=c?oe(c):void 0,this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),l)),!(!c||!c.track)){w.n=2;break}return this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),l)),w.a(2,void 0);case 2:if(e=c.track,e.off(_.Muted,this.onTrackMuted),e.off(_.Unmuted,this.onTrackUnmuted),e.off(_.Ended,this.handleTrackEnded),e.off(_.UpstreamPaused,this.onTrackUpstreamPaused),e.off(_.UpstreamResumed,this.onTrackUpstreamResumed),e.off(_.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),d=e.sender,e.sender=void 0,!(e.isUpstreamPaused&&e.mediaStreamTrack&&d)){w.n=3;break}return w.n=3,d.replaceTrack(e.mediaStreamTrack);case 3:if(n===void 0&&(n=(u=(s=this.roomOptions)===null||s===void 0?void 0:s.stopLocalTrackOnUnpublish)!==null&&u!==void 0?u:!0),n?e.stop():e.stopMonitor(),f=!1,this.engine.pcManager&&this.engine.pcManager.currentState<ce.FAILED&&d)try{h=$(this.engine.pcManager.publisher.getTransceivers());try{for(h.s();!(p=h.n()).done;)g=p.value,g.sender===d&&(g.direction="inactive",f=!0)}catch(I){h.e(I)}finally{h.f()}if(this.engine.removeTrack(d)&&(f=!0),e instanceof ke){k=$(e.simulcastCodecs);try{for(k.s();!(y=k.n()).done;)S=te(y.value,2),T=S[1],T.sender&&(this.engine.removeTrack(T.sender)&&(f=!0),T.sender=void 0)}catch(I){k.e(I)}finally{k.f()}e.simulcastCodecs.clear()}}catch(I){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),l),{error:I}))}this.trackPublications.delete(c.trackSid),C=c.kind,w.n=C===L.Kind.Audio?4:C===L.Kind.Video?5:6;break;case 4:return this.audioTrackPublications.delete(c.trackSid),w.a(3,7);case 5:return this.videoTrackPublications.delete(c.trackSid),w.a(3,7);case 6:return w.a(3,7);case 7:if(this.emit(F.LocalTrackUnpublished,c),c.setTrack(void 0),!f){w.n=8;break}return w.n=8,this.engine.negotiate();case 8:return w.a(2,c)}},a,this)}))}},{key:"sendChatMessage",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s;return v().w(function(u){for(;;)switch(u.n){case 0:return a={id:crypto.randomUUID(),message:e,timestamp:Date.now()},s=new qe({value:{case:"chatMessage",value:new $n(Object.assign(Object.assign({},a),{timestamp:H.parse(a.timestamp)}))}}),u.n=1,this.engine.sendDataPacket(s,re.RELIABLE);case 1:return this.emit(F.ChatMessage,a),u.a(2,a)}},n,this)}))}},{key:"editChatMessage",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s,u;return v().w(function(o){for(;;)switch(o.n){case 0:return s=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),u=new qe({value:{case:"chatMessage",value:new $n(Object.assign(Object.assign({},s),{timestamp:H.parse(s.timestamp),editTimestamp:H.parse(s.editTimestamp)}))}}),o.n=1,this.engine.sendDataPacket(u,re.RELIABLE);case 1:return this.emit(F.ChatMessage,s),o.a(2,s)}},a,this)}))}},{key:"unpublishTracks",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,Promise.all(e.map(function(o){return a.unpublishTrack(o)}));case 1:return s=u.v,u.a(2,s.filter(function(o){return o instanceof gi}))}},n)}))}},{key:"republishAllTracks",value:function(e){return b(this,arguments,void 0,function(n){var a=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return v().m(function u(){return v().w(function(o){for(;;)switch(o.n){case 0:if(!a.republishPromise){o.n=1;break}return o.n=1,a.republishPromise;case 1:return a.republishPromise=new Promise(function(c,l){return b(a,void 0,void 0,v().m(function d(){var f=this,h,p;return v().w(function(g){for(;;)switch(g.n){case 0:return g.p=0,h=[],this.trackPublications.forEach(function(k){k.track&&(n&&(k.options=Object.assign(Object.assign({},k.options),n)),h.push(k))}),g.n=1,Promise.all(h.map(function(k){return b(f,void 0,void 0,v().m(function y(){var S;return v().w(function(T){for(;;)switch(T.n){case 0:return S=k.track,T.n=1,this.unpublishTrack(S,!1);case 1:if(!(s&&!S.isMuted&&S.source!==L.Source.ScreenShare&&S.source!==L.Source.ScreenShareAudio&&(S instanceof he||S instanceof ke)&&!S.isUserProvided)){T.n=2;break}return this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:k.trackSid})),T.n=2,S.restartTrack();case 2:return T.n=3,this.publishOrRepublishTrack(S,k.options,!0);case 3:return T.a(2)}},y,this)}))}));case 1:c(),g.n=3;break;case 2:g.p=2,p=g.v,l(p);case 3:return g.p=3,this.republishPromise=void 0,g.f(3);case 4:return g.a(2)}},d,this,[[0,2,3,4]])}))}),o.n=2,a.republishPromise;case 2:return o.a(2)}},u)})()})}},{key:"publishData",value:function(e){return b(this,arguments,void 0,function(n){var a=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return v().m(function u(){var o,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return o=s.reliable?re.RELIABLE:re.LOSSY,c=s.destinationIdentities,l=s.topic,d=new qe({kind:o,value:{case:"user",value:new Dt({participantIdentity:a.identity,payload:n,destinationIdentities:c,destinationSids:c,topic:l})}}),f.n=1,a.engine.sendDataPacket(d,o);case 1:return f.a(2)}},u)})()})}},{key:"publishDtmf",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s;return v().w(function(u){for(;;)switch(u.n){case 0:return s=new qe({kind:re.RELIABLE,value:{case:"sipDtmf",value:new At({code:e,digit:n})}}),u.n=1,this.engine.sendDataPacket(s,re.RELIABLE);case 1:return u.a(2)}},a,this)}))}},{key:"performRpc",value:function(e,n,a){return b(this,arguments,void 0,function(s,u,o){var c=this,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;return v().m(function d(){var f;return v().w(function(h){for(;;)switch(h.n){case 0:return f=2e3,h.a(2,new Promise(function(p,g){return b(c,void 0,void 0,v().m(function k(){var y=this,S,T,C,w,I,R,U;return v().w(function(M){for(;;)switch(M.n){case 0:if(!(Yr(o)>ps)){M.n=1;break}return g(Ee.builtIn("REQUEST_PAYLOAD_TOO_LARGE")),M.a(2);case 1:if(!(!((T=(S=this.engine.latestJoinResponse)===null||S===void 0?void 0:S.serverInfo)===null||T===void 0)&&T.version&&et((w=(C=this.engine.latestJoinResponse)===null||C===void 0?void 0:C.serverInfo)===null||w===void 0?void 0:w.version,"1.8.0")<0)){M.n=2;break}return g(Ee.builtIn("UNSUPPORTED_SERVER")),M.a(2);case 2:return I=crypto.randomUUID(),M.n=3,this.publishRpcRequest(s,I,u,o,l-f);case 3:R=setTimeout(function(){y.pendingAcks.delete(I),g(Ee.builtIn("CONNECTION_TIMEOUT")),y.pendingResponses.delete(I),clearTimeout(U)},f),this.pendingAcks.set(I,{resolve:function(){clearTimeout(R)},participantIdentity:s}),U=setTimeout(function(){y.pendingResponses.delete(I),g(Ee.builtIn("RESPONSE_TIMEOUT"))},l),this.pendingResponses.set(I,{resolve:function(B,K){clearTimeout(U),y.pendingAcks.has(I)&&(console.warn("RPC response received before ack",I),y.pendingAcks.delete(I),clearTimeout(R)),K?g(K):p(B??"")},participantIdentity:s});case 4:return M.a(2)}},k,this)}))}))}},d)})()})}},{key:"registerRpcMethod",value:function(e,n){this.rpcHandlers.set(e,n)}},{key:"unregisterRpcMethod",value:function(e){this.rpcHandlers.delete(e)}},{key:"setTrackSubscriptionPermissions",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}},{key:"handleIncomingRpcAck",value:function(e){var n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}},{key:"handleIncomingRpcResponse",value:function(e,n,a){var s=this.pendingResponses.get(e);s?(s.resolve(n,a),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}},{key:"handleIncomingRpcRequest",value:function(e,n,a,s,u){return b(this,void 0,void 0,v().m(function o(){var c,l,d,f,h;return v().w(function(p){for(;;)switch(p.n){case 0:return p.n=1,this.publishRpcAck(e,n);case 1:if(c=this.rpcHandlers.get(a),c){p.n=3;break}return p.n=2,this.publishRpcResponse(e,n,null,Ee.builtIn("UNSUPPORTED_METHOD"));case 2:return p.a(2);case 3:return l=null,d=null,p.p=4,p.n=5,c(n,e,s,u);case 5:f=p.v,Yr(f)>ps?(l=Ee.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(a))):d=f,p.n=7;break;case 6:p.p=6,h=p.v,h instanceof Ee?l=h:(console.warn("Uncaught error returned by RPC handler for ".concat(a,". Returning APPLICATION_ERROR instead."),h),l=Ee.builtIn("APPLICATION_ERROR"));case 7:return p.n=8,this.publishRpcResponse(e,n,d,l);case 8:return p.a(2)}},o,this,[[4,6]])}))}},{key:"publishRpcRequest",value:function(e,n,a,s,u){return b(this,void 0,void 0,v().m(function o(){var c;return v().w(function(l){for(;;)switch(l.n){case 0:return c=new qe({destinationIdentities:[e],kind:re.RELIABLE,value:{case:"rpcRequest",value:new Lt({id:n,method:a,payload:s,responseTimeoutMs:u})}}),l.n=1,this.engine.sendDataPacket(c,re.RELIABLE);case 1:return l.a(2)}},o,this)}))}},{key:"publishRpcResponse",value:function(e,n,a,s){return b(this,void 0,void 0,v().m(function u(){var o;return v().w(function(c){for(;;)switch(c.n){case 0:return o=new qe({destinationIdentities:[e],kind:re.RELIABLE,value:{case:"rpcResponse",value:new Ut({requestId:n,value:s?{case:"error",value:s.toProto()}:{case:"payload",value:a??""}})}}),c.n=1,this.engine.sendDataPacket(o,re.RELIABLE);case 1:return c.a(2)}},u,this)}))}},{key:"publishRpcAck",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s;return v().w(function(u){for(;;)switch(u.n){case 0:return s=new qe({destinationIdentities:[e],kind:re.RELIABLE,value:{case:"rpcAck",value:new Mt({requestId:n})}}),u.n=1,this.engine.sendDataPacket(s,re.RELIABLE);case 1:return u.a(2)}},a,this)}))}},{key:"handleParticipantDisconnected",value:function(e){var n=$(this.pendingAcks),a;try{for(n.s();!(a=n.n()).done;){var s=te(a.value,2),u=s[0],o=s[1].participantIdentity;o===e&&this.pendingAcks.delete(u)}}catch(k){n.e(k)}finally{n.f()}var c=$(this.pendingResponses),l;try{for(c.s();!(l=c.n()).done;){var d=te(l.value,2),f=d[0],h=d[1],p=h.participantIdentity,g=h.resolve;p===e&&(g(null,Ee.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(f))}}catch(k){c.e(k)}finally{c.f()}}},{key:"setEnabledPublishCodecs",value:function(e){this.enabledPublishVideoCodecs=e.filter(function(n){return n.mime.split("/")[0].toLowerCase()==="video"})}},{key:"updateInfo",value:function(e){var n=this;return e.sid!==this.sid||!X(t,"updateInfo",this,3)([e])?!1:(e.tracks.forEach(function(a){var s,u=n.trackPublications.get(a.sid);if(u){console.log("Track type is: "+u.kind+" & Sid is: "+a.sid+" & Mute value is: "+a.muted);var o=/^TR_VS.*/,c=/^TR_As.*/;if(o.test(a.sid)||c.test(a.sid))return;var l=u.track;u.kind==L.Kind.Audio?(sessionStorage.getItem("isAudioMuted")&&sessionStorage.getItem("isAudioMuted")==="true"&&(n.log.debug("updating server audio mute state after reloading",Object.assign(Object.assign({},n.logContext),{sid:a.sid,muted:!0})),n.engine.client.sendMuteTrack(a.sid,!0),n.audioMuted=!0),a.muted?l instanceof he&&l.mute().then(function(){n.emit(F.TrackMuted,u)}):(n.audioMuted&&l instanceof he&&l.unmute().then(function(){n.emit(F.TrackUnmuted,u)}),n.audioMuted=!1)):!((s=u.track)===null||s===void 0)&&s.isUpstreamPaused||(sessionStorage.getItem("isVideoMuted")&&sessionStorage.getItem("isVideoMuted")==="true"&&(n.log.debug("updating server video mute state after reloading",Object.assign(Object.assign({},n.logContext),{sid:a.sid,muted:!0})),n.engine.client.sendMuteTrack(a.sid,!0),n.videoMuted=!0),a.muted?l instanceof ke&&l.mute().then(function(){n.emit(F.TrackMuted,u)}):(n.videoMuted&&l instanceof ke&&l.unmute().then(function(){n.emit(F.TrackUnmuted,u)}),n.videoMuted=!1))}}),!0)}},{key:"getPublicationForTrack",value:function(e){var n;return this.trackPublications.forEach(function(a){var s=a.track;s&&(e instanceof MediaStreamTrack?(s instanceof he||s instanceof ke)&&s.mediaStreamTrack===e&&(n=a):e===s&&(n=a))}),n}},{key:"waitForPendingPublicationOfSource",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a,s,u;return v().w(function(o){for(;;)switch(o.n){case 0:a=1e4,s=Date.now();case 1:if(!(Date.now()<s+a)){o.n=4;break}if(u=Array.from(this.pendingPublishPromises.entries()).find(function(c){var l=te(c,1),d=l[0];return d.source===e}),!u){o.n=2;break}return o.a(2,u[1]);case 2:return o.n=3,Ge(20);case 3:o.n=1;break;case 4:return o.a(2)}},n,this)}))}}])}(Ko),zo=function(r){function t(i,e,n,a){var s;return P(this,t),s=O(this,t,[i,e.sid,e.name,a]),s.track=void 0,s.allowed=!0,s.disabled=!1,s.currentVideoQuality=we.HIGH,s.handleEnded=function(u){s.setTrack(void 0),s.emit(_.Ended,u)},s.handleVisibilityChange=function(u){s.log.debug("adaptivestream video visibility ".concat(s.trackSid,", visible=").concat(u),s.logContext),s.disabled=!u,s.emitTrackUpdate()},s.handleVideoDimensionsChange=function(u){s.log.debug("adaptivestream video dimensions ".concat(u.width,"x").concat(u.height),s.logContext),s.videoDimensions=u,s.emitTrackUpdate()},s.subscribed=n,s.updateInfo(e),s}return N(t,r),E(t,[{key:"setSubscribed",value:function(e){var n=this.subscriptionStatus,a=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);var s=new On({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Jt({participantSid:"",trackSids:[this.trackSid]})]});this.emit(_.UpdateSubscription,s),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(a)}},{key:"subscriptionStatus",get:function(){return this.subscribed===!1?tn.SubscriptionStatus.Unsubscribed:X(t,"isSubscribed",this,1)?tn.SubscriptionStatus.Subscribed:tn.SubscriptionStatus.Desired}},{key:"permissionStatus",get:function(){return this.allowed?tn.PermissionStatus.Allowed:tn.PermissionStatus.NotAllowed}},{key:"isSubscribed",get:function(){return this.subscribed===!1?!1:X(t,"isSubscribed",this,1)}},{key:"isDesired",get:function(){return this.subscribed!==!1}},{key:"isEnabled",get:function(){return!this.disabled}},{key:"setEnabled",value:function(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}},{key:"setVideoQuality",value:function(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}},{key:"setVideoDimensions",value:function(e){var n,a;this.isManualOperationAllowed()&&(((n=this.videoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((a=this.videoDimensions)===null||a===void 0?void 0:a.height)===e.height||(this.track instanceof Kn&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}},{key:"setVideoFPS",value:function(e){this.isManualOperationAllowed()&&this.track instanceof Kn&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}},{key:"videoQuality",get:function(){return this.currentVideoQuality}},{key:"setTrack",value:function(e){var n=this.subscriptionStatus,a=this.permissionStatus,s=this.track;s!==e&&(s&&(s.off(_.VideoDimensionsChanged,this.handleVideoDimensionsChange),s.off(_.VisibilityChanged,this.handleVisibilityChange),s.off(_.Ended,this.handleEnded),s.detach(),s.stopMonitor(),this.emit(_.Unsubscribed,s)),X(t,"setTrack",this,3)([e]),e&&(e.sid=this.trackSid,e.on(_.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(_.VisibilityChanged,this.handleVisibilityChange),e.on(_.Ended,this.handleEnded),this.emit(_.Subscribed,e)),this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(n))}},{key:"setAllowed",value:function(e){var n=this.subscriptionStatus,a=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(n)}},{key:"setSubscriptionError",value:function(e){this.emit(_.SubscriptionFailed,e)}},{key:"updateInfo",value:function(e){X(t,"updateInfo",this,3)([e]);var n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?_.Muted:_.Unmuted)}},{key:"emitSubscriptionUpdateIfChanged",value:function(e){var n=this.subscriptionStatus;e!==n&&this.emit(_.SubscriptionStatusChanged,n,e)}},{key:"emitPermissionUpdateIfChanged",value:function(e){var n=this.permissionStatus;n!==e&&this.emit(_.SubscriptionPermissionChanged,this.permissionStatus,e)}},{key:"isManualOperationAllowed",value:function(){return this.kind===L.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}},{key:"isAdaptiveStream",get:function(){return this.track instanceof Kn&&this.track.isAdaptiveStream}},{key:"emitTrackUpdate",value:function(){var e=new qt({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=we.HIGH,this.emit(_.UpdateSettings,e)}}])}(tn),ki=function(r){function t(i,e,n,a,s,u,o){var c,l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:kn.STANDARD;return P(this,t),c=O(this,t,[e,n||"",a,s,u,o,l]),c.signalClient=i,c.trackPublications=new Map,c.audioTrackPublications=new Map,c.videoTrackPublications=new Map,c.volumeMap=new Map,c}return N(t,r),E(t,[{key:"logContext",get:function(){return Object.assign(Object.assign({},X(t,"logContext",this,1)),{rpID:this.sid,remoteParticipant:this.identity})}},{key:"addTrackPublication",value:function(e){var n=this;X(t,"addTrackPublication",this,3)([e]),e.on(_.UpdateSettings,function(a){n.log.debug("send update settings",Object.assign(Object.assign({},n.logContext),oe(e))),n.signalClient.sendUpdateTrackSettings(a)}),e.on(_.UpdateSubscription,function(a){a.participantTracks.forEach(function(s){s.participantSid=n.sid}),n.signalClient.sendUpdateSubscription(a)}),e.on(_.SubscriptionPermissionChanged,function(a){n.emit(F.TrackSubscriptionPermissionChanged,e,a)}),e.on(_.SubscriptionStatusChanged,function(a){n.emit(F.TrackSubscriptionStatusChanged,e,a)}),e.on(_.Subscribed,function(a){n.emit(F.TrackSubscribed,a,e)}),e.on(_.Unsubscribed,function(a){n.emit(F.TrackUnsubscribed,a,e)}),e.on(_.SubscriptionFailed,function(a){n.emit(F.TrackSubscriptionFailed,e.trackSid,a)})}},{key:"getTrackPublication",value:function(e){var n=X(t,"getTrackPublication",this,3)([e]);if(n)return n}},{key:"getTrackPublicationByName",value:function(e){var n=X(t,"getTrackPublicationByName",this,3)([e]);if(n)return n}},{key:"setVolume",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:L.Source.Microphone;this.volumeMap.set(n,e);var a=this.getTrackPublication(n);a&&a.track&&a.track.setVolume(e)}},{key:"getVolume",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:L.Source.Microphone,n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}},{key:"addSubscribedMediaTrack",value:function(e,n,a,s,u,o){var c=this,l=this.getTrackPublicationBySid(n);if(l||n.startsWith("TR")||this.trackPublications.forEach(function(h){!l&&e.kind===h.kind.toString()&&(l=h)}),!l){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(F.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(function(){c.addSubscribedMediaTrack(e,n,a,s,u,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),oe(l))),this.emit(F.TrackSubscriptionFailed,n);return}var d=e.kind==="video",f;return d?f=new Kn(e,n,s,u):f=new bt(e,n,s,this.audioContext,this.audioOutput),f.source=l.source,f.isMuted=l.isMuted,f.setMediaStream(a),f.start(),l.setTrack(f),this.volumeMap.has(l.source)&&f instanceof bt&&f.setVolume(this.volumeMap.get(l.source)),l}},{key:"hasMetadata",get:function(){return!!this.participantInfo}},{key:"getTrackPublicationBySid",value:function(e){return this.trackPublications.get(e)}},{key:"updateInfo",value:function(e){var n=this;if(!X(t,"updateInfo",this,3)([e]))return!1;var a=new Map,s=new Map;return e.tracks.forEach(function(u){var o,c,l=n.getTrackPublicationBySid(u.sid);if(l)l.updateInfo(u);else{var d=L.kindFromProto(u.type);if(!d)return;l=new zo(d,u,(o=n.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:function(){return n.logContext},loggerName:(c=n.loggerOptions)===null||c===void 0?void 0:c.loggerName}),l.updateInfo(u),s.set(u.sid,l);var f=Array.from(n.trackPublications.values()).find(function(h){return h.source===(l==null?void 0:l.source)});f&&l.source!==L.Source.Unknown&&n.log.debug("received a second track publication for ".concat(n.identity," with the same source: ").concat(l.source),Object.assign(Object.assign({},n.logContext),{oldTrack:oe(f),newTrack:oe(l)})),n.addTrackPublication(l)}a.set(u.sid,l)}),this.trackPublications.forEach(function(u){a.has(u.trackSid)||(n.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},n.logContext),oe(u))),n.unpublishTrack(u.trackSid,!0))}),s.forEach(function(u){n.emit(F.TrackPublished,u)}),!0}},{key:"unpublishTrack",value:function(e,n){var a=this.trackPublications.get(e);if(a){var s=a.track;switch(s&&(s.stop(),a.setTrack(void 0)),this.trackPublications.delete(e),a.kind){case L.Kind.Audio:this.audioTrackPublications.delete(e);break;case L.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(F.TrackUnpublished,a)}}},{key:"setAudioOutput",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a;return v().w(function(s){for(;;)switch(s.n){case 0:return this.audioOutput=e,a=[],this.audioTrackPublications.forEach(function(u){var o;u.track instanceof bt&&a.push(u.track.setSinkId((o=e.deviceId)!==null&&o!==void 0?o:"default"))}),s.n=1,Promise.all(a);case 1:return s.a(2)}},n,this)}))}},{key:"emit",value:function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:a})),X(t,"emit",this,3)([e].concat(a))}}],[{key:"fromParticipantInfo",value:function(e,n,a){return new t(e,n.sid,n.identity,n.name,n.metadata,n.attributes,a,n.kind)}}])}(Ko),ee;(function(r){r.Disconnected="disconnected",r.Connecting="connecting",r.Connected="connected",r.Reconnecting="reconnecting",r.SignalReconnecting="signalReconnecting"})(ee||(ee={}));var Ql=4*1e3,cr=function(r){function t(i){var e;P(this,t);var n,a,s;if(e=O(this,t),e.state=ee.Disconnected,e.activeSpeakers=[],e.isE2EEEnabled=!1,e.audioEnabled=!0,e.isVideoPlaybackBlocked=!1,e.log=x,e.bufferedEvents=[],e.isResuming=!1,e.connect=function(o,c,l){return b(e,void 0,void 0,v().m(function d(){var f=this,h,p,g,k,y;return v().w(function(S){for(;;)switch(S.n){case 0:if(tl()){S.n=2;break}if(!dn()){S.n=1;break}throw Error("WebRTC isn't detected, have you called registerGlobals?");case 1:throw Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");case 2:return p=sessionStorage.getItem("token"),(!c||c.trim().length===0)&&p!=null&&(x.info("Reload Performed, using latest token to refresh: "+p),c=p),S.n=3,this.disconnectLock.lock();case 3:if(g=S.v,this.state!==ee.Connected){S.n=4;break}return this.log.info("already connected to room ".concat(this.name),this.logContext),g(),S.a(2,Promise.resolve());case 4:if(!this.connectFuture){S.n=5;break}return g(),S.a(2,this.connectFuture.promise);case 5:return this.setAndEmitConnectionState(ee.Connecting),((h=this.regionUrlProvider)===null||h===void 0?void 0:h.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Kr(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new vs(o,c):this.regionUrlProvider.updateToken(c),this.regionUrlProvider.fetchRegionSettings().then(function(T){var C;(C=f.regionUrlProvider)===null||C===void 0||C.setServerReportedRegions(T)}).catch(function(T){f.log.warn("could not fetch region settings",Object.assign(Object.assign({},f.logContext),{error:T}))})),k=function(C,w,I){return b(f,void 0,void 0,v().m(function R(){var U,M,z,B,K,Y,Z;return v().w(function(W){for(;;)switch(W.n){case 0:return this.abortController&&this.abortController.abort(),z=new AbortController,this.abortController=z,g==null||g(),W.p=1,W.n=2,this.attemptConnection(I??o,c,l,z);case 2:this.abortController=void 0,C(),W.n=12;break;case 3:if(W.p=3,Y=W.v,!(this.regionUrlProvider&&Y instanceof se&&Y.reason!==3&&Y.reason!==0)){W.n=11;break}return B=null,W.p=4,W.n=5,this.regionUrlProvider.getNextBestRegionUrl((U=this.abortController)===null||U===void 0?void 0:U.signal);case 5:B=W.v,W.n=7;break;case 6:if(W.p=6,Z=W.v,!(Z instanceof se&&(Z.status===401||Z.reason===3))){W.n=7;break}return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),w(Z),W.a(2);case 7:if(!(B&&!(!((M=this.abortController)===null||M===void 0)&&M.signal.aborted))){W.n=9;break}return this.log.info("Initial connection failed with ConnectionError: ".concat(Y.message,". Retrying with another region: ").concat(B),this.logContext),this.recreateEngine(),W.n=8,k(C,w,B);case 8:W.n=10;break;case 9:this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,ts(Y)),w(Y);case 10:W.n=12;break;case 11:K=Ce.UNKNOWN_REASON,Y instanceof se&&(K=ts(Y)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,K),w(Y);case 12:return W.a(2)}},R,this,[[4,6],[1,3]])}))},y=this.regionUrl,this.regionUrl=void 0,this.connectFuture=new Uo(function(T,C){k(T,C,y)},function(){f.clearConnectionFutures()}),S.a(2,this.connectFuture.promise)}},d,this)}))},e.connectSignal=function(o,c,l,d,f,h){return b(e,void 0,void 0,v().m(function p(){var g,k,y,S,T;return v().w(function(C){for(;;)switch(C.n){case 0:return C.n=1,l.join(o,c,{autoSubscribe:d.autoSubscribe,adaptiveStream:V(f.adaptiveStream)==="object"?!0:f.adaptiveStream,maxRetries:d.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:d.websocketTimeout},h.signal);case 1:if(S=C.v,T=S.serverInfo,T||(T={version:S.serverVersion,region:S.serverRegion}),this.serverInfo=T,this.log.debug("connected to Livekit Server ".concat(Object.entries(T).map(function(w){var I=te(w,2),R=I[0],U=I[1];return"".concat(R,": ").concat(U)}).join(", ")),{room:(g=S.room)===null||g===void 0?void 0:g.name,roomSid:(k=S.room)===null||k===void 0?void 0:k.sid,identity:(y=S.participant)===null||y===void 0?void 0:y.identity}),T.version){C.n=2;break}throw new Fc("unknown server version");case 2:return T.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),f.dynacast=!1),C.a(2,S)}},p,this)}))},e.applyJoinResponse=function(o){var c=o.participant;if(e.localParticipant.sid=c.sid,e.localParticipant.identity=c.identity,e.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),e.options.e2ee&&e.e2eeManager)try{e.e2eeManager.setSifTrailer(o.sifTrailer)}catch(l){e.log.error(l instanceof Error?l.message:"Could not set SifTrailer",Object.assign(Object.assign({},e.logContext),{error:l}))}e.handleParticipantUpdates([c].concat(Ue(o.otherParticipants))),o.room&&e.handleRoomUpdate(o.room)},e.attemptConnection=function(o,c,l,d){return b(e,void 0,void 0,v().m(function f(){var h,p,g,k,y,S;return v().w(function(T){for(;;)switch(T.n){case 0:return this.state===ee.Reconnecting||this.isResuming||!((h=this.engine)===null||h===void 0)&&h.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((p=this.regionUrlProvider)===null||p===void 0)&&p.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},va),l),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout),T.p=1,T.n=2,this.connectSignal(o,c,this.engine,this.connOptions,this.options,d);case 2:g=T.v,this.applyJoinResponse(g),this.setupLocalParticipantEvents(),this.emit(A.SignalConnected),T.n=5;break;case 3:return T.p=3,y=T.v,T.n=4,this.engine.close();case 4:throw this.recreateEngine(),k=new se("could not establish signal connection",1),y instanceof Error&&(k.message="".concat(k.message,": ").concat(y.message)),y instanceof se&&(k.reason=y.reason,k.status=y.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:y})),k;case 5:if(!d.signal.aborted){T.n=7;break}return T.n=6,this.engine.close();case 6:throw this.recreateEngine(),new se("Connection attempt aborted",3);case 7:return T.p=7,T.n=8,this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,d);case 8:T.n=11;break;case 9:return T.p=9,S=T.v,T.n=10,this.engine.close();case 10:throw this.recreateEngine(),S;case 11:Ie()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Ie()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ee.Connected),this.emit(A.Connected),this.registerConnectionReconcile();case 12:return T.a(2)}},f,this,[[7,9],[1,3]])}))},e.disconnect=function(){for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return b(e,[].concat(c),void 0,function(){var d=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return v().m(function h(){var p,g,k,y,S;return v().w(function(T){for(;;)switch(T.n){case 0:return sessionStorage.removeItem("token"),sessionStorage.removeItem("isAudioMuted"),sessionStorage.removeItem("isVideoMuted"),T.n=1,d.disconnectLock.lock();case 1:if(S=T.v,T.p=2,d.state!==ee.Disconnected){T.n=3;break}return d.log.debug("already disconnected",d.logContext),T.a(2);case 3:if(d.log.info("disconnect from room",Object.assign({},d.logContext)),(d.state===ee.Connecting||d.state===ee.Reconnecting||d.isResuming)&&(d.log.warn("abort connection attempt",d.logContext),(p=d.abortController)===null||p===void 0||p.abort(),(k=(g=d.connectFuture)===null||g===void 0?void 0:g.reject)===null||k===void 0||k.call(g,new se("Client initiated disconnect",3)),d.connectFuture=void 0),!((y=d.engine)===null||y===void 0)&&y.client.isDisconnected){T.n=4;break}return T.n=4,d.engine.client.sendLeave();case 4:if(!d.engine){T.n=5;break}return T.n=5,d.engine.close();case 5:d.handleDisconnect(f,Ce.CLIENT_INITIATED),d.engine=void 0;case 6:return T.p=6,S(),T.f(6);case 7:return T.a(2)}},h,null,[[2,,6,7]])})()})},e.onPageLeave=function(){return b(e,void 0,void 0,v().m(function o(){var c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:alert("on page leave"),this.log.info("Page leave detected, disconnecting",this.logContext),c=sessionStorage.getItem("token"),l=sessionStorage.getItem("isAudioMuted"),d=sessionStorage.getItem("isVideoMuted"),this.disconnect(),sessionStorage.setItem("token",c),sessionStorage.setItem("isAudioMuted",l),sessionStorage.setItem("isVideoMuted",d);case 1:return f.a(2)}},o,this)}))},e.startAudio=function(){return b(e,void 0,void 0,v().m(function o(){var c=this,l,d,f,h,p,g,k;return v().w(function(y){for(;;)switch(y.n){case 0:return l=[],d=xe(),d&&d.os==="iOS"&&(f="livekit-dummy-audio-el",h=document.getElementById(f),h||(h=document.createElement("audio"),h.id=f,h.autoplay=!0,h.hidden=!0,p=gr(),p.enabled=!0,g=new MediaStream([p]),h.srcObject=g,document.addEventListener("visibilitychange",function(){h&&(h.srcObject=document.hidden?null:g,document.hidden||(c.log.debug("page visible again, triggering startAudio to resume playback and update playback status",c.logContext),c.startAudio()))}),document.body.append(h),this.once(A.Disconnected,function(){h==null||h.remove(),h=null})),l.push(h)),this.remoteParticipants.forEach(function(S){S.audioTrackPublications.forEach(function(T){T.track&&T.track.attachedElements.forEach(function(C){l.push(C)})})}),y.p=1,y.n=2,Promise.all([this.acquireAudioContext()].concat(Ue(l.map(function(S){return S.muted=!1,S.play()}))));case 2:this.handleAudioPlaybackStarted(),y.n=4;break;case 3:throw y.p=3,k=y.v,this.handleAudioPlaybackFailed(k),k;case 4:return y.a(2)}},o,this,[[1,3]])}))},e.startVideo=function(){return b(e,void 0,void 0,v().m(function o(){var c=this,l,d,f,h;return v().w(function(p){for(;;)switch(p.n){case 0:l=[],d=$(this.remoteParticipants.values());try{for(d.s();!(f=d.n()).done;)h=f.value,h.videoTrackPublications.forEach(function(g){var k;(k=g.track)===null||k===void 0||k.attachedElements.forEach(function(y){l.includes(y)||l.push(y)})})}catch(g){d.e(g)}finally{d.f()}return p.n=1,Promise.all(l.map(function(g){return g.play()})).then(function(){c.handleVideoPlaybackStarted()}).catch(function(g){g.name==="NotAllowedError"?c.handleVideoPlaybackFailed():c.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",c.logContext)});case 1:return p.a(2)}},o,this)}))},e.handleRestarting=function(){e.clearConnectionReconcile(),e.isResuming=!1;var o=$(e.remoteParticipants.values()),c;try{for(o.s();!(c=o.n()).done;){var l=c.value;e.handleParticipantDisconnected(l.identity,l)}}catch(d){o.e(d)}finally{o.f()}e.setAndEmitConnectionState(ee.Reconnecting)&&e.emit(A.Reconnecting)},e.handleSignalRestarted=function(o){return b(e,void 0,void 0,v().m(function c(){var l;return v().w(function(d){for(;;)switch(d.n){case 0:return this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o),d.p=1,d.n=2,this.localParticipant.republishAllTracks(void 0,!0);case 2:d.n=4;break;case 3:d.p=3,l=d.v,this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}));case 4:return d.p=4,d.n=5,this.engine.waitForRestarted();case 5:this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),d.n=7;break;case 6:return d.p=6,d.v,d.a(2);case 7:this.setAndEmitConnectionState(ee.Connected),this.emit(A.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents();case 8:return d.a(2)}},c,this,[[4,6],[1,3]])}))},e.handleParticipantUpdates=function(o){o.forEach(function(c){var l;if(c.identity===e.localParticipant.identity){e.localParticipant.updateInfo(c);return}c.identity===""&&(c.identity=(l=e.sidToIdentity.get(c.sid))!==null&&l!==void 0?l:"");var d=e.remoteParticipants.get(c.identity);c.state===Rn.DISCONNECTED?e.handleParticipantDisconnected(c.identity,d):d=e.getOrCreateParticipant(c.identity,c)})},e.handleActiveSpeakersUpdate=function(o){var c=[],l={};o.forEach(function(d){if(l[d.sid]=!0,d.sid===e.localParticipant.sid)e.localParticipant.audioLevel=d.level,e.localParticipant.setIsSpeaking(!0),c.push(e.localParticipant);else{var f=e.getRemoteParticipantBySid(d.sid);f&&(f.audioLevel=d.level,f.setIsSpeaking(!0),c.push(f))}}),l[e.localParticipant.sid]||(e.localParticipant.audioLevel=0,e.localParticipant.setIsSpeaking(!1)),e.remoteParticipants.forEach(function(d){l[d.sid]||(d.audioLevel=0,d.setIsSpeaking(!1))}),e.activeSpeakers=c,e.emitWhenConnected(A.ActiveSpeakersChanged,c)},e.handleSpeakersChanged=function(o){var c=new Map;e.activeSpeakers.forEach(function(d){var f=e.remoteParticipants.get(d.identity);f&&f.sid!==d.sid||c.set(d.sid,d)}),o.forEach(function(d){var f=e.getRemoteParticipantBySid(d.sid);d.sid===e.localParticipant.sid&&(f=e.localParticipant),f&&(f.audioLevel=d.level,f.setIsSpeaking(d.active),d.active?c.set(d.sid,f):c.delete(d.sid))});var l=Array.from(c.values());l.sort(function(d,f){return f.audioLevel-d.audioLevel}),e.activeSpeakers=l,e.emitWhenConnected(A.ActiveSpeakersChanged,l)},e.handleStreamStateUpdate=function(o){o.streamStates.forEach(function(c){var l=e.getRemoteParticipantBySid(c.participantSid);if(l){var d=l.getTrackPublicationBySid(c.trackSid);if(!(!d||!d.track)){var f=L.streamStateFromProto(c.state);f!==d.track.streamState&&(d.track.streamState=f,l.emit(F.TrackStreamStateChanged,d,d.track.streamState),e.emitWhenConnected(A.TrackStreamStateChanged,d,d.track.streamState,l))}}})},e.handleSubscriptionPermissionUpdate=function(o){var c=e.getRemoteParticipantBySid(o.participantSid);if(c){var l=c.getTrackPublicationBySid(o.trackSid);l&&l.setAllowed(o.allowed)}},e.handleSubscriptionError=function(o){var c=Array.from(e.remoteParticipants.values()).find(function(d){return d.trackPublications.has(o.trackSid)});if(c){var l=c.getTrackPublicationBySid(o.trackSid);l&&l.setSubscriptionError(o.err)}},e.handleDataPacket=function(o){var c=e.remoteParticipants.get(o.participantIdentity);o.value.case==="user"?e.handleUserPacket(c,o.value.value,o.kind):o.value.case==="transcription"?e.handleTranscription(c,o.value.value):o.value.case==="sipDtmf"?e.handleSipDtmf(c,o.value.value):o.value.case==="metrics"?e.handleMetrics(o.value.value,c):o.value.case==="chatMessage"&&e.handleChatMessage(c,o.value.value)},e.handleUserPacket=function(o,c,l){e.emit(A.DataReceived,c.payload,o,l,c.topic),o==null||o.emit(F.DataReceived,c.payload,l,c.destinationIdentities)},e.handleSipDtmf=function(o,c){e.emit(A.SipDTMFReceived,c,o),o==null||o.emit(F.SipDTMFReceived,c)},e.bufferedSegments=new Map,e.handleTranscription=function(o,c){var l=c.transcribedParticipantIdentity===e.localParticipant.identity?e.localParticipant:e.getParticipantByIdentity(c.transcribedParticipantIdentity),d=l==null?void 0:l.trackPublications.get(c.trackId),f=dl(c,e.transcriptionReceivedTimes);d==null||d.emit(_.TranscriptionReceived,f),l==null||l.emit(F.TranscriptionReceived,f,d),e.emit(A.TranscriptionReceived,f,l,d)},e.handleMetrics=function(o,c){e.emit(A.MetricsReceived,o,c)},e.handleChatMessage=function(o,c){var l=fl(c);e.emit(A.ChatMessage,l,o)},e.handleAudioPlaybackStarted=function(){e.canPlaybackAudio||(e.audioEnabled=!0,e.emit(A.AudioPlaybackStatusChanged,!0))},e.handleAudioPlaybackFailed=function(o){e.log.warn("could not playback audio",Object.assign(Object.assign({},e.logContext),{error:o})),e.canPlaybackAudio&&(e.audioEnabled=!1,e.emit(A.AudioPlaybackStatusChanged,!1))},e.handleVideoPlaybackStarted=function(){e.isVideoPlaybackBlocked&&(e.isVideoPlaybackBlocked=!1,e.emit(A.VideoPlaybackStatusChanged,!0))},e.handleVideoPlaybackFailed=function(){e.isVideoPlaybackBlocked||(e.isVideoPlaybackBlocked=!0,e.emit(A.VideoPlaybackStatusChanged,!1))},e.handleDeviceChange=function(){return b(e,void 0,void 0,v().m(function o(){var c=this,l,d,f,h,p,g,k,y,S,T,C,w,I,R;return v().w(function(U){for(;;)switch(U.n){case 0:return f=We.getInstance().previousDevices,U.n=1,We.getInstance().getDevices(void 0,!1);case 1:if(h=U.v,p=xe(),!((p==null?void 0:p.name)==="Chrome"&&p.os!=="iOS")){U.n=8;break}g=$(h),U.p=2,y=v().m(function M(){var z,B;return v().w(function(K){for(;;)switch(K.n){case 0:z=k.value,B=f.find(function(Y){return Y.deviceId===z.deviceId}),B&&B.label!==""&&B.kind===z.kind&&B.label!==z.label&&c.getActiveDevice(z.kind)==="default"&&c.emit(A.ActiveDeviceChanged,z.kind,z.deviceId);case 1:return K.a(2)}},M)}),g.s();case 3:if((k=g.n()).done){U.n=5;break}return U.d(Ta(y()),4);case 4:U.n=3;break;case 5:U.n=7;break;case 6:U.p=6,R=U.v,g.e(R);case 7:return U.p=7,g.f(),U.f(7);case 8:S=["audiooutput","audioinput","videoinput"],T=v().m(function M(){var z,B,K;return v().w(function(Y){for(;;)switch(Y.n){case 0:if(z=I[w],B=h.filter(function(Z){return Z.kind===z}),K=c.getActiveDevice(z),K!==((l=f.filter(function(Z){return Z.kind===z})[0])===null||l===void 0?void 0:l.deviceId)){Y.n=2;break}if(!(B.length>0&&((d=B[0])===null||d===void 0?void 0:d.deviceId)!==K)){Y.n=2;break}return Y.n=1,c.switchActiveDevice(z,B[0].deviceId);case 1:return Y.a(2,0);case 2:if(!(z==="audioinput"&&!yn()||z==="videoinput")){Y.n=3;break}return Y.a(2,0);case 3:if(!(B.length>0&&!B.find(function(Z){return Z.deviceId===c.getActiveDevice(z)}))){Y.n=4;break}return Y.n=4,c.switchActiveDevice(z,B[0].deviceId);case 4:return Y.a(2)}},M)}),w=0,I=S;case 9:if(!(w<I.length)){U.n=12;break}return U.d(Ta(T()),10);case 10:if(C=U.v,C!==0){U.n=11;break}return U.a(3,11);case 11:w++,U.n=9;break;case 12:this.emit(A.MediaDevicesChanged);case 13:return U.a(2)}},o,this,[[2,6,7,8]])}))},e.handleRoomUpdate=function(o){var c=e.roomInfo;e.roomInfo=o,c&&c.metadata!==o.metadata&&e.emitWhenConnected(A.RoomMetadataChanged,o.metadata),(c==null?void 0:c.activeRecording)!==o.activeRecording&&e.emitWhenConnected(A.RecordingStatusChanged,o.activeRecording)},e.handleConnectionQualityUpdate=function(o){o.updates.forEach(function(c){if(c.participantSid===e.localParticipant.sid){e.localParticipant.setConnectionQuality(c.quality);return}var l=e.getRemoteParticipantBySid(c.participantSid);l&&l.setConnectionQuality(c.quality)})},e.onLocalParticipantMetadataChanged=function(o){e.emit(A.ParticipantMetadataChanged,o,e.localParticipant)},e.onLocalParticipantNameChanged=function(o){e.emit(A.ParticipantNameChanged,o,e.localParticipant)},e.onLocalAttributesChanged=function(o){e.emit(A.ParticipantAttributesChanged,o,e.localParticipant)},e.onLocalTrackMuted=function(o){e.emit(A.TrackMuted,o,e.localParticipant)},e.onLocalTrackUnmuted=function(o){e.emit(A.TrackUnmuted,o,e.localParticipant)},e.onTrackProcessorUpdate=function(o){var c;(c=o==null?void 0:o.onPublish)===null||c===void 0||c.call(o,e)},e.onLocalTrackPublished=function(o){return b(e,void 0,void 0,v().m(function c(){var l,d,f,h,p,g,k,y,S;return v().w(function(T){for(;;)switch(T.n){case 0:if((l=o.track)===null||l===void 0||l.on(_.TrackProcessorUpdate,this.onTrackProcessorUpdate),(d=o.track)===null||d===void 0||d.on(_.Restarted,this.onLocalTrackRestarted),(p=(h=(f=o.track)===null||f===void 0?void 0:f.getProcessor())===null||h===void 0?void 0:h.onPublish)===null||p===void 0||p.call(h,this),this.emit(A.LocalTrackPublished,o,this.localParticipant),!(o.track instanceof he)){T.n=2;break}return T.n=1,o.track.checkForSilence();case 1:k=T.v,k&&this.emit(A.LocalAudioSilenceDetected,o);case 2:return T.n=3,(g=o.track)===null||g===void 0?void 0:g.getDeviceId(!1);case 3:y=T.v,S=Qa(o.source),S&&y&&y!==this.localParticipant.activeDeviceMap.get(S)&&(this.localParticipant.activeDeviceMap.set(S,y),this.emit(A.ActiveDeviceChanged,S,y));case 4:return T.a(2)}},c,this)}))},e.onLocalTrackUnpublished=function(o){var c,l;(c=o.track)===null||c===void 0||c.off(_.TrackProcessorUpdate,e.onTrackProcessorUpdate),(l=o.track)===null||l===void 0||l.off(_.Restarted,e.onLocalTrackRestarted),e.emit(A.LocalTrackUnpublished,o,e.localParticipant)},e.onLocalTrackRestarted=function(o){return b(e,void 0,void 0,v().m(function c(){var l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return f.n=1,o.getDeviceId(!1);case 1:l=f.v,d=Qa(o.source),d&&l&&l!==this.localParticipant.activeDeviceMap.get(d)&&(this.log.debug("local track restarted, setting ".concat(d," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(d,l),this.emit(A.ActiveDeviceChanged,d,l));case 2:return f.a(2)}},c,this)}))},e.onLocalConnectionQualityChanged=function(o){e.emit(A.ConnectionQualityChanged,o,e.localParticipant)},e.onMediaDevicesError=function(o){e.emit(A.MediaDevicesError,o)},e.onLocalParticipantPermissionsChanged=function(o){e.emit(A.ParticipantPermissionsChanged,o,e.localParticipant)},e.onLocalChatMessageSent=function(o){e.emit(A.ChatMessage,o,e.localParticipant)},e.setMaxListeners(100),e.remoteParticipants=new Map,e.sidToIdentity=new Map,e.options=Object.assign(Object.assign({},Nl),i),e.log=ln((n=e.options.loggerName)!==null&&n!==void 0?n:ze.Room),e.transcriptionReceivedTimes=new Map,e.options.audioCaptureDefaults=Object.assign(Object.assign({},_o),i==null?void 0:i.audioCaptureDefaults),e.options.videoCaptureDefaults=Object.assign(Object.assign({},qo),i==null?void 0:i.videoCaptureDefaults),e.options.publishDefaults=Object.assign(Object.assign({},Ol),i==null?void 0:i.publishDefaults),e.maybeCreateEngine(),e.disconnectLock=new Me,e.localParticipant=new wn("","",e.engine,e.options),e.options.videoCaptureDefaults.deviceId&&e.localParticipant.activeDeviceMap.set("videoinput",Cn(e.options.videoCaptureDefaults.deviceId)),e.options.audioCaptureDefaults.deviceId&&e.localParticipant.activeDeviceMap.set("audioinput",Cn(e.options.audioCaptureDefaults.deviceId)),!((a=e.options.audioOutput)===null||a===void 0)&&a.deviceId&&e.switchActiveDevice("audiooutput",Cn(e.options.audioOutput.deviceId)).catch(function(o){return e.log.warn("Could not set audio output: ".concat(o.message),e.logContext)}),e.options.e2ee&&e.setupE2EE(),Ie()){var u=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",e.handleDeviceChange,{signal:u.signal}),t.cleanupRegistry&&t.cleanupRegistry.register(e,function(){u.abort()})}return e}return N(t,r),E(t,[{key:"setE2EEEnabled",value:function(e){return b(this,void 0,void 0,v().m(function n(){return v().w(function(a){for(;;)switch(a.n){case 0:if(!this.e2eeManager){a.n=2;break}return a.n=1,Promise.all([this.localParticipant.setE2EEEnabled(e)]);case 1:this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity),a.n=3;break;case 2:throw Error("e2ee not configured, please set e2ee settings within the room options");case 3:return a.a(2)}},n,this)}))}},{key:"setupE2EE",value:function(){var e=this,n;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new ml(this.options.e2ee),this.e2eeManager.on(mn.ParticipantEncryptionStatusChanged,function(a,s){s instanceof wn&&(e.isE2EEEnabled=a),e.emit(A.ParticipantEncryptionStatusChanged,a,s)}),this.e2eeManager.on(mn.EncryptionError,function(a){return e.emit(A.EncryptionError,a)}),(n=this.e2eeManager)===null||n===void 0||n.setup(this))}},{key:"logContext",get:function(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}},{key:"isRecording",get:function(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}},{key:"getSid",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this;return v().w(function(a){for(;;)switch(a.n){case 0:if(this.state!==ee.Disconnected){a.n=1;break}return a.a(2,"");case 1:if(!(this.roomInfo&&this.roomInfo.sid!=="")){a.n=2;break}return a.a(2,this.roomInfo.sid);case 2:return a.a(2,new Promise(function(s,u){var o=function(l){l.sid!==""&&(n.engine.off(q.RoomUpdate,o),s(l.sid))};n.engine.on(q.RoomUpdate,o),n.once(A.Disconnected,function(){n.engine.off(q.RoomUpdate,o),u("Room disconnected before room server id was available")})}))}},e,this)}))}},{key:"name",get:function(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}},{key:"metadata",get:function(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}},{key:"numParticipants",get:function(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}},{key:"numPublishers",get:function(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}},{key:"maybeCreateEngine",value:function(){var e=this;if(!(this.engine&&!this.engine.isClosed)){var n=0;this.engine=new Vl(this.options),this.engine.on(q.ParticipantUpdate,this.handleParticipantUpdates).on(q.RoomUpdate,this.handleRoomUpdate).on(q.SpeakersChanged,this.handleSpeakersChanged).on(q.StreamStateChanged,this.handleStreamStateUpdate).on(q.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(q.SubscriptionError,this.handleSubscriptionError).on(q.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(q.MediaTrackAdded,function(a,s,u){e.onTrackAdded(a,s,u)}).on(q.Disconnected,function(a){e.handleDisconnect(e.options.stopLocalTrackOnUnpublish,a)}).on(q.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(q.DataPacketReceived,this.handleDataPacket).on(q.Resuming,function(){e.clearConnectionReconcile(),e.isResuming=!0,e.log.info("Resuming signal connection",e.logContext),e.setAndEmitConnectionState(ee.SignalReconnecting)&&e.emit(A.SignalReconnecting)}).on(q.Resumed,function(){e.registerConnectionReconcile(),e.isResuming=!1,e.log.info("Resumed signal connection",e.logContext),e.updateSubscriptions(),e.emitBufferedEvents(),e.setAndEmitConnectionState(ee.Connected)&&e.emit(A.Reconnected)}).on(q.SignalResumed,function(){e.bufferedEvents=[],(e.state===ee.Reconnecting||e.isResuming)&&e.sendSyncState()}).on(q.Restarting,this.handleRestarting).on(q.SignalRestarted,this.handleSignalRestarted).on(q.Offline,function(){e.setAndEmitConnectionState(ee.Reconnecting)&&e.emit(A.Reconnecting)}).on(q.DCBufferStatusChanged,function(a,s){e.emit(A.DCBufferStatusChanged,a,s)}).on(q.PrimaryDelay,function(a){n=Math.max(n,a)}).on(q.SecondaryDelay,function(a){n=Math.max(n,a),e.emit(A.ReconnectICEDelay,n/1e3),n=0}).on(q.LocalTrackSubscribed,function(a){var s=e.localParticipant.getTrackPublications().find(function(u){var o=u.trackSid;return o===a});if(!s){e.log.warn("could not find local track subscription for subscribed event",e.logContext);return}e.localParticipant.emit(F.LocalTrackSubscribed,s),e.emitWhenConnected(A.LocalTrackSubscribed,s,e.localParticipant)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine)}}},{key:"prepareConnection",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s,u;return v().w(function(o){for(;;)switch(o.n){case 0:if(this.state===ee.Disconnected){o.n=1;break}return o.a(2);case 1:if(this.log.debug("prepareConnection to ".concat(e),this.logContext),o.p=2,!(Kr(new URL(e))&&n)){o.n=6;break}return this.regionUrlProvider=new vs(e,n),o.n=3,this.regionUrlProvider.getNextBestRegionUrl();case 3:if(s=o.v,!(s&&this.state===ee.Disconnected)){o.n=5;break}return this.regionUrl=s,o.n=4,fetch(ns(s),{method:"HEAD"});case 4:this.log.debug("prepared connection to ".concat(s),this.logContext);case 5:o.n=7;break;case 6:return o.n=7,fetch(ns(e),{method:"HEAD"});case 7:o.n=9;break;case 8:o.p=8,u=o.v,this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:u}));case 9:return o.a(2)}},a,this,[[2,8]])}))}},{key:"getParticipantByIdentity",value:function(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}},{key:"clearConnectionFutures",value:function(){this.connectFuture=void 0}},{key:"simulateScenario",value:function(e,n){return b(this,void 0,void 0,v().m(function a(){var s=this,u,o,c;return v().w(function(l){for(;;)switch(l.n){case 0:u=function(){},c=e,l.n=c==="signal-reconnect"?1:c==="speaker"?3:c==="node-failure"?4:c==="server-leave"?5:c==="migration"?6:c==="resume-reconnect"?7:c==="disconnect-signal-on-resume"?9:c==="disconnect-signal-on-resume-no-messages"?10:c==="full-reconnect"?11:c==="force-tcp"||c==="force-tls"?13:c==="subscriber-bandwidth"?14:c==="leave-full-reconnect"?16:17;break;case 1:return l.n=2,this.engine.client.handleOnClose("simulate disconnect");case 2:return l.a(3,17);case 3:return o=new De({scenario:{case:"speakerUpdate",value:3}}),l.a(3,17);case 4:return o=new De({scenario:{case:"nodeFailure",value:!0}}),l.a(3,17);case 5:return o=new De({scenario:{case:"serverLeave",value:!0}}),l.a(3,17);case 6:return o=new De({scenario:{case:"migration",value:!0}}),l.a(3,17);case 7:return this.engine.failNext(),l.n=8,this.engine.client.handleOnClose("simulate resume-disconnect");case 8:return l.a(3,17);case 9:return u=function(){return b(s,void 0,void 0,v().m(function f(){return v().w(function(h){for(;;)switch(h.n){case 0:return h.n=1,this.engine.client.handleOnClose("simulate resume-disconnect");case 1:return h.a(2)}},f,this)}))},o=new De({scenario:{case:"disconnectSignalOnResume",value:!0}}),l.a(3,17);case 10:return u=function(){return b(s,void 0,void 0,v().m(function f(){return v().w(function(h){for(;;)switch(h.n){case 0:return h.n=1,this.engine.client.handleOnClose("simulate resume-disconnect");case 1:return h.a(2)}},f,this)}))},o=new De({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}}),l.a(3,17);case 11:return this.engine.fullReconnectOnNext=!0,l.n=12,this.engine.client.handleOnClose("simulate full-reconnect");case 12:return l.a(3,17);case 13:return o=new De({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),u=function(){return b(s,void 0,void 0,v().m(function f(){var h;return v().w(function(p){for(;;)switch(p.n){case 0:h=this.engine.client.onLeave,h&&h(new Nn({reason:Ce.CLIENT_INITIATED,action:Xe.RECONNECT}));case 1:return p.a(2)}},f,this)}))},l.a(3,17);case 14:if(!(n===void 0||typeof n!="number")){l.n=15;break}throw new Error("subscriber-bandwidth requires a number as argument");case 15:return o=new De({scenario:{case:"subscriberBandwidth",value:BigInt(n)}}),l.a(3,17);case 16:o=new De({scenario:{case:"leaveRequestFullReconnect",value:!0}});case 17:if(!o){l.n=19;break}return l.n=18,this.engine.client.sendSimulateScenario(o);case 18:return l.n=19,u();case 19:return l.a(2)}},a,this)}))}},{key:"canPlaybackAudio",get:function(){return this.audioEnabled}},{key:"canPlaybackVideo",get:function(){return!this.isVideoPlaybackBlocked}},{key:"getActiveDevice",value:function(e){return this.localParticipant.activeDeviceMap.get(e)}},{key:"switchActiveDevice",value:function(e,n){return b(this,arguments,void 0,function(a,s){var u=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return v().m(function c(){var l,d,f,h,p,g,k,y,S,T,C,w,I,R,U,M,z,B,K,Y,Z,W;return v().w(function(Q){for(;;)switch(Q.n){case 0:if(S=!0,T=!1,C=o?{exact:s}:s,a!=="audioinput"){Q.n=5;break}return T=u.localParticipant.audioTrackPublications.size===0,w=(l=u.getActiveDevice(a))!==null&&l!==void 0?l:u.options.audioCaptureDefaults.deviceId,u.options.audioCaptureDefaults.deviceId=C,I=Array.from(u.localParticipant.audioTrackPublications.values()).filter(function(ne){return ne.source===L.Source.Microphone}),Q.p=1,Q.n=2,Promise.all(I.map(function(ne){var ge;return(ge=ne.audioTrack)===null||ge===void 0?void 0:ge.setDeviceId(C)}));case 2:S=Q.v.every(function(ne){return ne===!0}),Q.n=4;break;case 3:throw Q.p=3,z=Q.v,u.options.audioCaptureDefaults.deviceId=w,z;case 4:Q.n=20;break;case 5:if(a!=="videoinput"){Q.n=10;break}return T=u.localParticipant.videoTrackPublications.size===0,R=(d=u.getActiveDevice(a))!==null&&d!==void 0?d:u.options.videoCaptureDefaults.deviceId,u.options.videoCaptureDefaults.deviceId=C,U=Array.from(u.localParticipant.videoTrackPublications.values()).filter(function(ne){return ne.source===L.Source.Camera}),Q.p=6,Q.n=7,Promise.all(U.map(function(ne){var ge;return(ge=ne.videoTrack)===null||ge===void 0?void 0:ge.setDeviceId(C)}));case 7:S=Q.v.every(function(ne){return ne===!0}),Q.n=9;break;case 8:throw Q.p=8,B=Q.v,u.options.videoCaptureDefaults.deviceId=R,B;case 9:Q.n=20;break;case 10:if(a!=="audiooutput"){Q.n=20;break}if(!(!Gr()&&!u.options.webAudioMix||u.options.webAudioMix&&u.audioContext&&!("setSinkId"in u.audioContext))){Q.n=11;break}throw new Error("cannot switch audio output, setSinkId not supported");case 11:if(!u.options.webAudioMix){Q.n=16;break}return Q.n=12,We.getInstance().normalizeDeviceId("audiooutput",s);case 12:if(Y=f=Q.v,K=Y!==null,!K){Q.n=13;break}K=f!==void 0;case 13:if(!K){Q.n=14;break}Z=f,Q.n=15;break;case 14:Z="";case 15:s=Z;case 16:return(h=(y=u.options).audioOutput)!==null&&h!==void 0||(y.audioOutput={}),M=(p=u.getActiveDevice(a))!==null&&p!==void 0?p:u.options.audioOutput.deviceId,u.options.audioOutput.deviceId=s,Q.p=17,u.options.webAudioMix&&((g=u.audioContext)===null||g===void 0||g.setSinkId(s)),Q.n=18,Promise.all(Array.from(u.remoteParticipants.values()).map(function(ne){return ne.setAudioOutput({deviceId:s})}));case 18:Q.n=20;break;case 19:throw Q.p=19,W=Q.v,u.options.audioOutput.deviceId=M,W;case 20:return(T||a==="audiooutput")&&(u.localParticipant.activeDeviceMap.set(a,a==="audiooutput"&&((k=u.options.audioOutput)===null||k===void 0?void 0:k.deviceId)||s),u.emit(A.ActiveDeviceChanged,a,s)),Q.a(2,S)}},c,null,[[17,19],[6,8],[1,3]])})()})}},{key:"setupLocalParticipantEvents",value:function(){this.localParticipant.on(F.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(F.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(F.AttributesChanged,this.onLocalAttributesChanged).on(F.TrackMuted,this.onLocalTrackMuted).on(F.TrackUnmuted,this.onLocalTrackUnmuted).on(F.LocalTrackPublished,this.onLocalTrackPublished).on(F.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(F.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(F.MediaDevicesError,this.onMediaDevicesError).on(F.AudioStreamAcquired,this.startAudio).on(F.ChatMessage,this.onLocalChatMessageSent).on(F.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}},{key:"recreateEngine",value:function(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}},{key:"onTrackAdded",value:function(e,n,a){var s=this;if(this.state===ee.Connecting||this.state===ee.Reconnecting){var u=function(){s.onTrackAdded(e,n,a),o()},o=function(){s.off(A.Reconnected,u),s.off(A.Connected,u),s.off(A.Disconnected,o)};this.once(A.Reconnected,u),this.once(A.Connected,u),this.once(A.Disconnected,o);return}if(this.state===ee.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}var c=nl(n.id),l=c[0],d=c[1],f=e.id;if(d&&d.startsWith("TR")&&(f=d),l===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}var h=Array.from(this.remoteParticipants.values()).find(function(g){return g.sid===l});if(!h){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(l),this.logContext);return}var p;this.options.adaptiveStream&&(V(this.options.adaptiveStream)==="object"?p=this.options.adaptiveStream:p={}),h.addSubscribedMediaTrack(e,f,n,a,p)}},{key:"handleDisconnect",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,a=arguments.length>1?arguments[1]:void 0,s;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==ee.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(function(u){u.trackPublications.forEach(function(o){u.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(function(u){var o,c,l;u.track&&e.localParticipant.unpublishTrack(u.track,n),n?((o=u.track)===null||o===void 0||o.detach(),(c=u.track)===null||c===void 0||c.stop()):(l=u.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off(F.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(F.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(F.AttributesChanged,this.onLocalAttributesChanged).off(F.TrackMuted,this.onLocalTrackMuted).off(F.TrackUnmuted,this.onLocalTrackUnmuted).off(F.LocalTrackPublished,this.onLocalTrackPublished).off(F.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(F.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(F.MediaDevicesError,this.onMediaDevicesError).off(F.AudioStreamAcquired,this.startAudio).off(F.ChatMessage,this.onLocalChatMessageSent).off(F.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Ie()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(s=navigator.mediaDevices)===null||s===void 0||s.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ee.Disconnected),this.emit(A.Disconnected,a)}}}},{key:"handleParticipantDisconnected",value:function(e,n){var a;this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(function(s){n.unpublishTrack(s.trackSid,!0)}),this.emit(A.ParticipantDisconnected,n),(a=this.localParticipant)===null||a===void 0||a.handleParticipantDisconnected(n.identity))}},{key:"acquireAudioContext",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this,a,s,u,o;return v().w(function(c){for(;;)switch(c.n){case 0:if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(a=fa())!==null&&a!==void 0?a:void 0),!(this.audioContext&&this.audioContext.state==="suspended")){c.n=4;break}return c.p=1,c.n=2,this.audioContext.resume();case 2:c.n=4;break;case 3:c.p=3,o=c.v,this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:o}));case 4:this.options.webAudioMix&&this.remoteParticipants.forEach(function(l){return l.setAudioContext(n.audioContext)}),this.localParticipant.setAudioContext(this.audioContext),u=((s=this.audioContext)===null||s===void 0?void 0:s.state)==="running",u!==this.canPlaybackAudio&&(this.audioEnabled=u,this.emit(A.AudioPlaybackStatusChanged,u));case 5:return c.a(2)}},e,this,[[1,3]])}))}},{key:"createParticipant",value:function(e,n){var a=this,s,u;return n?u=ki.fromParticipantInfo(this.engine.client,n,{loggerContextCb:function(){return a.logContext},loggerName:this.options.loggerName}):u=new ki(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:function(){return a.logContext},loggerName:this.options.loggerName}),this.options.webAudioMix&&u.setAudioContext(this.audioContext),!((s=this.options.audioOutput)===null||s===void 0)&&s.deviceId&&u.setAudioOutput(this.options.audioOutput).catch(function(o){return a.log.warn("Could not set audio output: ".concat(o.message),a.logContext)}),u}},{key:"getOrCreateParticipant",value:function(e,n){var a=this;if(this.remoteParticipants.has(e)){var s=this.remoteParticipants.get(e);if(n){var u=s.updateInfo(n);u&&this.sidToIdentity.set(n.sid,n.identity)}return s}var o=this.createParticipant(e,n);return this.remoteParticipants.set(e,o),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(A.ParticipantConnected,o),o.on(F.TrackPublished,function(c){a.emitWhenConnected(A.TrackPublished,c,o)}).on(F.TrackSubscribed,function(c,l){c.kind===L.Kind.Audio?(c.on(_.AudioPlaybackStarted,a.handleAudioPlaybackStarted),c.on(_.AudioPlaybackFailed,a.handleAudioPlaybackFailed)):c.kind===L.Kind.Video&&(c.on(_.VideoPlaybackFailed,a.handleVideoPlaybackFailed),c.on(_.VideoPlaybackStarted,a.handleVideoPlaybackStarted)),a.emit(A.TrackSubscribed,c,l,o)}).on(F.TrackUnpublished,function(c){a.emit(A.TrackUnpublished,c,o)}).on(F.TrackUnsubscribed,function(c,l){a.emit(A.TrackUnsubscribed,c,l,o)}).on(F.TrackSubscriptionFailed,function(c){a.emit(A.TrackSubscriptionFailed,c,o)}).on(F.TrackMuted,function(c){a.emitWhenConnected(A.TrackMuted,c,o)}).on(F.TrackUnmuted,function(c){a.emitWhenConnected(A.TrackUnmuted,c,o)}).on(F.ParticipantMetadataChanged,function(c){a.emitWhenConnected(A.ParticipantMetadataChanged,c,o)}).on(F.ParticipantNameChanged,function(c){a.emitWhenConnected(A.ParticipantNameChanged,c,o)}).on(F.AttributesChanged,function(c){a.emitWhenConnected(A.ParticipantAttributesChanged,c,o)}).on(F.ConnectionQualityChanged,function(c){a.emitWhenConnected(A.ConnectionQualityChanged,c,o)}).on(F.ParticipantPermissionsChanged,function(c){a.emitWhenConnected(A.ParticipantPermissionsChanged,c,o)}).on(F.TrackSubscriptionStatusChanged,function(c,l){a.emitWhenConnected(A.TrackSubscriptionStatusChanged,c,l,o)}).on(F.TrackSubscriptionFailed,function(c,l){a.emit(A.TrackSubscriptionFailed,c,o,l)}).on(F.TrackSubscriptionPermissionChanged,function(c,l){a.emitWhenConnected(A.TrackSubscriptionPermissionChanged,c,l,o)}),n&&o.updateInfo(n),o}},{key:"sendSyncState",value:function(){var e=Array.from(this.remoteParticipants.values()).reduce(function(a,s){return a.push.apply(a,Ue(s.getTrackPublications())),a},[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}},{key:"updateSubscriptions",value:function(){var e=$(this.remoteParticipants.values()),n;try{for(e.s();!(n=e.n()).done;){var a=n.value,s=$(a.videoTrackPublications.values()),u;try{for(s.s();!(u=s.n()).done;){var o=u.value;o.isSubscribed&&o instanceof zo&&o.emitTrackUpdate()}}catch(c){s.e(c)}finally{s.f()}}}catch(c){e.e(c)}finally{e.f()}}},{key:"getRemoteParticipantBySid",value:function(e){var n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}},{key:"registerConnectionReconcile",value:function(){var e=this;this.clearConnectionReconcile();var n=0;this.connectionReconcileInterval=ye.setInterval(function(){!e.engine||e.engine.isClosed||!e.engine.verifyTransport()?(n++,e.log.warn("detected connection state mismatch",Object.assign(Object.assign({},e.logContext),{numFailures:n,engine:e.engine?{closed:e.engine.isClosed,transportsConnected:e.engine.verifyTransport()}:void 0})),n>=3&&(e.recreateEngine(),e.handleDisconnect(e.options.stopLocalTrackOnUnpublish,Ce.STATE_MISMATCH))):n=0},Ql)}},{key:"clearConnectionReconcile",value:function(){this.connectionReconcileInterval&&ye.clearInterval(this.connectionReconcileInterval)}},{key:"setAndEmitConnectionState",value:function(e){return e===this.state?!1:(this.state=e,this.emit(A.ConnectionStateChanged,this.state),!0)}},{key:"emitBufferedEvents",value:function(){var e=this;this.bufferedEvents.forEach(function(n){var a=te(n,2),s=a[0],u=a[1];e.emit.apply(e,[s].concat(Ue(u)))}),this.bufferedEvents=[]}},{key:"emitWhenConnected",value:function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];if(this.state===ee.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,a]);else if(this.state===ee.Connected)return this.emit.apply(this,[e].concat(a));return!1}},{key:"simulateParticipants",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a=this,s,u,o,c,l,d,f,h,p,g,k,y,S,T,C,w,I,R,U,M,z,B,K,Y,Z,W,Q,ne,ge,Fe,Ln,bn,fn,ot;return v().w(function(be){for(;;)switch(be.n){case 0:if(o=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),c=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants),this.handleDisconnect(),this.roomInfo=new nt({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:H.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new gn({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(A.SignalConnected),this.emit(A.Connected),this.setAndEmitConnectionState(ee.Connected),!o.video){be.n=4;break}if(T=gi,C=L.Kind.Video,w=new cn({source:de.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Se.AUDIO,name:"video-dummy"}),I=ke,!o.useRealTracks){be.n=2;break}return be.n=1,window.navigator.mediaDevices.getUserMedia({video:!0});case 1:R=be.v.getVideoTracks()[0],be.n=3;break;case 2:R=es(160*((s=c.aspectRatios[0])!==null&&s!==void 0?s:1),160,!0,!0);case 3:U=R,M=void 0,z={loggerName:this.options.loggerName,loggerContextCb:function(){return a.logContext}},B=new I(U,M,!1,z),K={loggerName:this.options.loggerName,loggerContextCb:function(){return a.logContext}},l=new T(C,w,B,K),this.localParticipant.addTrackPublication(l),this.localParticipant.emit(F.LocalTrackPublished,l);case 4:if(!o.audio){be.n=8;break}if(Y=gi,Z=L.Kind.Audio,W=new cn({source:de.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Se.AUDIO}),Q=he,!o.useRealTracks){be.n=6;break}return be.n=5,navigator.mediaDevices.getUserMedia({audio:!0});case 5:ne=be.v.getAudioTracks()[0],be.n=7;break;case 6:ne=gr();case 7:ge=ne,Fe=void 0,Ln=this.audioContext,bn={loggerName:this.options.loggerName,loggerContextCb:function(){return a.logContext}},fn=new Q(ge,Fe,!1,Ln,bn),ot={loggerName:this.options.loggerName,loggerContextCb:function(){return a.logContext}},d=new Y(Z,W,fn,ot),this.localParticipant.addTrackPublication(d),this.localParticipant.emit(F.LocalTrackPublished,d);case 8:for(f=0;f<c.count-1;f+=1)h=new gn({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(f),state:Rn.ACTIVE,tracks:[],joinedAt:H.parse(Date.now())}),p=this.getOrCreateParticipant(h.identity,h),c.video&&(g=es(160*((u=c.aspectRatios[f%c.aspectRatios.length])!==null&&u!==void 0?u:1),160,!1,!0),k=new cn({source:de.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Se.AUDIO}),p.addSubscribedMediaTrack(g,k.sid,new MediaStream([g]),new RTCRtpReceiver),h.tracks=[].concat(Ue(h.tracks),[k])),c.audio&&(y=gr(),S=new cn({source:de.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Se.AUDIO}),p.addSubscribedMediaTrack(y,S.sid,new MediaStream([y]),new RTCRtpReceiver),h.tracks=[].concat(Ue(h.tracks),[S])),p.updateInfo(h);case 9:return be.a(2)}},n,this)}))}},{key:"emit",value:function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];if(e!==A.ActiveSpeakersChanged){var u=$o(a).filter(function(o){return o!==void 0});this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:u}))}return X(t,"emit",this,3)([e].concat(a))}}],[{key:"getLocalDevices",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return We.getInstance().getDevices(e,n)}}])}(en.EventEmitter);cr.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(function(r){r()});function $o(r){return r.map(function(t){if(t)return Array.isArray(t)?$o(t):V(t)==="object"?"logContext"in t&&t.logContext:t})}var je;(function(r){r[r.IDLE=0]="IDLE",r[r.RUNNING=1]="RUNNING",r[r.SKIPPED=2]="SKIPPED",r[r.SUCCESS=3]="SUCCESS",r[r.FAILED=4]="FAILED"})(je||(je={}));var st=function(r){function t(i,e){var n,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return P(this,t),n=O(this,t),n.status=je.IDLE,n.logs=[],n.errorsAsWarnings=!1,n.url=i,n.token=e,n.name=n.constructor.name,n.room=new cr(a.roomOptions),n.connectOptions=a.connectOptions,a.errorsAsWarnings&&(n.errorsAsWarnings=a.errorsAsWarnings),n}return N(t,r),E(t,[{key:"run",value:function(e){return b(this,void 0,void 0,v().m(function n(){var a;return v().w(function(s){for(;;)switch(s.n){case 0:if(this.status===je.IDLE){s.n=1;break}throw Error("check is running already");case 1:return this.setStatus(je.RUNNING),s.p=2,s.n=3,this.perform();case 3:s.n=5;break;case 4:s.p=4,a=s.v,a instanceof Error&&(this.errorsAsWarnings?this.appendWarning(a.message):this.appendError(a.message));case 5:return s.n=6,this.disconnect();case 6:return s.n=7,new Promise(function(u){return setTimeout(u,500)});case 7:return this.status!==je.SKIPPED&&this.setStatus(this.isSuccess()?je.SUCCESS:je.FAILED),e&&e(),s.a(2,this.getInfo())}},n,this,[[2,4]])}))}},{key:"isSuccess",value:function(){return!this.logs.some(function(e){return e.level==="error"})}},{key:"connect",value:function(){return b(this,void 0,void 0,v().m(function e(){return v().w(function(n){for(;;)switch(n.n){case 0:if(this.room.state!==ee.Connected){n.n=1;break}return n.a(2,this.room);case 1:return n.n=2,this.room.connect(this.url,this.token,this.connectOptions);case 2:return n.a(2,this.room)}},e,this)}))}},{key:"disconnect",value:function(){return b(this,void 0,void 0,v().m(function e(){return v().w(function(n){for(;;)switch(n.n){case 0:if(!(this.room&&this.room.state!==ee.Disconnected)){n.n=2;break}return n.n=1,this.room.disconnect();case 1:return n.n=2,new Promise(function(a){return setTimeout(a,500)});case 2:return n.a(2)}},e,this)}))}},{key:"skip",value:function(){this.setStatus(je.SKIPPED)}},{key:"appendMessage",value:function(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}},{key:"appendWarning",value:function(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}},{key:"appendError",value:function(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}},{key:"setStatus",value:function(e){this.status=e,this.emit("update",this.getInfo())}},{key:"engine",get:function(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}},{key:"getInfo",value:function(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}])}(en.EventEmitter);function Qo(r){return b(this,void 0,void 0,v().m(function t(){var i=this,e,n,a,s,u,o,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return r??(r={}),(e=r.audio)!==null&&e!==void 0||(r.audio={deviceId:"default"}),(n=r.video)!==null&&n!==void 0||(r.video={deviceId:"default"}),a=ha(r),s=a.audioProcessor,u=a.videoProcessor,o=Oo(r,_o,qo),c=or(o),l=navigator.mediaDevices.getUserMedia(c),r.audio&&(We.userMediaPromiseMap.set("audioinput",l),l.catch(function(){return We.userMediaPromiseMap.delete("audioinput")})),r.video&&(We.userMediaPromiseMap.set("videoinput",l),l.catch(function(){return We.userMediaPromiseMap.delete("videoinput")})),f.n=1,l;case 1:return d=f.v,f.a(2,Promise.all(d.getTracks().map(function(h){return b(i,void 0,void 0,v().m(function p(){var g,k,y,S;return v().w(function(T){for(;;)switch(T.n){case 0:if(g=h.kind==="audio",g?o.audio:o.video,y=g?c.audio:c.video,typeof y!="boolean"&&(k=y),k?k.deviceId=h.getSettings().deviceId:k={deviceId:h.getSettings().deviceId},S=jo(h,k),S.kind===L.Kind.Video?S.source=L.Source.Camera:S.kind===L.Kind.Audio&&(S.source=L.Source.Microphone),S.mediaStream=d,!(S instanceof he&&s)){T.n=2;break}return T.n=1,S.setProcessor(s);case 1:T.n=3;break;case 2:if(!(S instanceof ke&&u)){T.n=3;break}return T.n=3,S.setProcessor(u);case 3:return T.a(2,S)}},p)}))})))}},t)}))}function Yl(r){return b(this,void 0,void 0,v().m(function t(){var i;return v().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Qo({audio:!1,video:r});case 1:return i=e.v,e.a(2,i[0])}},t)}))}function Xl(r){return b(this,void 0,void 0,v().m(function t(){var i;return v().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Qo({audio:r,video:!1});case 1:return i=e.v,e.a(2,i[0])}},t)}))}var Zl=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Can publish audio"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,u,o;return v().w(function(c){for(;;)switch(c.n){case 0:return c.n=1,this.connect();case 1:return a=c.v,c.n=2,Xl();case 2:return s=c.v,a.localParticipant.publishTrack(s),c.n=3,new Promise(function(l){return setTimeout(l,3e3)});case 3:return c.n=4,(n=s.sender)===null||n===void 0?void 0:n.getStats();case 4:if(u=c.v,u){c.n=5;break}throw new Error("Could not get RTCStats");case 5:if(o=0,u.forEach(function(l){l.type==="outbound-rtp"&&(l.kind==="audio"||!l.kind&&l.mediaType)}),o!==0){c.n=6;break}throw new Error("Could not determine packets are sent");case 6:this.appendMessage("published ".concat(o," audio packets"));case 7:return c.a(2)}},e,this)}))}}])}(st),xl=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Can publish video"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,u,o;return v().w(function(c){for(;;)switch(c.n){case 0:return c.n=1,this.connect();case 1:return a=c.v,c.n=2,Yl();case 2:return s=c.v,a.localParticipant.publishTrack(s),c.n=3,new Promise(function(l){return setTimeout(l,5e3)});case 3:return c.n=4,(n=s.sender)===null||n===void 0?void 0:n.getStats();case 4:if(u=c.v,u){c.n=5;break}throw new Error("Could not get RTCStats");case 5:if(o=0,u.forEach(function(l){l.type==="outbound-rtp"&&(l.kind==="video"||!l.kind&&l.mediaType==="video")&&(o+=l.packetsSent)}),o!==0){c.n=6;break}throw new Error("Could not determine packets are sent");case 6:this.appendMessage("published ".concat(o," video packets"));case 7:return c.a(2)}},e,this)}))}}])}(st),ed=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Resuming connection after interruption"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,u,o,c,l,d;return v().w(function(f){for(;;)switch(f.n){case 0:return f.n=1,this.connect();case 1:return a=f.v,s=!1,u=!1,c=new Promise(function(h){setTimeout(h,5e3),o=h}),l=function(){s=!0},a.on(A.SignalReconnecting,l).on(A.Reconnecting,l).on(A.Reconnected,function(){u=!0,o(!0)}),(n=a.engine.client.ws)===null||n===void 0||n.close(),d=a.engine.client.onClose,d&&d(""),f.n=2,c;case 2:if(s){f.n=3;break}throw new Error("Did not attempt to reconnect");case 3:if(!(!u||a.state!==ee.Connected)){f.n=4;break}throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect");case 4:return f.a(2)}},e,this)}))}}])}(st),nd=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Can connect via TURN"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,u,o,c,l,d,f,h,p,g,k;return v().w(function(y){for(;;)switch(y.n){case 0:return s=new ma,y.n=1,s.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});case 1:u=y.v,o=!1,c=!1,l=!1,d=$(u.iceServers);try{for(d.s();!(f=d.n()).done;){h=f.value,p=$(h.urls);try{for(p.s();!(g=p.n()).done;)k=g.value,k.startsWith("turn:")?(c=!0,l=!0):k.startsWith("turns:")&&(c=!0,l=!0,o=!0),k.startsWith("stun:")&&(l=!0)}catch(S){p.e(S)}finally{p.f()}}}catch(S){d.e(S)}finally{d.f()}return l?c&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),y.n=2,s.close();case 2:if(!(!((a=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||a===void 0)&&a.iceServers||c)){y.n=4;break}return y.n=3,this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}});case 3:y.n=5;break;case 4:return this.appendWarning("No TURN servers configured."),this.skip(),y.n=5,new Promise(function(S){return setTimeout(S,0)});case 5:return y.a(2)}},e,this)}))}}])}(st),td=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Establishing WebRTC connection"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n=this,a,s,u;return v().w(function(o){for(;;)switch(o.n){case 0:return a=!1,s=!1,this.room.on(A.SignalConnected,function(){var c=n.room.engine.client.onTrickle;n.room.engine.client.onTrickle=function(l,d){if(l.candidate){var f=new RTCIceCandidate(l),h="".concat(f.protocol," ").concat(f.address,":").concat(f.port," ").concat(f.type);f.address&&(id(f.address)?h+=" (private)":f.protocol==="tcp"&&f.tcpType==="passive"?(a=!0,h+=" (passive)"):f.protocol==="udp"&&(s=!0)),n.appendMessage(h)}c&&c(l,d)},n.room.engine.pcManager&&(n.room.engine.pcManager.subscriber.onIceCandidateError=function(l){l instanceof RTCPeerConnectionIceErrorEvent&&n.appendWarning("error with ICE candidate: ".concat(l.errorCode," ").concat(l.errorText," ").concat(l.url))})}),o.p=1,o.n=2,this.connect();case 2:x.info("now the room is connected"),o.n=4;break;case 3:throw o.p=3,u=o.v,this.appendWarning("ports need to be open on firewall in order to connect."),u;case 4:a||this.appendWarning("Server is not configured for ICE/TCP"),s||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly");case 5:return o.a(2)}},e,this,[[1,3]])}))}}])}(st);function id(r){var t=r.split(".");if(t.length===4){if(t[0]==="10")return!0;if(t[0]==="192"&&t[1]==="168")return!0;if(t[0]==="172"){var i=parseInt(t[1],10);if(i>=16&&i<=31)return!0}}return!1}var rd=function(r){function t(){return P(this,t),O(this,t,arguments)}return N(t,r),E(t,[{key:"description",get:function(){return"Connecting to signal connection via WebSocket"}},{key:"perform",value:function(){return b(this,void 0,void 0,v().m(function e(){var n,a,s,u,o;return v().w(function(c){for(;;)switch(c.n){case 0:return(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it"),u=new ma,c.n=1,u.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});case 1:return o=c.v,this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((n=o.serverInfo)===null||n===void 0?void 0:n.edition)===Qn.Cloud&&(!((a=o.serverInfo)===null||a===void 0)&&a.region)&&this.appendMessage("LiveKit Cloud: ".concat((s=o.serverInfo)===null||s===void 0?void 0:s.region)),c.n=2,u.close();case 2:return c.a(2)}},e,this)}))}}])}(st);en.EventEmitter;const G=r=>document.getElementById(r),Oe={isFrontFacing:!1,encoder:new TextEncoder,decoder:new TextDecoder,defaultDevices:new Map,bitrateInterval:void 0,e2eeKeyProvider:new Jc};let j,on;const ga=new URLSearchParams(window.location.search),ad=ga.get("url")??"ws://localhost:7880",sd=ga.get("token")??"";G("url").value=ad;G("token").value=sd;let ks=ga.get("key");ks?G("crypto-key").value=ks:G("crypto-key").value="password";function od(r,t,i){const e=new URLSearchParams({url:r,token:t,key:i});window.history.replaceState(null,"",`${window.location.pathname}?${e.toString()}`)}const ys=new Set;function ud(r,t,i){console.log("TranscriptionReceived RoomEvent");for(const s of r)console.log("TranscriptionSegment"),console.log(s),console.log(t),console.log(`[ Speaker: ${t==null?void 0:t.identity}, TranscriptionSegment id: ${s.id}, text: ${s.text}
    , language: ${s.language}, firstReceivedTime: ${s.firstReceivedTime}, lastReceivedTime: ${s.lastReceivedTime}
    , startTime: ${s.startTime}, endTime: ${s.endTime}, final: ${s.final}, error: ${s.error}, failureReason: ${s.failureReason} ]`);const e=G("live-transcription"),n=G("final-transcription"),a=(t==null?void 0:t.identity)||"Unknown";r.forEach(s=>{const u=new Date(s.lastReceivedTime),o=u.toLocaleDateString("en-US"),c=u.toLocaleTimeString("en-US",{hour12:!0}),l=`${o} ${c}`;if(s.final){const d=`${a}-${s.text.trim()}`;if(!ys.has(d)){ys.add(d);const h=document.createElement("div"),p=document.createElement("span");p.style.color="grey",p.textContent=l+" ";const g=document.createElement("span");g.style.fontWeight="bold",g.textContent=a+": ";const k=document.createElement("span");k.style.color="green",k.textContent=s.text,h.appendChild(p),h.appendChild(g),h.appendChild(k),n.appendChild(h)}const f=document.getElementById(`live-${a}`);f&&f.remove()}else{let d=document.getElementById(`live-${a}`);if(d){const f=document.getElementById(`live-timestamp-${a}`);f&&(f.textContent=l+" ");const h=document.getElementById(`live-message-${a}`);h&&h.textContent!==s.text&&(h.textContent=s.text)}else{d=document.createElement("div"),d.id=`live-${a}`;const f=document.createElement("span");f.id=`live-timestamp-${a}`,f.style.color="grey",f.textContent=l+" ";const h=document.createElement("span");h.style.fontWeight="bold",h.textContent=a+": ";const p=document.createElement("span");p.id=`live-message-${a}`,p.style.color="blue",p.textContent=s.text,d.appendChild(f),d.appendChild(h),d.appendChild(p),e.appendChild(d)}}}),e.scrollTop=e.scrollHeight,n.scrollTop=n.scrollHeight}const Yo={connectWithFormInput:async()=>{var g,k;const r=G("url").value,t=G("token").value,i=G("simulcast").checked,e=G("dynacast").checked,n=G("force-turn").checked,a=G("adaptive-stream").checked,s=G("publish-option").checked,u=G("preferred-codec").value;let o=Ve.h720.resolution;const c=G("preferred-quality").value,l=G("crypto-key").value,d=G("auto-subscribe").checked,f=G("audio-output").value;switch(dc(mi.debug),od(r,t,l),c){case"720":o=Ve.h720.resolution;break;case"540":o=Ve.h540.resolution;break}const h={adaptiveStream:a,dynacast:e,audioOutput:{deviceId:f},publishDefaults:{simulcast:i,videoSimulcastLayers:[Ve.h540,Ve.h720],videoCodec:u||"vp8",dtx:!0,red:!0,forceStereo:!1,screenShareEncoding:sr.h1080fps30.encoding,scalabilityMode:"L3T3_KEY"},videoCaptureDefaults:{resolution:o}};(((g=h.publishDefaults)==null?void 0:g.videoCodec)==="av1"||((k=h.publishDefaults)==null?void 0:k.videoCodec)==="vp9")&&(h.publishDefaults.backupCodec=!0);const p={autoSubscribe:d};n&&(p.rtcConfig={iceTransportPolicy:"relay"}),await Yo.connectToRoom(r,t,h,p,s),Oe.bitrateInterval=setInterval(md,1e3)},connectToRoom:async(r,t,i,e,n)=>{const a=new cr(i),{DenoiseProcessor:s}=await nu(async()=>{const{DenoiseProcessor:o}=await import("./index-1lKASwg9.js");return{DenoiseProcessor:o}},[]);on=Date.now(),await a.prepareConnection(r,t);const u=Date.now()-on;ie(`prewarmed connection in ${u}ms`),a.on(A.ParticipantConnected,wr).on(A.ParticipantDisconnected,ld).on(A.ChatMessage,cd).on(A.Disconnected,dd).on(A.Reconnecting,()=>ie("Reconnecting to room")).on(A.Reconnected,async()=>{ie("Successfully reconnected. server",await a.engine.getConnectedServerAddress())}).on(A.TranscriptionReceived,ud).on(A.LocalTrackPublished,async o=>{if(o.source===L.Source.Microphone&&o.track instanceof he){const l=new s({deepfilter:{enable:!0}});console.log("Enabling noise suppression for local audio track"),await o.track.setProcessor(l),await l.setEnabled(!0)}const c=o.track;if(c instanceof he){console.log("room recording is inprogress: "+a.isRecording);const{calculateVolume:l}=ul(c);setInterval(()=>{var d;(d=G("local-volume"))==null||d.setAttribute("value",l().toFixed(4))},200)}Le(a.localParticipant),$e(),Fn(a)}).on(A.LocalTrackUnpublished,()=>{Le(a.localParticipant),$e(),Fn(a)}).on(A.RoomMetadataChanged,o=>{ie("new metadata for room",o)}).on(A.MediaDevicesChanged,ka).on(A.AudioPlaybackStatusChanged,()=>{var o,c;a.canPlaybackAudio?(o=G("start-audio-button"))==null||o.setAttribute("disabled","true"):(c=G("start-audio-button"))==null||c.removeAttribute("disabled")}).on(A.MediaDevicesError,o=>{const c=It.getFailure(o);ie("media device failure",c)}).on(A.ConnectionQualityChanged,(o,c)=>{ie("connection quality changed",c==null?void 0:c.identity,o)}).on(A.TrackSubscribed,(o,c,l)=>{ie("subscribed to track",c.trackSid,l.identity),Le(l),Fn(a)}).on(A.TrackUnsubscribed,(o,c,l)=>{ie("unsubscribed from track",c.trackSid),Le(l),Fn(a)}).on(A.TrackUnpublished,(o,c)=>{ie("TrackUnpublished from track",o.trackSid),Le(c),Fn(a)}).on(A.SignalConnected,async()=>{const o=Date.now()-on;ie(`signal connection established in ${o}ms`),n&&(await a.localParticipant.enableCameraAndMicrophone(),ie(`tracks published in ${Date.now()-on}ms`),$e())}).on(A.ReconnectICEDelay,o=>{ie(`@ICE connection delay: ${o} seconds`)}).on(A.ParticipantEncryptionStatusChanged,()=>{$e()}).on(A.RecordingStatusChanged,o=>{console.log("room recording is inprogress: "+o)}).on(A.TrackStreamStateChanged,(o,c,l)=>{ie(`stream state changed for ${o.trackSid} (${l.identity}) to ${c.toString()}`)});try{const o=G("crypto-key").value;Oe.e2eeKeyProvider.setKey(o),G("e2ee").checked&&await a.setE2EEEnabled(!0),await a.connect(r,t,e);const c=Date.now()-on;ie(`successfully connected to ${a.name} in ${Math.round(c)}ms`,await a.engine.getConnectedServerAddress())}catch(o){let c=o;o.message&&(c=o.message),ie("could not connect:",c);return}return j=a,window.currentRoom=a,Zo(!0),$e(),a.remoteParticipants.forEach(o=>{wr(o)}),wr(a.localParticipant),a},toggleE2EE:async()=>{if(!j||!j.options.e2ee)return;const r=G("crypto-key").value;Oe.e2eeKeyProvider.setKey(r),await j.setE2EEEnabled(!j.isE2EEEnabled)},ratchetE2EEKey:async()=>{!j||!j.options.e2ee||await Oe.e2eeKeyProvider.ratchetKey()},toggleAudio:async()=>{if(!j)return;const r=j.localParticipant.isMicrophoneEnabled;Be("toggle-audio-button",!0),ie(r?"disabling audio":"enabling audio"),await j.localParticipant.setMicrophoneEnabled(!r),Be("toggle-audio-button",!1),$e()},toggleVideo:async()=>{if(!j)return;Be("toggle-video-button",!0);const r=j.localParticipant.isCameraEnabled;ie(r?"disabling video":"enabling video"),await j.localParticipant.setCameraEnabled(!r),Be("toggle-video-button",!1),Le(j.localParticipant),$e()},flipVideo:()=>{var i;const r=j==null?void 0:j.localParticipant.getTrackPublication(L.Source.Camera);if(!r)return;Oe.isFrontFacing?qn("flip-video-button","Front Camera",!1):qn("flip-video-button","Back Camera",!1),Oe.isFrontFacing=!Oe.isFrontFacing;const t={resolution:Ve.h720.resolution,facingMode:Oe.isFrontFacing?"user":"environment"};(i=r.videoTrack)==null||i.restartTrack(t)},shareScreen:async()=>{if(!j)return;const r=j.localParticipant.isScreenShareEnabled;ie(`${r?"stopping":"starting"} screen share`),Be("share-screen-button",!0);try{await j.localParticipant.setScreenShareEnabled(!r,{audio:!0})}catch(t){ie("error sharing screen",t)}Be("share-screen-button",!1),$e()},startAudio:()=>{j==null||j.startAudio()},enterText:()=>{var s;if(!j)return;const r=G("chat-error");if(r.style.display="none",!((s=j.localParticipant.permissions)!=null&&s.canPublishData)){const u=G("chat-error");u.innerHTML="You are not permitted to use Chat feature. Please contact admin.",u.style.display="block",u.style.color="red";return}const t=G("entry");var i=G("participant-list"),e=new Array,n,a=0;for(n=0;n<i.options.length;n++)i.options[n].selected&&(e[a]=i.options[n].value,a++);if(t.value){const u=Oe.encoder.encode(t.value);e.length>0&&!e.includes("everyone")?(ie("sending message to participant(s)",e),j.localParticipant.publishData(u,{reliable:!0,destinationIdentities:e,topic:"lk-chat-topic"})):(ie("sending message to all the participant"),j.localParticipant.publishData(u,{reliable:!0,topic:"lk-chat-topic"}));let o="Everyone";e.length>0&&!e.includes("Everyone")&&(e.length==1?j.remoteParticipants.forEach(l=>{l.sid==e[0]&&(o=l.name?l.name:l.identity)}):o="Specific Participants");const c=j.localParticipant.name?j.localParticipant.name:j.localParticipant.identity;G("chat").value+=`${c} (me) to ${o}: ${t.value}
`,t.value=""}},disconnectRoom:()=>{j&&j.disconnect(),Oe.bitrateInterval&&clearInterval(Oe.bitrateInterval)},handleScenario:r=>{const t=r.target.value;t==="subscribe-all"?j==null||j.remoteParticipants.forEach(i=>{i.trackPublications.forEach(e=>e.setSubscribed(!0))}):t==="unsubscribe-all"?j==null||j.remoteParticipants.forEach(i=>{i.trackPublications.forEach(e=>e.setSubscribed(!1))}):t!==""&&(j==null||j.simulateScenario(t),r.target.value="")},handleDeviceSelected:async r=>{const t=r.target.value,i=r.target.id,e=Zr[i];e&&(Oe.defaultDevices.set(e,t),j&&await j.switchActiveDevice(e,t))},handlePreferredQuality:r=>{const t=r.target.value;let i=we.HIGH;switch(t){case"low":i=we.LOW;break;case"medium":i=we.MEDIUM;break;case"high":i=we.HIGH;break}j&&j.remoteParticipants.forEach(e=>{e.trackPublications.forEach(n=>{n.setVideoQuality(i)})})},handlePreferredFPS:r=>{const t=+r.target.value;j&&j.remoteParticipants.forEach(i=>{i.trackPublications.forEach(e=>{e.setVideoFPS(t)})})}};window.appActions=Yo;function cd(r,t){G("chat").value+=`${t==null?void 0:t.identity}${t instanceof wn?" (me)":""}: ${r.message}
`}function wr(r){ie("participant",r.identity,"connected",r.metadata),console.log("tracks",r.trackPublications),r.on(F.TrackMuted,t=>{ie("track was muted",t.trackSid,r.identity),Le(r),$e()}).on(F.TrackUnmuted,t=>{ie("track was unmuted",t.trackSid,r.identity),Le(r),$e()}).on(F.IsSpeakingChanged,()=>{Le(r)}).on(F.ConnectionQualityChanged,()=>{Le(r)}).on(F.TranscriptionReceived,t=>{console.log("TranscriptionReceived ParticipantEvent:",t),t.forEach(i=>{console.log(`Speaker: ${r==null?void 0:r.identity}, Text: ${i.text}`)})}).on(F.ParticipantPermissionsChanged,(t,i)=>{r instanceof wn&&(i!=null&&i.canPublish?(Be("toggle-audio-button",!1),Be("toggle-video-button",!1)):(Be("toggle-audio-button",!0),Be("toggle-video-button",!0)),console.log(t),console.log(i))}),fd(r)}function ld(r){ie("participant",r.sid,"disconnected"),Le(r,!0),hd(r)}function dd(r){if(!j)return;ie("disconnected from room",{reason:r}),Zo(!1),Le(j.localParticipant,!0),j.remoteParticipants.forEach(a=>{Le(a,!0)}),Fn(j);const t=G("participants-area");t&&(t.innerHTML="");const i=G("chat");i.value="";const e=G("participant-list");let n=e.options.length;for(;n--;)e.options[n].value!="everyone"&&e.remove(n);j=void 0,window.currentRoom=void 0}function ie(...r){const t=G("log");for(let i=0;i<arguments.length;i+=1)typeof r[i]=="object"?t.innerHTML+=`${JSON&&JSON.stringify?JSON.stringify(r[i],void 0,2):r[i]} `:t.innerHTML+=`${r[i]} `;t.innerHTML+=`
`,t.scrollTop=t.scrollHeight}function Le(r,t=!1){var p,g,k,y;const i=G("participants-area");if(!i)return;const{identity:e}=r;let n=G(`participant-${e}`);if(!n&&!t){n=document.createElement("div"),n.id=`participant-${e}`,n.className="participant",n.innerHTML=`
      <video id="video-${e}"></video>
      <audio id="audio-${e}"></audio>
      <div class="info-bar">
        <div id="name-${e}" class="name">
        </div>
        <div style="text-align: center;">
          <span id="codec-${e}" class="codec">
          </span>
          <span id="size-${e}" class="size">
          </span>
          <span id="bitrate-${e}" class="bitrate">
          </span>
        </div>
        <div class="right">
          <span id="signal-${e}"></span>
          <span id="mic-${e}" class="mic-on"></span>
          <span id="e2ee-${e}" class="e2ee-on"></span>
        </div>
      </div>
      ${r instanceof ki?`<div class="volume-control">
        <input id="volume-${e}" type="range" min="0" max="1" step="0.1" value="1" orient="vertical" />
      </div>`:'<progress id="local-volume" max="1" value="0" />'}

    `,i.appendChild(n);const S=G(`size-${e}`),T=G(`video-${e}`);T.onresize=()=>{Xo(T,S)}}const a=G(`video-${e}`),s=G(`audio-${e}`);if(t){n==null||n.remove(),a&&(a.srcObject=null,a.src=""),s&&(s.srcObject=null,s.src="");return}G(`name-${e}`).innerHTML=r.identity,r instanceof wn&&(G(`name-${e}`).innerHTML+=" (you)");const u=G(`mic-${e}`),o=G(`signal-${e}`),c=r.getTrackPublication(L.Source.Camera),l=r.getTrackPublication(L.Source.Microphone);if(r.isSpeaking?n.classList.add("speaking"):n.classList.remove("speaking"),r instanceof ki&&G(`volume-${e}`).addEventListener("input",T=>{r.setVolume(Number.parseFloat(T.target.value))}),c&&c.isSubscribed&&!c.isMuted){if(r instanceof wn)a.style.transform="scale(-1, 1)";else if(!((p=c==null?void 0:c.videoTrack)!=null&&p.attachedElements.includes(a))){const S=Date.now();a.onloadeddata=()=>{const T=Date.now()-S;let C=0;r.joinedAt&&r.joinedAt.getTime()<on&&(C=Date.now()-on),ie(`RemoteVideoTrack ${c==null?void 0:c.trackSid} (${a.videoWidth}x${a.videoHeight}) rendered in ${T}ms`,C>0?`, ${C}ms from start`:"")}}(g=c==null?void 0:c.videoTrack)==null||g.attach(a)}else G(`size-${e}`).innerHTML="",c!=null&&c.videoTrack?(k=c.videoTrack)==null||k.detach(a):(a.src="",a.srcObject=null);l&&l.isSubscribed&&!l.isMuted?(r instanceof wn||(s.onloadeddata=()=>{if(r.joinedAt&&r.joinedAt.getTime()<on){const S=Date.now()-on;ie(`RemoteAudioTrack ${l==null?void 0:l.trackSid} played ${S}ms from start`)}},(y=l==null?void 0:l.audioTrack)==null||y.attach(s)),u.className="mic-on",u.innerHTML='<i class="fas fa-microphone"></i>'):(u.className="mic-off",u.innerHTML='<i class="fas fa-microphone-slash"></i>');const h=G(`e2ee-${e}`);switch(r.isEncrypted?(h.className="e2ee-on",h.innerHTML='<i class="fas fa-lock"></i>'):(h.className="e2ee-off",h.innerHTML='<i class="fas fa-unlock"></i>'),r.connectionQuality){case He.Excellent:case He.Good:case He.Poor:o.className=`connection-${r.connectionQuality}`,o.innerHTML='<i class="fas fa-circle"></i>';break;default:o.innerHTML=""}}function fd(r){if(!j||j.state!==ee.Connected)return;const t=G("participant-list");if(r!=(j==null?void 0:j.localParticipant)){const i=document.createElement("option");r.name?i.text=r.name:i.text=r.identity,i.value=r.sid,t.appendChild(i)}}function hd(r){if(!j||j.state!==ee.Connected)return;const t=G("participant-list");if(r!=(j==null?void 0:j.localParticipant)){let i=t.options.length;for(;i--;)t.options[i].value==r.sid&&t.remove(i)}}function Fn(r){var a,s;const t=G("screenshare-area");if(r.state!==ee.Connected){t.style.display="none";return}let i,e=r.localParticipant.getTrackPublication(L.Source.ScreenShare),n;if(e?i=r.localParticipant:r.remoteParticipants.forEach(u=>{if(e)return;i=u;const o=u.getTrackPublication(L.Source.ScreenShare);o!=null&&o.isSubscribed&&(e=o);const c=u.getTrackPublication(L.Source.ScreenShareAudio);c!=null&&c.isSubscribed&&(n=c)}),e&&i){t.style.display="block";const u=G("screenshare-video");(a=e.videoTrack)==null||a.attach(u),n&&((s=n.audioTrack)==null||s.attach(u)),console.log("Outside onresize"),console.log(u.videoWidth+":"+u.videoHeight),u.onwaiting=()=>{console.log("Inside onwaiting"),o.innerHTML="Waiting for the good signal... If the issue persists for long, please refresh the browser to reconnect to the room."},u.onresize=()=>{console.log("Inside onresize"),console.log(u.videoWidth+":"+u.videoHeight),Xo(u,G("screenshare-resolution"))},u.onplaying=()=>{console.log("Inside onplay"),i?o.innerHTML=`Screenshare from ${i.identity}`:o.innerHTML="Screenshare from unknown participant"};const o=G("screenshare-info");i?o.innerHTML=`Screenshare from ${i.identity}`:o.innerHTML="Screenshare from unknown participant"}else t.style.display="none"}function md(){if(!j||j.state!==ee.Connected)return;const r=[...j.remoteParticipants.values()];r.push(j.localParticipant);for(const t of r){const i=G(`bitrate-${t.identity}`);let e=0;for(const a of t.trackPublications.values())if(a.track&&(e+=a.track.currentBitrate),a.source===L.Source.Camera&&a.videoTrack instanceof Kn){const s=G(`codec-${t.identity}`);s.innerHTML=a.videoTrack.getDecoderImplementation()??""}let n="";e>0&&(n=`${Math.round(e/1024).toLocaleString()} kbps`),i&&(i.innerHTML=n)}}function Xo(r,t){t.innerHTML=`(${r.videoWidth}x${r.videoHeight})`}function qn(r,t,i,e=void 0){const n=G(r);n&&(e!==void 0&&(n.disabled=e),n.innerHTML=t,i?n.classList.add("active"):n.classList.remove("active"))}function Be(r,t){const i=G(r);i.disabled=t}setTimeout(ka,100);function Zo(r){const t=["toggle-video-button","toggle-audio-button","share-screen-button","disconnect-ws-button","disconnect-room-button","flip-video-button","send-button"];j&&j.options.e2ee&&t.push("toggle-e2ee-button","e2ee-ratchet-button");const i=["connect-button"],e=r?t:i,n=r?i:t;e.forEach(a=>{var s;return(s=G(a))==null?void 0:s.removeAttribute("disabled")}),n.forEach(a=>{var s;return(s=G(a))==null?void 0:s.setAttribute("disabled","true")})}const Zr={"video-input":"videoinput","audio-input":"audioinput","audio-output":"audiooutput"};async function ka(){Promise.all(Object.keys(Zr).map(async r=>{const t=Zr[r];if(!t)return;const i=await cr.getLocalDevices(t),e=G(r);vd(e,i,Oe.defaultDevices.get(t))}))}function vd(r,t,i){for(const e of t){const n=document.createElement("option");n.text=e.label,n.value=e.deviceId,e.deviceId===i&&(n.selected=!0)}}function $e(){if(!j)return;const r=j.localParticipant;qn("toggle-video-button",`${r.isCameraEnabled?"Disable":"Enable"} Video`,r.isCameraEnabled),qn("toggle-audio-button",`${r.isMicrophoneEnabled?"Disable":"Enable"} Audio`,r.isMicrophoneEnabled),qn("share-screen-button",r.isScreenShareEnabled?"Stop Screen Share":"Share Screen",r.isScreenShareEnabled),qn("toggle-e2ee-button",`${j.isE2EEEnabled?"Disable":"Enable"} E2EE`,j.isE2EEEnabled),Be("toggle-audio-button",!1),Be("toggle-video-button",!1)}async function pd(){ka()}function gd(){const r=G("preferred-codec"),t=[["","Preferred codec"],["h264","H.264"],["vp8","VP8"]];Do()&&t.push(["vp9","VP9"]),No()&&t.push(["av1","AV1"]);for(const i of t){const e=document.createElement("option");e.value=i[0],e.appendChild(document.createTextNode(i[1])),r.appendChild(e)}}pd();gd();
